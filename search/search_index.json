{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"SD\u8bad\u7ec3\u5408\u96c6\u6587\u6863 \u6b22\u8fce\u6765\u5230SD\u8bad\u7ec3\u5408\u96c6\u6587\u6863\uff01\u672c\u7ad9\u70b9\u63d0\u4f9b\u4e86\u5168\u9762\u7684Stable Diffusion\u6a21\u578b\u8bad\u7ec3\u8d44\u6e90\u548c\u6307\u5357\u3002 \u6587\u6863\u5185\u5bb9 SD-Scripts-Docs \u90e8\u5206 \u6b64\u90e8\u5206\u5185\u5bb9\u662f\u7531 sd-scripts \u5b98\u65b9\u4ed3\u5e93\u6574\u7406\u7ffb\u8bd1\u7684\u4e2d\u6587\u6587\u6863\u3002 ALLDocs \u90e8\u5206 \u6b64\u90e8\u5206\u5305\u542b\u4e86\u4e00\u7cfb\u5217\u5b9e\u7528\u6559\u7a0b\uff0c\u5206\u4e3a\u4ee5\u4e0b\u4e24\u7c7b\uff1a \u5df2\u9a8c\u8bc1\u6559\u7a0b \uff1a\u7ecf\u8fc7\u5b9e\u9645\u6d4b\u8bd5\u5e76\u786e\u8ba4\u6709\u6548\u7684\u65b9\u6cd5\u548c\u6d41\u7a0b\uff0c\u53ef\u76f4\u63a5\u5e94\u7528\u4e8e\u60a8\u7684\u9879\u76ee\u4e2d \u7406\u8bba\u63a2\u7d22 \uff1a\u57fa\u4e8e\u7406\u8bba\u5206\u6790\u4f46\u5c1a\u672a\u5b8c\u5168\u9a8c\u8bc1\u7684\u5185\u5bb9\u548c\u731c\u60f3\uff0c\u4e3a\u8fdb\u9636\u7528\u6237\u63d0\u4f9b\u7814\u7a76\u65b9\u5411 \u793e\u533a\u8d21\u732e \u6211\u4eec\u975e\u5e38\u6b22\u8fce\u793e\u533a\u6210\u5458\u8d21\u732e\u81ea\u5df1\u7684\u7ecf\u9a8c\u548c\u77e5\u8bc6\uff01\u5982\u679c\u60a8\u6709\u5173\u4e8eSD-Scripts\u7684\u6559\u7a0b\u3001\u6280\u5de7\u6216\u53d1\u73b0\uff0c\u8bf7\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u6295\u7a3f\uff1a \u5728GitHub\u4e0a\u63d0\u4ea4Pull Request \u60a8\u7684\u8d21\u732e\u5c06\u5e2e\u52a9\u66f4\u591a\u4e2d\u6587\u7528\u6237\u66f4\u597d\u7684\u7ec3\u51fa\u60f3\u8981\u7684\u6a21\u578b\uff0c\u5171\u540c\u4fc3\u8fdbAI\u7ed8\u753b\u793e\u533a\u7684\u53d1\u5c55\u3002","title":"Home"},{"location":"#sd","text":"\u6b22\u8fce\u6765\u5230SD\u8bad\u7ec3\u5408\u96c6\u6587\u6863\uff01\u672c\u7ad9\u70b9\u63d0\u4f9b\u4e86\u5168\u9762\u7684Stable Diffusion\u6a21\u578b\u8bad\u7ec3\u8d44\u6e90\u548c\u6307\u5357\u3002","title":"SD\u8bad\u7ec3\u5408\u96c6\u6587\u6863"},{"location":"#_1","text":"","title":"\u6587\u6863\u5185\u5bb9"},{"location":"#sd-scripts-docs","text":"\u6b64\u90e8\u5206\u5185\u5bb9\u662f\u7531 sd-scripts \u5b98\u65b9\u4ed3\u5e93\u6574\u7406\u7ffb\u8bd1\u7684\u4e2d\u6587\u6587\u6863\u3002","title":"SD-Scripts-Docs \u90e8\u5206"},{"location":"#alldocs","text":"\u6b64\u90e8\u5206\u5305\u542b\u4e86\u4e00\u7cfb\u5217\u5b9e\u7528\u6559\u7a0b\uff0c\u5206\u4e3a\u4ee5\u4e0b\u4e24\u7c7b\uff1a \u5df2\u9a8c\u8bc1\u6559\u7a0b \uff1a\u7ecf\u8fc7\u5b9e\u9645\u6d4b\u8bd5\u5e76\u786e\u8ba4\u6709\u6548\u7684\u65b9\u6cd5\u548c\u6d41\u7a0b\uff0c\u53ef\u76f4\u63a5\u5e94\u7528\u4e8e\u60a8\u7684\u9879\u76ee\u4e2d \u7406\u8bba\u63a2\u7d22 \uff1a\u57fa\u4e8e\u7406\u8bba\u5206\u6790\u4f46\u5c1a\u672a\u5b8c\u5168\u9a8c\u8bc1\u7684\u5185\u5bb9\u548c\u731c\u60f3\uff0c\u4e3a\u8fdb\u9636\u7528\u6237\u63d0\u4f9b\u7814\u7a76\u65b9\u5411","title":"ALLDocs \u90e8\u5206"},{"location":"#_2","text":"\u6211\u4eec\u975e\u5e38\u6b22\u8fce\u793e\u533a\u6210\u5458\u8d21\u732e\u81ea\u5df1\u7684\u7ecf\u9a8c\u548c\u77e5\u8bc6\uff01\u5982\u679c\u60a8\u6709\u5173\u4e8eSD-Scripts\u7684\u6559\u7a0b\u3001\u6280\u5de7\u6216\u53d1\u73b0\uff0c\u8bf7\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u6295\u7a3f\uff1a \u5728GitHub\u4e0a\u63d0\u4ea4Pull Request \u60a8\u7684\u8d21\u732e\u5c06\u5e2e\u52a9\u66f4\u591a\u4e2d\u6587\u7528\u6237\u66f4\u597d\u7684\u7ec3\u51fa\u60f3\u8981\u7684\u6a21\u578b\uff0c\u5171\u540c\u4fc3\u8fdbAI\u7ed8\u753b\u793e\u533a\u7684\u53d1\u5c55\u3002","title":"\u793e\u533a\u8d21\u732e"},{"location":"404/","text":"","title":"404"},{"location":"sd-scripts-docs/config/","text":"\u672c\u6587\u6863\u4ecb\u7ecd\u4e86\u53ef\u4ee5\u901a\u8fc7 --dataset_config \u4f20\u9012\u7684\u914d\u7f6e\u6587\u4ef6\u3002 \u6982\u8981 \u901a\u8fc7\u4f20\u9012\u914d\u7f6e\u6587\u4ef6\uff0c\u7528\u6237\u53ef\u4ee5\u8fdb\u884c\u66f4\u7ec6\u81f4\u7684\u8bbe\u7f6e\u3002 \u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\u6570\u636e\u96c6 \u4f8b\u5982\uff0c\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u6570\u636e\u96c6\u8bbe\u7f6e\u4e0d\u540c\u7684 resolution \uff0c\u5e76\u6df7\u5408\u4f7f\u7528\u5b83\u4eec\u8fdb\u884c\u8bad\u7ec3\u3002 \u5bf9\u4e8e\u652f\u6301DreamBooth\u548cfine-tuning\u4e24\u79cd\u8bad\u7ec3\u65b9\u6cd5\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u6df7\u5408\u4f7f\u7528\u8fd9\u4e24\u79cd\u65b9\u5f0f\u7684\u6570\u636e\u96c6\u3002 \u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u5b50\u96c6\u8bbe\u7f6e\u4e0d\u540c\u7684\u9009\u9879 \u5b50\u96c6\u662f\u6307\u5c06\u6570\u636e\u96c6\u6309\u56fe\u50cf\u76ee\u5f55\u6216\u5143\u6570\u636e\u5206\u5272\u540e\u7684\u90e8\u5206\u3002\u591a\u4e2a\u5b50\u96c6\u7ec4\u6210\u4e00\u4e2a\u6570\u636e\u96c6\u3002 \u50cf keep_tokens \u548c flip_aug \u8fd9\u6837\u7684\u9009\u9879\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u5b50\u96c6\u5355\u72ec\u8bbe\u7f6e\u3002\u800c\u50cf resolution \u548c batch_size \u8fd9\u6837\u7684\u9009\u9879\u5219\u662f\u9488\u5bf9\u6574\u4e2a\u6570\u636e\u96c6\u7684\uff0c\u5bf9\u4e8e\u5c5e\u4e8e\u540c\u4e00\u6570\u636e\u96c6\u7684\u5b50\u96c6\uff0c\u8fd9\u4e9b\u9009\u9879\u7684\u503c\u662f\u76f8\u540c\u7684\u3002\u5177\u4f53\u7ec6\u8282\u5c06\u5728\u540e\u6587\u4e2d\u8bf4\u660e\u3002 \u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u4f7f\u7528JSON\u6216TOML\u683c\u5f0f\u3002\u8003\u8651\u5230\u6613\u8bfb\u6027\uff0c\u63a8\u8350\u4f7f\u7528 TOML \u3002\u4ee5\u4e0b\u8bf4\u660e\u5c06\u57fa\u4e8eTOML\u683c\u5f0f\u3002 \u4e0b\u9762\u662f\u4e00\u4e2aTOML\u914d\u7f6e\u6587\u4ef6\u7684\u4f8b\u5b50\uff1a [general] shuffle_caption = true caption_extension = '.txt' keep_tokens = 1 # \u8fd9\u662f\u4e00\u4e2aDreamBooth\u65b9\u5f0f\u7684\u6570\u636e\u96c6 [[datasets]] resolution = 512 batch_size = 4 keep_tokens = 2 [[datasets.subsets]] image_dir = 'C:\\hoge' class_tokens = 'hoge girl' # \u8fd9\u4e2a\u5b50\u96c6\u7684keep_tokens = 2\uff08\u4f7f\u7528\u6240\u5c5edatasets\u7684\u503c\uff09 [[datasets.subsets]] image_dir = 'C:\\fuga' class_tokens = 'fuga boy' keep_tokens = 3 [[datasets.subsets]] is_reg = true image_dir = 'C:\\reg' class_tokens = 'human' keep_tokens = 1 # \u8fd9\u662f\u4e00\u4e2afine-tuning\u65b9\u5f0f\u7684\u6570\u636e\u96c6 [[datasets]] resolution = [768, 768] batch_size = 2 [[datasets.subsets]] image_dir = 'C:\\piyo' metadata_file = 'C:\\piyo\\piyo_md.json' # \u8fd9\u4e2a\u5b50\u96c6\u7684keep_tokens = 1\uff08\u4f7f\u7528general\u7684\u503c\uff09 \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u4e09\u4e2a\u76ee\u5f55\u5c06\u4ee5512x512\uff08batch size 4\uff09\u7684\u5206\u8fa8\u7387\u4f7f\u7528DreamBooth\u65b9\u5f0f\u8fdb\u884c\u8bad\u7ec3\uff0c\u800c\u4e00\u4e2a\u76ee\u5f55\u5c06\u4ee5768x768\uff08batch size 2\uff09\u7684\u5206\u8fa8\u7387\u4f7f\u7528fine-tuning\u65b9\u5f0f\u8fdb\u884c\u8bad\u7ec3\u3002 \u6570\u636e\u96c6\u548c\u5b50\u96c6\u7684\u8bbe\u7f6e \u6570\u636e\u96c6\u548c\u5b50\u96c6\u7684\u8bbe\u7f6e\u53ef\u4ee5\u5728\u591a\u4e2a\u5730\u65b9\u8fdb\u884c\u914d\u7f6e\u3002 [general] \u8fd9\u91cc\u6307\u5b9a\u9002\u7528\u4e8e\u6240\u6709\u6570\u636e\u96c6\u6216\u6240\u6709\u5b50\u96c6\u7684\u9009\u9879\u3002 \u5982\u679c\u5728\u6570\u636e\u96c6\u6216\u5b50\u96c6\u7684\u8bbe\u7f6e\u4e2d\u5b58\u5728\u540c\u540d\u7684\u9009\u9879\uff0c\u5219\u6570\u636e\u96c6\u6216\u5b50\u96c6\u7684\u8bbe\u7f6e\u5c06\u4f18\u5148\u3002 [[datasets]] datasets \u662f\u7528\u4e8e\u6ce8\u518c\u6570\u636e\u96c6\u8bbe\u7f6e\u7684\u90e8\u5206\u3002\u8fd9\u91cc\u6307\u5b9a\u9002\u7528\u4e8e\u5404\u4e2a\u6570\u636e\u96c6\u7684\u9009\u9879\u3002 \u5982\u679c\u5b50\u96c6\u4e2d\u5b58\u5728\u540c\u540d\u7684\u9009\u9879\uff0c\u5219\u5b50\u96c6\u7684\u8bbe\u7f6e\u5c06\u4f18\u5148\u3002 [[datasets.subsets]] datasets.subsets \u662f\u7528\u4e8e\u6ce8\u518c\u5b50\u96c6\u8bbe\u7f6e\u7684\u90e8\u5206\u3002\u8fd9\u91cc\u6307\u5b9a\u9002\u7528\u4e8e\u5404\u4e2a\u5b50\u96c6\u7684\u9009\u9879\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u5173\u4e8e\u56fe\u50cf\u76ee\u5f55\u548c\u6ce8\u518c\u4f4d\u7f6e\u5bf9\u5e94\u5173\u7cfb\u7684\u793a\u610f\u56fe\uff0c\u57fa\u4e8e\u524d\u9762\u7684\u4f8b\u5b50\uff1a C:\\ \u251c\u2500 hoge -> [[datasets.subsets]] No.1 \u2510 \u2510 \u251c\u2500 fuga -> [[datasets.subsets]] No.2 |-> [[datasets]] No.1 |-> [general] \u251c\u2500 reg -> [[datasets.subsets]] No.3 \u2518 | \u2514\u2500 piyo -> [[datasets.subsets]] No.4 --> [[datasets]] No.2 \u2518 \u6bcf\u4e2a\u56fe\u50cf\u76ee\u5f55\u5bf9\u5e94\u4e00\u4e2a [[datasets.subsets]] \u3002\u591a\u4e2a [[datasets.subsets]] \u7ec4\u5408\u6210\u4e00\u4e2a [[datasets]] \u3002\u6240\u6709 [[datasets]] \u548c [[datasets.subsets]] \u90fd\u5c5e\u4e8e [general] \u3002 \u4e0d\u540c\u6ce8\u518c\u4f4d\u7f6e\u53ef\u4ee5\u6307\u5b9a\u7684\u9009\u9879\u4e0d\u540c\u3002\u5982\u679c\u5b58\u5728\u540c\u540d\u7684\u9009\u9879\uff0c\u5219\u8f83\u4f4e\u7ea7\u522b\u7684\u6ce8\u518c\u4f4d\u7f6e\u7684\u503c\u5c06\u4f18\u5148\u3002\u67e5\u770b\u524d\u9762\u7684\u4f8b\u5b50\u4e2d keep_tokens \u9009\u9879\u7684\u5904\u7406\u65b9\u5f0f\u53ef\u4ee5\u5e2e\u52a9\u7406\u89e3\u8fd9\u4e00\u70b9\u3002 \u6b64\u5916\uff0c\u53ef\u7528\u7684\u9009\u9879\u8fd8\u4f1a\u6839\u636e\u8bad\u7ec3\u65b9\u6cd5\u652f\u6301\u7684\u9009\u9879\u800c\u6709\u6240\u4e0d\u540c\u3002 \u4ec5\u9002\u7528\u4e8eDreamBooth\u65b9\u5f0f\u7684\u9009\u9879 \u4ec5\u9002\u7528\u4e8efine-tuning\u65b9\u5f0f\u7684\u9009\u9879 \u5982\u679c\u652f\u6301caption dropout\uff0c\u5219\u53ef\u7528\u7684\u9009\u9879 \u5bf9\u4e8e\u540c\u65f6\u652f\u6301DreamBooth\u548cfine-tuning\u7684\u8bad\u7ec3\u65b9\u6cd5\uff0c\u53ef\u4ee5\u6df7\u5408\u4f7f\u7528\u8fd9\u4e24\u79cd\u65b9\u5f0f\u3002\u4f46\u662f\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u540c\u4e00\u4e2a\u6570\u636e\u96c6\u4e2d\uff0c\u4e0d\u80fd\u6df7\u5408\u4f7f\u7528DreamBooth\u548cfine-tuning\u65b9\u5f0f\u7684\u5b50\u96c6\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u8981\u6df7\u5408\u4f7f\u7528\u8fd9\u4e24\u79cd\u65b9\u5f0f\uff0c\u9700\u8981\u5c06\u5b83\u4eec\u8bbe\u7f6e\u4e3a\u4e0d\u540c\u7684\u6570\u636e\u96c6\u3002 \u7a0b\u5e8f\u7684\u884c\u4e3a\u662f\uff0c\u5982\u679c\u5b58\u5728 metadata_file \u9009\u9879\uff0c\u5219\u5224\u65ad\u4e3afine-tuning\u65b9\u5f0f\u7684\u5b50\u96c6\u3002\u56e0\u6b64\uff0c\u5bf9\u4e8e\u5c5e\u4e8e\u540c\u4e00\u6570\u636e\u96c6\u7684\u5b50\u96c6\uff0c\u8981\u4e48\u5168\u90e8\u5177\u6709 metadata_file \u9009\u9879\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u5177\u6709\u8be5\u9009\u9879\u3002 \u4e0b\u9762\u4ecb\u7ecd\u53ef\u7528\u7684\u9009\u9879\u3002\u5bf9\u4e8e\u4e0e\u547d\u4ee4\u884c\u53c2\u6570\u540d\u79f0\u76f8\u540c\u7684\u9009\u9879\uff0c\u901a\u5e38\u4e0d\u518d\u91cd\u590d\u8bf4\u660e\u3002\u8bf7\u53c2\u8003\u5176\u4ed6README\u6587\u4ef6\u3002 \u6240\u6709\u8bad\u7ec3\u65b9\u6cd5\u5171\u901a\u7684\u9009\u9879 \u8fd9\u4e9b\u9009\u9879\u4e0e\u8bad\u7ec3\u65b9\u6cd5\u65e0\u5173\u3002 \u6570\u636e\u96c6\u9009\u9879 \u8fd9\u4e9b\u9009\u9879\u4e0e\u6570\u636e\u96c6\u7684\u8bbe\u7f6e\u76f8\u5173\uff0c\u4e0d\u80fd\u5728 datasets.subsets \u4e2d\u6307\u5b9a\u3002 \u9009\u9879\u540d \u8bbe\u7f6e\u793a\u4f8b [general] [[datasets]] batch_size 1 o o bucket_no_upscale true o o bucket_reso_steps 64 o o enable_bucket true o o max_bucket_reso 1024 o o min_bucket_reso 128 o o resolution 256 , [512, 512] o o batch_size \u4e0e\u547d\u4ee4\u884c\u53c2\u6570 --train_batch_size \u7b49\u6548\u3002 max_bucket_reso , min_bucket_reso \u6307\u5b9abucket\u7684\u6700\u5927\u548c\u6700\u5c0f\u5206\u8fa8\u7387\u3002\u5fc5\u987b\u80fd\u88ab bucket_reso_steps \u6574\u9664\u3002 \u8fd9\u4e9b\u8bbe\u7f6e\u5bf9\u4e8e\u6570\u636e\u96c6\u662f\u56fa\u5b9a\u7684\u3002\u56e0\u6b64\uff0c\u5c5e\u4e8e\u540c\u4e00\u6570\u636e\u96c6\u7684\u5b50\u96c6\u5c06\u5171\u4eab\u8fd9\u4e9b\u8bbe\u7f6e\u3002\u4f8b\u5982\uff0c\u5982\u679c\u8981\u4f7f\u7528\u4e0d\u540c\u5206\u8fa8\u7387\u7684\u6570\u636e\u96c6\uff0c\u53ef\u4ee5\u50cf\u4e0a\u9762\u7684\u4f8b\u5b50\u4e00\u6837\uff0c\u5c06\u5b83\u4eec\u5b9a\u4e49\u4e3a\u4e0d\u540c\u7684\u6570\u636e\u96c6\u3002 \u5b50\u96c6\u9009\u9879 \u8fd9\u4e9b\u9009\u9879\u4e0e\u5b50\u96c6\u7684\u8bbe\u7f6e\u76f8\u5173\u3002 \u9009\u9879\u540d \u8bbe\u7f6e\u793a\u4f8b [general] [[datasets]] [[dataset.subsets]] color_aug false o o o face_crop_aug_range [1.0, 3.0] o o o flip_aug true o o o keep_tokens 2 o o o num_repeats 10 o o o random_crop false o o o shuffle_caption true o o o caption_prefix \u201cmasterpiece, best quality, \u201d o o o caption_suffix \u201c, from side\u201d o o o caption_separator \uff08\u901a\u5e38\u4e0d\u8bbe\u7f6e\uff09 o o o keep_tokens_separator \u201c|||\u201d o o o secondary_separator \u201c;;;\u201d o o o enable_wildcard true o o o resize_interpolation \uff08\u901a\u5e38\u4e0d\u8bbe\u7f6e\uff09 o o o num_repeats \u6307\u5b9a\u5b50\u96c6\u4e2d\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570\u3002\u76f8\u5f53\u4e8efine-tuning\u4e2d\u7684 --dataset_repeats \uff0c\u4f46 num_repeats \u53ef\u7528\u4e8e\u4efb\u4f55\u8bad\u7ec3\u65b9\u6cd5\u3002 caption_prefix , caption_suffix \u6307\u5b9a\u5728\u6807\u9898\u524d\u540e\u6dfb\u52a0\u7684\u5b57\u7b26\u4e32\u3002shuffle\u64cd\u4f5c\u5c06\u5728\u6dfb\u52a0\u8fd9\u4e9b\u5b57\u7b26\u4e32\u540e\u8fdb\u884c\u3002\u5982\u679c\u8bbe\u7f6e\u4e86 keep_tokens \uff0c\u8bf7\u6ce8\u610f\u8fd9\u4e00\u70b9\u3002 caption_separator \u6307\u5b9a\u7528\u4e8e\u5206\u9694\u6807\u7b7e\u7684\u5b57\u7b26\u4e32\u3002\u9ed8\u8ba4\u4e3a , \u3002\u901a\u5e38\u4e0d\u9700\u8981\u8bbe\u7f6e\u6b64\u9009\u9879\u3002 keep_tokens_separator \u6307\u5b9a\u7528\u4e8e\u5206\u9694\u6807\u9898\u4e2d\u8981\u4fdd\u7559\u90e8\u5206\u7684\u5b57\u7b26\u3002\u4f8b\u5982\uff0c aaa, bbb ||| ccc, ddd, eee, fff ||| ggg, hhh \u5c06\u4fdd\u7559 aaa, bbb \u548c ggg, hhh \u90e8\u5206\uff0c\u4e0d\u4f1a\u88abshuffle\u6216drop\u3002\u4e2d\u95f4\u7684\u9017\u53f7\u662f\u53ef\u9009\u7684\u3002\u7ed3\u679c\u53ef\u80fd\u662f aaa, bbb, eee, ccc, fff, ggg, hhh \u6216 aaa, bbb, fff, ccc, eee, ggg, hhh \u7b49\u3002 secondary_separator \u6307\u5b9a\u989d\u5916\u7684\u5206\u9694\u7b26\u3002\u7531\u6b64\u5206\u9694\u7684\u90e8\u5206\u5c06\u88ab\u89c6\u4e3a\u4e00\u4e2a\u6807\u7b7e\uff0c\u8fdb\u884cshuffle\u548cdrop\uff0c\u7136\u540e\u66ff\u6362\u4e3a caption_separator \u3002\u4f8b\u5982\uff0c aaa;;;bbb;;;ccc \u5c06\u88ab\u66ff\u6362\u4e3a aaa,bbb,ccc \uff0c\u6216\u8005\u4e00\u8d77\u88abdrop\u3002 enable_wildcard \u542f\u7528\u901a\u914d\u7b26\u8868\u793a\u6cd5\u548c\u591a\u884c\u6807\u9898\u3002\u901a\u914d\u7b26\u8868\u793a\u6cd5\u548c\u591a\u884c\u6807\u9898\u5c06\u5728\u540e\u9762\u8bf4\u660e\u3002 resize_interpolation \u6307\u5b9a\u56fe\u50cf\u7f29\u653e\u65f6\u4f7f\u7528\u7684\u63d2\u503c\u65b9\u6cd5\u3002\u901a\u5e38\u4e0d\u9700\u8981\u8bbe\u7f6e\u3002\u5982\u679c\u6307\u5b9a\u4e86\uff0c\u5219\u5c06\u4f7f\u7528\u76f8\u540c\u7684\u63d2\u503c\u65b9\u6cd5\u8fdb\u884c\u653e\u5927\u548c\u7f29\u5c0f\u3002\u53ef\u4ee5\u6307\u5b9a\u7684\u503c\u6709 lanczos , nearest , bilinear , linear , bicubic , cubic , area , box \u3002\u9ed8\u8ba4\uff08\u672a\u6307\u5b9a\u65f6\uff09\u4e3a\u7f29\u5c0f\u65f6\u4f7f\u7528 area \uff0c\u653e\u5927\u65f6\u4f7f\u7528 lanczos \u3002\u5982\u679c\u6307\u5b9a\u4e86\u6b64\u9009\u9879\uff0c\u5219\u5c06\u4f7f\u7528\u76f8\u540c\u7684\u63d2\u503c\u65b9\u6cd5\u8fdb\u884c\u653e\u5927\u548c\u7f29\u5c0f\u3002\u6307\u5b9a lanczos \u6216 box \u65f6\u5c06\u4f7f\u7528PIL\uff0c\u5176\u4ed6\u503c\u5c06\u4f7f\u7528OpenCV\u3002 \u4ec5\u9002\u7528\u4e8eDreamBooth\u65b9\u5f0f\u7684\u9009\u9879 DreamBooth\u65b9\u5f0f\u7684\u9009\u9879\u4ec5\u5b58\u5728\u4e8e\u5b50\u96c6\u9009\u9879\u4e2d\u3002 \u5b50\u96c6\u9009\u9879 \u8fd9\u4e9b\u9009\u9879\u4e0eDreamBooth\u65b9\u5f0f\u7684\u5b50\u96c6\u8bbe\u7f6e\u76f8\u5173\u3002 \u9009\u9879\u540d \u8bbe\u7f6e\u793a\u4f8b [general] [[datasets]] [[dataset.subsets]] image_dir \u2018C:\\hoge\u2019 - - o\uff08\u5fc5\u987b\uff09 caption_extension \".txt\" o o o class_tokens \u201csks girl\u201d - - o cache_info false o o o is_reg false - - o \u9996\u5148\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c image_dir \u5fc5\u987b\u6307\u5b9a\u56fe\u50cf\u6587\u4ef6\u76f4\u63a5\u4f4d\u4e8e\u8be5\u8def\u5f84\u4e0b\u3002\u5728\u4f20\u7edf\u7684DreamBooth\u65b9\u6cd5\u4e2d\uff0c\u56fe\u50cf\u6587\u4ef6\u9700\u8981\u653e\u5728\u5b50\u76ee\u5f55\u4e0b\uff0c\u4f46\u8fd9\u91cc\u7684\u89c4\u8303\u4e0e\u4e4b\u4e0d\u517c\u5bb9\u3002\u6b64\u5916\uff0c\u5373\u4f7f\u6587\u4ef6\u5939\u540d\u4e3a 5_cat \uff0c\u4e5f\u4e0d\u4f1a\u53cd\u6620\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570\u548c\u7c7b\u522b\u540d\u79f0\u3002\u5982\u679c\u9700\u8981\u5355\u72ec\u8bbe\u7f6e\u8fd9\u4e9b\uff0c\u8bf7\u4f7f\u7528 num_repeats \u548c class_tokens \u663e\u5f0f\u6307\u5b9a\u3002 image_dir \u6307\u5b9a\u56fe\u50cf\u76ee\u5f55\u7684\u8def\u5f84\u3002\u8fd9\u662f\u5fc5\u987b\u7684\u9009\u9879\u3002 \u56fe\u50cf\u5fc5\u987b\u76f4\u63a5\u4f4d\u4e8e\u76ee\u5f55\u4e0b\u3002 class_tokens \u8bbe\u7f6e\u7c7b\u522b\u6807\u8bb0\u3002 \u4ec5\u5f53\u56fe\u50cf\u5bf9\u5e94\u7684\u6807\u9898\u6587\u4ef6\u4e0d\u5b58\u5728\u65f6\uff0c\u624d\u4f1a\u5728\u8bad\u7ec3\u65f6\u4f7f\u7528\u3002\u662f\u5426\u4f7f\u7528\u7684\u5224\u65ad\u662f\u9488\u5bf9\u6bcf\u4e2a\u56fe\u50cf\u8fdb\u884c\u7684\u3002\u5982\u679c\u672a\u6307\u5b9a class_tokens \u4e14\u6807\u9898\u6587\u4ef6\u4e5f\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u51fa\u9519\u3002 cache_info \u6307\u5b9a\u662f\u5426\u7f13\u5b58\u56fe\u50cf\u5927\u5c0f\u548c\u6807\u9898\u3002\u9ed8\u8ba4\u503c\u4e3a false \u3002\u7f13\u5b58\u5c06\u4fdd\u5b58\u5728 image_dir \u4e2d\u7684 metadata_cache.json \u6587\u4ef6\u4e2d\u3002 \u7f13\u5b58\u53ef\u4ee5\u52a0\u5feb\u7b2c\u4e8c\u6b21\u53ca\u4ee5\u540e\u8bfb\u53d6\u6570\u636e\u96c6\u7684\u901f\u5ea6\u3002\u5bf9\u4e8e\u6570\u5343\u5f20\u4ee5\u4e0a\u7684\u56fe\u50cf\uff0c\u542f\u7528\u6b64\u9009\u9879\u662f\u6709\u6548\u7684\u3002 is_reg \u6307\u5b9a\u5b50\u96c6\u4e2d\u7684\u56fe\u50cf\u662f\u5426\u4e3a\u6b63\u5219\u5316\u56fe\u50cf\u3002\u9ed8\u8ba4\u503c\u4e3a false \uff0c\u5373\u4e0d\u662f\u6b63\u5219\u5316\u56fe\u50cf\u3002 \u4ec5\u9002\u7528\u4e8efine-tuning\u65b9\u5f0f\u7684\u9009\u9879 fine-tuning\u65b9\u5f0f\u7684\u9009\u9879\u4ec5\u5b58\u5728\u4e8e\u5b50\u96c6\u9009\u9879\u4e2d\u3002 \u5b50\u96c6\u9009\u9879 \u8fd9\u4e9b\u9009\u9879\u4e0efine-tuning\u65b9\u5f0f\u7684\u5b50\u96c6\u8bbe\u7f6e\u76f8\u5173\u3002 \u9009\u9879\u540d \u8bbe\u7f6e\u793a\u4f8b [general] [[datasets]] [[dataset.subsets]] image_dir \u2018C:\\hoge\u2019 - - o metadata_file 'C:\\piyo\\piyo_md.json' - - o\uff08\u5fc5\u987b\uff09 image_dir \u6307\u5b9a\u56fe\u50cf\u76ee\u5f55\u7684\u8def\u5f84\u3002\u4e0eDreamBooth\u65b9\u5f0f\u4e0d\u540c\uff0c\u8fd9\u91cc\u4e0d\u662f\u5fc5\u987b\u7684\uff0c\u4f46\u5efa\u8bae\u6307\u5b9a\u3002 \u4e0d\u9700\u8981\u6307\u5b9a\u7684\u60c5\u51b5\u662f\uff0c\u5728\u751f\u6210\u5143\u6570\u636e\u6587\u4ef6\u65f6\uff0c\u4f7f\u7528\u4e86 image_dir \u4ee5\u5916\u7684\u8def\u5f84\u3002 \u56fe\u50cf\u5fc5\u987b\u76f4\u63a5\u4f4d\u4e8e\u76ee\u5f55\u4e0b\u3002 metadata_file \u6307\u5b9a\u5b50\u96c6\u4e2d\u4f7f\u7528\u7684\u5143\u6570\u636e\u6587\u4ef6\u7684\u8def\u5f84\u3002\u8fd9\u662f\u5fc5\u987b\u7684\u9009\u9879\u3002 \u4e0e\u547d\u4ee4\u884c\u53c2\u6570 --in_json \u7b49\u6548\u3002 \u7531\u4e8e\u5b50\u96c6\u9700\u8981\u5355\u72ec\u6307\u5b9a\u5143\u6570\u636e\u6587\u4ef6\uff0c\u56e0\u6b64\u4e0d\u5efa\u8bae\u521b\u5efa\u8de8\u76ee\u5f55\u7684\u5143\u6570\u636e\u6587\u4ef6\u4f5c\u4e3a\u4e00\u4e2a\u5143\u6570\u636e\u6587\u4ef6\u3002\u5f3a\u70c8\u5efa\u8bae\u4e3a\u6bcf\u4e2a\u56fe\u50cf\u76ee\u5f55\u521b\u5efa\u5143\u6570\u636e\u6587\u4ef6\uff0c\u5e76\u5c06\u5b83\u4eec\u6ce8\u518c\u4e3a\u4e0d\u540c\u7684\u5b50\u96c6\u3002 \u5982\u679c\u652f\u6301caption dropout\uff0c\u5219\u53ef\u7528\u7684\u9009\u9879 \u5982\u679c\u8bad\u7ec3\u65b9\u6cd5\u652f\u6301caption dropout\uff0c\u5219\u4ee5\u4e0b\u9009\u9879\u53ef\u7528\u3002\u8fd9\u4e9b\u9009\u9879\u4ec5\u5b58\u5728\u4e8e\u5b50\u96c6\u9009\u9879\u4e2d\u3002 \u5b50\u96c6\u9009\u9879 \u8fd9\u4e9b\u9009\u9879\u4e0e\u652f\u6301caption dropout\u7684\u5b50\u96c6\u8bbe\u7f6e\u76f8\u5173\u3002 \u9009\u9879\u540d [general] [[datasets]] [[dataset.subsets]] caption_dropout_every_n_epochs o o o caption_dropout_rate o o o caption_tag_dropout_rate o o o \u5b50\u96c6\u91cd\u590d\u65f6\u7684\u884c\u4e3a \u5bf9\u4e8eDreamBooth\u65b9\u5f0f\u7684\u6570\u636e\u96c6\uff0c\u5982\u679c\u5176\u4e2d\u5b58\u5728 image_dir \u76f8\u540c\u7684\u5b50\u96c6\uff0c\u5219\u88ab\u89c6\u4e3a\u91cd\u590d\uff0c\u7b2c\u4e8c\u4e2a\u53ca\u4ee5\u540e\u7684\u5b50\u96c6\u5c06\u88ab\u5ffd\u7565\u3002 \u5bf9\u4e8efine-tuning\u65b9\u5f0f\u7684\u6570\u636e\u96c6\uff0c\u5982\u679c\u5176\u4e2d\u5b58\u5728 metadata_file \u76f8\u540c\u7684\u5b50\u96c6\uff0c\u5219\u88ab\u89c6\u4e3a\u91cd\u590d\uff0c\u7b2c\u4e8c\u4e2a\u53ca\u4ee5\u540e\u7684\u5b50\u96c6\u5c06\u88ab\u5ffd\u7565\u3002 \u7136\u800c\uff0c\u5982\u679c\u5b50\u96c6\u5c5e\u4e8e\u4e0d\u540c\u7684\u6570\u636e\u96c6\uff0c\u5219\u4e0d\u88ab\u89c6\u4e3a\u91cd\u590d\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u5c06\u5177\u6709\u76f8\u540c image_dir \u7684\u5b50\u96c6\u653e\u5728\u4e0d\u540c\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u5982\u4e0b\u6240\u793a\uff0c\u5219\u4e0d\u4f1a\u88ab\u89c6\u4e3a\u91cd\u590d\u3002 \u8fd9\u5728\u4ee5\u4e0d\u540c\u5206\u8fa8\u7387\u8bad\u7ec3\u540c\u4e00\u56fe\u50cf\u65f6\u5f88\u6709\u7528\u3002 # \u5982\u679c\u5b58\u5728\u4e8e\u4e0d\u540c\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u5219\u4e0d\u88ab\u89c6\u4e3a\u91cd\u590d\uff0c\u90fd\u4f1a\u88ab\u7528\u4e8e\u8bad\u7ec3 [[datasets]] resolution = 512 [[datasets.subsets]] image_dir = 'C:\\hoge' [[datasets]] resolution = 768 [[datasets.subsets]] image_dir = 'C:\\hoge' \u4e0e\u547d\u4ee4\u884c\u53c2\u6570\u7684\u7ed3\u5408\u4f7f\u7528 \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u4e00\u4e9b\u9009\u9879\u4e0e\u547d\u4ee4\u884c\u53c2\u6570\u7684\u9009\u9879\u5177\u6709\u76f8\u540c\u7684\u4f5c\u7528\u3002 \u4ee5\u4e0b\u547d\u4ee4\u884c\u53c2\u6570\u7684\u9009\u9879\u5728\u4f20\u9012\u914d\u7f6e\u6587\u4ef6\u65f6\u5c06\u88ab\u5ffd\u7565\u3002 --train_data_dir --reg_data_dir --in_json \u4ee5\u4e0b\u547d\u4ee4\u884c\u53c2\u6570\u7684\u9009\u9879\u5728\u540c\u65f6\u901a\u8fc7\u547d\u4ee4\u884c\u548c\u914d\u7f6e\u6587\u4ef6\u6307\u5b9a\u65f6\uff0c\u914d\u7f6e\u6587\u4ef6\u7684\u9009\u9879\u5c06\u4f18\u5148\u3002\u6ca1\u6709\u7279\u522b\u8bf4\u660e\u7684\u5747\u4e3a\u540c\u540d\u9009\u9879\u3002 \u547d\u4ee4\u884c\u53c2\u6570\u9009\u9879 \u4f18\u5148\u7684\u914d\u7f6e\u6587\u4ef6\u9009\u9879 --bucket_no_upscale --bucket_reso_steps --caption_dropout_every_n_epochs --caption_dropout_rate --caption_extension --caption_tag_dropout_rate --color_aug --dataset_repeats num_repeats --enable_bucket --face_crop_aug_range --flip_aug --keep_tokens --min_bucket_reso --random_crop --resolution --shuffle_caption --train_batch_size batch_size \u9519\u8bef\u6307\u5357 \u76ee\u524d\uff0c\u6211\u4eec\u4f7f\u7528\u5916\u90e8\u5e93\u6765\u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\u662f\u5426\u6b63\u786e\u4e66\u5199\uff0c\u4f46\u7531\u4e8e\u7ef4\u62a4\u4e0d\u591f\uff0c\u5bfc\u81f4\u9519\u8bef\u6d88\u606f\u4e0d\u591f\u6e05\u6670\u3002 \u6211\u4eec\u8ba1\u5212\u5728\u5c06\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002 \u4f5c\u4e3a\u4e34\u65f6\u89e3\u51b3\u65b9\u6848\uff0c\u6211\u4eec\u5217\u51fa\u4e86\u4e00\u4e9b\u5e38\u89c1\u7684\u9519\u8bef\u53ca\u5176\u89e3\u51b3\u65b9\u6cd5\u3002 \u5982\u679c\u60a8\u786e\u4fe1\u914d\u7f6e\u6b63\u786e\u5374\u4ecd\u7136\u51fa\u9519\uff0c\u6216\u8005\u65e0\u6cd5\u7406\u89e3\u9519\u8bef\u539f\u56e0\uff0c\u8bf7\u8054\u7cfb\u6211\u4eec\uff0c\u56e0\u4e3a\u53ef\u80fd\u662fbug\u3002 voluptuous.error.MultipleInvalid: required key not provided @ ... \uff1a\u8fd9\u662f\u4e00\u4e2a\u9519\u8bef\uff0c\u8868\u660e\u7f3a\u5c11\u5fc5\u987b\u7684\u9009\u9879\u3002\u53ef\u80fd\u662f\u5fd8\u8bb0\u6307\u5b9a\u6216\u9519\u8bef\u5730\u4e66\u5199\u4e86\u9009\u9879\u540d\u79f0\u3002 ... \u90e8\u5206\u663e\u793a\u4e86\u9519\u8bef\u53d1\u751f\u7684\u4f4d\u7f6e\u3002\u4f8b\u5982\uff0c\u5982\u679c\u51fa\u73b0 voluptuous.error.MultipleInvalid: required key not provided @ data['datasets'][0]['subsets'][0]['image_dir'] \uff0c\u5219\u610f\u5473\u7740\u7b2c0\u4e2a datasets \u4e2d\u7684\u7b2c0\u4e2a subsets \u7f3a\u5c11 image_dir \u3002 voluptuous.error.MultipleInvalid: expected int for dictionary value @ ... \uff1a\u8fd9\u662f\u4e00\u4e2a\u9519\u8bef\uff0c\u8868\u660e\u503c\u7684\u683c\u5f0f\u4e0d\u6b63\u786e\u3002\u53ef\u80fd\u662f\u503c\u7684\u683c\u5f0f\u9519\u8bef\u3002 int \u90e8\u5206\u4f1a\u6839\u636e\u9009\u9879\u7684\u4e0d\u540c\u800c\u53d8\u5316\u3002\u672cREADME\u4e2d\u7684\u201c\u8bbe\u7f6e\u793a\u4f8b\u201d\u53ef\u80fd\u4f1a\u6709\u6240\u5e2e\u52a9\u3002 voluptuous.error.MultipleInvalid: extra keys not allowed @ ... \uff1a\u5f53\u5b58\u5728\u4e0d\u652f\u6301\u7684\u9009\u9879\u540d\u79f0\u65f6\uff0c\u4f1a\u53d1\u751f\u6b64\u9519\u8bef\u3002\u53ef\u80fd\u662f\u9519\u8bef\u5730\u4e66\u5199\u4e86\u9009\u9879\u540d\u79f0\u6216\u8bef\u5199\u4e86\u5176\u4ed6\u5185\u5bb9\u3002 \u5176\u4ed6 \u591a\u884c\u6807\u9898 \u8bbe\u7f6e enable_wildcard = true \u540e\uff0c\u591a\u884c\u6807\u9898\u4e5f\u4f1a\u88ab\u542f\u7528\u3002\u5982\u679c\u6807\u9898\u6587\u4ef6\u5305\u542b\u591a\u884c\uff0c\u5219\u4f1a\u968f\u673a\u9009\u62e9\u4e00\u884c\u4f5c\u4e3a\u6807\u9898\u3002 1girl, hatsune miku, vocaloid, upper body, looking at viewer, microphone, stage a girl with a microphone standing on a stage detailed digital art of a girl with a microphone on a stage \u4e5f\u53ef\u4ee5\u4e0e\u901a\u914d\u7b26\u8868\u793a\u6cd5\u7ed3\u5408\u4f7f\u7528\u3002 \u5143\u6570\u636e\u6587\u4ef6\u4e5f\u652f\u6301\u591a\u884c\u6807\u9898\u3002\u5728JSON\u4e2d\uff0c\u4f7f\u7528 \\n \u8868\u793a\u6362\u884c\u3002\u5982\u679c\u6807\u9898\u6587\u4ef6\u5305\u542b\u591a\u884c\uff0c\u4f7f\u7528 merge_captions_to_metadata.py \u5c06\u521b\u5efa\u8fd9\u79cd\u683c\u5f0f\u7684\u5143\u6570\u636e\u6587\u4ef6\u3002 \u5143\u6570\u636e\u4e2d\u7684\u6807\u7b7e ( tags ) \u5c06\u88ab\u6dfb\u52a0\u5230\u6807\u9898\u7684\u6bcf\u4e00\u884c\u3002 { \"/path/to/image.png\": { \"caption\": \"a cartoon of a frog with the word frog on it\\ntest multiline caption1\\ntest multiline caption2\", \"tags\": \"open mouth, simple background, standing, no humans, animal, black background, frog, animal costume, animal focus\" }, ... } \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b9e\u9645\u7684\u6807\u9898\u53ef\u80fd\u662f a cartoon of a frog with the word frog on it, open mouth, simple background ... \u6216 test multiline caption1, open mouth, simple background ... \u3001 test multiline caption2, open mouth, simple background ... \u7b49\u3002 \u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\uff1a\u9644\u52a0\u5206\u9694\u7b26\u3001\u901a\u914d\u7b26\u8868\u793a\u6cd5\u3001 keep_tokens_separator \u7b49 [general] flip_aug = true color_aug = false resolution = [1024, 1024] [[datasets]] batch_size = 6 enable_bucket = true bucket_no_upscale = true caption_extension = \".txt\" keep_tokens_separator= \"|||\" shuffle_caption = true caption_tag_dropout_rate = 0.1 secondary_separator = \";;;\" # \u4e5f\u53ef\u4ee5\u5199\u5728subset\u4fa7 enable_wildcard = true # \u540c\u4e0a [[datasets.subsets]] image_dir = \"/path/to/image_dir\" num_repeats = 1 # |||\u524d\u540e\u4e0d\u9700\u8981\u9017\u53f7\uff08\u4f1a\u81ea\u52a8\u6dfb\u52a0\uff09 caption_prefix = \"1girl, hatsune miku, vocaloid |||\" # |||\u540e\u9762\u7684\u90e8\u5206\u4e0d\u4f1a\u88abshuffle\u6216drop # \u7b80\u5355\u5730\u4f5c\u4e3a\u5b57\u7b26\u4e32\u8fde\u63a5\uff0c\u56e0\u6b64\u9700\u8981\u81ea\u5df1\u6dfb\u52a0\u9017\u53f7 caption_suffix = \", anime screencap ||| masterpiece, rating: general\" \u6807\u9898\u793a\u4f8b\uff0csecondary_separator \u8868\u793a\u6cd5\uff1a secondary_separator = \";;;\" \u7684\u60c5\u51b5 1girl, hatsune miku, vocaloid, upper body, looking at viewer, sky;;;cloud;;;day, outdoors sky;;;cloud;;;day \u90e8\u5206\u4e0d\u4f1a\u88abshuffle\u6216drop\uff0c\u800c\u662f\u88ab\u66ff\u6362\u4e3a sky,cloud,day \u3002\u5982\u679c\u542f\u7528\u4e86shuffle\u6216drop\uff0c\u5219\u4f1a\u4f5c\u4e3a\u4e00\u4e2a\u6807\u7b7e\u6574\u4f53\u5904\u7406\u3002\u7ed3\u679c\u53ef\u80fd\u662f vocaloid, 1girl, upper body, sky,cloud,day, outdoors, hatsune miku \uff08shuffle\uff09\u6216 vocaloid, 1girl, outdoors, looking at viewer, upper body, hatsune miku \uff08drop\u540e\u7684\u60c5\u51b5\uff09\u7b49\u3002 \u6807\u9898\u793a\u4f8b\uff0c\u901a\u914d\u7b26\u8868\u793a\u6cd5\uff1a enable_wildcard = true \u7684\u60c5\u51b5 1girl, hatsune miku, vocaloid, upper body, looking at viewer, {simple|white} background \u968f\u673a\u9009\u62e9 simple \u6216 white \uff0c\u7ed3\u679c\u662f simple background \u6216 white background \u3002 1girl, hatsune miku, vocaloid, {{retro style}} \u5982\u679c\u8981\u5728\u6807\u7b7e\u5b57\u7b26\u4e32\u4e2d\u5305\u542b { \u6216 } \uff0c\u8bf7\u50cf {{ \u6216 }} \u8fd9\u6837\u5199\u4e24\u6b21\uff08\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5b9e\u9645\u7528\u4e8e\u8bad\u7ec3\u7684\u6807\u9898\u662f {retro style} \uff09\u3002 \u6807\u9898\u793a\u4f8b\uff0c keep_tokens_separator \u8868\u793a\u6cd5\uff1a keep_tokens_separator = \"|||\" \u7684\u60c5\u51b5 1girl, hatsune miku, vocaloid ||| stage, microphone, white shirt, smile ||| best quality, rating: general \u7ed3\u679c\u53ef\u80fd\u662f 1girl, hatsune miku, vocaloid, microphone, stage, white shirt, best quality, rating: general \u6216 1girl, hatsune miku, vocaloid, white shirt, smile, stage, microphone, best quality, rating: general \u7b49\u3002","title":"\u6570\u636e\u96c6\u914d\u7f6e"},{"location":"sd-scripts-docs/config/#_1","text":"\u901a\u8fc7\u4f20\u9012\u914d\u7f6e\u6587\u4ef6\uff0c\u7528\u6237\u53ef\u4ee5\u8fdb\u884c\u66f4\u7ec6\u81f4\u7684\u8bbe\u7f6e\u3002 \u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\u6570\u636e\u96c6 \u4f8b\u5982\uff0c\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u6570\u636e\u96c6\u8bbe\u7f6e\u4e0d\u540c\u7684 resolution \uff0c\u5e76\u6df7\u5408\u4f7f\u7528\u5b83\u4eec\u8fdb\u884c\u8bad\u7ec3\u3002 \u5bf9\u4e8e\u652f\u6301DreamBooth\u548cfine-tuning\u4e24\u79cd\u8bad\u7ec3\u65b9\u6cd5\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u6df7\u5408\u4f7f\u7528\u8fd9\u4e24\u79cd\u65b9\u5f0f\u7684\u6570\u636e\u96c6\u3002 \u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u5b50\u96c6\u8bbe\u7f6e\u4e0d\u540c\u7684\u9009\u9879 \u5b50\u96c6\u662f\u6307\u5c06\u6570\u636e\u96c6\u6309\u56fe\u50cf\u76ee\u5f55\u6216\u5143\u6570\u636e\u5206\u5272\u540e\u7684\u90e8\u5206\u3002\u591a\u4e2a\u5b50\u96c6\u7ec4\u6210\u4e00\u4e2a\u6570\u636e\u96c6\u3002 \u50cf keep_tokens \u548c flip_aug \u8fd9\u6837\u7684\u9009\u9879\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u5b50\u96c6\u5355\u72ec\u8bbe\u7f6e\u3002\u800c\u50cf resolution \u548c batch_size \u8fd9\u6837\u7684\u9009\u9879\u5219\u662f\u9488\u5bf9\u6574\u4e2a\u6570\u636e\u96c6\u7684\uff0c\u5bf9\u4e8e\u5c5e\u4e8e\u540c\u4e00\u6570\u636e\u96c6\u7684\u5b50\u96c6\uff0c\u8fd9\u4e9b\u9009\u9879\u7684\u503c\u662f\u76f8\u540c\u7684\u3002\u5177\u4f53\u7ec6\u8282\u5c06\u5728\u540e\u6587\u4e2d\u8bf4\u660e\u3002 \u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u4f7f\u7528JSON\u6216TOML\u683c\u5f0f\u3002\u8003\u8651\u5230\u6613\u8bfb\u6027\uff0c\u63a8\u8350\u4f7f\u7528 TOML \u3002\u4ee5\u4e0b\u8bf4\u660e\u5c06\u57fa\u4e8eTOML\u683c\u5f0f\u3002 \u4e0b\u9762\u662f\u4e00\u4e2aTOML\u914d\u7f6e\u6587\u4ef6\u7684\u4f8b\u5b50\uff1a [general] shuffle_caption = true caption_extension = '.txt' keep_tokens = 1 # \u8fd9\u662f\u4e00\u4e2aDreamBooth\u65b9\u5f0f\u7684\u6570\u636e\u96c6 [[datasets]] resolution = 512 batch_size = 4 keep_tokens = 2 [[datasets.subsets]] image_dir = 'C:\\hoge' class_tokens = 'hoge girl' # \u8fd9\u4e2a\u5b50\u96c6\u7684keep_tokens = 2\uff08\u4f7f\u7528\u6240\u5c5edatasets\u7684\u503c\uff09 [[datasets.subsets]] image_dir = 'C:\\fuga' class_tokens = 'fuga boy' keep_tokens = 3 [[datasets.subsets]] is_reg = true image_dir = 'C:\\reg' class_tokens = 'human' keep_tokens = 1 # \u8fd9\u662f\u4e00\u4e2afine-tuning\u65b9\u5f0f\u7684\u6570\u636e\u96c6 [[datasets]] resolution = [768, 768] batch_size = 2 [[datasets.subsets]] image_dir = 'C:\\piyo' metadata_file = 'C:\\piyo\\piyo_md.json' # \u8fd9\u4e2a\u5b50\u96c6\u7684keep_tokens = 1\uff08\u4f7f\u7528general\u7684\u503c\uff09 \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u4e09\u4e2a\u76ee\u5f55\u5c06\u4ee5512x512\uff08batch size 4\uff09\u7684\u5206\u8fa8\u7387\u4f7f\u7528DreamBooth\u65b9\u5f0f\u8fdb\u884c\u8bad\u7ec3\uff0c\u800c\u4e00\u4e2a\u76ee\u5f55\u5c06\u4ee5768x768\uff08batch size 2\uff09\u7684\u5206\u8fa8\u7387\u4f7f\u7528fine-tuning\u65b9\u5f0f\u8fdb\u884c\u8bad\u7ec3\u3002","title":"\u6982\u8981"},{"location":"sd-scripts-docs/config/#_2","text":"\u6570\u636e\u96c6\u548c\u5b50\u96c6\u7684\u8bbe\u7f6e\u53ef\u4ee5\u5728\u591a\u4e2a\u5730\u65b9\u8fdb\u884c\u914d\u7f6e\u3002 [general] \u8fd9\u91cc\u6307\u5b9a\u9002\u7528\u4e8e\u6240\u6709\u6570\u636e\u96c6\u6216\u6240\u6709\u5b50\u96c6\u7684\u9009\u9879\u3002 \u5982\u679c\u5728\u6570\u636e\u96c6\u6216\u5b50\u96c6\u7684\u8bbe\u7f6e\u4e2d\u5b58\u5728\u540c\u540d\u7684\u9009\u9879\uff0c\u5219\u6570\u636e\u96c6\u6216\u5b50\u96c6\u7684\u8bbe\u7f6e\u5c06\u4f18\u5148\u3002 [[datasets]] datasets \u662f\u7528\u4e8e\u6ce8\u518c\u6570\u636e\u96c6\u8bbe\u7f6e\u7684\u90e8\u5206\u3002\u8fd9\u91cc\u6307\u5b9a\u9002\u7528\u4e8e\u5404\u4e2a\u6570\u636e\u96c6\u7684\u9009\u9879\u3002 \u5982\u679c\u5b50\u96c6\u4e2d\u5b58\u5728\u540c\u540d\u7684\u9009\u9879\uff0c\u5219\u5b50\u96c6\u7684\u8bbe\u7f6e\u5c06\u4f18\u5148\u3002 [[datasets.subsets]] datasets.subsets \u662f\u7528\u4e8e\u6ce8\u518c\u5b50\u96c6\u8bbe\u7f6e\u7684\u90e8\u5206\u3002\u8fd9\u91cc\u6307\u5b9a\u9002\u7528\u4e8e\u5404\u4e2a\u5b50\u96c6\u7684\u9009\u9879\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u5173\u4e8e\u56fe\u50cf\u76ee\u5f55\u548c\u6ce8\u518c\u4f4d\u7f6e\u5bf9\u5e94\u5173\u7cfb\u7684\u793a\u610f\u56fe\uff0c\u57fa\u4e8e\u524d\u9762\u7684\u4f8b\u5b50\uff1a C:\\ \u251c\u2500 hoge -> [[datasets.subsets]] No.1 \u2510 \u2510 \u251c\u2500 fuga -> [[datasets.subsets]] No.2 |-> [[datasets]] No.1 |-> [general] \u251c\u2500 reg -> [[datasets.subsets]] No.3 \u2518 | \u2514\u2500 piyo -> [[datasets.subsets]] No.4 --> [[datasets]] No.2 \u2518 \u6bcf\u4e2a\u56fe\u50cf\u76ee\u5f55\u5bf9\u5e94\u4e00\u4e2a [[datasets.subsets]] \u3002\u591a\u4e2a [[datasets.subsets]] \u7ec4\u5408\u6210\u4e00\u4e2a [[datasets]] \u3002\u6240\u6709 [[datasets]] \u548c [[datasets.subsets]] \u90fd\u5c5e\u4e8e [general] \u3002 \u4e0d\u540c\u6ce8\u518c\u4f4d\u7f6e\u53ef\u4ee5\u6307\u5b9a\u7684\u9009\u9879\u4e0d\u540c\u3002\u5982\u679c\u5b58\u5728\u540c\u540d\u7684\u9009\u9879\uff0c\u5219\u8f83\u4f4e\u7ea7\u522b\u7684\u6ce8\u518c\u4f4d\u7f6e\u7684\u503c\u5c06\u4f18\u5148\u3002\u67e5\u770b\u524d\u9762\u7684\u4f8b\u5b50\u4e2d keep_tokens \u9009\u9879\u7684\u5904\u7406\u65b9\u5f0f\u53ef\u4ee5\u5e2e\u52a9\u7406\u89e3\u8fd9\u4e00\u70b9\u3002 \u6b64\u5916\uff0c\u53ef\u7528\u7684\u9009\u9879\u8fd8\u4f1a\u6839\u636e\u8bad\u7ec3\u65b9\u6cd5\u652f\u6301\u7684\u9009\u9879\u800c\u6709\u6240\u4e0d\u540c\u3002 \u4ec5\u9002\u7528\u4e8eDreamBooth\u65b9\u5f0f\u7684\u9009\u9879 \u4ec5\u9002\u7528\u4e8efine-tuning\u65b9\u5f0f\u7684\u9009\u9879 \u5982\u679c\u652f\u6301caption dropout\uff0c\u5219\u53ef\u7528\u7684\u9009\u9879 \u5bf9\u4e8e\u540c\u65f6\u652f\u6301DreamBooth\u548cfine-tuning\u7684\u8bad\u7ec3\u65b9\u6cd5\uff0c\u53ef\u4ee5\u6df7\u5408\u4f7f\u7528\u8fd9\u4e24\u79cd\u65b9\u5f0f\u3002\u4f46\u662f\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u540c\u4e00\u4e2a\u6570\u636e\u96c6\u4e2d\uff0c\u4e0d\u80fd\u6df7\u5408\u4f7f\u7528DreamBooth\u548cfine-tuning\u65b9\u5f0f\u7684\u5b50\u96c6\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u8981\u6df7\u5408\u4f7f\u7528\u8fd9\u4e24\u79cd\u65b9\u5f0f\uff0c\u9700\u8981\u5c06\u5b83\u4eec\u8bbe\u7f6e\u4e3a\u4e0d\u540c\u7684\u6570\u636e\u96c6\u3002 \u7a0b\u5e8f\u7684\u884c\u4e3a\u662f\uff0c\u5982\u679c\u5b58\u5728 metadata_file \u9009\u9879\uff0c\u5219\u5224\u65ad\u4e3afine-tuning\u65b9\u5f0f\u7684\u5b50\u96c6\u3002\u56e0\u6b64\uff0c\u5bf9\u4e8e\u5c5e\u4e8e\u540c\u4e00\u6570\u636e\u96c6\u7684\u5b50\u96c6\uff0c\u8981\u4e48\u5168\u90e8\u5177\u6709 metadata_file \u9009\u9879\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u5177\u6709\u8be5\u9009\u9879\u3002 \u4e0b\u9762\u4ecb\u7ecd\u53ef\u7528\u7684\u9009\u9879\u3002\u5bf9\u4e8e\u4e0e\u547d\u4ee4\u884c\u53c2\u6570\u540d\u79f0\u76f8\u540c\u7684\u9009\u9879\uff0c\u901a\u5e38\u4e0d\u518d\u91cd\u590d\u8bf4\u660e\u3002\u8bf7\u53c2\u8003\u5176\u4ed6README\u6587\u4ef6\u3002","title":"\u6570\u636e\u96c6\u548c\u5b50\u96c6\u7684\u8bbe\u7f6e"},{"location":"sd-scripts-docs/config/#_3","text":"\u8fd9\u4e9b\u9009\u9879\u4e0e\u8bad\u7ec3\u65b9\u6cd5\u65e0\u5173\u3002","title":"\u6240\u6709\u8bad\u7ec3\u65b9\u6cd5\u5171\u901a\u7684\u9009\u9879"},{"location":"sd-scripts-docs/config/#_4","text":"\u8fd9\u4e9b\u9009\u9879\u4e0e\u6570\u636e\u96c6\u7684\u8bbe\u7f6e\u76f8\u5173\uff0c\u4e0d\u80fd\u5728 datasets.subsets \u4e2d\u6307\u5b9a\u3002 \u9009\u9879\u540d \u8bbe\u7f6e\u793a\u4f8b [general] [[datasets]] batch_size 1 o o bucket_no_upscale true o o bucket_reso_steps 64 o o enable_bucket true o o max_bucket_reso 1024 o o min_bucket_reso 128 o o resolution 256 , [512, 512] o o batch_size \u4e0e\u547d\u4ee4\u884c\u53c2\u6570 --train_batch_size \u7b49\u6548\u3002 max_bucket_reso , min_bucket_reso \u6307\u5b9abucket\u7684\u6700\u5927\u548c\u6700\u5c0f\u5206\u8fa8\u7387\u3002\u5fc5\u987b\u80fd\u88ab bucket_reso_steps \u6574\u9664\u3002 \u8fd9\u4e9b\u8bbe\u7f6e\u5bf9\u4e8e\u6570\u636e\u96c6\u662f\u56fa\u5b9a\u7684\u3002\u56e0\u6b64\uff0c\u5c5e\u4e8e\u540c\u4e00\u6570\u636e\u96c6\u7684\u5b50\u96c6\u5c06\u5171\u4eab\u8fd9\u4e9b\u8bbe\u7f6e\u3002\u4f8b\u5982\uff0c\u5982\u679c\u8981\u4f7f\u7528\u4e0d\u540c\u5206\u8fa8\u7387\u7684\u6570\u636e\u96c6\uff0c\u53ef\u4ee5\u50cf\u4e0a\u9762\u7684\u4f8b\u5b50\u4e00\u6837\uff0c\u5c06\u5b83\u4eec\u5b9a\u4e49\u4e3a\u4e0d\u540c\u7684\u6570\u636e\u96c6\u3002","title":"\u6570\u636e\u96c6\u9009\u9879"},{"location":"sd-scripts-docs/config/#_5","text":"\u8fd9\u4e9b\u9009\u9879\u4e0e\u5b50\u96c6\u7684\u8bbe\u7f6e\u76f8\u5173\u3002 \u9009\u9879\u540d \u8bbe\u7f6e\u793a\u4f8b [general] [[datasets]] [[dataset.subsets]] color_aug false o o o face_crop_aug_range [1.0, 3.0] o o o flip_aug true o o o keep_tokens 2 o o o num_repeats 10 o o o random_crop false o o o shuffle_caption true o o o caption_prefix \u201cmasterpiece, best quality, \u201d o o o caption_suffix \u201c, from side\u201d o o o caption_separator \uff08\u901a\u5e38\u4e0d\u8bbe\u7f6e\uff09 o o o keep_tokens_separator \u201c|||\u201d o o o secondary_separator \u201c;;;\u201d o o o enable_wildcard true o o o resize_interpolation \uff08\u901a\u5e38\u4e0d\u8bbe\u7f6e\uff09 o o o num_repeats \u6307\u5b9a\u5b50\u96c6\u4e2d\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570\u3002\u76f8\u5f53\u4e8efine-tuning\u4e2d\u7684 --dataset_repeats \uff0c\u4f46 num_repeats \u53ef\u7528\u4e8e\u4efb\u4f55\u8bad\u7ec3\u65b9\u6cd5\u3002 caption_prefix , caption_suffix \u6307\u5b9a\u5728\u6807\u9898\u524d\u540e\u6dfb\u52a0\u7684\u5b57\u7b26\u4e32\u3002shuffle\u64cd\u4f5c\u5c06\u5728\u6dfb\u52a0\u8fd9\u4e9b\u5b57\u7b26\u4e32\u540e\u8fdb\u884c\u3002\u5982\u679c\u8bbe\u7f6e\u4e86 keep_tokens \uff0c\u8bf7\u6ce8\u610f\u8fd9\u4e00\u70b9\u3002 caption_separator \u6307\u5b9a\u7528\u4e8e\u5206\u9694\u6807\u7b7e\u7684\u5b57\u7b26\u4e32\u3002\u9ed8\u8ba4\u4e3a , \u3002\u901a\u5e38\u4e0d\u9700\u8981\u8bbe\u7f6e\u6b64\u9009\u9879\u3002 keep_tokens_separator \u6307\u5b9a\u7528\u4e8e\u5206\u9694\u6807\u9898\u4e2d\u8981\u4fdd\u7559\u90e8\u5206\u7684\u5b57\u7b26\u3002\u4f8b\u5982\uff0c aaa, bbb ||| ccc, ddd, eee, fff ||| ggg, hhh \u5c06\u4fdd\u7559 aaa, bbb \u548c ggg, hhh \u90e8\u5206\uff0c\u4e0d\u4f1a\u88abshuffle\u6216drop\u3002\u4e2d\u95f4\u7684\u9017\u53f7\u662f\u53ef\u9009\u7684\u3002\u7ed3\u679c\u53ef\u80fd\u662f aaa, bbb, eee, ccc, fff, ggg, hhh \u6216 aaa, bbb, fff, ccc, eee, ggg, hhh \u7b49\u3002 secondary_separator \u6307\u5b9a\u989d\u5916\u7684\u5206\u9694\u7b26\u3002\u7531\u6b64\u5206\u9694\u7684\u90e8\u5206\u5c06\u88ab\u89c6\u4e3a\u4e00\u4e2a\u6807\u7b7e\uff0c\u8fdb\u884cshuffle\u548cdrop\uff0c\u7136\u540e\u66ff\u6362\u4e3a caption_separator \u3002\u4f8b\u5982\uff0c aaa;;;bbb;;;ccc \u5c06\u88ab\u66ff\u6362\u4e3a aaa,bbb,ccc \uff0c\u6216\u8005\u4e00\u8d77\u88abdrop\u3002 enable_wildcard \u542f\u7528\u901a\u914d\u7b26\u8868\u793a\u6cd5\u548c\u591a\u884c\u6807\u9898\u3002\u901a\u914d\u7b26\u8868\u793a\u6cd5\u548c\u591a\u884c\u6807\u9898\u5c06\u5728\u540e\u9762\u8bf4\u660e\u3002 resize_interpolation \u6307\u5b9a\u56fe\u50cf\u7f29\u653e\u65f6\u4f7f\u7528\u7684\u63d2\u503c\u65b9\u6cd5\u3002\u901a\u5e38\u4e0d\u9700\u8981\u8bbe\u7f6e\u3002\u5982\u679c\u6307\u5b9a\u4e86\uff0c\u5219\u5c06\u4f7f\u7528\u76f8\u540c\u7684\u63d2\u503c\u65b9\u6cd5\u8fdb\u884c\u653e\u5927\u548c\u7f29\u5c0f\u3002\u53ef\u4ee5\u6307\u5b9a\u7684\u503c\u6709 lanczos , nearest , bilinear , linear , bicubic , cubic , area , box \u3002\u9ed8\u8ba4\uff08\u672a\u6307\u5b9a\u65f6\uff09\u4e3a\u7f29\u5c0f\u65f6\u4f7f\u7528 area \uff0c\u653e\u5927\u65f6\u4f7f\u7528 lanczos \u3002\u5982\u679c\u6307\u5b9a\u4e86\u6b64\u9009\u9879\uff0c\u5219\u5c06\u4f7f\u7528\u76f8\u540c\u7684\u63d2\u503c\u65b9\u6cd5\u8fdb\u884c\u653e\u5927\u548c\u7f29\u5c0f\u3002\u6307\u5b9a lanczos \u6216 box \u65f6\u5c06\u4f7f\u7528PIL\uff0c\u5176\u4ed6\u503c\u5c06\u4f7f\u7528OpenCV\u3002","title":"\u5b50\u96c6\u9009\u9879"},{"location":"sd-scripts-docs/config/#dreambooth","text":"DreamBooth\u65b9\u5f0f\u7684\u9009\u9879\u4ec5\u5b58\u5728\u4e8e\u5b50\u96c6\u9009\u9879\u4e2d\u3002","title":"\u4ec5\u9002\u7528\u4e8eDreamBooth\u65b9\u5f0f\u7684\u9009\u9879"},{"location":"sd-scripts-docs/config/#_6","text":"\u8fd9\u4e9b\u9009\u9879\u4e0eDreamBooth\u65b9\u5f0f\u7684\u5b50\u96c6\u8bbe\u7f6e\u76f8\u5173\u3002 \u9009\u9879\u540d \u8bbe\u7f6e\u793a\u4f8b [general] [[datasets]] [[dataset.subsets]] image_dir \u2018C:\\hoge\u2019 - - o\uff08\u5fc5\u987b\uff09 caption_extension \".txt\" o o o class_tokens \u201csks girl\u201d - - o cache_info false o o o is_reg false - - o \u9996\u5148\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c image_dir \u5fc5\u987b\u6307\u5b9a\u56fe\u50cf\u6587\u4ef6\u76f4\u63a5\u4f4d\u4e8e\u8be5\u8def\u5f84\u4e0b\u3002\u5728\u4f20\u7edf\u7684DreamBooth\u65b9\u6cd5\u4e2d\uff0c\u56fe\u50cf\u6587\u4ef6\u9700\u8981\u653e\u5728\u5b50\u76ee\u5f55\u4e0b\uff0c\u4f46\u8fd9\u91cc\u7684\u89c4\u8303\u4e0e\u4e4b\u4e0d\u517c\u5bb9\u3002\u6b64\u5916\uff0c\u5373\u4f7f\u6587\u4ef6\u5939\u540d\u4e3a 5_cat \uff0c\u4e5f\u4e0d\u4f1a\u53cd\u6620\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570\u548c\u7c7b\u522b\u540d\u79f0\u3002\u5982\u679c\u9700\u8981\u5355\u72ec\u8bbe\u7f6e\u8fd9\u4e9b\uff0c\u8bf7\u4f7f\u7528 num_repeats \u548c class_tokens \u663e\u5f0f\u6307\u5b9a\u3002 image_dir \u6307\u5b9a\u56fe\u50cf\u76ee\u5f55\u7684\u8def\u5f84\u3002\u8fd9\u662f\u5fc5\u987b\u7684\u9009\u9879\u3002 \u56fe\u50cf\u5fc5\u987b\u76f4\u63a5\u4f4d\u4e8e\u76ee\u5f55\u4e0b\u3002 class_tokens \u8bbe\u7f6e\u7c7b\u522b\u6807\u8bb0\u3002 \u4ec5\u5f53\u56fe\u50cf\u5bf9\u5e94\u7684\u6807\u9898\u6587\u4ef6\u4e0d\u5b58\u5728\u65f6\uff0c\u624d\u4f1a\u5728\u8bad\u7ec3\u65f6\u4f7f\u7528\u3002\u662f\u5426\u4f7f\u7528\u7684\u5224\u65ad\u662f\u9488\u5bf9\u6bcf\u4e2a\u56fe\u50cf\u8fdb\u884c\u7684\u3002\u5982\u679c\u672a\u6307\u5b9a class_tokens \u4e14\u6807\u9898\u6587\u4ef6\u4e5f\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u51fa\u9519\u3002 cache_info \u6307\u5b9a\u662f\u5426\u7f13\u5b58\u56fe\u50cf\u5927\u5c0f\u548c\u6807\u9898\u3002\u9ed8\u8ba4\u503c\u4e3a false \u3002\u7f13\u5b58\u5c06\u4fdd\u5b58\u5728 image_dir \u4e2d\u7684 metadata_cache.json \u6587\u4ef6\u4e2d\u3002 \u7f13\u5b58\u53ef\u4ee5\u52a0\u5feb\u7b2c\u4e8c\u6b21\u53ca\u4ee5\u540e\u8bfb\u53d6\u6570\u636e\u96c6\u7684\u901f\u5ea6\u3002\u5bf9\u4e8e\u6570\u5343\u5f20\u4ee5\u4e0a\u7684\u56fe\u50cf\uff0c\u542f\u7528\u6b64\u9009\u9879\u662f\u6709\u6548\u7684\u3002 is_reg \u6307\u5b9a\u5b50\u96c6\u4e2d\u7684\u56fe\u50cf\u662f\u5426\u4e3a\u6b63\u5219\u5316\u56fe\u50cf\u3002\u9ed8\u8ba4\u503c\u4e3a false \uff0c\u5373\u4e0d\u662f\u6b63\u5219\u5316\u56fe\u50cf\u3002","title":"\u5b50\u96c6\u9009\u9879"},{"location":"sd-scripts-docs/config/#fine-tuning","text":"fine-tuning\u65b9\u5f0f\u7684\u9009\u9879\u4ec5\u5b58\u5728\u4e8e\u5b50\u96c6\u9009\u9879\u4e2d\u3002","title":"\u4ec5\u9002\u7528\u4e8efine-tuning\u65b9\u5f0f\u7684\u9009\u9879"},{"location":"sd-scripts-docs/config/#_7","text":"\u8fd9\u4e9b\u9009\u9879\u4e0efine-tuning\u65b9\u5f0f\u7684\u5b50\u96c6\u8bbe\u7f6e\u76f8\u5173\u3002 \u9009\u9879\u540d \u8bbe\u7f6e\u793a\u4f8b [general] [[datasets]] [[dataset.subsets]] image_dir \u2018C:\\hoge\u2019 - - o metadata_file 'C:\\piyo\\piyo_md.json' - - o\uff08\u5fc5\u987b\uff09 image_dir \u6307\u5b9a\u56fe\u50cf\u76ee\u5f55\u7684\u8def\u5f84\u3002\u4e0eDreamBooth\u65b9\u5f0f\u4e0d\u540c\uff0c\u8fd9\u91cc\u4e0d\u662f\u5fc5\u987b\u7684\uff0c\u4f46\u5efa\u8bae\u6307\u5b9a\u3002 \u4e0d\u9700\u8981\u6307\u5b9a\u7684\u60c5\u51b5\u662f\uff0c\u5728\u751f\u6210\u5143\u6570\u636e\u6587\u4ef6\u65f6\uff0c\u4f7f\u7528\u4e86 image_dir \u4ee5\u5916\u7684\u8def\u5f84\u3002 \u56fe\u50cf\u5fc5\u987b\u76f4\u63a5\u4f4d\u4e8e\u76ee\u5f55\u4e0b\u3002 metadata_file \u6307\u5b9a\u5b50\u96c6\u4e2d\u4f7f\u7528\u7684\u5143\u6570\u636e\u6587\u4ef6\u7684\u8def\u5f84\u3002\u8fd9\u662f\u5fc5\u987b\u7684\u9009\u9879\u3002 \u4e0e\u547d\u4ee4\u884c\u53c2\u6570 --in_json \u7b49\u6548\u3002 \u7531\u4e8e\u5b50\u96c6\u9700\u8981\u5355\u72ec\u6307\u5b9a\u5143\u6570\u636e\u6587\u4ef6\uff0c\u56e0\u6b64\u4e0d\u5efa\u8bae\u521b\u5efa\u8de8\u76ee\u5f55\u7684\u5143\u6570\u636e\u6587\u4ef6\u4f5c\u4e3a\u4e00\u4e2a\u5143\u6570\u636e\u6587\u4ef6\u3002\u5f3a\u70c8\u5efa\u8bae\u4e3a\u6bcf\u4e2a\u56fe\u50cf\u76ee\u5f55\u521b\u5efa\u5143\u6570\u636e\u6587\u4ef6\uff0c\u5e76\u5c06\u5b83\u4eec\u6ce8\u518c\u4e3a\u4e0d\u540c\u7684\u5b50\u96c6\u3002","title":"\u5b50\u96c6\u9009\u9879"},{"location":"sd-scripts-docs/config/#caption-dropout","text":"\u5982\u679c\u8bad\u7ec3\u65b9\u6cd5\u652f\u6301caption dropout\uff0c\u5219\u4ee5\u4e0b\u9009\u9879\u53ef\u7528\u3002\u8fd9\u4e9b\u9009\u9879\u4ec5\u5b58\u5728\u4e8e\u5b50\u96c6\u9009\u9879\u4e2d\u3002","title":"\u5982\u679c\u652f\u6301caption dropout\uff0c\u5219\u53ef\u7528\u7684\u9009\u9879"},{"location":"sd-scripts-docs/config/#_8","text":"\u8fd9\u4e9b\u9009\u9879\u4e0e\u652f\u6301caption dropout\u7684\u5b50\u96c6\u8bbe\u7f6e\u76f8\u5173\u3002 \u9009\u9879\u540d [general] [[datasets]] [[dataset.subsets]] caption_dropout_every_n_epochs o o o caption_dropout_rate o o o caption_tag_dropout_rate o o o","title":"\u5b50\u96c6\u9009\u9879"},{"location":"sd-scripts-docs/config/#_9","text":"\u5bf9\u4e8eDreamBooth\u65b9\u5f0f\u7684\u6570\u636e\u96c6\uff0c\u5982\u679c\u5176\u4e2d\u5b58\u5728 image_dir \u76f8\u540c\u7684\u5b50\u96c6\uff0c\u5219\u88ab\u89c6\u4e3a\u91cd\u590d\uff0c\u7b2c\u4e8c\u4e2a\u53ca\u4ee5\u540e\u7684\u5b50\u96c6\u5c06\u88ab\u5ffd\u7565\u3002 \u5bf9\u4e8efine-tuning\u65b9\u5f0f\u7684\u6570\u636e\u96c6\uff0c\u5982\u679c\u5176\u4e2d\u5b58\u5728 metadata_file \u76f8\u540c\u7684\u5b50\u96c6\uff0c\u5219\u88ab\u89c6\u4e3a\u91cd\u590d\uff0c\u7b2c\u4e8c\u4e2a\u53ca\u4ee5\u540e\u7684\u5b50\u96c6\u5c06\u88ab\u5ffd\u7565\u3002 \u7136\u800c\uff0c\u5982\u679c\u5b50\u96c6\u5c5e\u4e8e\u4e0d\u540c\u7684\u6570\u636e\u96c6\uff0c\u5219\u4e0d\u88ab\u89c6\u4e3a\u91cd\u590d\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u5c06\u5177\u6709\u76f8\u540c image_dir \u7684\u5b50\u96c6\u653e\u5728\u4e0d\u540c\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u5982\u4e0b\u6240\u793a\uff0c\u5219\u4e0d\u4f1a\u88ab\u89c6\u4e3a\u91cd\u590d\u3002 \u8fd9\u5728\u4ee5\u4e0d\u540c\u5206\u8fa8\u7387\u8bad\u7ec3\u540c\u4e00\u56fe\u50cf\u65f6\u5f88\u6709\u7528\u3002 # \u5982\u679c\u5b58\u5728\u4e8e\u4e0d\u540c\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u5219\u4e0d\u88ab\u89c6\u4e3a\u91cd\u590d\uff0c\u90fd\u4f1a\u88ab\u7528\u4e8e\u8bad\u7ec3 [[datasets]] resolution = 512 [[datasets.subsets]] image_dir = 'C:\\hoge' [[datasets]] resolution = 768 [[datasets.subsets]] image_dir = 'C:\\hoge'","title":"\u5b50\u96c6\u91cd\u590d\u65f6\u7684\u884c\u4e3a"},{"location":"sd-scripts-docs/config/#_10","text":"\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u4e00\u4e9b\u9009\u9879\u4e0e\u547d\u4ee4\u884c\u53c2\u6570\u7684\u9009\u9879\u5177\u6709\u76f8\u540c\u7684\u4f5c\u7528\u3002 \u4ee5\u4e0b\u547d\u4ee4\u884c\u53c2\u6570\u7684\u9009\u9879\u5728\u4f20\u9012\u914d\u7f6e\u6587\u4ef6\u65f6\u5c06\u88ab\u5ffd\u7565\u3002 --train_data_dir --reg_data_dir --in_json \u4ee5\u4e0b\u547d\u4ee4\u884c\u53c2\u6570\u7684\u9009\u9879\u5728\u540c\u65f6\u901a\u8fc7\u547d\u4ee4\u884c\u548c\u914d\u7f6e\u6587\u4ef6\u6307\u5b9a\u65f6\uff0c\u914d\u7f6e\u6587\u4ef6\u7684\u9009\u9879\u5c06\u4f18\u5148\u3002\u6ca1\u6709\u7279\u522b\u8bf4\u660e\u7684\u5747\u4e3a\u540c\u540d\u9009\u9879\u3002 \u547d\u4ee4\u884c\u53c2\u6570\u9009\u9879 \u4f18\u5148\u7684\u914d\u7f6e\u6587\u4ef6\u9009\u9879 --bucket_no_upscale --bucket_reso_steps --caption_dropout_every_n_epochs --caption_dropout_rate --caption_extension --caption_tag_dropout_rate --color_aug --dataset_repeats num_repeats --enable_bucket --face_crop_aug_range --flip_aug --keep_tokens --min_bucket_reso --random_crop --resolution --shuffle_caption --train_batch_size batch_size","title":"\u4e0e\u547d\u4ee4\u884c\u53c2\u6570\u7684\u7ed3\u5408\u4f7f\u7528"},{"location":"sd-scripts-docs/config/#_11","text":"\u76ee\u524d\uff0c\u6211\u4eec\u4f7f\u7528\u5916\u90e8\u5e93\u6765\u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\u662f\u5426\u6b63\u786e\u4e66\u5199\uff0c\u4f46\u7531\u4e8e\u7ef4\u62a4\u4e0d\u591f\uff0c\u5bfc\u81f4\u9519\u8bef\u6d88\u606f\u4e0d\u591f\u6e05\u6670\u3002 \u6211\u4eec\u8ba1\u5212\u5728\u5c06\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002 \u4f5c\u4e3a\u4e34\u65f6\u89e3\u51b3\u65b9\u6848\uff0c\u6211\u4eec\u5217\u51fa\u4e86\u4e00\u4e9b\u5e38\u89c1\u7684\u9519\u8bef\u53ca\u5176\u89e3\u51b3\u65b9\u6cd5\u3002 \u5982\u679c\u60a8\u786e\u4fe1\u914d\u7f6e\u6b63\u786e\u5374\u4ecd\u7136\u51fa\u9519\uff0c\u6216\u8005\u65e0\u6cd5\u7406\u89e3\u9519\u8bef\u539f\u56e0\uff0c\u8bf7\u8054\u7cfb\u6211\u4eec\uff0c\u56e0\u4e3a\u53ef\u80fd\u662fbug\u3002 voluptuous.error.MultipleInvalid: required key not provided @ ... \uff1a\u8fd9\u662f\u4e00\u4e2a\u9519\u8bef\uff0c\u8868\u660e\u7f3a\u5c11\u5fc5\u987b\u7684\u9009\u9879\u3002\u53ef\u80fd\u662f\u5fd8\u8bb0\u6307\u5b9a\u6216\u9519\u8bef\u5730\u4e66\u5199\u4e86\u9009\u9879\u540d\u79f0\u3002 ... \u90e8\u5206\u663e\u793a\u4e86\u9519\u8bef\u53d1\u751f\u7684\u4f4d\u7f6e\u3002\u4f8b\u5982\uff0c\u5982\u679c\u51fa\u73b0 voluptuous.error.MultipleInvalid: required key not provided @ data['datasets'][0]['subsets'][0]['image_dir'] \uff0c\u5219\u610f\u5473\u7740\u7b2c0\u4e2a datasets \u4e2d\u7684\u7b2c0\u4e2a subsets \u7f3a\u5c11 image_dir \u3002 voluptuous.error.MultipleInvalid: expected int for dictionary value @ ... \uff1a\u8fd9\u662f\u4e00\u4e2a\u9519\u8bef\uff0c\u8868\u660e\u503c\u7684\u683c\u5f0f\u4e0d\u6b63\u786e\u3002\u53ef\u80fd\u662f\u503c\u7684\u683c\u5f0f\u9519\u8bef\u3002 int \u90e8\u5206\u4f1a\u6839\u636e\u9009\u9879\u7684\u4e0d\u540c\u800c\u53d8\u5316\u3002\u672cREADME\u4e2d\u7684\u201c\u8bbe\u7f6e\u793a\u4f8b\u201d\u53ef\u80fd\u4f1a\u6709\u6240\u5e2e\u52a9\u3002 voluptuous.error.MultipleInvalid: extra keys not allowed @ ... \uff1a\u5f53\u5b58\u5728\u4e0d\u652f\u6301\u7684\u9009\u9879\u540d\u79f0\u65f6\uff0c\u4f1a\u53d1\u751f\u6b64\u9519\u8bef\u3002\u53ef\u80fd\u662f\u9519\u8bef\u5730\u4e66\u5199\u4e86\u9009\u9879\u540d\u79f0\u6216\u8bef\u5199\u4e86\u5176\u4ed6\u5185\u5bb9\u3002","title":"\u9519\u8bef\u6307\u5357"},{"location":"sd-scripts-docs/config/#_12","text":"","title":"\u5176\u4ed6"},{"location":"sd-scripts-docs/config/#_13","text":"\u8bbe\u7f6e enable_wildcard = true \u540e\uff0c\u591a\u884c\u6807\u9898\u4e5f\u4f1a\u88ab\u542f\u7528\u3002\u5982\u679c\u6807\u9898\u6587\u4ef6\u5305\u542b\u591a\u884c\uff0c\u5219\u4f1a\u968f\u673a\u9009\u62e9\u4e00\u884c\u4f5c\u4e3a\u6807\u9898\u3002 1girl, hatsune miku, vocaloid, upper body, looking at viewer, microphone, stage a girl with a microphone standing on a stage detailed digital art of a girl with a microphone on a stage \u4e5f\u53ef\u4ee5\u4e0e\u901a\u914d\u7b26\u8868\u793a\u6cd5\u7ed3\u5408\u4f7f\u7528\u3002 \u5143\u6570\u636e\u6587\u4ef6\u4e5f\u652f\u6301\u591a\u884c\u6807\u9898\u3002\u5728JSON\u4e2d\uff0c\u4f7f\u7528 \\n \u8868\u793a\u6362\u884c\u3002\u5982\u679c\u6807\u9898\u6587\u4ef6\u5305\u542b\u591a\u884c\uff0c\u4f7f\u7528 merge_captions_to_metadata.py \u5c06\u521b\u5efa\u8fd9\u79cd\u683c\u5f0f\u7684\u5143\u6570\u636e\u6587\u4ef6\u3002 \u5143\u6570\u636e\u4e2d\u7684\u6807\u7b7e ( tags ) \u5c06\u88ab\u6dfb\u52a0\u5230\u6807\u9898\u7684\u6bcf\u4e00\u884c\u3002 { \"/path/to/image.png\": { \"caption\": \"a cartoon of a frog with the word frog on it\\ntest multiline caption1\\ntest multiline caption2\", \"tags\": \"open mouth, simple background, standing, no humans, animal, black background, frog, animal costume, animal focus\" }, ... } \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b9e\u9645\u7684\u6807\u9898\u53ef\u80fd\u662f a cartoon of a frog with the word frog on it, open mouth, simple background ... \u6216 test multiline caption1, open mouth, simple background ... \u3001 test multiline caption2, open mouth, simple background ... \u7b49\u3002","title":"\u591a\u884c\u6807\u9898"},{"location":"sd-scripts-docs/config/#keep_tokens_separator","text":"[general] flip_aug = true color_aug = false resolution = [1024, 1024] [[datasets]] batch_size = 6 enable_bucket = true bucket_no_upscale = true caption_extension = \".txt\" keep_tokens_separator= \"|||\" shuffle_caption = true caption_tag_dropout_rate = 0.1 secondary_separator = \";;;\" # \u4e5f\u53ef\u4ee5\u5199\u5728subset\u4fa7 enable_wildcard = true # \u540c\u4e0a [[datasets.subsets]] image_dir = \"/path/to/image_dir\" num_repeats = 1 # |||\u524d\u540e\u4e0d\u9700\u8981\u9017\u53f7\uff08\u4f1a\u81ea\u52a8\u6dfb\u52a0\uff09 caption_prefix = \"1girl, hatsune miku, vocaloid |||\" # |||\u540e\u9762\u7684\u90e8\u5206\u4e0d\u4f1a\u88abshuffle\u6216drop # \u7b80\u5355\u5730\u4f5c\u4e3a\u5b57\u7b26\u4e32\u8fde\u63a5\uff0c\u56e0\u6b64\u9700\u8981\u81ea\u5df1\u6dfb\u52a0\u9017\u53f7 caption_suffix = \", anime screencap ||| masterpiece, rating: general\"","title":"\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\uff1a\u9644\u52a0\u5206\u9694\u7b26\u3001\u901a\u914d\u7b26\u8868\u793a\u6cd5\u3001keep_tokens_separator \u7b49"},{"location":"sd-scripts-docs/config/#secondary_separator-secondary_separator","text":"1girl, hatsune miku, vocaloid, upper body, looking at viewer, sky;;;cloud;;;day, outdoors sky;;;cloud;;;day \u90e8\u5206\u4e0d\u4f1a\u88abshuffle\u6216drop\uff0c\u800c\u662f\u88ab\u66ff\u6362\u4e3a sky,cloud,day \u3002\u5982\u679c\u542f\u7528\u4e86shuffle\u6216drop\uff0c\u5219\u4f1a\u4f5c\u4e3a\u4e00\u4e2a\u6807\u7b7e\u6574\u4f53\u5904\u7406\u3002\u7ed3\u679c\u53ef\u80fd\u662f vocaloid, 1girl, upper body, sky,cloud,day, outdoors, hatsune miku \uff08shuffle\uff09\u6216 vocaloid, 1girl, outdoors, looking at viewer, upper body, hatsune miku \uff08drop\u540e\u7684\u60c5\u51b5\uff09\u7b49\u3002","title":"\u6807\u9898\u793a\u4f8b\uff0csecondary_separator \u8868\u793a\u6cd5\uff1asecondary_separator = \";;;\" \u7684\u60c5\u51b5"},{"location":"sd-scripts-docs/config/#enable_wildcard-true","text":"1girl, hatsune miku, vocaloid, upper body, looking at viewer, {simple|white} background \u968f\u673a\u9009\u62e9 simple \u6216 white \uff0c\u7ed3\u679c\u662f simple background \u6216 white background \u3002 1girl, hatsune miku, vocaloid, {{retro style}} \u5982\u679c\u8981\u5728\u6807\u7b7e\u5b57\u7b26\u4e32\u4e2d\u5305\u542b { \u6216 } \uff0c\u8bf7\u50cf {{ \u6216 }} \u8fd9\u6837\u5199\u4e24\u6b21\uff08\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5b9e\u9645\u7528\u4e8e\u8bad\u7ec3\u7684\u6807\u9898\u662f {retro style} \uff09\u3002","title":"\u6807\u9898\u793a\u4f8b\uff0c\u901a\u914d\u7b26\u8868\u793a\u6cd5\uff1aenable_wildcard = true \u7684\u60c5\u51b5"},{"location":"sd-scripts-docs/config/#keep_tokens_separator-keep_tokens_separator","text":"1girl, hatsune miku, vocaloid ||| stage, microphone, white shirt, smile ||| best quality, rating: general \u7ed3\u679c\u53ef\u80fd\u662f 1girl, hatsune miku, vocaloid, microphone, stage, white shirt, best quality, rating: general \u6216 1girl, hatsune miku, vocaloid, white shirt, smile, stage, microphone, best quality, rating: general \u7b49\u3002","title":"\u6807\u9898\u793a\u4f8b\uff0ckeep_tokens_separator \u8868\u793a\u6cd5\uff1akeep_tokens_separator = \"|||\" \u7684\u60c5\u51b5"},{"location":"sd-scripts-docs/fine_tune/","text":"NovelAI\u63d0\u51fa\u7684\u8bad\u7ec3\u65b9\u6cd5\u3001\u81ea\u52a8\u6807\u6ce8\u3001\u6807\u7b7e\u5316\u3001Windows + VRAM 12GB\uff08\u5bf9\u4e8eSD v1.x\uff09\u73af\u5883\u7b49\u6240\u5bf9\u5e94\u7684fine tuning\u3002\u5728\u8fd9\u91cc\uff0cfine tuning\u6307\u7684\u662f\u7528\u56fe\u50cf\u548c\u6807\u6ce8\u8bad\u7ec3\u6a21\u578b\uff08\u4e0d\u5305\u62ecLoRA\u3001Textual Inversion\u548cHypernetworks\uff09\u3002 \u8bf7\u540c\u65f6\u53c2\u8003 \u5173\u4e8e\u8bad\u7ec3\u7684\u5171\u540c\u6587\u6863 \u3002 \u6982\u8981 \u4f7f\u7528Diffusers\u5bf9Stable Diffusion\u7684U-Net\u8fdb\u884cfine tuning\u3002\u5bf9\u5e94\u4e86NovelAI\u7684\u6587\u7ae0\u4e2d\u7684\u4ee5\u4e0b\u6539\u8fdb\uff08\u867d\u7136Aspect Ratio Bucketing\u53c2\u8003\u4e86NovelAI\u7684\u4ee3\u7801\uff0c\u4f46\u6700\u7ec8\u7684\u4ee3\u7801\u90fd\u662f\u539f\u521b\u7684\uff09\u3002 \u4f7f\u7528CLIP\uff08Text Encoder\uff09\u7684\u5012\u6570\u7b2c\u4e8c\u5c42\u7684\u8f93\u51fa\uff0c\u800c\u4e0d\u662f\u6700\u540e\u4e00\u5c42\u7684\u8f93\u51fa\u3002 \u4ee5\u975e\u6b63\u65b9\u5f62\u5206\u8fa8\u7387\u8fdb\u884c\u8bad\u7ec3\uff08Aspect Ratio Bucketing\uff09\u3002 \u5c06\u6807\u8bb0\u957f\u5ea6\u4ece75\u6269\u5c55\u5230225\u3002 \u4f7f\u7528BLIP\u8fdb\u884c\u6807\u6ce8\uff08\u81ea\u52a8\u521b\u5efa\u6807\u6ce8\uff09\u3001\u4f7f\u7528DeepDanbooru\u6216WD14Tagger\u8fdb\u884c\u81ea\u52a8\u6807\u7b7e\u5316\u3002 \u652f\u6301Hypernetwork\u7684\u8bad\u7ec3\u3002 \u652f\u6301Stable Diffusion v2.0\uff08base\u4ee5\u53ca768/v\uff09\u3002 \u63d0\u524d\u83b7\u53d6VAE\u7684\u8f93\u51fa\u5e76\u4fdd\u5b58\u5230\u78c1\u76d8\uff0c\u4ee5\u51cf\u5c11\u8bad\u7ec3\u65f6\u7684\u5185\u5b58\u4f7f\u7528\u91cf\u5e76\u63d0\u9ad8\u901f\u5ea6\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e0d\u8bad\u7ec3Text Encoder\u3002\u5728\u6574\u4f53\u6a21\u578b\u7684fine tuning\u4e2d\uff0c\u901a\u5e38\u53ea\u8bad\u7ec3U-Net\uff08NovelAI\u4f3c\u4e4e\u4e5f\u662f\u5982\u6b64\uff09\u3002\u53ef\u4ee5\u901a\u8fc7\u9009\u9879\u6307\u5b9a\u6765\u8bad\u7ec3Text Encoder\u3002 \u5173\u4e8e\u8ffd\u52a0\u529f\u80fd \u66f4\u6539CLIP\u7684\u8f93\u51fa \u4e3a\u4e86\u5c06\u63d0\u793a\u53cd\u6620\u5230\u56fe\u50cf\u4e2d\uff0cCLIP\uff08Text Encoder\uff09\u5c06\u6587\u672c\u8f6c\u6362\u4e3a\u7279\u5f81\u91cf\u3002Stable Diffusion\u4f7f\u7528CLIP\u7684\u6700\u540e\u4e00\u5c42\u7684\u8f93\u51fa\uff0c\u4f46\u53ef\u4ee5\u66f4\u6539\u4e3a\u4f7f\u7528\u5012\u6570\u7b2c\u4e8c\u5c42\u7684\u8f93\u51fa\u3002\u636eNovelAI\u8bf4\uff0c\u8fd9\u6837\u53ef\u4ee5\u66f4\u51c6\u786e\u5730\u53cd\u6620\u63d0\u793a\u3002 \u4e5f\u53ef\u4ee5\u4fdd\u6301\u539f\u6837\uff0c\u4f7f\u7528\u6700\u540e\u4e00\u5c42\u7684\u8f93\u51fa\u3002 *\u6ce8\u610f\uff1aStable Diffusion 2.0\u9ed8\u8ba4\u4f7f\u7528\u5012\u6570\u7b2c\u4e8c\u5c42\u3002\u8bf7\u4e0d\u8981\u6307\u5b9aclip_skip\u9009\u9879\u3002 \u4ee5\u975e\u6b63\u65b9\u5f62\u5206\u8fa8\u7387\u8fdb\u884c\u8bad\u7ec3 Stable Diffusion\u662f\u5728512 512\u7684\u5206\u8fa8\u7387\u4e0b\u8bad\u7ec3\u7684\uff0c\u4f46\u9664\u4e86\u8fd9\u4e2a\u5206\u8fa8\u7387\u4ee5\u5916\uff0c\u8fd8\u4f1a\u5728256 1024\u6216384*640\u7b49\u5206\u8fa8\u7387\u4e0b\u8fdb\u884c\u8bad\u7ec3\u3002\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u88c1\u526a\u7684\u90e8\u5206\uff0c\u66f4\u51c6\u786e\u5730\u5b66\u4e60\u63d0\u793a\u548c\u56fe\u50cf\u4e4b\u95f4\u7684\u5173\u7cfb\u3002 \u8bad\u7ec3\u5206\u8fa8\u7387\u4f1a\u5728\u4e0d\u8d85\u8fc7\u4f5c\u4e3a\u53c2\u6570\u7ed9\u51fa\u7684\u5206\u8fa8\u7387\u7684\u9762\u79ef\uff08=\u5185\u5b58\u4f7f\u7528\u91cf\uff09\u7684\u8303\u56f4\u5185\uff0c\u4ee564\u50cf\u7d20\u4e3a\u5355\u4f4d\u8fdb\u884c\u8c03\u6574\u3002 \u5728\u673a\u5668\u5b66\u4e60\u4e2d\uff0c\u901a\u5e38\u5c06\u8f93\u5165\u5927\u5c0f\u7edf\u4e00\u8d77\u6765\uff0c\u4f46\u5e76\u4e0d\u662f\u7279\u522b\u6709\u7ea6\u675f\uff0c\u5b9e\u9645\u4e0a\u53ea\u8981\u5728\u540c\u4e00\u4e2a\u6279\u6b21\u4e2d\u7edf\u4e00\u5373\u53ef\u3002NovelAI\u6240\u8bf4\u7684bucketing\u662f\u6307\u9884\u5148\u6839\u636e\u957f\u5bbd\u6bd4\u5c06\u8bad\u7ec3\u6570\u636e\u5206\u7c7b\u5230\u4e0d\u540c\u7684\u8bad\u7ec3\u5206\u8fa8\u7387\u4e2d\uff0c\u7136\u540e\u5728\u6bcf\u4e2abucket\u5185\u521b\u5efa\u6279\u6b21\uff0c\u4ee5\u7edf\u4e00\u6279\u6b21\u5185\u7684\u56fe\u50cf\u5927\u5c0f\u3002 \u5c06\u6807\u8bb0\u957f\u5ea6\u4ece75\u6269\u5c55\u5230225 Stable Diffusion\u7684\u6700\u5927\u6807\u8bb0\u957f\u5ea6\u662f75\uff08\u5305\u62ec\u5f00\u59cb\u548c\u7ed3\u675f\u6807\u8bb0\u662f77\uff09\uff0c\u8fd9\u91cc\u5c06\u5176\u6269\u5c55\u5230225\u3002 \u4f46\u662f\uff0c\u7531\u4e8eCLIP\u7684\u6700\u5927\u63a5\u53d7\u957f\u5ea6\u662f75\uff0c\u56e0\u6b64\u5728\u6807\u8bb0\u957f\u5ea6\u4e3a225\u65f6\uff0c\u4f1a\u7b80\u5355\u5730\u5c06\u5176\u5206\u6210\u4e09\u90e8\u5206\uff0c\u5206\u522b\u8c03\u7528CLIP\uff0c\u7136\u540e\u5c06\u7ed3\u679c\u8fde\u63a5\u8d77\u6765\u3002 *\u6ce8\u610f\uff1a\u8fd9\u79cd\u5b9e\u73b0\u65b9\u5f0f\u662f\u5426\u5408\u9002\u5c1a\u4e0d\u660e\u786e\u3002\u76ee\u524d\u770b\u6765\u662f\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u7684\u3002\u7279\u522b\u662f\u57282.0\u7248\u672c\u4e2d\uff0c\u6ca1\u6709\u53ef\u4ee5\u53c2\u8003\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u56e0\u6b64\u91c7\u7528\u4e86\u72ec\u81ea\u7684\u5b9e\u73b0\u65b9\u5f0f\u3002 *\u6ce8\u610f\uff1a\u5728Automatic1111\u7684Web UI\u4e2d\uff0c\u4f3c\u4e4e\u4f1a\u6839\u636e\u9017\u53f7\u8fdb\u884c\u5206\u5272\uff0c\u4f46\u8fd9\u91cc\u53ea\u662f\u8fdb\u884c\u4e86\u7b80\u5355\u7684\u5206\u5272\u3002 \u8bad\u7ec3\u6b65\u9aa4 \u8bf7\u9884\u5148\u53c2\u8003\u672c\u4ed3\u5e93\u7684README\uff0c\u8fdb\u884c\u73af\u5883\u8bbe\u7f6e\u3002 \u6570\u636e\u51c6\u5907 \u8bf7\u53c2\u8003 \u5173\u4e8e\u8bad\u7ec3\u6570\u636e\u7684\u51c6\u5907 \u3002fine tuning\u4ec5\u652f\u6301\u4f7f\u7528\u5143\u6570\u636e\u7684fine tuning\u65b9\u5f0f\u3002 \u6267\u884c\u8bad\u7ec3 \u4f8b\u5982\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u6267\u884c\u8bad\u7ec3\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u4e3a\u4e86\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\u7684\u8bbe\u7f6e\u793a\u4f8b\u3002\u8bf7\u6839\u636e\u9700\u8981\u4fee\u6539\u6bcf\u4e00\u884c\u3002 accelerate launch --num_cpu_threads_per_process 1 fine_tune.py --pretrained_model_name_or_path=<.ckpt\u6216.safetensors\u6216Diffusers\u6a21\u578b\u76ee\u5f55> --output_dir=<\u8bad\u7ec3\u597d\u7684\u6a21\u578b\u7684\u8f93\u51fa\u76ee\u5f55> --output_name=<\u8bad\u7ec3\u597d\u7684\u6a21\u578b\u8f93\u51fa\u65f6\u7684\u6587\u4ef6\u540d> --dataset_config=<\u6570\u636e\u51c6\u5907\u65f6\u521b\u5efa\u7684.toml\u6587\u4ef6> --save_model_as=safetensors --learning_rate=5e-6 --max_train_steps=10000 --use_8bit_adam --xformers --gradient_checkpointing --mixed_precision=fp16 num_cpu_threads_per_process \u901a\u5e38\u8bbe\u7f6e\u4e3a1\u3002 \u5728 pretrained_model_name_or_path \u4e2d\u6307\u5b9a\u7528\u4e8e\u8fdb\u884c\u989d\u5916\u8bad\u7ec3\u7684\u539f\u59cb\u6a21\u578b\u3002\u53ef\u4ee5\u6307\u5b9aStable Diffusion\u7684checkpoint\u6587\u4ef6\uff08.ckpt\u6216.safetensors\uff09\u3001Diffusers\u7684\u672c\u5730\u78c1\u76d8\u4e0a\u7684\u6a21\u578b\u76ee\u5f55\u3001Diffusers\u7684\u6a21\u578bID\uff08\u4f8b\u5982\"stabilityai/stable-diffusion-2\"\uff09\u3002 \u5728 output_dir \u4e2d\u6307\u5b9a\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u7684\u4fdd\u5b58\u76ee\u5f55\u3002\u5728 output_name \u4e2d\u6307\u5b9a\u6a21\u578b\u7684\u6587\u4ef6\u540d\uff08\u4e0d\u5305\u62ec\u6269\u5c55\u540d\uff09\u3002\u901a\u8fc7 save_model_as \u6307\u5b9a\u4ee5safetensors\u683c\u5f0f\u4fdd\u5b58\u6a21\u578b\u3002 \u5728 dataset_config \u4e2d\u6307\u5b9a .toml \u6587\u4ef6\u3002\u5728\u6587\u4ef6\u5185\uff0c\u521d\u59cb\u7684\u6279\u6b21\u5927\u5c0f\u5e94\u8bbe\u7f6e\u4e3a 1 \u4ee5\u51cf\u5c11\u5185\u5b58\u6d88\u8017\u3002 \u5c06\u8bad\u7ec3\u6b65\u6570 max_train_steps \u8bbe\u7f6e\u4e3a10000\u3002\u8fd9\u91cc\u5c06\u5b66\u4e60\u7387 learning_rate \u8bbe\u7f6e\u4e3a5e-6\u3002 \u4e3a\u4e86\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff0c\u6307\u5b9a mixed_precision=\"fp16\" \uff08\u5728RTX30\u7cfb\u5217\u4e4b\u540e\u7684\u663e\u5361\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a bf16 \u3002\u8bf7\u4e0e\u5728\u73af\u5883\u8bbe\u7f6e\u65f6\u5bf9accelerate\u8fdb\u884c\u7684\u8bbe\u7f6e\u4fdd\u6301\u4e00\u81f4\uff09\u3002\u540c\u65f6\u6307\u5b9a gradient_checkpointing \u3002 \u4e3a\u4e86\u4f7f\u7528\u5185\u5b58\u6d88\u8017\u8f83\u5c11\u76848bit AdamW\u4f5c\u4e3a\u4f18\u5316\u5668\uff08\u7528\u4e8e\u5c06\u6a21\u578b\u4f18\u5316/\u8bad\u7ec3\u5230\u9002\u5e94\u8bad\u7ec3\u6570\u636e\u7684\u7c7b\uff09\uff0c\u6307\u5b9a optimizer_type=\"AdamW8bit\" \u3002 \u6307\u5b9a xformers \u9009\u9879\uff0c\u4f7f\u7528xformers\u7684CrossAttention\u3002\u5982\u679c\u6ca1\u6709\u5b89\u88c5xformers\u6216\u51fa\u73b0\u9519\u8bef\uff08\u5728\u67d0\u4e9b\u73af\u5883\u4e0b\uff0c\u5f53 mixed_precision=\"no\" \u65f6\u53ef\u80fd\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff09\uff0c\u53ef\u4ee5\u6539\u4e3a\u6307\u5b9a mem_eff_attn \u9009\u9879\uff0c\u4f7f\u7528\u8282\u7701\u5185\u5b58\u7248\u672c\u7684CrossAttention\uff08\u901f\u5ea6\u4f1a\u53d8\u6162\uff09\u3002 \u5982\u679c\u5185\u5b58\u8db3\u591f\uff0c\u53ef\u4ee5\u7f16\u8f91 .toml \u6587\u4ef6\uff0c\u5c06\u6279\u6b21\u5927\u5c0f\u589e\u52a0\u5230\u4f8b\u5982 4 \uff08\u53ef\u80fd\u4f1a\u63d0\u9ad8\u901f\u5ea6\u548c\u7cbe\u5ea6\uff09\u3002 \u5e38\u89c1\u9009\u9879 \u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\uff0c\u8bf7\u53c2\u8003\u6709\u5173\u9009\u9879\u7684\u6587\u6863\u3002 \u8bad\u7ec3Stable Diffusion 2.x\u6216\u4ece\u4e2d\u6d3e\u751f\u7684\u6a21\u578b \u8bad\u7ec3clip skip\u4e3a2\u6216\u4ee5\u4e0a\u7684\u6a21\u578b \u4f7f\u7528\u8d85\u8fc775\u4e2a\u6807\u8bb0\u7684\u6807\u6ce8\u8fdb\u884c\u8bad\u7ec3 \u5173\u4e8e\u6279\u6b21\u5927\u5c0f \u7531\u4e8e\u662f\u5bf9\u6574\u4e2a\u6a21\u578b\u8fdb\u884c\u8bad\u7ec3\uff0c\u4e0eLoRA\u7b49\u76f8\u6bd4\uff0c\u5185\u5b58\u6d88\u8017\u4f1a\u66f4\u5927\uff08\u4e0eDreamBooth\u76f8\u540c\uff09\u3002 \u5173\u4e8e\u5b66\u4e60\u7387 \u901a\u5e38\u4f7f\u75281e-6\u52305e-6\u5de6\u53f3\u7684\u5b66\u4e60\u7387\u3002\u53ef\u4ee5\u53c2\u8003\u5176\u4ed6fine tuning\u7684\u4f8b\u5b50\u3002 \u4ee5\u524d\u7684\u683c\u5f0f\u7684\u6570\u636e\u96c6\u6307\u5b9a\u7684\u547d\u4ee4\u884c \u901a\u8fc7\u9009\u9879\u6307\u5b9a\u5206\u8fa8\u7387\u548c\u6279\u6b21\u5927\u5c0f\u3002\u547d\u4ee4\u884c\u793a\u4f8b\u5982\u4e0b\u3002 accelerate launch --num_cpu_threads_per_process 1 fine_tune.py --pretrained_model_name_or_path=model.ckpt --in_json meta_lat.json --train_data_dir=train_data --output_dir=fine_tuned --shuffle_caption --train_batch_size=1 --learning_rate=5e-6 --max_train_steps=10000 --use_8bit_adam --xformers --gradient_checkpointing --mixed_precision=bf16 --save_every_n_epochs=4 fine tuning\u7279\u6709\u7684\u5176\u4ed6\u4e3b\u8981\u9009\u9879 \u5173\u4e8e\u6240\u6709\u9009\u9879\uff0c\u8bf7\u53c2\u8003\u5176\u4ed6\u6587\u6863\u3002 train_text_encoder \u5c06Text Encoder\u4e5f\u4f5c\u4e3a\u8bad\u7ec3\u5bf9\u8c61\u3002\u5185\u5b58\u4f7f\u7528\u91cf\u4f1a\u7565\u5fae\u589e\u52a0\u3002 \u5728\u901a\u5e38\u7684fine tuning\u4e2d\uff0c\u4e0d\u5c06Text Encoder\u4f5c\u4e3a\u8bad\u7ec3\u5bf9\u8c61\uff08\u53ef\u80fd\u662f\u56e0\u4e3aU-Net\u662f\u6839\u636eText Encoder\u7684\u8f93\u51fa\u8fdb\u884c\u8bad\u7ec3\u7684\uff09\uff0c\u4f46\u5728\u8bad\u7ec3\u6570\u636e\u8f83\u5c11\u7684\u60c5\u51b5\u4e0b\uff0c\u50cfDreamBooth\u4e00\u6837\u5bf9Text Encoder\u8fdb\u884c\u8bad\u7ec3\u4f3c\u4e4e\u4e5f\u662f\u6709\u6548\u7684\u3002 diffusers_xformers \u4f7f\u7528Diffusers\u7684xformers\u529f\u80fd\uff0c\u800c\u4e0d\u662f\u811a\u672c\u81ea\u6709\u7684xformers\u66ff\u6362\u529f\u80fd\u3002\u8fd9\u6837\u5c31\u65e0\u6cd5\u8fdb\u884cHypernetwork\u7684\u8bad\u7ec3\u3002","title":"\u5fae\u8c03\u8bad\u7ec3"},{"location":"sd-scripts-docs/fine_tune/#_1","text":"\u4f7f\u7528Diffusers\u5bf9Stable Diffusion\u7684U-Net\u8fdb\u884cfine tuning\u3002\u5bf9\u5e94\u4e86NovelAI\u7684\u6587\u7ae0\u4e2d\u7684\u4ee5\u4e0b\u6539\u8fdb\uff08\u867d\u7136Aspect Ratio Bucketing\u53c2\u8003\u4e86NovelAI\u7684\u4ee3\u7801\uff0c\u4f46\u6700\u7ec8\u7684\u4ee3\u7801\u90fd\u662f\u539f\u521b\u7684\uff09\u3002 \u4f7f\u7528CLIP\uff08Text Encoder\uff09\u7684\u5012\u6570\u7b2c\u4e8c\u5c42\u7684\u8f93\u51fa\uff0c\u800c\u4e0d\u662f\u6700\u540e\u4e00\u5c42\u7684\u8f93\u51fa\u3002 \u4ee5\u975e\u6b63\u65b9\u5f62\u5206\u8fa8\u7387\u8fdb\u884c\u8bad\u7ec3\uff08Aspect Ratio Bucketing\uff09\u3002 \u5c06\u6807\u8bb0\u957f\u5ea6\u4ece75\u6269\u5c55\u5230225\u3002 \u4f7f\u7528BLIP\u8fdb\u884c\u6807\u6ce8\uff08\u81ea\u52a8\u521b\u5efa\u6807\u6ce8\uff09\u3001\u4f7f\u7528DeepDanbooru\u6216WD14Tagger\u8fdb\u884c\u81ea\u52a8\u6807\u7b7e\u5316\u3002 \u652f\u6301Hypernetwork\u7684\u8bad\u7ec3\u3002 \u652f\u6301Stable Diffusion v2.0\uff08base\u4ee5\u53ca768/v\uff09\u3002 \u63d0\u524d\u83b7\u53d6VAE\u7684\u8f93\u51fa\u5e76\u4fdd\u5b58\u5230\u78c1\u76d8\uff0c\u4ee5\u51cf\u5c11\u8bad\u7ec3\u65f6\u7684\u5185\u5b58\u4f7f\u7528\u91cf\u5e76\u63d0\u9ad8\u901f\u5ea6\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e0d\u8bad\u7ec3Text Encoder\u3002\u5728\u6574\u4f53\u6a21\u578b\u7684fine tuning\u4e2d\uff0c\u901a\u5e38\u53ea\u8bad\u7ec3U-Net\uff08NovelAI\u4f3c\u4e4e\u4e5f\u662f\u5982\u6b64\uff09\u3002\u53ef\u4ee5\u901a\u8fc7\u9009\u9879\u6307\u5b9a\u6765\u8bad\u7ec3Text Encoder\u3002","title":"\u6982\u8981"},{"location":"sd-scripts-docs/fine_tune/#_2","text":"","title":"\u5173\u4e8e\u8ffd\u52a0\u529f\u80fd"},{"location":"sd-scripts-docs/fine_tune/#clip","text":"\u4e3a\u4e86\u5c06\u63d0\u793a\u53cd\u6620\u5230\u56fe\u50cf\u4e2d\uff0cCLIP\uff08Text Encoder\uff09\u5c06\u6587\u672c\u8f6c\u6362\u4e3a\u7279\u5f81\u91cf\u3002Stable Diffusion\u4f7f\u7528CLIP\u7684\u6700\u540e\u4e00\u5c42\u7684\u8f93\u51fa\uff0c\u4f46\u53ef\u4ee5\u66f4\u6539\u4e3a\u4f7f\u7528\u5012\u6570\u7b2c\u4e8c\u5c42\u7684\u8f93\u51fa\u3002\u636eNovelAI\u8bf4\uff0c\u8fd9\u6837\u53ef\u4ee5\u66f4\u51c6\u786e\u5730\u53cd\u6620\u63d0\u793a\u3002 \u4e5f\u53ef\u4ee5\u4fdd\u6301\u539f\u6837\uff0c\u4f7f\u7528\u6700\u540e\u4e00\u5c42\u7684\u8f93\u51fa\u3002 *\u6ce8\u610f\uff1aStable Diffusion 2.0\u9ed8\u8ba4\u4f7f\u7528\u5012\u6570\u7b2c\u4e8c\u5c42\u3002\u8bf7\u4e0d\u8981\u6307\u5b9aclip_skip\u9009\u9879\u3002","title":"\u66f4\u6539CLIP\u7684\u8f93\u51fa"},{"location":"sd-scripts-docs/fine_tune/#_3","text":"Stable Diffusion\u662f\u5728512 512\u7684\u5206\u8fa8\u7387\u4e0b\u8bad\u7ec3\u7684\uff0c\u4f46\u9664\u4e86\u8fd9\u4e2a\u5206\u8fa8\u7387\u4ee5\u5916\uff0c\u8fd8\u4f1a\u5728256 1024\u6216384*640\u7b49\u5206\u8fa8\u7387\u4e0b\u8fdb\u884c\u8bad\u7ec3\u3002\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u88c1\u526a\u7684\u90e8\u5206\uff0c\u66f4\u51c6\u786e\u5730\u5b66\u4e60\u63d0\u793a\u548c\u56fe\u50cf\u4e4b\u95f4\u7684\u5173\u7cfb\u3002 \u8bad\u7ec3\u5206\u8fa8\u7387\u4f1a\u5728\u4e0d\u8d85\u8fc7\u4f5c\u4e3a\u53c2\u6570\u7ed9\u51fa\u7684\u5206\u8fa8\u7387\u7684\u9762\u79ef\uff08=\u5185\u5b58\u4f7f\u7528\u91cf\uff09\u7684\u8303\u56f4\u5185\uff0c\u4ee564\u50cf\u7d20\u4e3a\u5355\u4f4d\u8fdb\u884c\u8c03\u6574\u3002 \u5728\u673a\u5668\u5b66\u4e60\u4e2d\uff0c\u901a\u5e38\u5c06\u8f93\u5165\u5927\u5c0f\u7edf\u4e00\u8d77\u6765\uff0c\u4f46\u5e76\u4e0d\u662f\u7279\u522b\u6709\u7ea6\u675f\uff0c\u5b9e\u9645\u4e0a\u53ea\u8981\u5728\u540c\u4e00\u4e2a\u6279\u6b21\u4e2d\u7edf\u4e00\u5373\u53ef\u3002NovelAI\u6240\u8bf4\u7684bucketing\u662f\u6307\u9884\u5148\u6839\u636e\u957f\u5bbd\u6bd4\u5c06\u8bad\u7ec3\u6570\u636e\u5206\u7c7b\u5230\u4e0d\u540c\u7684\u8bad\u7ec3\u5206\u8fa8\u7387\u4e2d\uff0c\u7136\u540e\u5728\u6bcf\u4e2abucket\u5185\u521b\u5efa\u6279\u6b21\uff0c\u4ee5\u7edf\u4e00\u6279\u6b21\u5185\u7684\u56fe\u50cf\u5927\u5c0f\u3002","title":"\u4ee5\u975e\u6b63\u65b9\u5f62\u5206\u8fa8\u7387\u8fdb\u884c\u8bad\u7ec3"},{"location":"sd-scripts-docs/fine_tune/#75225","text":"Stable Diffusion\u7684\u6700\u5927\u6807\u8bb0\u957f\u5ea6\u662f75\uff08\u5305\u62ec\u5f00\u59cb\u548c\u7ed3\u675f\u6807\u8bb0\u662f77\uff09\uff0c\u8fd9\u91cc\u5c06\u5176\u6269\u5c55\u5230225\u3002 \u4f46\u662f\uff0c\u7531\u4e8eCLIP\u7684\u6700\u5927\u63a5\u53d7\u957f\u5ea6\u662f75\uff0c\u56e0\u6b64\u5728\u6807\u8bb0\u957f\u5ea6\u4e3a225\u65f6\uff0c\u4f1a\u7b80\u5355\u5730\u5c06\u5176\u5206\u6210\u4e09\u90e8\u5206\uff0c\u5206\u522b\u8c03\u7528CLIP\uff0c\u7136\u540e\u5c06\u7ed3\u679c\u8fde\u63a5\u8d77\u6765\u3002 *\u6ce8\u610f\uff1a\u8fd9\u79cd\u5b9e\u73b0\u65b9\u5f0f\u662f\u5426\u5408\u9002\u5c1a\u4e0d\u660e\u786e\u3002\u76ee\u524d\u770b\u6765\u662f\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u7684\u3002\u7279\u522b\u662f\u57282.0\u7248\u672c\u4e2d\uff0c\u6ca1\u6709\u53ef\u4ee5\u53c2\u8003\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u56e0\u6b64\u91c7\u7528\u4e86\u72ec\u81ea\u7684\u5b9e\u73b0\u65b9\u5f0f\u3002 *\u6ce8\u610f\uff1a\u5728Automatic1111\u7684Web UI\u4e2d\uff0c\u4f3c\u4e4e\u4f1a\u6839\u636e\u9017\u53f7\u8fdb\u884c\u5206\u5272\uff0c\u4f46\u8fd9\u91cc\u53ea\u662f\u8fdb\u884c\u4e86\u7b80\u5355\u7684\u5206\u5272\u3002","title":"\u5c06\u6807\u8bb0\u957f\u5ea6\u4ece75\u6269\u5c55\u5230225"},{"location":"sd-scripts-docs/fine_tune/#_4","text":"\u8bf7\u9884\u5148\u53c2\u8003\u672c\u4ed3\u5e93\u7684README\uff0c\u8fdb\u884c\u73af\u5883\u8bbe\u7f6e\u3002","title":"\u8bad\u7ec3\u6b65\u9aa4"},{"location":"sd-scripts-docs/fine_tune/#_5","text":"\u8bf7\u53c2\u8003 \u5173\u4e8e\u8bad\u7ec3\u6570\u636e\u7684\u51c6\u5907 \u3002fine tuning\u4ec5\u652f\u6301\u4f7f\u7528\u5143\u6570\u636e\u7684fine tuning\u65b9\u5f0f\u3002","title":"\u6570\u636e\u51c6\u5907"},{"location":"sd-scripts-docs/fine_tune/#_6","text":"\u4f8b\u5982\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u6267\u884c\u8bad\u7ec3\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u4e3a\u4e86\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\u7684\u8bbe\u7f6e\u793a\u4f8b\u3002\u8bf7\u6839\u636e\u9700\u8981\u4fee\u6539\u6bcf\u4e00\u884c\u3002 accelerate launch --num_cpu_threads_per_process 1 fine_tune.py --pretrained_model_name_or_path=<.ckpt\u6216.safetensors\u6216Diffusers\u6a21\u578b\u76ee\u5f55> --output_dir=<\u8bad\u7ec3\u597d\u7684\u6a21\u578b\u7684\u8f93\u51fa\u76ee\u5f55> --output_name=<\u8bad\u7ec3\u597d\u7684\u6a21\u578b\u8f93\u51fa\u65f6\u7684\u6587\u4ef6\u540d> --dataset_config=<\u6570\u636e\u51c6\u5907\u65f6\u521b\u5efa\u7684.toml\u6587\u4ef6> --save_model_as=safetensors --learning_rate=5e-6 --max_train_steps=10000 --use_8bit_adam --xformers --gradient_checkpointing --mixed_precision=fp16 num_cpu_threads_per_process \u901a\u5e38\u8bbe\u7f6e\u4e3a1\u3002 \u5728 pretrained_model_name_or_path \u4e2d\u6307\u5b9a\u7528\u4e8e\u8fdb\u884c\u989d\u5916\u8bad\u7ec3\u7684\u539f\u59cb\u6a21\u578b\u3002\u53ef\u4ee5\u6307\u5b9aStable Diffusion\u7684checkpoint\u6587\u4ef6\uff08.ckpt\u6216.safetensors\uff09\u3001Diffusers\u7684\u672c\u5730\u78c1\u76d8\u4e0a\u7684\u6a21\u578b\u76ee\u5f55\u3001Diffusers\u7684\u6a21\u578bID\uff08\u4f8b\u5982\"stabilityai/stable-diffusion-2\"\uff09\u3002 \u5728 output_dir \u4e2d\u6307\u5b9a\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u7684\u4fdd\u5b58\u76ee\u5f55\u3002\u5728 output_name \u4e2d\u6307\u5b9a\u6a21\u578b\u7684\u6587\u4ef6\u540d\uff08\u4e0d\u5305\u62ec\u6269\u5c55\u540d\uff09\u3002\u901a\u8fc7 save_model_as \u6307\u5b9a\u4ee5safetensors\u683c\u5f0f\u4fdd\u5b58\u6a21\u578b\u3002 \u5728 dataset_config \u4e2d\u6307\u5b9a .toml \u6587\u4ef6\u3002\u5728\u6587\u4ef6\u5185\uff0c\u521d\u59cb\u7684\u6279\u6b21\u5927\u5c0f\u5e94\u8bbe\u7f6e\u4e3a 1 \u4ee5\u51cf\u5c11\u5185\u5b58\u6d88\u8017\u3002 \u5c06\u8bad\u7ec3\u6b65\u6570 max_train_steps \u8bbe\u7f6e\u4e3a10000\u3002\u8fd9\u91cc\u5c06\u5b66\u4e60\u7387 learning_rate \u8bbe\u7f6e\u4e3a5e-6\u3002 \u4e3a\u4e86\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff0c\u6307\u5b9a mixed_precision=\"fp16\" \uff08\u5728RTX30\u7cfb\u5217\u4e4b\u540e\u7684\u663e\u5361\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a bf16 \u3002\u8bf7\u4e0e\u5728\u73af\u5883\u8bbe\u7f6e\u65f6\u5bf9accelerate\u8fdb\u884c\u7684\u8bbe\u7f6e\u4fdd\u6301\u4e00\u81f4\uff09\u3002\u540c\u65f6\u6307\u5b9a gradient_checkpointing \u3002 \u4e3a\u4e86\u4f7f\u7528\u5185\u5b58\u6d88\u8017\u8f83\u5c11\u76848bit AdamW\u4f5c\u4e3a\u4f18\u5316\u5668\uff08\u7528\u4e8e\u5c06\u6a21\u578b\u4f18\u5316/\u8bad\u7ec3\u5230\u9002\u5e94\u8bad\u7ec3\u6570\u636e\u7684\u7c7b\uff09\uff0c\u6307\u5b9a optimizer_type=\"AdamW8bit\" \u3002 \u6307\u5b9a xformers \u9009\u9879\uff0c\u4f7f\u7528xformers\u7684CrossAttention\u3002\u5982\u679c\u6ca1\u6709\u5b89\u88c5xformers\u6216\u51fa\u73b0\u9519\u8bef\uff08\u5728\u67d0\u4e9b\u73af\u5883\u4e0b\uff0c\u5f53 mixed_precision=\"no\" \u65f6\u53ef\u80fd\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff09\uff0c\u53ef\u4ee5\u6539\u4e3a\u6307\u5b9a mem_eff_attn \u9009\u9879\uff0c\u4f7f\u7528\u8282\u7701\u5185\u5b58\u7248\u672c\u7684CrossAttention\uff08\u901f\u5ea6\u4f1a\u53d8\u6162\uff09\u3002 \u5982\u679c\u5185\u5b58\u8db3\u591f\uff0c\u53ef\u4ee5\u7f16\u8f91 .toml \u6587\u4ef6\uff0c\u5c06\u6279\u6b21\u5927\u5c0f\u589e\u52a0\u5230\u4f8b\u5982 4 \uff08\u53ef\u80fd\u4f1a\u63d0\u9ad8\u901f\u5ea6\u548c\u7cbe\u5ea6\uff09\u3002","title":"\u6267\u884c\u8bad\u7ec3"},{"location":"sd-scripts-docs/fine_tune/#_7","text":"\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\uff0c\u8bf7\u53c2\u8003\u6709\u5173\u9009\u9879\u7684\u6587\u6863\u3002 \u8bad\u7ec3Stable Diffusion 2.x\u6216\u4ece\u4e2d\u6d3e\u751f\u7684\u6a21\u578b \u8bad\u7ec3clip skip\u4e3a2\u6216\u4ee5\u4e0a\u7684\u6a21\u578b \u4f7f\u7528\u8d85\u8fc775\u4e2a\u6807\u8bb0\u7684\u6807\u6ce8\u8fdb\u884c\u8bad\u7ec3","title":"\u5e38\u89c1\u9009\u9879"},{"location":"sd-scripts-docs/fine_tune/#_8","text":"\u7531\u4e8e\u662f\u5bf9\u6574\u4e2a\u6a21\u578b\u8fdb\u884c\u8bad\u7ec3\uff0c\u4e0eLoRA\u7b49\u76f8\u6bd4\uff0c\u5185\u5b58\u6d88\u8017\u4f1a\u66f4\u5927\uff08\u4e0eDreamBooth\u76f8\u540c\uff09\u3002","title":"\u5173\u4e8e\u6279\u6b21\u5927\u5c0f"},{"location":"sd-scripts-docs/fine_tune/#_9","text":"\u901a\u5e38\u4f7f\u75281e-6\u52305e-6\u5de6\u53f3\u7684\u5b66\u4e60\u7387\u3002\u53ef\u4ee5\u53c2\u8003\u5176\u4ed6fine tuning\u7684\u4f8b\u5b50\u3002","title":"\u5173\u4e8e\u5b66\u4e60\u7387"},{"location":"sd-scripts-docs/fine_tune/#_10","text":"\u901a\u8fc7\u9009\u9879\u6307\u5b9a\u5206\u8fa8\u7387\u548c\u6279\u6b21\u5927\u5c0f\u3002\u547d\u4ee4\u884c\u793a\u4f8b\u5982\u4e0b\u3002 accelerate launch --num_cpu_threads_per_process 1 fine_tune.py --pretrained_model_name_or_path=model.ckpt --in_json meta_lat.json --train_data_dir=train_data --output_dir=fine_tuned --shuffle_caption --train_batch_size=1 --learning_rate=5e-6 --max_train_steps=10000 --use_8bit_adam --xformers --gradient_checkpointing --mixed_precision=bf16 --save_every_n_epochs=4","title":"\u4ee5\u524d\u7684\u683c\u5f0f\u7684\u6570\u636e\u96c6\u6307\u5b9a\u7684\u547d\u4ee4\u884c"},{"location":"sd-scripts-docs/fine_tune/#fine-tuning","text":"\u5173\u4e8e\u6240\u6709\u9009\u9879\uff0c\u8bf7\u53c2\u8003\u5176\u4ed6\u6587\u6863\u3002","title":"fine tuning\u7279\u6709\u7684\u5176\u4ed6\u4e3b\u8981\u9009\u9879"},{"location":"sd-scripts-docs/fine_tune/#train_text_encoder","text":"\u5c06Text Encoder\u4e5f\u4f5c\u4e3a\u8bad\u7ec3\u5bf9\u8c61\u3002\u5185\u5b58\u4f7f\u7528\u91cf\u4f1a\u7565\u5fae\u589e\u52a0\u3002 \u5728\u901a\u5e38\u7684fine tuning\u4e2d\uff0c\u4e0d\u5c06Text Encoder\u4f5c\u4e3a\u8bad\u7ec3\u5bf9\u8c61\uff08\u53ef\u80fd\u662f\u56e0\u4e3aU-Net\u662f\u6839\u636eText Encoder\u7684\u8f93\u51fa\u8fdb\u884c\u8bad\u7ec3\u7684\uff09\uff0c\u4f46\u5728\u8bad\u7ec3\u6570\u636e\u8f83\u5c11\u7684\u60c5\u51b5\u4e0b\uff0c\u50cfDreamBooth\u4e00\u6837\u5bf9Text Encoder\u8fdb\u884c\u8bad\u7ec3\u4f3c\u4e4e\u4e5f\u662f\u6709\u6548\u7684\u3002","title":"train_text_encoder"},{"location":"sd-scripts-docs/fine_tune/#diffusers_xformers","text":"\u4f7f\u7528Diffusers\u7684xformers\u529f\u80fd\uff0c\u800c\u4e0d\u662f\u811a\u672c\u81ea\u6709\u7684xformers\u66ff\u6362\u529f\u80fd\u3002\u8fd9\u6837\u5c31\u65e0\u6cd5\u8fdb\u884cHypernetwork\u7684\u8bad\u7ec3\u3002","title":"diffusers_xformers"},{"location":"sd-scripts-docs/flux_train/","text":"flux_train.md \u4f7f\u7528 flux_train_network.py \u8bad\u7ec3 FLUX.1 \u6a21\u578b\u7684 LoRA \u6307\u5357 \u672c\u6587\u6863\u4ecb\u7ecd\u4e86\u5982\u4f55\u4f7f\u7528 sd-scripts \u4ed3\u5e93\u4e2d\u7684 flux_train_network.py \u811a\u672c\u6765\u8bad\u7ec3 FLUX.1 \u6a21\u578b\u7684 LoRA\uff08\u4f4e\u79e9\u81ea\u9002\u5e94\uff09\u6a21\u578b\u3002 1. \u7b80\u4ecb flux_train_network.py \u662f\u4e00\u4e2a\u7528\u4e8e\u8bad\u7ec3 FLUX.1 \u6a21\u578b\u7684\u9644\u52a0\u7f51\u7edc\uff08\u5982 LoRA\uff09\u7684\u811a\u672c\u3002FLUX.1 \u662f\u4e00\u4e2a\u56fe\u50cf\u751f\u6210\u6a21\u578b\uff0c\u5176\u67b6\u6784\u4e0e Stable Diffusion \u4e0d\u540c\u3002\u4f7f\u7528\u6b64\u811a\u672c\uff0c\u60a8\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a LoRA \u6a21\u578b\uff0c\u4ee5\u518d\u73b0\u7279\u5b9a\u7684\u89d2\u8272\u6216\u7ed8\u753b\u98ce\u683c\u3002 \u672c\u6307\u5357\u9762\u5411\u5df2\u7ecf\u4e86\u89e3 LoRA \u8bad\u7ec3\u57fa\u672c\u6b65\u9aa4\u7684\u7528\u6237\uff0c\u5e76\u5047\u8bbe\u60a8\u6709\u4f7f\u7528 train_network.py \u8fdb\u884c\u8bad\u7ec3\u7684\u7ecf\u9a8c\u3002\u6709\u5173\u57fa\u672c\u7528\u6cd5\u548c\u901a\u7528\u9009\u9879\uff0c\u8bf7\u53c2\u9605 train_network.py \u6307\u5357 \u3002 \u524d\u63d0\u6761\u4ef6\uff1a \u5df2\u514b\u9686 sd-scripts \u4ed3\u5e93\u5e76\u5b8c\u6210 Python \u73af\u5883\u7684\u8bbe\u7f6e\u3002 \u5df2\u51c6\u5907\u597d\u7528\u4e8e\u8bad\u7ec3\u7684\u6570\u636e\u96c6\u3002\uff08\u6709\u5173\u6570\u636e\u96c6\u7684\u51c6\u5907\uff0c\u8bf7\u53c2\u9605 \u6570\u636e\u96c6\u914d\u7f6e\u6307\u5357 \u3002\uff09 2. \u4e0e train_network.py \u7684\u533a\u522b flux_train_network.py \u57fa\u4e8e train_network.py \uff0c\u5e76\u9488\u5bf9 FLUX.1 \u6a21\u578b\u8fdb\u884c\u4e86\u4fee\u6539\u3002\u4e3b\u8981\u533a\u522b\u5982\u4e0b\uff1a \u76ee\u6807\u6a21\u578b\uff1a \u652f\u6301 FLUX.1 \u6a21\u578b\uff08dev \u6216 schnell \u7248\u672c\uff09\u3002 \u6a21\u578b\u67b6\u6784\uff1a \u4e0e Stable Diffusion \u4e0d\u540c\uff0cFLUX.1 \u91c7\u7528\u57fa\u4e8e Transformer \u7684\u67b6\u6784\u3002\u5b83\u4f7f\u7528 CLIP-L \u548c T5-XXL \u4e24\u4e2a\u6587\u672c\u7f16\u7801\u5668\uff0c\u5e76\u4f7f\u7528\u4e13\u7528\u7684\u81ea\u52a8\u7f16\u7801\u5668\uff08AE\uff09\u4ee3\u66ff VAE\u3002 \u5fc5\u9700\u53c2\u6570\uff1a \u9700\u8981\u6307\u5b9a FLUX.1 \u6a21\u578b\u3001CLIP-L\u3001T5-XXL \u548c AE \u7684\u6a21\u578b\u6587\u4ef6\u8def\u5f84\u3002 \u90e8\u5206\u53c2\u6570\u4e0d\u517c\u5bb9\uff1a \u4e00\u4e9b\u9488\u5bf9 Stable Diffusion \u7684\u53c2\u6570\uff08\u4f8b\u5982 --v2 , --clip_skip , --max_token_length \uff09\u4e0d\u9002\u7528\u4e8e FLUX.1 \u8bad\u7ec3\u3002 FLUX.1 \u7279\u6709\u53c2\u6570\uff1a \u6dfb\u52a0\u4e86\u7528\u4e8e\u6307\u5b9a FLUX.1 \u7279\u6709\u8bad\u7ec3\u53c2\u6570\u7684\u53c2\u6570\uff0c\u4f8b\u5982\u65f6\u95f4\u6b65\u91c7\u6837\u65b9\u6cd5\u548c\u5f15\u5bfc\u5c3a\u5ea6\u3002 3. \u51c6\u5907 \u5f00\u59cb\u8bad\u7ec3\u524d\uff0c\u60a8\u9700\u8981\u51c6\u5907\u4ee5\u4e0b\u6587\u4ef6\uff1a \u8bad\u7ec3\u811a\u672c\uff1a flux_train_network.py FLUX.1 \u6a21\u578b\u6587\u4ef6\uff1a \u7528\u4f5c\u8bad\u7ec3\u57fa\u7840\u7684 FLUX.1 \u6a21\u578b\u7684 .safetensors \u6587\u4ef6\uff08\u4f8b\u5982 flux1-dev.safetensors \uff09\u3002 \u6587\u672c\u7f16\u7801\u5668\u6a21\u578b\u6587\u4ef6\uff1a CLIP-L \u6a21\u578b\u7684 .safetensors \u6587\u4ef6\u3002 T5-XXL \u6a21\u578b\u7684 .safetensors \u6587\u4ef6\u3002 \u81ea\u52a8\u7f16\u7801\u5668\u6a21\u578b\u6587\u4ef6\uff1a \u4e0e FLUX.1 \u76f8\u5bf9\u5e94\u7684 AE \u6a21\u578b\u7684 .safetensors \u6587\u4ef6\u3002 \u6570\u636e\u96c6\u5b9a\u4e49\u6587\u4ef6 (.toml)\uff1a \u4e00\u4e2a TOML \u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u7528\u4e8e\u63cf\u8ff0\u8bad\u7ec3\u6570\u636e\u96c6\u7684\u914d\u7f6e\u3002\uff08\u8be6\u89c1 \u6570\u636e\u96c6\u914d\u7f6e\u6307\u5357 \u3002\uff09 \u8fd9\u91cc\u4ee5 my_flux_dataset_config.toml \u4e3a\u4f8b\u3002 4. \u5f00\u59cb\u8bad\u7ec3 \u901a\u8fc7\u5728\u7ec8\u7aef\u4e2d\u8fd0\u884c flux_train_network.py \u6765\u5f00\u59cb\u8bad\u7ec3\u3002\u57fa\u672c\u547d\u4ee4\u884c\u7ed3\u6784\u4e0e train_network.py \u7c7b\u4f3c\uff0c\u4f46\u9700\u8981\u6307\u5b9a FLUX.1 \u7279\u6709\u7684\u53c2\u6570\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u57fa\u672c\u7684\u547d\u4ee4\u884c\u793a\u4f8b\uff1a accelerate launch --num_cpu_threads_per_process 1 flux_train_network.py --pretrained_model_name_or_path=\"<FLUX.1 \u6a21\u578b\u8def\u5f84>\" --clip_l=\"<CLIP-L \u6a21\u578b\u8def\u5f84>\" --t5xxl=\"<T5-XXL \u6a21\u578b\u8def\u5f84>\" --ae=\"<AE \u6a21\u578b\u8def\u5f84>\" --dataset_config=\"my_flux_dataset_config.toml\" --output_dir=\"<\u8bad\u7ec3\u7ed3\u679c\u8f93\u51fa\u76ee\u5f55>\" --output_name=\"my_flux_lora\" --save_model_as=safetensors --network_module=networks.lora --network_dim=16 --network_alpha=1 --learning_rate=1e-4 --optimizer_type=\"AdamW8bit\" --lr_scheduler=\"constant\" --sdpa --max_train_epochs=10 --save_every_n_epochs=1 --mixed_precision=\"fp16\" --gradient_checkpointing --apply_t5_attn_mask --blocks_to_swap=18 \u203b \u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u8bf7\u786e\u4fdd\u547d\u4ee4\u5199\u5728\u4e00\u884c\uff0c\u6216\u4f7f\u7528\u9002\u5f53\u7684\u6362\u884c\u7b26\uff08 \\ \u6216 ^ \uff09\u3002 4.1. \u4e3b\u8981\u547d\u4ee4\u884c\u53c2\u6570\u8bf4\u660e\uff08\u4e0e train_network.py \u76f8\u6bd4\u65b0\u589e\u6216\u4fee\u6539\u7684\u90e8\u5206\uff09 \u9664\u4e86 train_network.py \u6307\u5357 \u4e2d\u4ecb\u7ecd\u7684\u53c2\u6570\u5916\uff0c\u60a8\u8fd8\u9700\u8981\u6307\u5b9a\u4ee5\u4e0b FLUX.1 \u7279\u6709\u7684\u53c2\u6570\u3002\u6709\u5173\u901a\u7528\u53c2\u6570\uff08\u4f8b\u5982 --output_dir , --output_name , --network_module , --network_dim , --network_alpha , --learning_rate \u7b49\uff09\uff0c\u8bf7\u53c2\u8003\u4e0a\u8ff0\u6307\u5357\u3002 \u6a21\u578b\u76f8\u5173 [\u5fc5\u9700] --pretrained_model_name_or_path=\"<FLUX.1 \u6a21\u578b\u8def\u5f84>\" [\u5fc5\u9700] \u6307\u5b9a\u7528\u4f5c\u8bad\u7ec3\u57fa\u7840\u7684 FLUX.1 \u6a21\u578b\uff08dev \u6216 schnell \u7248\u672c\uff09\u7684 .safetensors \u6587\u4ef6\u8def\u5f84\u3002\u76ee\u524d\u4e0d\u652f\u6301 Diffusers \u683c\u5f0f\u7684\u76ee\u5f55\u3002 --clip_l=\"<CLIP-L \u6a21\u578b\u8def\u5f84>\" [\u5fc5\u9700] \u6307\u5b9a CLIP-L \u6587\u672c\u7f16\u7801\u5668\u6a21\u578b\u7684 .safetensors \u6587\u4ef6\u8def\u5f84\u3002 --t5xxl=\"<T5-XXL \u6a21\u578b\u8def\u5f84>\" [\u5fc5\u9700] \u6307\u5b9a T5-XXL \u6587\u672c\u7f16\u7801\u5668\u6a21\u578b\u7684 .safetensors \u6587\u4ef6\u8def\u5f84\u3002 --ae=\"<AE \u6a21\u578b\u8def\u5f84>\" [\u5fc5\u9700] \u6307\u5b9a\u4e0e FLUX.1 \u5bf9\u5e94\u7684\u81ea\u52a8\u7f16\u7801\u5668\u6a21\u578b\u7684 .safetensors \u6587\u4ef6\u8def\u5f84\u3002 FLUX.1 \u8bad\u7ec3\u53c2\u6570 --t5xxl_max_token_length=<\u6574\u6570> \u6307\u5b9a T5-XXL \u6587\u672c\u7f16\u7801\u5668\u4f7f\u7528\u7684\u6700\u5927 token \u957f\u5ea6\u3002\u5982\u679c\u7701\u7565\uff0c\u5bf9\u4e8e schnell \u7248\u672c\u9ed8\u8ba4\u4e3a 256\uff0c\u5bf9\u4e8e dev \u7248\u672c\u9ed8\u8ba4\u4e3a 512\u3002\u60a8\u53ef\u80fd\u9700\u8981\u6839\u636e\u6570\u636e\u96c6\u7684\u6807\u9898\u957f\u5ea6\u8fdb\u884c\u8c03\u6574\u3002 --apply_t5_attn_mask \u5728 T5-XXL \u8f93\u51fa\u4e0e FLUX \u6a21\u578b\u5185\u90e8\uff08\u53cc\u5757\uff09\u6ce8\u610f\u529b\u8ba1\u7b97\u671f\u95f4\uff0c\u5e94\u7528\u4e0e\u586b\u5145 token \u5bf9\u5e94\u7684\u6ce8\u610f\u529b\u63a9\u7801\u3002\u8fd9\u53ef\u80fd\u4f1a\u63d0\u9ad8\u7cbe\u5ea6\uff0c\u4f46\u4f1a\u7565\u5fae\u589e\u52a0\u8ba1\u7b97\u6210\u672c\u3002 --guidance_scale=<\u6d6e\u70b9\u6570> FLUX.1 dev \u7248\u672c\u662f\u5728\u7279\u5b9a\u7684\u5f15\u5bfc\u5c3a\u5ea6\u503c\u4e0b\u8fdb\u884c\u84b8\u998f\u7684\uff0c\u56e0\u6b64\u5728\u8bad\u7ec3\u65f6\u4e5f\u9700\u8981\u6307\u5b9a\u8be5\u503c\u3002\u9ed8\u8ba4\u503c\u4e3a 3.5 \u3002\u5bf9\u4e8e schnell \u7248\u672c\uff0c\u901a\u5e38\u5ffd\u7565\u6b64\u53c2\u6570\u3002 --timestep_sampling=<\u9009\u9879> \u6307\u5b9a\u8bad\u7ec3\u671f\u95f4\u4f7f\u7528\u7684\u91c7\u6837\u65f6\u95f4\u6b65\uff08\u566a\u58f0\u6c34\u5e73\uff09\u7684\u65b9\u6cd5\u3002\u53ef\u9009\u62e9 sigma , uniform , sigmoid , shift , flux_shift \u3002\u9ed8\u8ba4\u503c\u4e3a sigma \u3002 --sigmoid_scale=<\u6d6e\u70b9\u6570> \u5f53 timestep_sampling \u6307\u5b9a\u4e3a sigmoid \u3001 shift \u6216 flux_shift \u65f6\u7684\u7f29\u653e\u7cfb\u6570\u3002\u9ed8\u8ba4\u503c\u4e3a 1.0 \u3002 --model_prediction_type=<\u9009\u9879> \u6307\u5b9a\u6a21\u578b\u9884\u6d4b\u7684\u5185\u5bb9\u3002\u53ef\u9009\u62e9 raw \uff08\u76f4\u63a5\u4f7f\u7528\u9884\u6d4b\u503c\uff09\u3001 additive \uff08\u5c06\u9884\u6d4b\u503c\u6dfb\u52a0\u5230\u566a\u58f0\u8f93\u5165\uff09\u3001 sigma_scaled \uff08\u5e94\u7528 sigma \u7f29\u653e\uff09\u3002\u9ed8\u8ba4\u503c\u4e3a sigma_scaled \u3002 --discrete_flow_shift=<\u6d6e\u70b9\u6570> \u6307\u5b9a\u6d41\u5339\u914d\u4e2d\u4f7f\u7528\u7684\u8c03\u5ea6\u5668\u7684\u504f\u79fb\u503c\u3002\u9ed8\u8ba4\u503c\u4e3a 3.0 \u3002 \u5185\u5b58\u548c\u901f\u5ea6\u76f8\u5173 --blocks_to_swap=<\u6574\u6570> [\u5b9e\u9a8c\u6027\u529f\u80fd] \u4e3a\u4e86\u51cf\u5c11 VRAM \u4f7f\u7528\u91cf\uff0c\u53ef\u4ee5\u5728 CPU \u548c GPU \u4e4b\u95f4\u4ea4\u6362\u6a21\u578b\u7684\u90e8\u5206\uff08Transformer \u5757\uff09\u3002\u6307\u5b9a\u8981\u4ea4\u6362\u7684\u5757\u6570\uff08\u4f8b\u5982 18 \uff09\u3002\u589e\u52a0\u6b64\u503c\u4f1a\u51cf\u5c11 VRAM \u4f7f\u7528\u91cf\uff0c\u4f46\u4f1a\u964d\u4f4e\u8bad\u7ec3\u901f\u5ea6\u3002\u8bf7\u6839\u636e\u60a8\u7684 GPU VRAM \u5bb9\u91cf\u8fdb\u884c\u8c03\u6574\u3002\u8be5\u53c2\u6570\u53ef\u4e0e gradient_checkpointing \u4e00\u8d77\u4f7f\u7528\u3002 \u4e0d\u80fd\u4e0e --cpu_offload_checkpointing \u540c\u65f6\u4f7f\u7528\u3002 \u4e0d\u517c\u5bb9\u6216\u5df2\u5f03\u7528\u7684\u53c2\u6570 --v2 , --v_parameterization , --clip_skip \uff1a\u8fd9\u4e9b\u662f Stable Diffusion \u7279\u6709\u7684\u53c2\u6570\uff0c\u4e0d\u7528\u4e8e FLUX.1 \u8bad\u7ec3\u3002 --max_token_length \uff1a\u8fd9\u662f\u9488\u5bf9 Stable Diffusion v1/v2 \u7684\u53c2\u6570\u3002\u5bf9\u4e8e FLUX.1\uff0c\u8bf7\u4f7f\u7528 --t5xxl_max_token_length \u3002 --split_mode \uff1a\u5df2\u5f03\u7528\u3002\u8bf7\u4f7f\u7528 --blocks_to_swap \u4ee3\u66ff\u3002 4.2. \u5f00\u59cb\u8bad\u7ec3 \u8bbe\u7f6e\u597d\u5fc5\u8981\u7684\u53c2\u6570\u5e76\u8fd0\u884c\u547d\u4ee4\u540e\uff0c\u8bad\u7ec3\u5c31\u4f1a\u5f00\u59cb\u3002\u57fa\u672c\u6d41\u7a0b\u548c\u65e5\u5fd7\u67e5\u770b\u65b9\u6cd5\u4e0e train_network.py \u6307\u5357 \u76f8\u540c\u3002 5. \u4f7f\u7528\u8bad\u7ec3\u597d\u7684\u6a21\u578b \u8bad\u7ec3\u5b8c\u6210\u540e\uff0cLoRA \u6a21\u578b\u6587\u4ef6\uff08\u4f8b\u5982 my_flux_lora.safetensors \uff09\u5c06\u88ab\u4fdd\u5b58\u5230\u6307\u5b9a\u7684 output_dir \u3002\u8be5\u6587\u4ef6\u53ef\u5728\u652f\u6301 FLUX.1 \u6a21\u578b\u7684\u63a8\u7406\u73af\u5883\uff08\u4f8b\u5982 ComfyUI + ComfyUI-FluxNodes\uff09\u4e2d\u4f7f\u7528\u3002 6. \u5176\u4ed6\u529f\u80fd flux_train_network.py \u8fd8\u5305\u542b\u8bb8\u591a\u4e0e train_network.py \u76f8\u540c\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u751f\u6210\u793a\u4f8b\u56fe\u50cf\uff08\u4f7f\u7528 --sample_prompts \u7b49\uff09\u548c\u8be6\u7ec6\u7684\u4f18\u5316\u5668\u8bbe\u7f6e\u3002\u6709\u5173\u8fd9\u4e9b\u529f\u80fd\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 train_network.py \u6307\u5357 \u6216\u8fd0\u884c\u811a\u672c\u7684\u5e2e\u52a9\u547d\u4ee4 ( python flux_train_network.py --help )\u3002","title":"Flux-\u6a21\u578b\u8bad\u7ec3"},{"location":"sd-scripts-docs/flux_train/#flux_train_networkpy-flux1-lora","text":"\u672c\u6587\u6863\u4ecb\u7ecd\u4e86\u5982\u4f55\u4f7f\u7528 sd-scripts \u4ed3\u5e93\u4e2d\u7684 flux_train_network.py \u811a\u672c\u6765\u8bad\u7ec3 FLUX.1 \u6a21\u578b\u7684 LoRA\uff08\u4f4e\u79e9\u81ea\u9002\u5e94\uff09\u6a21\u578b\u3002","title":"\u4f7f\u7528 flux_train_network.py \u8bad\u7ec3 FLUX.1 \u6a21\u578b\u7684 LoRA \u6307\u5357"},{"location":"sd-scripts-docs/flux_train/#1","text":"flux_train_network.py \u662f\u4e00\u4e2a\u7528\u4e8e\u8bad\u7ec3 FLUX.1 \u6a21\u578b\u7684\u9644\u52a0\u7f51\u7edc\uff08\u5982 LoRA\uff09\u7684\u811a\u672c\u3002FLUX.1 \u662f\u4e00\u4e2a\u56fe\u50cf\u751f\u6210\u6a21\u578b\uff0c\u5176\u67b6\u6784\u4e0e Stable Diffusion \u4e0d\u540c\u3002\u4f7f\u7528\u6b64\u811a\u672c\uff0c\u60a8\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a LoRA \u6a21\u578b\uff0c\u4ee5\u518d\u73b0\u7279\u5b9a\u7684\u89d2\u8272\u6216\u7ed8\u753b\u98ce\u683c\u3002 \u672c\u6307\u5357\u9762\u5411\u5df2\u7ecf\u4e86\u89e3 LoRA \u8bad\u7ec3\u57fa\u672c\u6b65\u9aa4\u7684\u7528\u6237\uff0c\u5e76\u5047\u8bbe\u60a8\u6709\u4f7f\u7528 train_network.py \u8fdb\u884c\u8bad\u7ec3\u7684\u7ecf\u9a8c\u3002\u6709\u5173\u57fa\u672c\u7528\u6cd5\u548c\u901a\u7528\u9009\u9879\uff0c\u8bf7\u53c2\u9605 train_network.py \u6307\u5357 \u3002 \u524d\u63d0\u6761\u4ef6\uff1a \u5df2\u514b\u9686 sd-scripts \u4ed3\u5e93\u5e76\u5b8c\u6210 Python \u73af\u5883\u7684\u8bbe\u7f6e\u3002 \u5df2\u51c6\u5907\u597d\u7528\u4e8e\u8bad\u7ec3\u7684\u6570\u636e\u96c6\u3002\uff08\u6709\u5173\u6570\u636e\u96c6\u7684\u51c6\u5907\uff0c\u8bf7\u53c2\u9605 \u6570\u636e\u96c6\u914d\u7f6e\u6307\u5357 \u3002\uff09","title":"1. \u7b80\u4ecb"},{"location":"sd-scripts-docs/flux_train/#2-train_networkpy","text":"flux_train_network.py \u57fa\u4e8e train_network.py \uff0c\u5e76\u9488\u5bf9 FLUX.1 \u6a21\u578b\u8fdb\u884c\u4e86\u4fee\u6539\u3002\u4e3b\u8981\u533a\u522b\u5982\u4e0b\uff1a \u76ee\u6807\u6a21\u578b\uff1a \u652f\u6301 FLUX.1 \u6a21\u578b\uff08dev \u6216 schnell \u7248\u672c\uff09\u3002 \u6a21\u578b\u67b6\u6784\uff1a \u4e0e Stable Diffusion \u4e0d\u540c\uff0cFLUX.1 \u91c7\u7528\u57fa\u4e8e Transformer \u7684\u67b6\u6784\u3002\u5b83\u4f7f\u7528 CLIP-L \u548c T5-XXL \u4e24\u4e2a\u6587\u672c\u7f16\u7801\u5668\uff0c\u5e76\u4f7f\u7528\u4e13\u7528\u7684\u81ea\u52a8\u7f16\u7801\u5668\uff08AE\uff09\u4ee3\u66ff VAE\u3002 \u5fc5\u9700\u53c2\u6570\uff1a \u9700\u8981\u6307\u5b9a FLUX.1 \u6a21\u578b\u3001CLIP-L\u3001T5-XXL \u548c AE \u7684\u6a21\u578b\u6587\u4ef6\u8def\u5f84\u3002 \u90e8\u5206\u53c2\u6570\u4e0d\u517c\u5bb9\uff1a \u4e00\u4e9b\u9488\u5bf9 Stable Diffusion \u7684\u53c2\u6570\uff08\u4f8b\u5982 --v2 , --clip_skip , --max_token_length \uff09\u4e0d\u9002\u7528\u4e8e FLUX.1 \u8bad\u7ec3\u3002 FLUX.1 \u7279\u6709\u53c2\u6570\uff1a \u6dfb\u52a0\u4e86\u7528\u4e8e\u6307\u5b9a FLUX.1 \u7279\u6709\u8bad\u7ec3\u53c2\u6570\u7684\u53c2\u6570\uff0c\u4f8b\u5982\u65f6\u95f4\u6b65\u91c7\u6837\u65b9\u6cd5\u548c\u5f15\u5bfc\u5c3a\u5ea6\u3002","title":"2. \u4e0e train_network.py \u7684\u533a\u522b"},{"location":"sd-scripts-docs/flux_train/#3","text":"\u5f00\u59cb\u8bad\u7ec3\u524d\uff0c\u60a8\u9700\u8981\u51c6\u5907\u4ee5\u4e0b\u6587\u4ef6\uff1a \u8bad\u7ec3\u811a\u672c\uff1a flux_train_network.py FLUX.1 \u6a21\u578b\u6587\u4ef6\uff1a \u7528\u4f5c\u8bad\u7ec3\u57fa\u7840\u7684 FLUX.1 \u6a21\u578b\u7684 .safetensors \u6587\u4ef6\uff08\u4f8b\u5982 flux1-dev.safetensors \uff09\u3002 \u6587\u672c\u7f16\u7801\u5668\u6a21\u578b\u6587\u4ef6\uff1a CLIP-L \u6a21\u578b\u7684 .safetensors \u6587\u4ef6\u3002 T5-XXL \u6a21\u578b\u7684 .safetensors \u6587\u4ef6\u3002 \u81ea\u52a8\u7f16\u7801\u5668\u6a21\u578b\u6587\u4ef6\uff1a \u4e0e FLUX.1 \u76f8\u5bf9\u5e94\u7684 AE \u6a21\u578b\u7684 .safetensors \u6587\u4ef6\u3002 \u6570\u636e\u96c6\u5b9a\u4e49\u6587\u4ef6 (.toml)\uff1a \u4e00\u4e2a TOML \u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u7528\u4e8e\u63cf\u8ff0\u8bad\u7ec3\u6570\u636e\u96c6\u7684\u914d\u7f6e\u3002\uff08\u8be6\u89c1 \u6570\u636e\u96c6\u914d\u7f6e\u6307\u5357 \u3002\uff09 \u8fd9\u91cc\u4ee5 my_flux_dataset_config.toml \u4e3a\u4f8b\u3002","title":"3. \u51c6\u5907"},{"location":"sd-scripts-docs/flux_train/#4","text":"\u901a\u8fc7\u5728\u7ec8\u7aef\u4e2d\u8fd0\u884c flux_train_network.py \u6765\u5f00\u59cb\u8bad\u7ec3\u3002\u57fa\u672c\u547d\u4ee4\u884c\u7ed3\u6784\u4e0e train_network.py \u7c7b\u4f3c\uff0c\u4f46\u9700\u8981\u6307\u5b9a FLUX.1 \u7279\u6709\u7684\u53c2\u6570\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u57fa\u672c\u7684\u547d\u4ee4\u884c\u793a\u4f8b\uff1a accelerate launch --num_cpu_threads_per_process 1 flux_train_network.py --pretrained_model_name_or_path=\"<FLUX.1 \u6a21\u578b\u8def\u5f84>\" --clip_l=\"<CLIP-L \u6a21\u578b\u8def\u5f84>\" --t5xxl=\"<T5-XXL \u6a21\u578b\u8def\u5f84>\" --ae=\"<AE \u6a21\u578b\u8def\u5f84>\" --dataset_config=\"my_flux_dataset_config.toml\" --output_dir=\"<\u8bad\u7ec3\u7ed3\u679c\u8f93\u51fa\u76ee\u5f55>\" --output_name=\"my_flux_lora\" --save_model_as=safetensors --network_module=networks.lora --network_dim=16 --network_alpha=1 --learning_rate=1e-4 --optimizer_type=\"AdamW8bit\" --lr_scheduler=\"constant\" --sdpa --max_train_epochs=10 --save_every_n_epochs=1 --mixed_precision=\"fp16\" --gradient_checkpointing --apply_t5_attn_mask --blocks_to_swap=18 \u203b \u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u8bf7\u786e\u4fdd\u547d\u4ee4\u5199\u5728\u4e00\u884c\uff0c\u6216\u4f7f\u7528\u9002\u5f53\u7684\u6362\u884c\u7b26\uff08 \\ \u6216 ^ \uff09\u3002","title":"4. \u5f00\u59cb\u8bad\u7ec3"},{"location":"sd-scripts-docs/flux_train/#41-train_networkpy","text":"\u9664\u4e86 train_network.py \u6307\u5357 \u4e2d\u4ecb\u7ecd\u7684\u53c2\u6570\u5916\uff0c\u60a8\u8fd8\u9700\u8981\u6307\u5b9a\u4ee5\u4e0b FLUX.1 \u7279\u6709\u7684\u53c2\u6570\u3002\u6709\u5173\u901a\u7528\u53c2\u6570\uff08\u4f8b\u5982 --output_dir , --output_name , --network_module , --network_dim , --network_alpha , --learning_rate \u7b49\uff09\uff0c\u8bf7\u53c2\u8003\u4e0a\u8ff0\u6307\u5357\u3002","title":"4.1. \u4e3b\u8981\u547d\u4ee4\u884c\u53c2\u6570\u8bf4\u660e\uff08\u4e0e train_network.py \u76f8\u6bd4\u65b0\u589e\u6216\u4fee\u6539\u7684\u90e8\u5206\uff09"},{"location":"sd-scripts-docs/flux_train/#_1","text":"--pretrained_model_name_or_path=\"<FLUX.1 \u6a21\u578b\u8def\u5f84>\" [\u5fc5\u9700] \u6307\u5b9a\u7528\u4f5c\u8bad\u7ec3\u57fa\u7840\u7684 FLUX.1 \u6a21\u578b\uff08dev \u6216 schnell \u7248\u672c\uff09\u7684 .safetensors \u6587\u4ef6\u8def\u5f84\u3002\u76ee\u524d\u4e0d\u652f\u6301 Diffusers \u683c\u5f0f\u7684\u76ee\u5f55\u3002 --clip_l=\"<CLIP-L \u6a21\u578b\u8def\u5f84>\" [\u5fc5\u9700] \u6307\u5b9a CLIP-L \u6587\u672c\u7f16\u7801\u5668\u6a21\u578b\u7684 .safetensors \u6587\u4ef6\u8def\u5f84\u3002 --t5xxl=\"<T5-XXL \u6a21\u578b\u8def\u5f84>\" [\u5fc5\u9700] \u6307\u5b9a T5-XXL \u6587\u672c\u7f16\u7801\u5668\u6a21\u578b\u7684 .safetensors \u6587\u4ef6\u8def\u5f84\u3002 --ae=\"<AE \u6a21\u578b\u8def\u5f84>\" [\u5fc5\u9700] \u6307\u5b9a\u4e0e FLUX.1 \u5bf9\u5e94\u7684\u81ea\u52a8\u7f16\u7801\u5668\u6a21\u578b\u7684 .safetensors \u6587\u4ef6\u8def\u5f84\u3002","title":"\u6a21\u578b\u76f8\u5173 [\u5fc5\u9700]"},{"location":"sd-scripts-docs/flux_train/#flux1","text":"--t5xxl_max_token_length=<\u6574\u6570> \u6307\u5b9a T5-XXL \u6587\u672c\u7f16\u7801\u5668\u4f7f\u7528\u7684\u6700\u5927 token \u957f\u5ea6\u3002\u5982\u679c\u7701\u7565\uff0c\u5bf9\u4e8e schnell \u7248\u672c\u9ed8\u8ba4\u4e3a 256\uff0c\u5bf9\u4e8e dev \u7248\u672c\u9ed8\u8ba4\u4e3a 512\u3002\u60a8\u53ef\u80fd\u9700\u8981\u6839\u636e\u6570\u636e\u96c6\u7684\u6807\u9898\u957f\u5ea6\u8fdb\u884c\u8c03\u6574\u3002 --apply_t5_attn_mask \u5728 T5-XXL \u8f93\u51fa\u4e0e FLUX \u6a21\u578b\u5185\u90e8\uff08\u53cc\u5757\uff09\u6ce8\u610f\u529b\u8ba1\u7b97\u671f\u95f4\uff0c\u5e94\u7528\u4e0e\u586b\u5145 token \u5bf9\u5e94\u7684\u6ce8\u610f\u529b\u63a9\u7801\u3002\u8fd9\u53ef\u80fd\u4f1a\u63d0\u9ad8\u7cbe\u5ea6\uff0c\u4f46\u4f1a\u7565\u5fae\u589e\u52a0\u8ba1\u7b97\u6210\u672c\u3002 --guidance_scale=<\u6d6e\u70b9\u6570> FLUX.1 dev \u7248\u672c\u662f\u5728\u7279\u5b9a\u7684\u5f15\u5bfc\u5c3a\u5ea6\u503c\u4e0b\u8fdb\u884c\u84b8\u998f\u7684\uff0c\u56e0\u6b64\u5728\u8bad\u7ec3\u65f6\u4e5f\u9700\u8981\u6307\u5b9a\u8be5\u503c\u3002\u9ed8\u8ba4\u503c\u4e3a 3.5 \u3002\u5bf9\u4e8e schnell \u7248\u672c\uff0c\u901a\u5e38\u5ffd\u7565\u6b64\u53c2\u6570\u3002 --timestep_sampling=<\u9009\u9879> \u6307\u5b9a\u8bad\u7ec3\u671f\u95f4\u4f7f\u7528\u7684\u91c7\u6837\u65f6\u95f4\u6b65\uff08\u566a\u58f0\u6c34\u5e73\uff09\u7684\u65b9\u6cd5\u3002\u53ef\u9009\u62e9 sigma , uniform , sigmoid , shift , flux_shift \u3002\u9ed8\u8ba4\u503c\u4e3a sigma \u3002 --sigmoid_scale=<\u6d6e\u70b9\u6570> \u5f53 timestep_sampling \u6307\u5b9a\u4e3a sigmoid \u3001 shift \u6216 flux_shift \u65f6\u7684\u7f29\u653e\u7cfb\u6570\u3002\u9ed8\u8ba4\u503c\u4e3a 1.0 \u3002 --model_prediction_type=<\u9009\u9879> \u6307\u5b9a\u6a21\u578b\u9884\u6d4b\u7684\u5185\u5bb9\u3002\u53ef\u9009\u62e9 raw \uff08\u76f4\u63a5\u4f7f\u7528\u9884\u6d4b\u503c\uff09\u3001 additive \uff08\u5c06\u9884\u6d4b\u503c\u6dfb\u52a0\u5230\u566a\u58f0\u8f93\u5165\uff09\u3001 sigma_scaled \uff08\u5e94\u7528 sigma \u7f29\u653e\uff09\u3002\u9ed8\u8ba4\u503c\u4e3a sigma_scaled \u3002 --discrete_flow_shift=<\u6d6e\u70b9\u6570> \u6307\u5b9a\u6d41\u5339\u914d\u4e2d\u4f7f\u7528\u7684\u8c03\u5ea6\u5668\u7684\u504f\u79fb\u503c\u3002\u9ed8\u8ba4\u503c\u4e3a 3.0 \u3002","title":"FLUX.1 \u8bad\u7ec3\u53c2\u6570"},{"location":"sd-scripts-docs/flux_train/#_2","text":"--blocks_to_swap=<\u6574\u6570> [\u5b9e\u9a8c\u6027\u529f\u80fd] \u4e3a\u4e86\u51cf\u5c11 VRAM \u4f7f\u7528\u91cf\uff0c\u53ef\u4ee5\u5728 CPU \u548c GPU \u4e4b\u95f4\u4ea4\u6362\u6a21\u578b\u7684\u90e8\u5206\uff08Transformer \u5757\uff09\u3002\u6307\u5b9a\u8981\u4ea4\u6362\u7684\u5757\u6570\uff08\u4f8b\u5982 18 \uff09\u3002\u589e\u52a0\u6b64\u503c\u4f1a\u51cf\u5c11 VRAM \u4f7f\u7528\u91cf\uff0c\u4f46\u4f1a\u964d\u4f4e\u8bad\u7ec3\u901f\u5ea6\u3002\u8bf7\u6839\u636e\u60a8\u7684 GPU VRAM \u5bb9\u91cf\u8fdb\u884c\u8c03\u6574\u3002\u8be5\u53c2\u6570\u53ef\u4e0e gradient_checkpointing \u4e00\u8d77\u4f7f\u7528\u3002 \u4e0d\u80fd\u4e0e --cpu_offload_checkpointing \u540c\u65f6\u4f7f\u7528\u3002","title":"\u5185\u5b58\u548c\u901f\u5ea6\u76f8\u5173"},{"location":"sd-scripts-docs/flux_train/#_3","text":"--v2 , --v_parameterization , --clip_skip \uff1a\u8fd9\u4e9b\u662f Stable Diffusion \u7279\u6709\u7684\u53c2\u6570\uff0c\u4e0d\u7528\u4e8e FLUX.1 \u8bad\u7ec3\u3002 --max_token_length \uff1a\u8fd9\u662f\u9488\u5bf9 Stable Diffusion v1/v2 \u7684\u53c2\u6570\u3002\u5bf9\u4e8e FLUX.1\uff0c\u8bf7\u4f7f\u7528 --t5xxl_max_token_length \u3002 --split_mode \uff1a\u5df2\u5f03\u7528\u3002\u8bf7\u4f7f\u7528 --blocks_to_swap \u4ee3\u66ff\u3002","title":"\u4e0d\u517c\u5bb9\u6216\u5df2\u5f03\u7528\u7684\u53c2\u6570"},{"location":"sd-scripts-docs/flux_train/#42","text":"\u8bbe\u7f6e\u597d\u5fc5\u8981\u7684\u53c2\u6570\u5e76\u8fd0\u884c\u547d\u4ee4\u540e\uff0c\u8bad\u7ec3\u5c31\u4f1a\u5f00\u59cb\u3002\u57fa\u672c\u6d41\u7a0b\u548c\u65e5\u5fd7\u67e5\u770b\u65b9\u6cd5\u4e0e train_network.py \u6307\u5357 \u76f8\u540c\u3002","title":"4.2. \u5f00\u59cb\u8bad\u7ec3"},{"location":"sd-scripts-docs/flux_train/#5","text":"\u8bad\u7ec3\u5b8c\u6210\u540e\uff0cLoRA \u6a21\u578b\u6587\u4ef6\uff08\u4f8b\u5982 my_flux_lora.safetensors \uff09\u5c06\u88ab\u4fdd\u5b58\u5230\u6307\u5b9a\u7684 output_dir \u3002\u8be5\u6587\u4ef6\u53ef\u5728\u652f\u6301 FLUX.1 \u6a21\u578b\u7684\u63a8\u7406\u73af\u5883\uff08\u4f8b\u5982 ComfyUI + ComfyUI-FluxNodes\uff09\u4e2d\u4f7f\u7528\u3002","title":"5. \u4f7f\u7528\u8bad\u7ec3\u597d\u7684\u6a21\u578b"},{"location":"sd-scripts-docs/flux_train/#6","text":"flux_train_network.py \u8fd8\u5305\u542b\u8bb8\u591a\u4e0e train_network.py \u76f8\u540c\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u751f\u6210\u793a\u4f8b\u56fe\u50cf\uff08\u4f7f\u7528 --sample_prompts \u7b49\uff09\u548c\u8be6\u7ec6\u7684\u4f18\u5316\u5668\u8bbe\u7f6e\u3002\u6709\u5173\u8fd9\u4e9b\u529f\u80fd\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 train_network.py \u6307\u5357 \u6216\u8fd0\u884c\u811a\u672c\u7684\u5e2e\u52a9\u547d\u4ee4 ( python flux_train_network.py --help )\u3002","title":"6. \u5176\u4ed6\u529f\u80fd"},{"location":"sd-scripts-docs/gen_img/","text":"\u8fd9\u662f\u4e00\u4e2a\u57fa\u4e8eDiffusers\u7684\u63a8\u7406\uff08\u56fe\u50cf\u751f\u6210\uff09\u811a\u672c\uff0c\u652f\u6301SD 1.x\u548c2.x\u6a21\u578b\u3001LoRA\u3001ControlNet\u7b49\u3002\u4ee5\u4e0b\u662f\u8be5\u811a\u672c\u7684\u6838\u5fc3\u529f\u80fd\u548c\u7528\u6cd5\uff1a \u6838\u5fc3\u529f\u80fd\uff1a \u652f\u6301SD 1.x\u548c2.x\u6a21\u578b \uff1a\u5305\u62ec\u57fa\u7840\u6a21\u578b\u548cv-parameterization\u6a21\u578b\u3002 \u591a\u79cd\u751f\u6210\u6a21\u5f0f \uff1a\u652f\u6301txt2img\u3001img2img\u3001inpainting\u7b49\u3002 \u4ea4\u4e92\u6a21\u5f0f\u548c\u6279\u91cf\u751f\u6210 \uff1a\u652f\u6301\u4ea4\u4e92\u5f0f\u8f93\u5165\u63d0\u793a\u8bcd\uff0c\u4e5f\u652f\u6301\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u63d0\u793a\u8bcd\u8fdb\u884c\u6279\u91cf\u751f\u6210\u3002 \u9ad8\u7ea7\u9009\u9879 \uff1a\u652f\u6301\u8d1f\u9762\u63d0\u793a\u8bcd\u3001\u6743\u91cd\u8c03\u6574\u3001\u591a\u79cd\u91c7\u6837\u5668\u3001CLIP skip\u3001VAE\u52a0\u8f7d\u7b49\u3002 \u6269\u5c55\u529f\u80fd \uff1a\u652f\u6301LoRA\u3001ControlNet\u3001Textual Inversion\u3001Highres fix\u7b49\u3002 \u6027\u80fd\u4f18\u5316 \uff1a\u652f\u6301xformers\u52a0\u901f\u3001 fp16 \u548c bf16 \u63a8\u7406\u3002 \u57fa\u672c\u7528\u6cd5\uff1a \u4ea4\u4e92\u6a21\u5f0f\u751f\u6210\u56fe\u50cf \uff1a bash python gen_img_diffusers.py --ckpt <\u6a21\u578b\u540d\u79f0> --outdir <\u8f93\u51fa\u76ee\u5f55> --xformers --fp16 --interactive --ckpt \uff1a\u6307\u5b9a\u6a21\u578b\u6587\u4ef6\u6216Diffusers\u6a21\u578b\u76ee\u5f55\u3002 --outdir \uff1a\u6307\u5b9a\u8f93\u51fa\u56fe\u50cf\u7684\u4fdd\u5b58\u76ee\u5f55\u3002 --xformers \uff1a\u542f\u7528xformers\u52a0\u901f\u3002 --fp16 \uff1a\u4f7f\u7528\u534a\u7cbe\u5ea6\u6d6e\u70b9\u6570\u8fdb\u884c\u63a8\u7406\u3002 --interactive \uff1a\u8fdb\u5165\u4ea4\u4e92\u6a21\u5f0f\uff0c\u9010\u4e00\u8f93\u5165\u63d0\u793a\u8bcd\u751f\u6210\u56fe\u50cf\u3002 \u5355\u6761\u63d0\u793a\u8bcd\u6279\u91cf\u751f\u6210 \uff1a bash python gen_img_diffusers.py --ckpt <\u6a21\u578b\u540d\u79f0> --outdir <\u8f93\u51fa\u76ee\u5f55> --xformers --fp16 --images_per_prompt <\u751f\u6210\u6570\u91cf> --prompt \"<\u63d0\u793a\u8bcd>\" --images_per_prompt \uff1a\u6307\u5b9a\u6bcf\u4e2a\u63d0\u793a\u8bcd\u751f\u6210\u56fe\u50cf\u7684\u6570\u91cf\u3002 \u4ece\u6587\u4ef6\u8bfb\u53d6\u63d0\u793a\u8bcd\u6279\u91cf\u751f\u6210 \uff1a bash python gen_img_diffusers.py --ckpt <\u6a21\u578b\u540d\u79f0> --outdir <\u8f93\u51fa\u76ee\u5f55> --xformers --fp16 --from_file <\u63d0\u793a\u8bcd\u6587\u4ef6> --from_file \uff1a\u6307\u5b9a\u5305\u542b\u63d0\u793a\u8bcd\u7684\u6587\u672c\u6587\u4ef6\uff0c\u6bcf\u884c\u4e00\u4e2a\u63d0\u793a\u8bcd\u3002 \u4e3b\u8981\u9009\u9879\uff1a \u6a21\u578b\u76f8\u5173 \uff1a --ckpt <\u6a21\u578b\u540d\u79f0> \uff1a\u6307\u5b9a\u6a21\u578b\u6587\u4ef6\u6216Hugging Face\u6a21\u578bID\u3002 --v2 \uff1a\u4f7f\u7528Stable Diffusion 2.x\u6a21\u578b\u65f6\u9700\u8981\u6dfb\u52a0\u6b64\u9009\u9879\u3002 --v_parameterization \uff1a\u4f7f\u7528v-parameterization\u6a21\u578b\u65f6\u9700\u8981\u6dfb\u52a0\u6b64\u9009\u9879\u3002 \u56fe\u50cf\u751f\u6210\u4e0e\u8f93\u51fa \uff1a --W <\u5bbd\u5ea6> \u548c --H <\u9ad8\u5ea6> \uff1a\u8bbe\u7f6e\u751f\u6210\u56fe\u50cf\u7684\u5c3a\u5bf8\uff0c\u9ed8\u8ba4512x512\u3002 --steps <\u6b65\u6570> \uff1a\u8bbe\u7f6e\u91c7\u6837\u6b65\u6570\uff0c\u9ed8\u8ba450\u6b65\u3002 --scale <\u5f15\u5bfc\u6bd4\u4f8b> \uff1a\u8bbe\u7f6e\u65e0\u6761\u4ef6\u5f15\u5bfc\u6bd4\u4f8b\uff0c\u9ed8\u8ba47.5\u3002 --sampler <\u91c7\u6837\u5668\u540d\u79f0> \uff1a\u9009\u62e9\u91c7\u6837\u5668\uff0c\u5982 ddim \u3001 euler_a \u7b49\u3002 \u5185\u5b58\u4e0e\u6027\u80fd\u4f18\u5316 \uff1a --xformers \uff1a\u542f\u7528xformers\u52a0\u901f\u3002 --fp16 \u6216 --bf16 \uff1a\u4f7f\u7528\u8f83\u4f4e\u7cbe\u5ea6\u8fdb\u884c\u63a8\u7406\u4ee5\u8282\u7701\u5185\u5b58\u3002 \u989d\u5916\u7f51\u7edc\uff08LoRA\u7b49\uff09 \uff1a --network_module \uff1a\u6307\u5b9a\u4f7f\u7528\u7684\u989d\u5916\u7f51\u7edc\u6a21\u5757\uff0c\u5982LoRA\u3002 --network_weights \uff1a\u6307\u5b9aLoRA\u6743\u91cd\u6587\u4ef6\u3002 --network_mul \uff1a\u8c03\u6574LoRA\u6743\u91cd\u7684\u500d\u7387\u3002 ControlNet \uff1a --control_net_models \uff1a\u6307\u5b9aControlNet\u6a21\u578b\u6587\u4ef6\u3002 --guide_image_path \uff1a\u6307\u5b9aControlNet\u4f7f\u7528\u7684\u53c2\u8003\u56fe\u50cf\u3002 \u63d0\u793a\u8bcd\u9009\u9879\uff1a \u5728\u63d0\u793a\u8bcd\u4e2d\u53ef\u4ee5\u901a\u8fc7 -- \u52a0\u5b57\u6bcd\u7684\u65b9\u5f0f\u6307\u5b9a\u7279\u5b9a\u53c2\u6570\uff0c\u4f8b\u5982\uff1a - --n \uff1a\u6307\u5b9a\u8d1f\u9762\u63d0\u793a\u8bcd\u3002 - --w \u548c --h \uff1a\u8c03\u6574\u56fe\u50cf\u5bbd\u9ad8\u3002 - --s \uff1a\u8c03\u6574\u91c7\u6837\u6b65\u6570\u3002 - --l \uff1a\u8c03\u6574\u5f15\u5bfc\u6bd4\u4f8b\u3002 \u4f8b\u5982\uff1a 1girl, beautiful --n lowres, bad anatomy --w 768 --h 512 --s 30 img2img\u548cInpainting\uff1a img2img \uff1a --image_path \uff1a\u6307\u5b9a\u7528\u4e8eimg2img\u7684\u8f93\u5165\u56fe\u50cf\u3002 --strength \uff1a\u8bbe\u7f6eimg2img\u7684\u5f3a\u5ea6\uff0c\u9ed8\u8ba40.8\u3002 Inpainting \uff1a \u9700\u8981\u989d\u5916\u6307\u5b9a --mask_image \u6765\u63d0\u4f9b\u8499\u7248\u56fe\u50cf\u3002 \u5176\u4ed6\u9ad8\u7ea7\u529f\u80fd\uff1a Highres fix \uff1a\u901a\u8fc7\u4e24\u9636\u6bb5\u751f\u6210\u63d0\u5347\u56fe\u50cf\u5206\u8fa8\u7387\u3002 --highres_fix_scale \uff1a\u8bbe\u7f6e\u7b2c\u4e00\u9636\u6bb5\u751f\u6210\u7684\u56fe\u50cf\u6bd4\u4f8b\u3002 CLIP Guided Stable Diffusion \uff1a\u5229\u7528CLIP\u7279\u5f81\u4f18\u5316\u751f\u6210\u56fe\u50cf\u3002 --clip_guidance_scale \uff1a\u8bbe\u7f6eCLIP\u5f15\u5bfc\u7684\u5f3a\u5ea6\u3002 VGG16 Guided Stable Diffusion \uff1a\u5229\u7528VGG16\u7279\u5f81\u4f18\u5316\u751f\u6210\u56fe\u50cf\u3002 --vgg16_guidance_scale \uff1a\u8bbe\u7f6eVGG16\u5f15\u5bfc\u7684\u5f3a\u5ea6\u3002 \u9002\u7528\u573a\u666f\uff1a \u8be5\u811a\u672c\u9002\u7528\u4e8e\u9700\u8981\u7075\u6d3b\u63a7\u5236\u56fe\u50cf\u751f\u6210\u8fc7\u7a0b\u7684\u7528\u6237\uff0c\u4f8b\u5982\u8c03\u6574\u53c2\u6570\u3001\u5c1d\u8bd5\u4e0d\u540c\u6a21\u578b\u3001\u5b9e\u73b0\u7279\u5b9a\u98ce\u683c\u8f6c\u6362\u7b49\u3002 \u652f\u6301\u591a\u79cd\u6269\u5c55\u529f\u80fd\uff08\u5982LoRA\u3001ControlNet\uff09\uff0c\u53ef\u4ee5\u7528\u4e8e\u66f4\u7cbe\u7ec6\u5316\u7684\u56fe\u50cf\u751f\u6210\u3002 \u603b\u7684\u6765\u8bf4\uff0c\u8fd9\u4e2a\u811a\u672c\u662f\u4e00\u4e2a\u529f\u80fd\u5f3a\u5927\u4e14\u9ad8\u5ea6\u53ef\u5b9a\u5236\u7684\u56fe\u50cf\u751f\u6210\u5de5\u5177\uff0c\u9002\u5408\u7528\u4e8e\u7814\u7a76\u548c\u521b\u610f\u56fe\u50cf\u751f\u6210\u4efb\u52a1\u3002","title":"\u56fe\u50cf\u751f\u6210"},{"location":"sd-scripts-docs/gen_img/#_1","text":"\u652f\u6301SD 1.x\u548c2.x\u6a21\u578b \uff1a\u5305\u62ec\u57fa\u7840\u6a21\u578b\u548cv-parameterization\u6a21\u578b\u3002 \u591a\u79cd\u751f\u6210\u6a21\u5f0f \uff1a\u652f\u6301txt2img\u3001img2img\u3001inpainting\u7b49\u3002 \u4ea4\u4e92\u6a21\u5f0f\u548c\u6279\u91cf\u751f\u6210 \uff1a\u652f\u6301\u4ea4\u4e92\u5f0f\u8f93\u5165\u63d0\u793a\u8bcd\uff0c\u4e5f\u652f\u6301\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u63d0\u793a\u8bcd\u8fdb\u884c\u6279\u91cf\u751f\u6210\u3002 \u9ad8\u7ea7\u9009\u9879 \uff1a\u652f\u6301\u8d1f\u9762\u63d0\u793a\u8bcd\u3001\u6743\u91cd\u8c03\u6574\u3001\u591a\u79cd\u91c7\u6837\u5668\u3001CLIP skip\u3001VAE\u52a0\u8f7d\u7b49\u3002 \u6269\u5c55\u529f\u80fd \uff1a\u652f\u6301LoRA\u3001ControlNet\u3001Textual Inversion\u3001Highres fix\u7b49\u3002 \u6027\u80fd\u4f18\u5316 \uff1a\u652f\u6301xformers\u52a0\u901f\u3001 fp16 \u548c bf16 \u63a8\u7406\u3002","title":"\u6838\u5fc3\u529f\u80fd\uff1a"},{"location":"sd-scripts-docs/gen_img/#_2","text":"\u4ea4\u4e92\u6a21\u5f0f\u751f\u6210\u56fe\u50cf \uff1a bash python gen_img_diffusers.py --ckpt <\u6a21\u578b\u540d\u79f0> --outdir <\u8f93\u51fa\u76ee\u5f55> --xformers --fp16 --interactive --ckpt \uff1a\u6307\u5b9a\u6a21\u578b\u6587\u4ef6\u6216Diffusers\u6a21\u578b\u76ee\u5f55\u3002 --outdir \uff1a\u6307\u5b9a\u8f93\u51fa\u56fe\u50cf\u7684\u4fdd\u5b58\u76ee\u5f55\u3002 --xformers \uff1a\u542f\u7528xformers\u52a0\u901f\u3002 --fp16 \uff1a\u4f7f\u7528\u534a\u7cbe\u5ea6\u6d6e\u70b9\u6570\u8fdb\u884c\u63a8\u7406\u3002 --interactive \uff1a\u8fdb\u5165\u4ea4\u4e92\u6a21\u5f0f\uff0c\u9010\u4e00\u8f93\u5165\u63d0\u793a\u8bcd\u751f\u6210\u56fe\u50cf\u3002 \u5355\u6761\u63d0\u793a\u8bcd\u6279\u91cf\u751f\u6210 \uff1a bash python gen_img_diffusers.py --ckpt <\u6a21\u578b\u540d\u79f0> --outdir <\u8f93\u51fa\u76ee\u5f55> --xformers --fp16 --images_per_prompt <\u751f\u6210\u6570\u91cf> --prompt \"<\u63d0\u793a\u8bcd>\" --images_per_prompt \uff1a\u6307\u5b9a\u6bcf\u4e2a\u63d0\u793a\u8bcd\u751f\u6210\u56fe\u50cf\u7684\u6570\u91cf\u3002 \u4ece\u6587\u4ef6\u8bfb\u53d6\u63d0\u793a\u8bcd\u6279\u91cf\u751f\u6210 \uff1a bash python gen_img_diffusers.py --ckpt <\u6a21\u578b\u540d\u79f0> --outdir <\u8f93\u51fa\u76ee\u5f55> --xformers --fp16 --from_file <\u63d0\u793a\u8bcd\u6587\u4ef6> --from_file \uff1a\u6307\u5b9a\u5305\u542b\u63d0\u793a\u8bcd\u7684\u6587\u672c\u6587\u4ef6\uff0c\u6bcf\u884c\u4e00\u4e2a\u63d0\u793a\u8bcd\u3002","title":"\u57fa\u672c\u7528\u6cd5\uff1a"},{"location":"sd-scripts-docs/gen_img/#_3","text":"\u6a21\u578b\u76f8\u5173 \uff1a --ckpt <\u6a21\u578b\u540d\u79f0> \uff1a\u6307\u5b9a\u6a21\u578b\u6587\u4ef6\u6216Hugging Face\u6a21\u578bID\u3002 --v2 \uff1a\u4f7f\u7528Stable Diffusion 2.x\u6a21\u578b\u65f6\u9700\u8981\u6dfb\u52a0\u6b64\u9009\u9879\u3002 --v_parameterization \uff1a\u4f7f\u7528v-parameterization\u6a21\u578b\u65f6\u9700\u8981\u6dfb\u52a0\u6b64\u9009\u9879\u3002 \u56fe\u50cf\u751f\u6210\u4e0e\u8f93\u51fa \uff1a --W <\u5bbd\u5ea6> \u548c --H <\u9ad8\u5ea6> \uff1a\u8bbe\u7f6e\u751f\u6210\u56fe\u50cf\u7684\u5c3a\u5bf8\uff0c\u9ed8\u8ba4512x512\u3002 --steps <\u6b65\u6570> \uff1a\u8bbe\u7f6e\u91c7\u6837\u6b65\u6570\uff0c\u9ed8\u8ba450\u6b65\u3002 --scale <\u5f15\u5bfc\u6bd4\u4f8b> \uff1a\u8bbe\u7f6e\u65e0\u6761\u4ef6\u5f15\u5bfc\u6bd4\u4f8b\uff0c\u9ed8\u8ba47.5\u3002 --sampler <\u91c7\u6837\u5668\u540d\u79f0> \uff1a\u9009\u62e9\u91c7\u6837\u5668\uff0c\u5982 ddim \u3001 euler_a \u7b49\u3002 \u5185\u5b58\u4e0e\u6027\u80fd\u4f18\u5316 \uff1a --xformers \uff1a\u542f\u7528xformers\u52a0\u901f\u3002 --fp16 \u6216 --bf16 \uff1a\u4f7f\u7528\u8f83\u4f4e\u7cbe\u5ea6\u8fdb\u884c\u63a8\u7406\u4ee5\u8282\u7701\u5185\u5b58\u3002 \u989d\u5916\u7f51\u7edc\uff08LoRA\u7b49\uff09 \uff1a --network_module \uff1a\u6307\u5b9a\u4f7f\u7528\u7684\u989d\u5916\u7f51\u7edc\u6a21\u5757\uff0c\u5982LoRA\u3002 --network_weights \uff1a\u6307\u5b9aLoRA\u6743\u91cd\u6587\u4ef6\u3002 --network_mul \uff1a\u8c03\u6574LoRA\u6743\u91cd\u7684\u500d\u7387\u3002 ControlNet \uff1a --control_net_models \uff1a\u6307\u5b9aControlNet\u6a21\u578b\u6587\u4ef6\u3002 --guide_image_path \uff1a\u6307\u5b9aControlNet\u4f7f\u7528\u7684\u53c2\u8003\u56fe\u50cf\u3002","title":"\u4e3b\u8981\u9009\u9879\uff1a"},{"location":"sd-scripts-docs/gen_img/#_4","text":"\u5728\u63d0\u793a\u8bcd\u4e2d\u53ef\u4ee5\u901a\u8fc7 -- \u52a0\u5b57\u6bcd\u7684\u65b9\u5f0f\u6307\u5b9a\u7279\u5b9a\u53c2\u6570\uff0c\u4f8b\u5982\uff1a - --n \uff1a\u6307\u5b9a\u8d1f\u9762\u63d0\u793a\u8bcd\u3002 - --w \u548c --h \uff1a\u8c03\u6574\u56fe\u50cf\u5bbd\u9ad8\u3002 - --s \uff1a\u8c03\u6574\u91c7\u6837\u6b65\u6570\u3002 - --l \uff1a\u8c03\u6574\u5f15\u5bfc\u6bd4\u4f8b\u3002 \u4f8b\u5982\uff1a 1girl, beautiful --n lowres, bad anatomy --w 768 --h 512 --s 30","title":"\u63d0\u793a\u8bcd\u9009\u9879\uff1a"},{"location":"sd-scripts-docs/gen_img/#img2imginpainting","text":"img2img \uff1a --image_path \uff1a\u6307\u5b9a\u7528\u4e8eimg2img\u7684\u8f93\u5165\u56fe\u50cf\u3002 --strength \uff1a\u8bbe\u7f6eimg2img\u7684\u5f3a\u5ea6\uff0c\u9ed8\u8ba40.8\u3002 Inpainting \uff1a \u9700\u8981\u989d\u5916\u6307\u5b9a --mask_image \u6765\u63d0\u4f9b\u8499\u7248\u56fe\u50cf\u3002","title":"img2img\u548cInpainting\uff1a"},{"location":"sd-scripts-docs/gen_img/#_5","text":"Highres fix \uff1a\u901a\u8fc7\u4e24\u9636\u6bb5\u751f\u6210\u63d0\u5347\u56fe\u50cf\u5206\u8fa8\u7387\u3002 --highres_fix_scale \uff1a\u8bbe\u7f6e\u7b2c\u4e00\u9636\u6bb5\u751f\u6210\u7684\u56fe\u50cf\u6bd4\u4f8b\u3002 CLIP Guided Stable Diffusion \uff1a\u5229\u7528CLIP\u7279\u5f81\u4f18\u5316\u751f\u6210\u56fe\u50cf\u3002 --clip_guidance_scale \uff1a\u8bbe\u7f6eCLIP\u5f15\u5bfc\u7684\u5f3a\u5ea6\u3002 VGG16 Guided Stable Diffusion \uff1a\u5229\u7528VGG16\u7279\u5f81\u4f18\u5316\u751f\u6210\u56fe\u50cf\u3002 --vgg16_guidance_scale \uff1a\u8bbe\u7f6eVGG16\u5f15\u5bfc\u7684\u5f3a\u5ea6\u3002","title":"\u5176\u4ed6\u9ad8\u7ea7\u529f\u80fd\uff1a"},{"location":"sd-scripts-docs/gen_img/#_6","text":"\u8be5\u811a\u672c\u9002\u7528\u4e8e\u9700\u8981\u7075\u6d3b\u63a7\u5236\u56fe\u50cf\u751f\u6210\u8fc7\u7a0b\u7684\u7528\u6237\uff0c\u4f8b\u5982\u8c03\u6574\u53c2\u6570\u3001\u5c1d\u8bd5\u4e0d\u540c\u6a21\u578b\u3001\u5b9e\u73b0\u7279\u5b9a\u98ce\u683c\u8f6c\u6362\u7b49\u3002 \u652f\u6301\u591a\u79cd\u6269\u5c55\u529f\u80fd\uff08\u5982LoRA\u3001ControlNet\uff09\uff0c\u53ef\u4ee5\u7528\u4e8e\u66f4\u7cbe\u7ec6\u5316\u7684\u56fe\u50cf\u751f\u6210\u3002 \u603b\u7684\u6765\u8bf4\uff0c\u8fd9\u4e2a\u811a\u672c\u662f\u4e00\u4e2a\u529f\u80fd\u5f3a\u5927\u4e14\u9ad8\u5ea6\u53ef\u5b9a\u5236\u7684\u56fe\u50cf\u751f\u6210\u5de5\u5177\uff0c\u9002\u5408\u7528\u4e8e\u7814\u7a76\u548c\u521b\u610f\u56fe\u50cf\u751f\u6210\u4efb\u52a1\u3002","title":"\u9002\u7528\u573a\u666f\uff1a"},{"location":"sd-scripts-docs/masked_loss/","text":"masked_loss.md \u5173\u4e8e\u63a9\u7801\u635f\u5931 \u63a9\u7801\u635f\u5931\u662f\u4e00\u79cd\u901a\u8fc7\u8f93\u5165\u56fe\u50cf\u7684\u63a9\u7801\u6765\u6307\u5b9a\u90e8\u5206\u533a\u57df\u8fdb\u884c\u635f\u5931\u8ba1\u7b97\uff0c\u4ece\u800c\u5b9e\u73b0\u4ec5\u5bf9\u56fe\u50cf\u7684\u7279\u5b9a\u90e8\u5206\u8fdb\u884c\u8bad\u7ec3\u7684\u529f\u80fd\u3002\u4f8b\u5982\uff0c\u5f53\u4f60\u60f3\u8bad\u7ec3\u4e00\u4e2a\u89d2\u8272\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ec5\u5bf9\u89d2\u8272\u90e8\u5206\u8fdb\u884c\u63a9\u7801\u6765\u5ffd\u7565\u80cc\u666f\u7684\u5f71\u54cd\u3002 \u63a9\u7801\u635f\u5931\u6709\u4e24\u79cd\u6307\u5b9a\u63a9\u7801\u7684\u65b9\u6cd5\uff1a - \u4f7f\u7528\u63a9\u7801\u56fe\u50cf - \u4f7f\u7528\u900f\u660e\u5ea6\uff08Alpha\u901a\u9053\uff09 \u672c\u6587\u6863\u7684\u793a\u4f8b\u4f7f\u7528\u4e86 \u4e2d\u7684\u201cAI\u56fe\u50cf\u6a21\u578b\u7528\u8bad\u7ec3\u6570\u636e\u201d\u3002 \u4f7f\u7528\u63a9\u7801\u56fe\u50cf\u7684\u65b9\u6cd5 \u8fd9\u79cd\u65b9\u6cd5\u9700\u8981\u4e3a\u6bcf\u5f20\u8bad\u7ec3\u56fe\u50cf\u51c6\u5907\u5bf9\u5e94\u7684\u63a9\u7801\u56fe\u50cf\u3002\u63a9\u7801\u56fe\u50cf\u5e94\u4e0e\u8bad\u7ec3\u56fe\u50cf\u5177\u6709\u76f8\u540c\u7684\u6587\u4ef6\u540d\uff0c\u5e76\u5b58\u50a8\u5728\u4e0d\u540c\u7684\u76ee\u5f55\u4e2d\u3002 - \u8bad\u7ec3\u56fe\u50cf - \u63a9\u7801\u56fe\u50cf [[datasets.subsets]] image_dir = \"/path/to/a_zundamon\" caption_extension = \".txt\" conditioning_data_dir = \"/path/to/a_zundamon_mask\" num_repeats = 8 \u63a9\u7801\u56fe\u50cf\u5e94\u4e0e\u8bad\u7ec3\u56fe\u50cf\u5927\u5c0f\u76f8\u540c\uff0c\u5176\u4e2d\u9700\u8981\u8bad\u7ec3\u7684\u533a\u57df\u7528\u767d\u8272\u8868\u793a\uff0c\u4e0d\u9700\u8981\u8bad\u7ec3\u7684\u533a\u57df\u7528\u9ed1\u8272\u8868\u793a\u3002\u8be5\u529f\u80fd\u652f\u6301\u7070\u5ea6\u63a9\u7801\uff08\u4f8b\u5982\uff0c\u503c\u4e3a127\u7684\u50cf\u7d20\u5bf9\u5e94\u7684\u635f\u5931\u6743\u91cd\u4e3a0.5\uff09\u3002\u5b9e\u9645\u4e0a\uff0c\u63a9\u7801\u56fe\u50cf\u7684R\u901a\u9053\u5c06\u88ab\u4f7f\u7528\u3002 \u5bf9\u4e8eDreamBooth\u65b9\u5f0f\u7684\u6570\u636e\u96c6\uff0c\u4f60\u9700\u8981\u5c06\u63a9\u7801\u56fe\u50cf\u4fdd\u5b58\u5728 conditioning_data_dir \u6307\u5b9a\u7684\u76ee\u5f55\u4e2d\u3002\u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u8003 ControlNet-LLLite \u3002 \u4f7f\u7528\u900f\u660e\u5ea6\uff08Alpha\u901a\u9053\uff09\u7684\u65b9\u6cd5 \u8fd9\u79cd\u65b9\u6cd5\u4f7f\u7528\u8bad\u7ec3\u56fe\u50cf\u7684\u900f\u660e\u5ea6\uff08Alpha\u901a\u9053\uff09\u4f5c\u4e3a\u63a9\u7801\u3002\u900f\u660e\u5ea6\u4e3a0\u7684\u533a\u57df\u5c06\u88ab\u5ffd\u7565\uff0c\u800c\u900f\u660e\u5ea6\u4e3a255\u7684\u533a\u57df\u5c06\u88ab\u7528\u4e8e\u8bad\u7ec3\u3002\u5bf9\u4e8e\u534a\u900f\u660e\u533a\u57df\uff0c\u5176\u635f\u5931\u6743\u91cd\u5c06\u6839\u636e\u5176\u900f\u660e\u5ea6\u8fdb\u884c\u8c03\u6574\uff08\u4f8b\u5982\uff0c\u900f\u660e\u5ea6\u4e3a127\u7684\u50cf\u7d20\u5bf9\u5e94\u7684\u635f\u5931\u6743\u91cd\u7ea6\u4e3a0.5\uff09\u3002 \u4e0a\u8ff0\u56fe\u50cf\u5747\u4e3aPNG\u683c\u5f0f\u5e76\u5e26\u6709\u900f\u660e\u901a\u9053 \u5728\u8bad\u7ec3\u65f6\uff0c\u4f60\u9700\u8981\u5728\u811a\u672c\u7684\u9009\u9879\u4e2d\u6dfb\u52a0 --alpha_mask \uff0c\u6216\u8005\u5728\u6570\u636e\u96c6\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684subset\u90e8\u5206\u8bbe\u7f6e alpha_mask \u3002\u4f8b\u5982\uff1a [[datasets.subsets]] image_dir = \"/path/to/image/dir\" caption_extension = \".txt\" num_repeats = 8 alpha_mask = true \u8bad\u7ec3\u65f6\u7684\u6ce8\u610f\u4e8b\u9879 \u76ee\u524d\u4ec5\u652f\u6301DreamBooth\u65b9\u5f0f\u7684\u6570\u636e\u96c6\u3002 \u63a9\u7801\u5c06\u5728latents\u5c3a\u5bf8\uff08\u5373\u539f\u59cb\u56fe\u50cf\u76841/8\uff09\u4e0b\u5e94\u7528\u3002\u56e0\u6b64\uff0c\u7ec6\u5c0f\u7684\u90e8\u5206\uff08\u4f8b\u5982\u5218\u6d77\u6216\u8033\u73af\u7b49\uff09\u53ef\u80fd\u65e0\u6cd5\u88ab\u5f88\u597d\u5730\u8bad\u7ec3\u3002\u4f60\u53ef\u80fd\u9700\u8981\u5bf9\u63a9\u7801\u8fdb\u884c\u4e00\u4e9b\u8c03\u6574\uff0c\u6bd4\u5982\u7a0d\u5fae\u6269\u5927\u63a9\u7801\u533a\u57df\u3002 \u4f7f\u7528\u63a9\u7801\u635f\u5931\u65f6\uff0c\u53ef\u80fd\u4e0d\u9700\u8981\u5728\u56fe\u50cf\u7684\u63cf\u8ff0\u6587\u672c\u4e2d\u5305\u542b\u4e0d\u88ab\u63a9\u7801\u7684\u90e8\u5206\u3002\uff08\u5f85\u9a8c\u8bc1\uff09 \u5f53\u4f7f\u7528 alpha_mask \u65f6\uff0c\u5207\u6362\u63a9\u7801\u7684\u6709\u65e0\u5c06\u81ea\u52a8\u91cd\u65b0\u751f\u6210latents\u7f13\u5b58\u3002","title":"\u8499\u7248\u6570\u636e"},{"location":"sd-scripts-docs/masked_loss/#_1","text":"\u63a9\u7801\u635f\u5931\u662f\u4e00\u79cd\u901a\u8fc7\u8f93\u5165\u56fe\u50cf\u7684\u63a9\u7801\u6765\u6307\u5b9a\u90e8\u5206\u533a\u57df\u8fdb\u884c\u635f\u5931\u8ba1\u7b97\uff0c\u4ece\u800c\u5b9e\u73b0\u4ec5\u5bf9\u56fe\u50cf\u7684\u7279\u5b9a\u90e8\u5206\u8fdb\u884c\u8bad\u7ec3\u7684\u529f\u80fd\u3002\u4f8b\u5982\uff0c\u5f53\u4f60\u60f3\u8bad\u7ec3\u4e00\u4e2a\u89d2\u8272\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ec5\u5bf9\u89d2\u8272\u90e8\u5206\u8fdb\u884c\u63a9\u7801\u6765\u5ffd\u7565\u80cc\u666f\u7684\u5f71\u54cd\u3002 \u63a9\u7801\u635f\u5931\u6709\u4e24\u79cd\u6307\u5b9a\u63a9\u7801\u7684\u65b9\u6cd5\uff1a - \u4f7f\u7528\u63a9\u7801\u56fe\u50cf - \u4f7f\u7528\u900f\u660e\u5ea6\uff08Alpha\u901a\u9053\uff09 \u672c\u6587\u6863\u7684\u793a\u4f8b\u4f7f\u7528\u4e86 \u4e2d\u7684\u201cAI\u56fe\u50cf\u6a21\u578b\u7528\u8bad\u7ec3\u6570\u636e\u201d\u3002","title":"\u5173\u4e8e\u63a9\u7801\u635f\u5931"},{"location":"sd-scripts-docs/masked_loss/#_2","text":"\u8fd9\u79cd\u65b9\u6cd5\u9700\u8981\u4e3a\u6bcf\u5f20\u8bad\u7ec3\u56fe\u50cf\u51c6\u5907\u5bf9\u5e94\u7684\u63a9\u7801\u56fe\u50cf\u3002\u63a9\u7801\u56fe\u50cf\u5e94\u4e0e\u8bad\u7ec3\u56fe\u50cf\u5177\u6709\u76f8\u540c\u7684\u6587\u4ef6\u540d\uff0c\u5e76\u5b58\u50a8\u5728\u4e0d\u540c\u7684\u76ee\u5f55\u4e2d\u3002 - \u8bad\u7ec3\u56fe\u50cf - \u63a9\u7801\u56fe\u50cf [[datasets.subsets]] image_dir = \"/path/to/a_zundamon\" caption_extension = \".txt\" conditioning_data_dir = \"/path/to/a_zundamon_mask\" num_repeats = 8 \u63a9\u7801\u56fe\u50cf\u5e94\u4e0e\u8bad\u7ec3\u56fe\u50cf\u5927\u5c0f\u76f8\u540c\uff0c\u5176\u4e2d\u9700\u8981\u8bad\u7ec3\u7684\u533a\u57df\u7528\u767d\u8272\u8868\u793a\uff0c\u4e0d\u9700\u8981\u8bad\u7ec3\u7684\u533a\u57df\u7528\u9ed1\u8272\u8868\u793a\u3002\u8be5\u529f\u80fd\u652f\u6301\u7070\u5ea6\u63a9\u7801\uff08\u4f8b\u5982\uff0c\u503c\u4e3a127\u7684\u50cf\u7d20\u5bf9\u5e94\u7684\u635f\u5931\u6743\u91cd\u4e3a0.5\uff09\u3002\u5b9e\u9645\u4e0a\uff0c\u63a9\u7801\u56fe\u50cf\u7684R\u901a\u9053\u5c06\u88ab\u4f7f\u7528\u3002 \u5bf9\u4e8eDreamBooth\u65b9\u5f0f\u7684\u6570\u636e\u96c6\uff0c\u4f60\u9700\u8981\u5c06\u63a9\u7801\u56fe\u50cf\u4fdd\u5b58\u5728 conditioning_data_dir \u6307\u5b9a\u7684\u76ee\u5f55\u4e2d\u3002\u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u8003 ControlNet-LLLite \u3002","title":"\u4f7f\u7528\u63a9\u7801\u56fe\u50cf\u7684\u65b9\u6cd5"},{"location":"sd-scripts-docs/masked_loss/#alpha","text":"\u8fd9\u79cd\u65b9\u6cd5\u4f7f\u7528\u8bad\u7ec3\u56fe\u50cf\u7684\u900f\u660e\u5ea6\uff08Alpha\u901a\u9053\uff09\u4f5c\u4e3a\u63a9\u7801\u3002\u900f\u660e\u5ea6\u4e3a0\u7684\u533a\u57df\u5c06\u88ab\u5ffd\u7565\uff0c\u800c\u900f\u660e\u5ea6\u4e3a255\u7684\u533a\u57df\u5c06\u88ab\u7528\u4e8e\u8bad\u7ec3\u3002\u5bf9\u4e8e\u534a\u900f\u660e\u533a\u57df\uff0c\u5176\u635f\u5931\u6743\u91cd\u5c06\u6839\u636e\u5176\u900f\u660e\u5ea6\u8fdb\u884c\u8c03\u6574\uff08\u4f8b\u5982\uff0c\u900f\u660e\u5ea6\u4e3a127\u7684\u50cf\u7d20\u5bf9\u5e94\u7684\u635f\u5931\u6743\u91cd\u7ea6\u4e3a0.5\uff09\u3002 \u4e0a\u8ff0\u56fe\u50cf\u5747\u4e3aPNG\u683c\u5f0f\u5e76\u5e26\u6709\u900f\u660e\u901a\u9053 \u5728\u8bad\u7ec3\u65f6\uff0c\u4f60\u9700\u8981\u5728\u811a\u672c\u7684\u9009\u9879\u4e2d\u6dfb\u52a0 --alpha_mask \uff0c\u6216\u8005\u5728\u6570\u636e\u96c6\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684subset\u90e8\u5206\u8bbe\u7f6e alpha_mask \u3002\u4f8b\u5982\uff1a [[datasets.subsets]] image_dir = \"/path/to/image/dir\" caption_extension = \".txt\" num_repeats = 8 alpha_mask = true","title":"\u4f7f\u7528\u900f\u660e\u5ea6\uff08Alpha\u901a\u9053\uff09\u7684\u65b9\u6cd5"},{"location":"sd-scripts-docs/masked_loss/#_3","text":"\u76ee\u524d\u4ec5\u652f\u6301DreamBooth\u65b9\u5f0f\u7684\u6570\u636e\u96c6\u3002 \u63a9\u7801\u5c06\u5728latents\u5c3a\u5bf8\uff08\u5373\u539f\u59cb\u56fe\u50cf\u76841/8\uff09\u4e0b\u5e94\u7528\u3002\u56e0\u6b64\uff0c\u7ec6\u5c0f\u7684\u90e8\u5206\uff08\u4f8b\u5982\u5218\u6d77\u6216\u8033\u73af\u7b49\uff09\u53ef\u80fd\u65e0\u6cd5\u88ab\u5f88\u597d\u5730\u8bad\u7ec3\u3002\u4f60\u53ef\u80fd\u9700\u8981\u5bf9\u63a9\u7801\u8fdb\u884c\u4e00\u4e9b\u8c03\u6574\uff0c\u6bd4\u5982\u7a0d\u5fae\u6269\u5927\u63a9\u7801\u533a\u57df\u3002 \u4f7f\u7528\u63a9\u7801\u635f\u5931\u65f6\uff0c\u53ef\u80fd\u4e0d\u9700\u8981\u5728\u56fe\u50cf\u7684\u63cf\u8ff0\u6587\u672c\u4e2d\u5305\u542b\u4e0d\u88ab\u63a9\u7801\u7684\u90e8\u5206\u3002\uff08\u5f85\u9a8c\u8bc1\uff09 \u5f53\u4f7f\u7528 alpha_mask \u65f6\uff0c\u5207\u6362\u63a9\u7801\u7684\u6709\u65e0\u5c06\u81ea\u52a8\u91cd\u65b0\u751f\u6210latents\u7f13\u5b58\u3002","title":"\u8bad\u7ec3\u65f6\u7684\u6ce8\u610f\u4e8b\u9879"},{"location":"sd-scripts-docs/sd3_train_network/","text":"sd3_train_network.py \u7528\u7684Stable Diffusion 3/3.5\u6a21\u578b\u7684LoRA\u8bad\u7ec3\u6307\u5357 \u672c\u6587\u6863\u5c06\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 sd-scripts \u5b58\u50a8\u5e93\u4e2d\u7684 sd3_train_network.py \u6765\u8bad\u7ec3Stable Diffusion 3 (SD3) \u548c Stable Diffusion 3.5 (SD3.5) \u6a21\u578b\u7684LoRA\uff08Low-Rank Adaptation\uff09\u6a21\u578b\u3002 1. \u7b80\u4ecb sd3_train_network.py \u662f\u4e00\u4e2a\u7528\u4e8e\u8bad\u7ec3Stable Diffusion 3/3.5\u6a21\u578b\u7684LoRA\u7b49\u9644\u52a0\u7f51\u7edc\u7684\u811a\u672c\u3002SD3\u91c7\u7528\u4e86\u4e00\u79cd\u540d\u4e3aMMDiT\uff08\u591a\u6a21\u6001\u6269\u6563Transformer\uff09\u7684\u65b0\u67b6\u6784\uff0c\u4e0e\u4f20\u7edf\u7684Stable Diffusion\u6a21\u578b\u7ed3\u6784\u4e0d\u540c\u3002\u4f7f\u7528\u6b64\u811a\u672c\u53ef\u4ee5\u521b\u5efa\u9488\u5bf9SD3/3.5\u6a21\u578b\u7684LoRA\u6a21\u578b\u3002 \u672c\u6307\u5357\u9762\u5411\u4e86\u89e3LoRA\u8bad\u7ec3\u57fa\u672c\u6b65\u9aa4\u7684\u7528\u6237\uff0c\u5e76\u5047\u8bbe\u60a8\u5177\u6709\u4f7f\u7528 train_network.py \u8fdb\u884c\u8bad\u7ec3\u7684\u7ecf\u9a8c\u3002\u6709\u5173\u57fa\u672c\u7528\u6cd5\u548c\u901a\u7528\u9009\u9879\uff0c\u8bf7\u53c2\u9605 train_network.py \u7684\u4f7f\u7528\u6307\u5357 \u3002 \u524d\u63d0\u6761\u4ef6\uff1a \u5df2\u514b\u9686 sd-scripts \u5b58\u50a8\u5e93\u5e76\u8bbe\u7f6ePython\u73af\u5883\u3002 \u5df2\u51c6\u5907\u597d\u7528\u4e8e\u8bad\u7ec3\u7684\u6570\u636e\u96c6\u3002\uff08\u6709\u5173\u6570\u636e\u96c6\u51c6\u5907\uff0c\u8bf7\u53c2\u9605 \u6570\u636e\u96c6\u914d\u7f6e\u6307\u5357 \u3002\uff09 \u5df2\u51c6\u5907\u597d\u5f85\u8bad\u7ec3\u7684SD3/3.5\u6a21\u578b\u6587\u4ef6\u3002 2. \u4e0e train_network.py \u7684\u533a\u522b sd3_train_network.py \u57fa\u4e8e train_network.py \uff0c\u5e76\u9488\u5bf9SD3/3.5\u6a21\u578b\u8fdb\u884c\u4e86\u4fee\u6539\u3002\u4e3b\u8981\u533a\u522b\u5982\u4e0b\uff1a \u76ee\u6807\u6a21\u578b\uff1a \u9002\u7528\u4e8eStable Diffusion 3 Medium / Large (3.0 / 3.5) \u6a21\u578b\u3002 \u6a21\u578b\u7ed3\u6784\uff1a \u4f7f\u7528MMDiT\uff08\u57fa\u4e8eTransformer\uff09\u4ee3\u66ffU-Net\u3002\u4f7f\u7528CLIP-L\u3001CLIP-G\u548cT5-XXL\u4f5c\u4e3a\u6587\u672c\u7f16\u7801\u5668\u3002VAE\u4e0eSDXL\u517c\u5bb9\uff0c\u4f46\u8f93\u5165\u7f29\u653e\u5904\u7406\u4e0d\u540c\u3002 \u53c2\u6570\uff1a \u6709\u7528\u4e8e\u6307\u5b9aSD3/3.5\u6a21\u578b\u3001\u6587\u672c\u7f16\u7801\u5668\u7ec4\u548cVAE\u7684\u53c2\u6570\u3002\u4f46\u662f\uff0c\u5982\u679c\u662f\u5355\u4e2a .safetensors \u6587\u4ef6\uff0c\u5219\u53ef\u4ee5\u5728\u5185\u90e8\u81ea\u52a8\u5206\u79bb\uff0c\u56e0\u6b64\u65e0\u9700\u6307\u5b9a\u5355\u72ec\u7684\u8def\u5f84\u3002 \u90e8\u5206\u53c2\u6570\u4e0d\u517c\u5bb9\uff1a \u7528\u4e8eStable Diffusion v1/v2\u7684\u53c2\u6570\uff08\u4f8b\u5982\uff1a --v2 \u3001 --v_parameterization \u3001 --clip_skip \uff09\u4e0d\u7528\u4e8eSD3/3.5\u7684\u8bad\u7ec3\u3002 SD3\u7279\u6709\u7684\u53c2\u6570\uff1a \u6dfb\u52a0\u4e86\u6587\u672c\u7f16\u7801\u5668\u7684\u6ce8\u610f\u529b\u63a9\u7801\u548c\u4e22\u5f03\u7387\u3001\u4f4d\u7f6e\u5d4c\u5165\u8c03\u6574\uff08\u9002\u7528\u4e8eSD3.5\uff09\u3001\u65f6\u95f4\u6b65\u91c7\u6837\u548c\u635f\u5931\u52a0\u6743\u7b49\u53c2\u6570\u3002 3. \u51c6\u5907 \u5f00\u59cb\u8bad\u7ec3\u4e4b\u524d\uff0c\u9700\u8981\u4ee5\u4e0b\u6587\u4ef6\uff1a \u8bad\u7ec3\u811a\u672c\uff1a sd3_train_network.py SD3/3.5\u6a21\u578b\u6587\u4ef6\uff1a \u7528\u4e8e\u8bad\u7ec3\u7684SD3/3.5\u6a21\u578b\u7684 .safetensors \u6587\u4ef6\u3002\u5efa\u8bae\u4f7f\u7528\u5355\u6587\u4ef6\u683c\u5f0f\uff08Diffusers/ComfyUI/AUTOMATIC1111\u683c\u5f0f\uff09\u3002 \u5982\u679c\u6587\u672c\u7f16\u7801\u5668\u6216VAE\u662f\u5355\u72ec\u7684\u6587\u4ef6\uff0c\u8bf7\u5728\u76f8\u5e94\u7684\u53c2\u6570\u4e2d\u6307\u5b9a\u8def\u5f84\u3002 \u6570\u636e\u96c6\u5b9a\u4e49\u6587\u4ef6\uff08.toml\uff09\uff1a \u4e00\u4e2aTOML\u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u7528\u4e8e\u63cf\u8ff0\u8bad\u7ec3\u6570\u636e\u96c6\u7684\u914d\u7f6e\u3002\uff08\u8be6\u60c5\u8bf7\u53c2\u9605 \u6570\u636e\u96c6\u914d\u7f6e\u6307\u5357 \u3002\uff09 \u8fd9\u91cc\u4f7f\u7528 my_sd3_dataset_config.toml \u4f5c\u4e3a\u793a\u4f8b\u3002 4. \u5f00\u59cb\u8bad\u7ec3 \u901a\u8fc7\u5728\u7ec8\u7aef\u4e2d\u8fd0\u884c sd3_train_network.py \u6765\u5f00\u59cb\u8bad\u7ec3\u3002\u57fa\u672c\u547d\u4ee4\u884c\u7ed3\u6784\u4e0e train_network.py \u7c7b\u4f3c\uff0c\u4f46\u9700\u8981\u6307\u5b9aSD3/3.5\u7279\u6709\u7684\u53c2\u6570\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u57fa\u672c\u7684\u547d\u4ee4\u884c\u793a\u4f8b\uff1a accelerate launch --num_cpu_threads_per_process 1 sd3_train_network.py --pretrained_model_name_or_path=\"<SD3\u6a21\u578b\u7684\u8def\u5f84>\" --dataset_config=\"my_sd3_dataset_config.toml\" --output_dir=\"<\u8bad\u7ec3\u7ed3\u679c\u7684\u8f93\u51fa\u76ee\u5f55>\" --output_name=\"my_sd3_lora\" --save_model_as=safetensors --network_module=networks.lora --network_dim=16 --network_alpha=1 --learning_rate=1e-4 --optimizer_type=\"AdamW8bit\" --lr_scheduler=\"constant\" --sdpa --max_train_epochs=10 --save_every_n_epochs=1 --mixed_precision=\"fp16\" --gradient_checkpointing --apply_lg_attn_mask --apply_t5_attn_mask --weighting_scheme=\"sigma_sqrt\" --blocks_to_swap=32 \u203b\u5b9e\u9645\u4e0a\u5e94\u8be5\u5199\u5728\u4e00\u884c\u6216\u4f7f\u7528\u9002\u5f53\u7684\u6362\u884c\u7b26\uff08 \\ \u6216 ^ \uff09\u3002 4.1. \u4e3b\u8981\u547d\u4ee4\u884c\u53c2\u6570\u8bf4\u660e\uff08 train_network.py \u65b0\u589e\u6216\u66f4\u6539\u7684\u90e8\u5206\uff09 \u9664\u4e86 train_network.py \u6307\u5357 \u4e2d\u4ecb\u7ecd\u7684\u53c2\u6570\u5916\uff0c\u8fd8\u9700\u8981\u6307\u5b9a\u4ee5\u4e0bSD3/3.5\u7279\u6709\u7684\u53c2\u6570\u3002\u6709\u5173\u901a\u7528\u53c2\u6570\uff08 --output_dir \u3001 --output_name \u3001 --network_module \u3001 --network_dim \u3001 --network_alpha \u3001 --learning_rate \u7b49\uff09\uff0c\u8bf7\u53c2\u9605\u4e0a\u8ff0\u6307\u5357\u3002 \u6a21\u578b\u76f8\u5173\u53c2\u6570 --pretrained_model_name_or_path=\"<SD3\u6a21\u578b\u7684\u8def\u5f84>\" [\u5fc5\u586b] \u6307\u5b9a\u7528\u4e8e\u8bad\u7ec3\u7684SD3/3.5\u6a21\u578b\u7684 .safetensors \u6587\u4ef6\u8def\u5f84\u3002\u5047\u8bbe\u4e3a\u5355\u6587\u4ef6\u683c\u5f0f\uff08Diffusers/ComfyUI/AUTOMATIC1111\u683c\u5f0f\uff09\u3002 --clip_l \u3001 --clip_g \u3001 --t5xxl \u3001 --vae \uff1a \u5982\u679c\u57fa\u7840\u6a21\u578b\u662f\u5355\u6587\u4ef6\u683c\u5f0f\uff0c\u901a\u5e38\u4e0d\u9700\u8981\u6307\u5b9a\u8fd9\u4e9b\u53c2\u6570\uff08\u4f1a\u81ea\u52a8\u4ece\u6a21\u578b\u5185\u90e8\u52a0\u8f7d\uff09\u3002 \u5982\u679c\u6587\u672c\u7f16\u7801\u5668\u6216VAE\u4f5c\u4e3a\u5355\u72ec\u6587\u4ef6\u63d0\u4f9b\uff0c\u8bf7\u6307\u5b9a\u76f8\u5e94\u7684 .safetensors \u6587\u4ef6\u8def\u5f84\u3002 SD3/3.5\u8bad\u7ec3\u53c2\u6570 --t5xxl_max_token_length=<\u6574\u6570> \u6307\u5b9aT5-XXL\u6587\u672c\u7f16\u7801\u5668\u4f7f\u7528\u7684\u6700\u5927Token\u957f\u5ea6\u3002SD3\u7684\u9ed8\u8ba4\u503c\u4e3a 256 \u3002\u53ef\u80fd\u9700\u8981\u6839\u636e\u6570\u636e\u96c6\u7684\u5b57\u5e55\u957f\u5ea6\u8fdb\u884c\u8c03\u6574\u3002 --apply_lg_attn_mask \u5bf9CLIP-L\u548cCLIP-G\u7684\u8f93\u51fa\u5e94\u7528\u4e0e\u586b\u5145Token\u76f8\u5bf9\u5e94\u7684\u6ce8\u610f\u529b\u63a9\u7801\uff08\u96f6\u586b\u5145\uff09\u3002 --apply_t5_attn_mask \u5bf9T5-XXL\u7684\u8f93\u51fa\u5e94\u7528\u4e0e\u586b\u5145Token\u76f8\u5bf9\u5e94\u7684\u6ce8\u610f\u529b\u63a9\u7801\uff08\u96f6\u586b\u5145\uff09\u3002 --clip_l_dropout_rate \u3001 --clip_g_dropout_rate \u3001 --t5_dropout_rate \uff1a \u5bf9\u6bcf\u4e2a\u6587\u672c\u7f16\u7801\u5668\u7684\u8f93\u51fa\u4ee5\u6307\u5b9a\u7684\u6982\u7387\u5e94\u7528\u4e22\u5f03\uff08\u8f93\u51fa\u7f6e\u96f6\uff09\u3002\u6709\u52a9\u4e8e\u9632\u6b62\u8fc7\u62df\u5408\u3002\u9ed8\u8ba4\u503c\u4e3a 0.0 \uff08\u65e0\u4e22\u5f03\uff09\u3002 --pos_emb_random_crop_rate=<\u6d6e\u70b9\u6570> [\u9002\u7528\u4e8eSD3.5] \u6307\u5b9a\u5bf9MMDiT\u7684\u4f4d\u7f6e\u5d4c\u5165\u5e94\u7528\u968f\u673a\u88c1\u526a\u7684\u6982\u7387\u3002\u8fd9\u662fSD3 5M\uff083.5\uff09\u6a21\u578b\u4e2d\u8bad\u7ec3\u7684\u529f\u80fd\uff0c\u5bf9\u5176\u4ed6\u6a21\u578b\u7684\u6548\u679c\u6709\u9650\u3002\u9ed8\u8ba4\u503c\u4e3a 0.0 \u3002 --enable_scaled_pos_embed [\u9002\u7528\u4e8eSD3.5] \u5728\u591a\u5206\u8fa8\u7387\u8bad\u7ec3\u65f6\uff0c\u6839\u636e\u5206\u8fa8\u7387\u7f29\u653e\u4f4d\u7f6e\u5d4c\u5165\u3002\u8fd9\u662fSD3 5M\uff083.5\uff09\u6a21\u578b\u4e2d\u8bad\u7ec3\u7684\u529f\u80fd\uff0c\u5bf9\u5176\u4ed6\u6a21\u578b\u7684\u6548\u679c\u6709\u9650\u3002 --training_shift=<\u6d6e\u70b9\u6570> \u7528\u4e8e\u8c03\u6574\u8bad\u7ec3\u65f6\u65f6\u95f4\u6b65\uff08\u566a\u58f0\u6c34\u5e73\uff09\u5206\u5e03\u7684\u504f\u79fb\u503c\u3002\u4e0e weighting_scheme \u7ed3\u5408\u5e94\u7528\u3002\u5927\u4e8e 1.0 \u7684\u503c\u503e\u5411\u4e8e\u5f3a\u8c03\u566a\u58f0\u8f83\u5927\uff08\u7ed3\u6784\u8f83\u591a\uff09\u7684\u533a\u57df\uff0c\u800c\u5c0f\u4e8e 1.0 \u7684\u503c\u5219\u5f3a\u8c03\u566a\u58f0\u8f83\u5c0f\uff08\u7ec6\u8282\u8f83\u591a\uff09\u7684\u533a\u57df\u3002\u9ed8\u8ba4\u503c\u4e3a 1.0 \u3002 --weighting_scheme=<\u9009\u9879> \u6307\u5b9a\u6839\u636e\u635f\u5931\u8ba1\u7b97\u65f6\u7684\u65f6\u95f4\u6b65\uff08\u566a\u58f0\u6c34\u5e73\uff09\u8fdb\u884c\u52a0\u6743\u7684\u65b9\u6cd5\u3002\u53ef\u9009\u62e9 sigma_sqrt \u3001 logit_normal \u3001 mode \u3001 cosmap \u3001 uniform \uff08\u6216 none \uff09\u3002SD3\u8bba\u6587\u4e2d\u4f7f\u7528\u4e86 sigma_sqrt \u3002\u9ed8\u8ba4\u503c\u4e3a uniform \u3002 --logit_mean \u3001 --logit_std \u3001 --mode_scale \uff1a \u5f53 weighting_scheme \u9009\u62e9 logit_normal \u6216 mode \u65f6\uff0c\u7528\u4e8e\u63a7\u5236\u5176\u5206\u5e03\u7684\u53c2\u6570\u3002\u901a\u5e38\u4f7f\u7528\u9ed8\u8ba4\u503c\u5373\u53ef\u3002 \u5185\u5b58\u548c\u901f\u5ea6\u76f8\u5173\u53c2\u6570 --blocks_to_swap=<\u6574\u6570> [\u5b9e\u9a8c\u6027\u529f\u80fd] \u4e3a\u4e86\u51cf\u5c11VRAM\u4f7f\u7528\u91cf\uff0c\u8bbe\u7f6e\u5728CPU\u548cGPU\u4e4b\u95f4\u4ea4\u6362\u6a21\u578b\u90e8\u5206\uff08MMDiT\u7684Transformer\u5757\uff09\u3002\u4ee5\u6574\u6570\u6307\u5b9a\u8981\u4ea4\u6362\u7684\u5757\u6570\uff08\u4f8b\u5982\uff1a 32 \uff09\u3002\u589e\u52a0\u8be5\u503c\u4f1a\u51cf\u5c11VRAM\u4f7f\u7528\u91cf\uff0c\u4f46\u4f1a\u964d\u4f4e\u8bad\u7ec3\u901f\u5ea6\u3002\u8bf7\u6839\u636eGPU\u7684VRAM\u5bb9\u91cf\u8fdb\u884c\u8c03\u6574\u3002\u53ef\u4e0e gradient_checkpointing \u7ed3\u5408\u4f7f\u7528\u3002 \u4e0d\u80fd\u4e0e --cpu_offload_checkpointing \u540c\u65f6\u4f7f\u7528\u3002 \u4e0d\u517c\u5bb9\u6216\u5df2\u5f03\u7528\u7684\u53c2\u6570 --v2 \u3001 --v_parameterization \u3001 --clip_skip \uff1a\u8fd9\u4e9b\u662f\u9488\u5bf9Stable Diffusion v1/v2\u7684\u53c2\u6570\uff0c\u4e0d\u7528\u4e8eSD3/3.5\u7684\u8bad\u7ec3\u3002 4.2. \u5f00\u59cb\u8bad\u7ec3 \u8bbe\u7f6e\u5fc5\u8981\u7684\u53c2\u6570\u5e76\u8fd0\u884c\u547d\u4ee4\u540e\uff0c\u8bad\u7ec3\u5c06\u5f00\u59cb\u3002\u57fa\u672c\u6d41\u7a0b\u548c\u65e5\u5fd7\u68c0\u67e5\u65b9\u6cd5\u4e0e train_network.py \u6307\u5357 \u76f8\u540c\u3002 5. \u4f7f\u7528\u8bad\u7ec3\u597d\u7684\u6a21\u578b \u8bad\u7ec3\u5b8c\u6210\u540e\uff0cLoRA\u6a21\u578b\u6587\u4ef6\uff08\u4f8b\u5982\uff1a my_sd3_lora.safetensors \uff09\u5c06\u4fdd\u5b58\u5728\u6307\u5b9a\u7684 output_dir \u4e2d\u3002\u8be5\u6587\u4ef6\u53ef\u7528\u4e8e\u652f\u6301SD3/3.5\u6a21\u578b\u7684\u63a8\u7406\u73af\u5883\uff08\u4f8b\u5982\uff1aComfyUI\u7b49\uff09\u3002 6. \u5176\u4ed6\u529f\u80fd sd3_train_network.py \u5305\u542b\u8bb8\u591a\u4e0e train_network.py \u76f8\u540c\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u751f\u6210\u793a\u4f8b\u56fe\u50cf\uff08 --sample_prompts \u7b49\uff09\u548c\u8be6\u7ec6\u7684\u4f18\u5316\u5668\u8bbe\u7f6e\u3002\u6709\u5173\u8fd9\u4e9b\u529f\u80fd\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 train_network.py \u6307\u5357 \u548c\u811a\u672c\u7684\u5e2e\u52a9\uff08 python sd3_train_network.py --help \uff09\u3002","title":"SD3-\u6a21\u578b\u8bad\u7ec3"},{"location":"sd-scripts-docs/sd3_train_network/#sd3_train_networkpy-stable-diffusion-335lora","text":"\u672c\u6587\u6863\u5c06\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 sd-scripts \u5b58\u50a8\u5e93\u4e2d\u7684 sd3_train_network.py \u6765\u8bad\u7ec3Stable Diffusion 3 (SD3) \u548c Stable Diffusion 3.5 (SD3.5) \u6a21\u578b\u7684LoRA\uff08Low-Rank Adaptation\uff09\u6a21\u578b\u3002","title":"sd3_train_network.py \u7528\u7684Stable Diffusion 3/3.5\u6a21\u578b\u7684LoRA\u8bad\u7ec3\u6307\u5357"},{"location":"sd-scripts-docs/sd3_train_network/#1","text":"sd3_train_network.py \u662f\u4e00\u4e2a\u7528\u4e8e\u8bad\u7ec3Stable Diffusion 3/3.5\u6a21\u578b\u7684LoRA\u7b49\u9644\u52a0\u7f51\u7edc\u7684\u811a\u672c\u3002SD3\u91c7\u7528\u4e86\u4e00\u79cd\u540d\u4e3aMMDiT\uff08\u591a\u6a21\u6001\u6269\u6563Transformer\uff09\u7684\u65b0\u67b6\u6784\uff0c\u4e0e\u4f20\u7edf\u7684Stable Diffusion\u6a21\u578b\u7ed3\u6784\u4e0d\u540c\u3002\u4f7f\u7528\u6b64\u811a\u672c\u53ef\u4ee5\u521b\u5efa\u9488\u5bf9SD3/3.5\u6a21\u578b\u7684LoRA\u6a21\u578b\u3002 \u672c\u6307\u5357\u9762\u5411\u4e86\u89e3LoRA\u8bad\u7ec3\u57fa\u672c\u6b65\u9aa4\u7684\u7528\u6237\uff0c\u5e76\u5047\u8bbe\u60a8\u5177\u6709\u4f7f\u7528 train_network.py \u8fdb\u884c\u8bad\u7ec3\u7684\u7ecf\u9a8c\u3002\u6709\u5173\u57fa\u672c\u7528\u6cd5\u548c\u901a\u7528\u9009\u9879\uff0c\u8bf7\u53c2\u9605 train_network.py \u7684\u4f7f\u7528\u6307\u5357 \u3002 \u524d\u63d0\u6761\u4ef6\uff1a \u5df2\u514b\u9686 sd-scripts \u5b58\u50a8\u5e93\u5e76\u8bbe\u7f6ePython\u73af\u5883\u3002 \u5df2\u51c6\u5907\u597d\u7528\u4e8e\u8bad\u7ec3\u7684\u6570\u636e\u96c6\u3002\uff08\u6709\u5173\u6570\u636e\u96c6\u51c6\u5907\uff0c\u8bf7\u53c2\u9605 \u6570\u636e\u96c6\u914d\u7f6e\u6307\u5357 \u3002\uff09 \u5df2\u51c6\u5907\u597d\u5f85\u8bad\u7ec3\u7684SD3/3.5\u6a21\u578b\u6587\u4ef6\u3002","title":"1. \u7b80\u4ecb"},{"location":"sd-scripts-docs/sd3_train_network/#2-train_networkpy","text":"sd3_train_network.py \u57fa\u4e8e train_network.py \uff0c\u5e76\u9488\u5bf9SD3/3.5\u6a21\u578b\u8fdb\u884c\u4e86\u4fee\u6539\u3002\u4e3b\u8981\u533a\u522b\u5982\u4e0b\uff1a \u76ee\u6807\u6a21\u578b\uff1a \u9002\u7528\u4e8eStable Diffusion 3 Medium / Large (3.0 / 3.5) \u6a21\u578b\u3002 \u6a21\u578b\u7ed3\u6784\uff1a \u4f7f\u7528MMDiT\uff08\u57fa\u4e8eTransformer\uff09\u4ee3\u66ffU-Net\u3002\u4f7f\u7528CLIP-L\u3001CLIP-G\u548cT5-XXL\u4f5c\u4e3a\u6587\u672c\u7f16\u7801\u5668\u3002VAE\u4e0eSDXL\u517c\u5bb9\uff0c\u4f46\u8f93\u5165\u7f29\u653e\u5904\u7406\u4e0d\u540c\u3002 \u53c2\u6570\uff1a \u6709\u7528\u4e8e\u6307\u5b9aSD3/3.5\u6a21\u578b\u3001\u6587\u672c\u7f16\u7801\u5668\u7ec4\u548cVAE\u7684\u53c2\u6570\u3002\u4f46\u662f\uff0c\u5982\u679c\u662f\u5355\u4e2a .safetensors \u6587\u4ef6\uff0c\u5219\u53ef\u4ee5\u5728\u5185\u90e8\u81ea\u52a8\u5206\u79bb\uff0c\u56e0\u6b64\u65e0\u9700\u6307\u5b9a\u5355\u72ec\u7684\u8def\u5f84\u3002 \u90e8\u5206\u53c2\u6570\u4e0d\u517c\u5bb9\uff1a \u7528\u4e8eStable Diffusion v1/v2\u7684\u53c2\u6570\uff08\u4f8b\u5982\uff1a --v2 \u3001 --v_parameterization \u3001 --clip_skip \uff09\u4e0d\u7528\u4e8eSD3/3.5\u7684\u8bad\u7ec3\u3002 SD3\u7279\u6709\u7684\u53c2\u6570\uff1a \u6dfb\u52a0\u4e86\u6587\u672c\u7f16\u7801\u5668\u7684\u6ce8\u610f\u529b\u63a9\u7801\u548c\u4e22\u5f03\u7387\u3001\u4f4d\u7f6e\u5d4c\u5165\u8c03\u6574\uff08\u9002\u7528\u4e8eSD3.5\uff09\u3001\u65f6\u95f4\u6b65\u91c7\u6837\u548c\u635f\u5931\u52a0\u6743\u7b49\u53c2\u6570\u3002","title":"2. \u4e0etrain_network.py\u7684\u533a\u522b"},{"location":"sd-scripts-docs/sd3_train_network/#3","text":"\u5f00\u59cb\u8bad\u7ec3\u4e4b\u524d\uff0c\u9700\u8981\u4ee5\u4e0b\u6587\u4ef6\uff1a \u8bad\u7ec3\u811a\u672c\uff1a sd3_train_network.py SD3/3.5\u6a21\u578b\u6587\u4ef6\uff1a \u7528\u4e8e\u8bad\u7ec3\u7684SD3/3.5\u6a21\u578b\u7684 .safetensors \u6587\u4ef6\u3002\u5efa\u8bae\u4f7f\u7528\u5355\u6587\u4ef6\u683c\u5f0f\uff08Diffusers/ComfyUI/AUTOMATIC1111\u683c\u5f0f\uff09\u3002 \u5982\u679c\u6587\u672c\u7f16\u7801\u5668\u6216VAE\u662f\u5355\u72ec\u7684\u6587\u4ef6\uff0c\u8bf7\u5728\u76f8\u5e94\u7684\u53c2\u6570\u4e2d\u6307\u5b9a\u8def\u5f84\u3002 \u6570\u636e\u96c6\u5b9a\u4e49\u6587\u4ef6\uff08.toml\uff09\uff1a \u4e00\u4e2aTOML\u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u7528\u4e8e\u63cf\u8ff0\u8bad\u7ec3\u6570\u636e\u96c6\u7684\u914d\u7f6e\u3002\uff08\u8be6\u60c5\u8bf7\u53c2\u9605 \u6570\u636e\u96c6\u914d\u7f6e\u6307\u5357 \u3002\uff09 \u8fd9\u91cc\u4f7f\u7528 my_sd3_dataset_config.toml \u4f5c\u4e3a\u793a\u4f8b\u3002","title":"3. \u51c6\u5907"},{"location":"sd-scripts-docs/sd3_train_network/#4","text":"\u901a\u8fc7\u5728\u7ec8\u7aef\u4e2d\u8fd0\u884c sd3_train_network.py \u6765\u5f00\u59cb\u8bad\u7ec3\u3002\u57fa\u672c\u547d\u4ee4\u884c\u7ed3\u6784\u4e0e train_network.py \u7c7b\u4f3c\uff0c\u4f46\u9700\u8981\u6307\u5b9aSD3/3.5\u7279\u6709\u7684\u53c2\u6570\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u57fa\u672c\u7684\u547d\u4ee4\u884c\u793a\u4f8b\uff1a accelerate launch --num_cpu_threads_per_process 1 sd3_train_network.py --pretrained_model_name_or_path=\"<SD3\u6a21\u578b\u7684\u8def\u5f84>\" --dataset_config=\"my_sd3_dataset_config.toml\" --output_dir=\"<\u8bad\u7ec3\u7ed3\u679c\u7684\u8f93\u51fa\u76ee\u5f55>\" --output_name=\"my_sd3_lora\" --save_model_as=safetensors --network_module=networks.lora --network_dim=16 --network_alpha=1 --learning_rate=1e-4 --optimizer_type=\"AdamW8bit\" --lr_scheduler=\"constant\" --sdpa --max_train_epochs=10 --save_every_n_epochs=1 --mixed_precision=\"fp16\" --gradient_checkpointing --apply_lg_attn_mask --apply_t5_attn_mask --weighting_scheme=\"sigma_sqrt\" --blocks_to_swap=32 \u203b\u5b9e\u9645\u4e0a\u5e94\u8be5\u5199\u5728\u4e00\u884c\u6216\u4f7f\u7528\u9002\u5f53\u7684\u6362\u884c\u7b26\uff08 \\ \u6216 ^ \uff09\u3002","title":"4. \u5f00\u59cb\u8bad\u7ec3"},{"location":"sd-scripts-docs/sd3_train_network/#41-train_networkpy","text":"\u9664\u4e86 train_network.py \u6307\u5357 \u4e2d\u4ecb\u7ecd\u7684\u53c2\u6570\u5916\uff0c\u8fd8\u9700\u8981\u6307\u5b9a\u4ee5\u4e0bSD3/3.5\u7279\u6709\u7684\u53c2\u6570\u3002\u6709\u5173\u901a\u7528\u53c2\u6570\uff08 --output_dir \u3001 --output_name \u3001 --network_module \u3001 --network_dim \u3001 --network_alpha \u3001 --learning_rate \u7b49\uff09\uff0c\u8bf7\u53c2\u9605\u4e0a\u8ff0\u6307\u5357\u3002","title":"4.1. \u4e3b\u8981\u547d\u4ee4\u884c\u53c2\u6570\u8bf4\u660e\uff08train_network.py\u65b0\u589e\u6216\u66f4\u6539\u7684\u90e8\u5206\uff09"},{"location":"sd-scripts-docs/sd3_train_network/#_1","text":"--pretrained_model_name_or_path=\"<SD3\u6a21\u578b\u7684\u8def\u5f84>\" [\u5fc5\u586b] \u6307\u5b9a\u7528\u4e8e\u8bad\u7ec3\u7684SD3/3.5\u6a21\u578b\u7684 .safetensors \u6587\u4ef6\u8def\u5f84\u3002\u5047\u8bbe\u4e3a\u5355\u6587\u4ef6\u683c\u5f0f\uff08Diffusers/ComfyUI/AUTOMATIC1111\u683c\u5f0f\uff09\u3002 --clip_l \u3001 --clip_g \u3001 --t5xxl \u3001 --vae \uff1a \u5982\u679c\u57fa\u7840\u6a21\u578b\u662f\u5355\u6587\u4ef6\u683c\u5f0f\uff0c\u901a\u5e38\u4e0d\u9700\u8981\u6307\u5b9a\u8fd9\u4e9b\u53c2\u6570\uff08\u4f1a\u81ea\u52a8\u4ece\u6a21\u578b\u5185\u90e8\u52a0\u8f7d\uff09\u3002 \u5982\u679c\u6587\u672c\u7f16\u7801\u5668\u6216VAE\u4f5c\u4e3a\u5355\u72ec\u6587\u4ef6\u63d0\u4f9b\uff0c\u8bf7\u6307\u5b9a\u76f8\u5e94\u7684 .safetensors \u6587\u4ef6\u8def\u5f84\u3002","title":"\u6a21\u578b\u76f8\u5173\u53c2\u6570"},{"location":"sd-scripts-docs/sd3_train_network/#sd335","text":"--t5xxl_max_token_length=<\u6574\u6570> \u6307\u5b9aT5-XXL\u6587\u672c\u7f16\u7801\u5668\u4f7f\u7528\u7684\u6700\u5927Token\u957f\u5ea6\u3002SD3\u7684\u9ed8\u8ba4\u503c\u4e3a 256 \u3002\u53ef\u80fd\u9700\u8981\u6839\u636e\u6570\u636e\u96c6\u7684\u5b57\u5e55\u957f\u5ea6\u8fdb\u884c\u8c03\u6574\u3002 --apply_lg_attn_mask \u5bf9CLIP-L\u548cCLIP-G\u7684\u8f93\u51fa\u5e94\u7528\u4e0e\u586b\u5145Token\u76f8\u5bf9\u5e94\u7684\u6ce8\u610f\u529b\u63a9\u7801\uff08\u96f6\u586b\u5145\uff09\u3002 --apply_t5_attn_mask \u5bf9T5-XXL\u7684\u8f93\u51fa\u5e94\u7528\u4e0e\u586b\u5145Token\u76f8\u5bf9\u5e94\u7684\u6ce8\u610f\u529b\u63a9\u7801\uff08\u96f6\u586b\u5145\uff09\u3002 --clip_l_dropout_rate \u3001 --clip_g_dropout_rate \u3001 --t5_dropout_rate \uff1a \u5bf9\u6bcf\u4e2a\u6587\u672c\u7f16\u7801\u5668\u7684\u8f93\u51fa\u4ee5\u6307\u5b9a\u7684\u6982\u7387\u5e94\u7528\u4e22\u5f03\uff08\u8f93\u51fa\u7f6e\u96f6\uff09\u3002\u6709\u52a9\u4e8e\u9632\u6b62\u8fc7\u62df\u5408\u3002\u9ed8\u8ba4\u503c\u4e3a 0.0 \uff08\u65e0\u4e22\u5f03\uff09\u3002 --pos_emb_random_crop_rate=<\u6d6e\u70b9\u6570> [\u9002\u7528\u4e8eSD3.5] \u6307\u5b9a\u5bf9MMDiT\u7684\u4f4d\u7f6e\u5d4c\u5165\u5e94\u7528\u968f\u673a\u88c1\u526a\u7684\u6982\u7387\u3002\u8fd9\u662fSD3 5M\uff083.5\uff09\u6a21\u578b\u4e2d\u8bad\u7ec3\u7684\u529f\u80fd\uff0c\u5bf9\u5176\u4ed6\u6a21\u578b\u7684\u6548\u679c\u6709\u9650\u3002\u9ed8\u8ba4\u503c\u4e3a 0.0 \u3002 --enable_scaled_pos_embed [\u9002\u7528\u4e8eSD3.5] \u5728\u591a\u5206\u8fa8\u7387\u8bad\u7ec3\u65f6\uff0c\u6839\u636e\u5206\u8fa8\u7387\u7f29\u653e\u4f4d\u7f6e\u5d4c\u5165\u3002\u8fd9\u662fSD3 5M\uff083.5\uff09\u6a21\u578b\u4e2d\u8bad\u7ec3\u7684\u529f\u80fd\uff0c\u5bf9\u5176\u4ed6\u6a21\u578b\u7684\u6548\u679c\u6709\u9650\u3002 --training_shift=<\u6d6e\u70b9\u6570> \u7528\u4e8e\u8c03\u6574\u8bad\u7ec3\u65f6\u65f6\u95f4\u6b65\uff08\u566a\u58f0\u6c34\u5e73\uff09\u5206\u5e03\u7684\u504f\u79fb\u503c\u3002\u4e0e weighting_scheme \u7ed3\u5408\u5e94\u7528\u3002\u5927\u4e8e 1.0 \u7684\u503c\u503e\u5411\u4e8e\u5f3a\u8c03\u566a\u58f0\u8f83\u5927\uff08\u7ed3\u6784\u8f83\u591a\uff09\u7684\u533a\u57df\uff0c\u800c\u5c0f\u4e8e 1.0 \u7684\u503c\u5219\u5f3a\u8c03\u566a\u58f0\u8f83\u5c0f\uff08\u7ec6\u8282\u8f83\u591a\uff09\u7684\u533a\u57df\u3002\u9ed8\u8ba4\u503c\u4e3a 1.0 \u3002 --weighting_scheme=<\u9009\u9879> \u6307\u5b9a\u6839\u636e\u635f\u5931\u8ba1\u7b97\u65f6\u7684\u65f6\u95f4\u6b65\uff08\u566a\u58f0\u6c34\u5e73\uff09\u8fdb\u884c\u52a0\u6743\u7684\u65b9\u6cd5\u3002\u53ef\u9009\u62e9 sigma_sqrt \u3001 logit_normal \u3001 mode \u3001 cosmap \u3001 uniform \uff08\u6216 none \uff09\u3002SD3\u8bba\u6587\u4e2d\u4f7f\u7528\u4e86 sigma_sqrt \u3002\u9ed8\u8ba4\u503c\u4e3a uniform \u3002 --logit_mean \u3001 --logit_std \u3001 --mode_scale \uff1a \u5f53 weighting_scheme \u9009\u62e9 logit_normal \u6216 mode \u65f6\uff0c\u7528\u4e8e\u63a7\u5236\u5176\u5206\u5e03\u7684\u53c2\u6570\u3002\u901a\u5e38\u4f7f\u7528\u9ed8\u8ba4\u503c\u5373\u53ef\u3002","title":"SD3/3.5\u8bad\u7ec3\u53c2\u6570"},{"location":"sd-scripts-docs/sd3_train_network/#_2","text":"--blocks_to_swap=<\u6574\u6570> [\u5b9e\u9a8c\u6027\u529f\u80fd] \u4e3a\u4e86\u51cf\u5c11VRAM\u4f7f\u7528\u91cf\uff0c\u8bbe\u7f6e\u5728CPU\u548cGPU\u4e4b\u95f4\u4ea4\u6362\u6a21\u578b\u90e8\u5206\uff08MMDiT\u7684Transformer\u5757\uff09\u3002\u4ee5\u6574\u6570\u6307\u5b9a\u8981\u4ea4\u6362\u7684\u5757\u6570\uff08\u4f8b\u5982\uff1a 32 \uff09\u3002\u589e\u52a0\u8be5\u503c\u4f1a\u51cf\u5c11VRAM\u4f7f\u7528\u91cf\uff0c\u4f46\u4f1a\u964d\u4f4e\u8bad\u7ec3\u901f\u5ea6\u3002\u8bf7\u6839\u636eGPU\u7684VRAM\u5bb9\u91cf\u8fdb\u884c\u8c03\u6574\u3002\u53ef\u4e0e gradient_checkpointing \u7ed3\u5408\u4f7f\u7528\u3002 \u4e0d\u80fd\u4e0e --cpu_offload_checkpointing \u540c\u65f6\u4f7f\u7528\u3002","title":"\u5185\u5b58\u548c\u901f\u5ea6\u76f8\u5173\u53c2\u6570"},{"location":"sd-scripts-docs/sd3_train_network/#_3","text":"--v2 \u3001 --v_parameterization \u3001 --clip_skip \uff1a\u8fd9\u4e9b\u662f\u9488\u5bf9Stable Diffusion v1/v2\u7684\u53c2\u6570\uff0c\u4e0d\u7528\u4e8eSD3/3.5\u7684\u8bad\u7ec3\u3002","title":"\u4e0d\u517c\u5bb9\u6216\u5df2\u5f03\u7528\u7684\u53c2\u6570"},{"location":"sd-scripts-docs/sd3_train_network/#42","text":"\u8bbe\u7f6e\u5fc5\u8981\u7684\u53c2\u6570\u5e76\u8fd0\u884c\u547d\u4ee4\u540e\uff0c\u8bad\u7ec3\u5c06\u5f00\u59cb\u3002\u57fa\u672c\u6d41\u7a0b\u548c\u65e5\u5fd7\u68c0\u67e5\u65b9\u6cd5\u4e0e train_network.py \u6307\u5357 \u76f8\u540c\u3002","title":"4.2. \u5f00\u59cb\u8bad\u7ec3"},{"location":"sd-scripts-docs/sd3_train_network/#5","text":"\u8bad\u7ec3\u5b8c\u6210\u540e\uff0cLoRA\u6a21\u578b\u6587\u4ef6\uff08\u4f8b\u5982\uff1a my_sd3_lora.safetensors \uff09\u5c06\u4fdd\u5b58\u5728\u6307\u5b9a\u7684 output_dir \u4e2d\u3002\u8be5\u6587\u4ef6\u53ef\u7528\u4e8e\u652f\u6301SD3/3.5\u6a21\u578b\u7684\u63a8\u7406\u73af\u5883\uff08\u4f8b\u5982\uff1aComfyUI\u7b49\uff09\u3002","title":"5. \u4f7f\u7528\u8bad\u7ec3\u597d\u7684\u6a21\u578b"},{"location":"sd-scripts-docs/sd3_train_network/#6","text":"sd3_train_network.py \u5305\u542b\u8bb8\u591a\u4e0e train_network.py \u76f8\u540c\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u751f\u6210\u793a\u4f8b\u56fe\u50cf\uff08 --sample_prompts \u7b49\uff09\u548c\u8be6\u7ec6\u7684\u4f18\u5316\u5668\u8bbe\u7f6e\u3002\u6709\u5173\u8fd9\u4e9b\u529f\u80fd\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 train_network.py \u6307\u5357 \u548c\u811a\u672c\u7684\u5e2e\u52a9\uff08 python sd3_train_network.py --help \uff09\u3002","title":"6. \u5176\u4ed6\u529f\u80fd"},{"location":"sd-scripts-docs/sdxl_train_network/","text":"SDXL LoRA \u5b66\u4e60\u811a\u672c sdxl_train_network.py \u7684\u4f7f\u7528\u65b9\u6cd5 \u672c\u6587\u6863\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 sd-scripts \u4ed3\u5e93\u4e2d\u7684 sdxl_train_network.py \u811a\u672c\u6765\u8bad\u7ec3 SDXL (Stable Diffusion XL) \u6a21\u578b\u7684 LoRA (Low-Rank Adaptation) \u6a21\u578b\u3002 1. \u7b80\u4ecb sdxl_train_network.py \u662f\u4e00\u4e2a\u7528\u4e8e\u8bad\u7ec3 SDXL \u6a21\u578b\u9644\u52a0\u7f51\u7edc\uff08\u5982 LoRA\uff09\u7684\u811a\u672c\u3002\u5176\u57fa\u672c\u7528\u6cd5\u4e0e train_network.py \u76f8\u540c\uff0c\u4f46\u9700\u8981\u9488\u5bf9 SDXL \u6a21\u578b\u8fdb\u884c\u7279\u5b9a\u8bbe\u7f6e\u3002 \u672c\u6307\u5357\u91cd\u70b9\u4ecb\u7ecd SDXL LoRA \u8bad\u7ec3\uff0c\u5e76\u8bf4\u660e\u4e0e train_network.py \u7684\u4e3b\u8981\u533a\u522b\u4ee5\u53ca SDXL \u7279\u6709\u7684\u8bbe\u7f6e\u9879\u3002 \u524d\u63d0\u6761\u4ef6\uff1a \u5df2\u514b\u9686 sd-scripts \u4ed3\u5e93\u5e76\u8bbe\u7f6e\u597d Python \u73af\u5883\u3002 \u51c6\u5907\u597d\u7528\u4e8e\u8bad\u7ec3\u7684\u6570\u636e\u96c6\u3002\uff08\u6709\u5173\u6570\u636e\u96c6\u51c6\u5907\uff0c\u8bf7\u53c2\u9605 \u6570\u636e\u96c6\u51c6\u5907\u6307\u5357 \u3002\uff09 \u5df2\u9605\u8bfb LoRA \u8bad\u7ec3\u811a\u672c train_network.py \u7684\u4f7f\u7528\u65b9\u6cd5 \u3002 2. \u51c6\u5907\u5de5\u4f5c \u5f00\u59cb\u8bad\u7ec3\u524d\uff0c\u9700\u8981\u4ee5\u4e0b\u6587\u4ef6\uff1a \u8bad\u7ec3\u811a\u672c\uff1a sdxl_train_network.py \u6570\u636e\u96c6\u5b9a\u4e49\u6587\u4ef6 (.toml)\uff1a \u4e00\u4e2a TOML \u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u7528\u4e8e\u63cf\u8ff0\u8bad\u7ec3\u6570\u636e\u96c6\u7684\u914d\u7f6e\u3002 \u5173\u4e8e\u6570\u636e\u96c6\u5b9a\u4e49\u6587\u4ef6 \u6570\u636e\u96c6\u5b9a\u4e49\u6587\u4ef6 ( .toml ) \u7684\u57fa\u672c\u5199\u6cd5\u4e0e train_network.py \u76f8\u540c\u3002\u8bf7\u53c2\u9605 \u6570\u636e\u96c6\u914d\u7f6e\u6307\u5357 \u548c LoRA \u8bad\u7ec3\u811a\u672c train_network.py \u7684\u4f7f\u7528\u65b9\u6cd5 \u3002 SDXL \u901a\u5e38\u4f7f\u7528\u9ad8\u5206\u8fa8\u7387\u6570\u636e\u96c6\u548c\u5bbd\u9ad8\u6bd4\u6876 ( enable_bucket = true )\u3002 \u4e0b\u9762\u4ee5 my_sdxl_dataset_config.toml \u4e3a\u4f8b\u8fdb\u884c\u8bf4\u660e\u3002 3. \u5f00\u59cb\u8bad\u7ec3 \u901a\u8fc7\u5728\u7ec8\u7aef\u8fd0\u884c sdxl_train_network.py \u6765\u5f00\u59cb\u8bad\u7ec3\u3002 \u4ee5\u4e0b\u662f\u4e00\u4e2a\u57fa\u672c\u7684 SDXL LoRA \u8bad\u7ec3\u547d\u4ee4\u884c\u793a\u4f8b\uff1a accelerate launch --num_cpu_threads_per_process 1 sdxl_train_network.py --pretrained_model_name_or_path=\"<SDXL\u57fa\u7840\u6a21\u578b\u7684\u8def\u5f84>\" --dataset_config=\"my_sdxl_dataset_config.toml\" --output_dir=\"<\u8bad\u7ec3\u7ed3\u679c\u8f93\u51fa\u76ee\u5f55>\" --output_name=\"my_sdxl_lora\" --save_model_as=safetensors --network_module=networks.lora --network_dim=32 --network_alpha=16 --learning_rate=1e-4 --unet_lr=1e-4 --text_encoder_lr1=1e-5 --text_encoder_lr2=1e-5 --optimizer_type=\"AdamW8bit\" --lr_scheduler=\"constant\" --max_train_epochs=10 --save_every_n_epochs=1 --mixed_precision=\"bf16\" --gradient_checkpointing --cache_text_encoder_outputs --cache_latents \u4e0e train_network.py \u7684\u8fd0\u884c\u793a\u4f8b\u76f8\u6bd4\uff0c\u4e3b\u8981\u533a\u522b\u5982\u4e0b\uff1a \u8fd0\u884c\u7684\u811a\u672c\u662f sdxl_train_network.py \u3002 --pretrained_model_name_or_path \u9700\u8981\u6307\u5b9a SDXL \u7684\u57fa\u7840\u6a21\u578b\u3002 --text_encoder_lr \u88ab\u62c6\u5206\u4e3a --text_encoder_lr1 \u548c --text_encoder_lr2 \uff08\u56e0\u4e3a SDXL \u6709\u4e24\u4e2a Text Encoder\uff09\u3002 \u63a8\u8350\u4f7f\u7528 bf16 \u6216 fp16 \u4f5c\u4e3a --mixed_precision \u3002 \u63a8\u8350\u4f7f\u7528 --cache_text_encoder_outputs \u548c --cache_latents \u4ee5\u51cf\u5c11 VRAM \u4f7f\u7528\u91cf\u3002 \u63a5\u4e0b\u6765\uff0c\u4ecb\u7ecd\u4e0e train_network.py \u4e0d\u540c\u7684\u4e3b\u8981\u547d\u4ee4\u884c\u53c2\u6570\u3002 3.1. \u4e3b\u8981\u547d\u4ee4\u884c\u53c2\u6570\uff08\u5dee\u5f02\u90e8\u5206\uff09 \u6a21\u578b\u76f8\u5173 --pretrained_model_name_or_path=\"<\u6a21\u578b\u8def\u5f84>\" [\u5fc5\u9700] \u6307\u5b9a\u7528\u4e8e\u8bad\u7ec3\u7684 SDXL \u6a21\u578b \u3002\u53ef\u4ee5\u662f Hugging Face Hub \u7684\u6a21\u578b ID\uff08\u4f8b\u5982 \"stabilityai/stable-diffusion-xl-base-1.0\" \uff09\uff0c\u4e5f\u53ef\u4ee5\u662f\u672c\u5730\u7684 Diffusers \u683c\u5f0f\u6a21\u578b\u76ee\u5f55\u6216 .safetensors \u6587\u4ef6\u8def\u5f84\u3002 --v2 , --v_parameterization \u8fd9\u4e9b\u53c2\u6570\u9002\u7528\u4e8e SD1.x/2.x \u6a21\u578b\u3002\u4f7f\u7528 sdxl_train_network.py \u65f6\uff0c\u7531\u4e8e\u662f\u9488\u5bf9 SDXL \u6a21\u578b\uff0c\u56e0\u6b64 \u901a\u5e38\u4e0d\u9700\u8981\u6307\u5b9a\u8fd9\u4e9b\u53c2\u6570 \u3002 \u6570\u636e\u96c6\u76f8\u5173 --dataset_config=\"<\u914d\u7f6e\u6587\u4ef6\u8def\u5f84>\" \u4e0e train_network.py \u76f8\u540c\u3002 SDXL \u4e2d\u901a\u5e38\u4f1a\u4f7f\u7528\u9ad8\u5206\u8fa8\u7387\u6570\u636e\u6216\u6876\u529f\u80fd\uff08\u5728 .toml \u4e2d\u8bbe\u7f6e enable_bucket = true \uff09\u3002 \u8f93\u51fa\u548c\u4fdd\u5b58\u76f8\u5173 \u4e0e train_network.py \u76f8\u540c\u3002 LoRA \u53c2\u6570 \u4e0e train_network.py \u76f8\u540c\u3002 \u8bad\u7ec3\u53c2\u6570 --learning_rate=1e-4 \u5168\u5c40\u5b66\u4e60\u7387\u3002\u82e5\u672a\u6307\u5b9a unet_lr \u3001 text_encoder_lr1 \u548c text_encoder_lr2 \uff0c\u5219\u4f7f\u7528\u8be5\u503c\u3002 --unet_lr=1e-4 U-Net \u90e8\u5206 LoRA \u6a21\u5757\u7684\u5b66\u4e60\u7387\u3002\u82e5\u672a\u6307\u5b9a\uff0c\u5219\u4f7f\u7528 --learning_rate \u7684\u503c\u3002 --text_encoder_lr1=1e-5 Text Encoder 1 (OpenCLIP ViT-G/14) \u7684 LoRA \u6a21\u5757 \u7684\u5b66\u4e60\u7387\u3002\u901a\u5e38\u5efa\u8bae\u6bd4 U-Net \u7684\u5b66\u4e60\u7387\u5c0f\u3002 --text_encoder_lr2=1e-5 Text Encoder 2 (CLIP ViT-L/14) \u7684 LoRA \u6a21\u5757 \u7684\u5b66\u4e60\u7387\u3002\u901a\u5e38\u5efa\u8bae\u6bd4 U-Net \u7684\u5b66\u4e60\u7387\u5c0f\u3002 --optimizer_type=\"AdamW8bit\" \u4e0e train_network.py \u76f8\u540c\u3002 --lr_scheduler=\"constant\" \u4e0e train_network.py \u76f8\u540c\u3002 --lr_warmup_steps \u4e0e train_network.py \u76f8\u540c\u3002 --max_train_steps , --max_train_epochs \u4e0e train_network.py \u76f8\u540c\u3002 --mixed_precision=\"bf16\" \u6df7\u5408\u7cbe\u5ea6\u8bad\u7ec3\u7684\u8bbe\u7f6e\u3002SDXL \u4e2d\u63a8\u8350\u4f7f\u7528 bf16 \u6216 fp16 \u3002\u8bf7\u6839\u636e GPU \u7684\u652f\u6301\u60c5\u51b5\u9009\u62e9\uff0c\u4ee5\u51cf\u5c11 VRAM \u4f7f\u7528\u5e76\u63d0\u5347\u8bad\u7ec3\u901f\u5ea6\u3002 --gradient_accumulation_steps=1 \u4e0e train_network.py \u76f8\u540c\u3002 --gradient_checkpointing \u4e0e train_network.py \u76f8\u540c\u3002\u7531\u4e8e SDXL \u5185\u5b58\u6d88\u8017\u8f83\u5927\uff0c\u63a8\u8350\u542f\u7528\u6b64\u9009\u9879\u3002 --cache_latents \u5c06 VAE \u7684\u8f93\u51fa\u7f13\u5b58\u5230\u5185\u5b58\uff08\u6216\u6307\u5b9a --cache_latents_to_disk \u65f6\u7f13\u5b58\u5230\u78c1\u76d8\uff09\u3002\u53ef\u4ee5\u8df3\u8fc7 VAE \u8ba1\u7b97\uff0c\u4ece\u800c\u51cf\u5c11 VRAM \u4f7f\u7528\u5e76\u52a0\u901f\u8bad\u7ec3\u3002\u4f46\u4f1a\u7981\u7528\u56fe\u50cf\u589e\u5f3a\uff08\u5982 --color_aug \u3001 --flip_aug \u3001 --random_crop \u7b49\uff09\u3002SDXL \u8bad\u7ec3\u63a8\u8350\u4f7f\u7528\u6b64\u9009\u9879\u3002 --cache_latents_to_disk \u4e0e --cache_latents \u914d\u5408\u4f7f\u7528\uff0c\u5c06\u7f13\u5b58\u5b58\u50a8\u5230\u78c1\u76d8\u3002\u5728\u9996\u6b21\u52a0\u8f7d\u6570\u636e\u96c6\u65f6\uff0c\u4f1a\u5c06 VAE \u8f93\u51fa\u7f13\u5b58\u5230\u78c1\u76d8\u3002\u5728\u540e\u7eed\u8bad\u7ec3\u4e2d\u53ef\u4ee5\u8df3\u8fc7 VAE \u8ba1\u7b97\uff0c\u9002\u5408\u6570\u636e\u91cf\u8f83\u5927\u7684\u60c5\u51b5\u3002 --cache_text_encoder_outputs \u5c06 Text Encoder \u7684\u8f93\u51fa\u7f13\u5b58\u5230\u5185\u5b58\uff08\u6216\u6307\u5b9a --cache_text_encoder_outputs_to_disk \u65f6\u7f13\u5b58\u5230\u78c1\u76d8\uff09\u3002\u53ef\u4ee5\u51cf\u5c11 VRAM \u4f7f\u7528\u5e76\u52a0\u901f\u8bad\u7ec3\u3002\u4f46\u4f1a\u7981\u7528\u6587\u672c\u589e\u5f3a\uff08\u5982 --shuffle_caption \u3001 --caption_dropout_rate \u7b49\uff09\u3002 \u6ce8\u610f\uff1a \u4f7f\u7528\u6b64\u9009\u9879\u65f6\uff0cText Encoder \u7684 LoRA \u6a21\u5757\u5c06\u65e0\u6cd5\u8bad\u7ec3\uff08\u5fc5\u987b\u6307\u5b9a --network_train_unet_only \uff09\u3002 --cache_text_encoder_outputs_to_disk \u4e0e --cache_text_encoder_outputs \u914d\u5408\u4f7f\u7528\uff0c\u5c06\u7f13\u5b58\u5b58\u50a8\u5230\u78c1\u76d8\u3002 --no_half_vae \u5373\u4f7f\u5728\u4f7f\u7528\u6df7\u5408\u7cbe\u5ea6 ( fp16 / bf16 ) \u65f6\uff0c\u4e5f\u8ba9 VAE \u4ee5 float32 \u8fd0\u884c\u3002SDXL \u7684 VAE \u5728 float16 \u4e0b\u53ef\u80fd\u4e0d\u7a33\u5b9a\uff0c\u56e0\u6b64\u5728\u6307\u5b9a fp16 \u65f6\u5efa\u8bae\u542f\u7528\u6b64\u9009\u9879\u3002 --clip_skip SDXL \u901a\u5e38\u4e0d\u9700\u8981\u4f7f\u7528\uff0c\u63a8\u8350\u4e0d\u6307\u5b9a\u3002 --fused_backward_pass \u5c06\u68af\u5ea6\u8ba1\u7b97\u548c\u4f18\u5316\u5668\u6b65\u9aa4\u5408\u5e76\uff0c\u4ee5\u51cf\u5c11 VRAM \u4f7f\u7528\u91cf\u3002\u9002\u7528\u4e8e SDXL\uff08\u76ee\u524d\u4ec5\u652f\u6301 Adafactor \u4f18\u5316\u5668\uff09\u3002 \u5176\u4ed6 --seed \u3001 --logging_dir \u3001 --log_prefix \u7b49\u53c2\u6570\u4e0e train_network.py \u76f8\u540c\u3002 3.2. \u5f00\u59cb\u8bad\u7ec3 \u914d\u7f6e\u597d\u5fc5\u8981\u53c2\u6570\u540e\uff0c\u8fd0\u884c\u547d\u4ee4\u5373\u53ef\u5f00\u59cb\u8bad\u7ec3\u3002\u8bad\u7ec3\u8fdb\u5ea6\u4f1a\u8f93\u51fa\u5230\u63a7\u5236\u53f0\u3002\u57fa\u672c\u6d41\u7a0b\u4e0e train_network.py \u76f8\u540c\u3002 4. \u4f7f\u7528\u8bad\u7ec3\u597d\u7684\u6a21\u578b \u8bad\u7ec3\u5b8c\u6210\u540e\uff0c\u5728 --output_dir \u6307\u5b9a\u7684\u76ee\u5f55\u4e0b\u4f1a\u4fdd\u5b58\u4ee5 --output_name \u547d\u540d\u7684 LoRA \u6a21\u578b\u6587\u4ef6\uff08\u4f8b\u5982 .safetensors \uff09\u3002 \u8be5\u6587\u4ef6\u53ef\u7528\u4e8e\u652f\u6301 SDXL \u7684 GUI \u5de5\u5177\uff0c\u5982 AUTOMATIC1111/stable-diffusion-webui \u548c ComfyUI\u3002 5. \u8865\u5145\uff1a\u4e0e train_network.py \u7684\u4e3b\u8981\u533a\u522b \u76ee\u6807\u6a21\u578b\uff1a sdxl_train_network.py \u4e13\u95e8\u7528\u4e8e SDXL \u6a21\u578b\u3002 Text Encoder\uff1a SDXL \u6709\u4e24\u4e2a Text Encoder\uff0c\u56e0\u6b64\u5b66\u4e60\u7387\u7684\u6307\u5b9a\uff08 --text_encoder_lr1 \u3001 --text_encoder_lr2 \uff09\u6709\u6240\u4e0d\u540c\u3002 \u7f13\u5b58\u529f\u80fd\uff1a --cache_text_encoder_outputs \u5728 SDXL \u4e2d\u6548\u679c\u663e\u8457\uff0c\u63a8\u8350\u4f7f\u7528\u3002 \u63a8\u8350\u8bbe\u7f6e\uff1a \u7531\u4e8e SDXL \u5185\u5b58\u5360\u7528\u8f83\u5927\uff0c\u63a8\u8350\u4f7f\u7528 bf16 \u6216 fp16 \u6df7\u5408\u7cbe\u5ea6\u3001 gradient_checkpointing \uff0c\u4ee5\u53ca\u7f13\u5b58\u529f\u80fd\uff08 --cache_latents \u3001 --cache_text_encoder_outputs \uff09\u3002\u82e5\u4f7f\u7528 fp16 \uff0c\u5efa\u8bae\u642d\u914d --no_half_vae \u8ba9 VAE \u4ee5 float32 \u8fd0\u884c\u3002 \u66f4\u591a\u8be6\u7ec6\u9009\u9879\uff0c\u8bf7\u53c2\u8003\u811a\u672c\u7684\u5e2e\u52a9\u4fe1\u606f ( python sdxl_train_network.py --help ) \u6216\u4ed3\u5e93\u4e2d\u7684\u5176\u4ed6\u6587\u6863\u3002","title":"SDXL-Lora-\u6a21\u578b\u8bad\u7ec3"},{"location":"sd-scripts-docs/sdxl_train_network/#sdxl-lora-sdxl_train_networkpy","text":"\u672c\u6587\u6863\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 sd-scripts \u4ed3\u5e93\u4e2d\u7684 sdxl_train_network.py \u811a\u672c\u6765\u8bad\u7ec3 SDXL (Stable Diffusion XL) \u6a21\u578b\u7684 LoRA (Low-Rank Adaptation) \u6a21\u578b\u3002","title":"SDXL LoRA \u5b66\u4e60\u811a\u672c sdxl_train_network.py \u7684\u4f7f\u7528\u65b9\u6cd5"},{"location":"sd-scripts-docs/sdxl_train_network/#1","text":"sdxl_train_network.py \u662f\u4e00\u4e2a\u7528\u4e8e\u8bad\u7ec3 SDXL \u6a21\u578b\u9644\u52a0\u7f51\u7edc\uff08\u5982 LoRA\uff09\u7684\u811a\u672c\u3002\u5176\u57fa\u672c\u7528\u6cd5\u4e0e train_network.py \u76f8\u540c\uff0c\u4f46\u9700\u8981\u9488\u5bf9 SDXL \u6a21\u578b\u8fdb\u884c\u7279\u5b9a\u8bbe\u7f6e\u3002 \u672c\u6307\u5357\u91cd\u70b9\u4ecb\u7ecd SDXL LoRA \u8bad\u7ec3\uff0c\u5e76\u8bf4\u660e\u4e0e train_network.py \u7684\u4e3b\u8981\u533a\u522b\u4ee5\u53ca SDXL \u7279\u6709\u7684\u8bbe\u7f6e\u9879\u3002 \u524d\u63d0\u6761\u4ef6\uff1a \u5df2\u514b\u9686 sd-scripts \u4ed3\u5e93\u5e76\u8bbe\u7f6e\u597d Python \u73af\u5883\u3002 \u51c6\u5907\u597d\u7528\u4e8e\u8bad\u7ec3\u7684\u6570\u636e\u96c6\u3002\uff08\u6709\u5173\u6570\u636e\u96c6\u51c6\u5907\uff0c\u8bf7\u53c2\u9605 \u6570\u636e\u96c6\u51c6\u5907\u6307\u5357 \u3002\uff09 \u5df2\u9605\u8bfb LoRA \u8bad\u7ec3\u811a\u672c train_network.py \u7684\u4f7f\u7528\u65b9\u6cd5 \u3002","title":"1. \u7b80\u4ecb"},{"location":"sd-scripts-docs/sdxl_train_network/#2","text":"\u5f00\u59cb\u8bad\u7ec3\u524d\uff0c\u9700\u8981\u4ee5\u4e0b\u6587\u4ef6\uff1a \u8bad\u7ec3\u811a\u672c\uff1a sdxl_train_network.py \u6570\u636e\u96c6\u5b9a\u4e49\u6587\u4ef6 (.toml)\uff1a \u4e00\u4e2a TOML \u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u7528\u4e8e\u63cf\u8ff0\u8bad\u7ec3\u6570\u636e\u96c6\u7684\u914d\u7f6e\u3002","title":"2. \u51c6\u5907\u5de5\u4f5c"},{"location":"sd-scripts-docs/sdxl_train_network/#_1","text":"\u6570\u636e\u96c6\u5b9a\u4e49\u6587\u4ef6 ( .toml ) \u7684\u57fa\u672c\u5199\u6cd5\u4e0e train_network.py \u76f8\u540c\u3002\u8bf7\u53c2\u9605 \u6570\u636e\u96c6\u914d\u7f6e\u6307\u5357 \u548c LoRA \u8bad\u7ec3\u811a\u672c train_network.py \u7684\u4f7f\u7528\u65b9\u6cd5 \u3002 SDXL \u901a\u5e38\u4f7f\u7528\u9ad8\u5206\u8fa8\u7387\u6570\u636e\u96c6\u548c\u5bbd\u9ad8\u6bd4\u6876 ( enable_bucket = true )\u3002 \u4e0b\u9762\u4ee5 my_sdxl_dataset_config.toml \u4e3a\u4f8b\u8fdb\u884c\u8bf4\u660e\u3002","title":"\u5173\u4e8e\u6570\u636e\u96c6\u5b9a\u4e49\u6587\u4ef6"},{"location":"sd-scripts-docs/sdxl_train_network/#3","text":"\u901a\u8fc7\u5728\u7ec8\u7aef\u8fd0\u884c sdxl_train_network.py \u6765\u5f00\u59cb\u8bad\u7ec3\u3002 \u4ee5\u4e0b\u662f\u4e00\u4e2a\u57fa\u672c\u7684 SDXL LoRA \u8bad\u7ec3\u547d\u4ee4\u884c\u793a\u4f8b\uff1a accelerate launch --num_cpu_threads_per_process 1 sdxl_train_network.py --pretrained_model_name_or_path=\"<SDXL\u57fa\u7840\u6a21\u578b\u7684\u8def\u5f84>\" --dataset_config=\"my_sdxl_dataset_config.toml\" --output_dir=\"<\u8bad\u7ec3\u7ed3\u679c\u8f93\u51fa\u76ee\u5f55>\" --output_name=\"my_sdxl_lora\" --save_model_as=safetensors --network_module=networks.lora --network_dim=32 --network_alpha=16 --learning_rate=1e-4 --unet_lr=1e-4 --text_encoder_lr1=1e-5 --text_encoder_lr2=1e-5 --optimizer_type=\"AdamW8bit\" --lr_scheduler=\"constant\" --max_train_epochs=10 --save_every_n_epochs=1 --mixed_precision=\"bf16\" --gradient_checkpointing --cache_text_encoder_outputs --cache_latents \u4e0e train_network.py \u7684\u8fd0\u884c\u793a\u4f8b\u76f8\u6bd4\uff0c\u4e3b\u8981\u533a\u522b\u5982\u4e0b\uff1a \u8fd0\u884c\u7684\u811a\u672c\u662f sdxl_train_network.py \u3002 --pretrained_model_name_or_path \u9700\u8981\u6307\u5b9a SDXL \u7684\u57fa\u7840\u6a21\u578b\u3002 --text_encoder_lr \u88ab\u62c6\u5206\u4e3a --text_encoder_lr1 \u548c --text_encoder_lr2 \uff08\u56e0\u4e3a SDXL \u6709\u4e24\u4e2a Text Encoder\uff09\u3002 \u63a8\u8350\u4f7f\u7528 bf16 \u6216 fp16 \u4f5c\u4e3a --mixed_precision \u3002 \u63a8\u8350\u4f7f\u7528 --cache_text_encoder_outputs \u548c --cache_latents \u4ee5\u51cf\u5c11 VRAM \u4f7f\u7528\u91cf\u3002 \u63a5\u4e0b\u6765\uff0c\u4ecb\u7ecd\u4e0e train_network.py \u4e0d\u540c\u7684\u4e3b\u8981\u547d\u4ee4\u884c\u53c2\u6570\u3002","title":"3. \u5f00\u59cb\u8bad\u7ec3"},{"location":"sd-scripts-docs/sdxl_train_network/#31","text":"","title":"3.1. \u4e3b\u8981\u547d\u4ee4\u884c\u53c2\u6570\uff08\u5dee\u5f02\u90e8\u5206\uff09"},{"location":"sd-scripts-docs/sdxl_train_network/#_2","text":"--pretrained_model_name_or_path=\"<\u6a21\u578b\u8def\u5f84>\" [\u5fc5\u9700] \u6307\u5b9a\u7528\u4e8e\u8bad\u7ec3\u7684 SDXL \u6a21\u578b \u3002\u53ef\u4ee5\u662f Hugging Face Hub \u7684\u6a21\u578b ID\uff08\u4f8b\u5982 \"stabilityai/stable-diffusion-xl-base-1.0\" \uff09\uff0c\u4e5f\u53ef\u4ee5\u662f\u672c\u5730\u7684 Diffusers \u683c\u5f0f\u6a21\u578b\u76ee\u5f55\u6216 .safetensors \u6587\u4ef6\u8def\u5f84\u3002 --v2 , --v_parameterization \u8fd9\u4e9b\u53c2\u6570\u9002\u7528\u4e8e SD1.x/2.x \u6a21\u578b\u3002\u4f7f\u7528 sdxl_train_network.py \u65f6\uff0c\u7531\u4e8e\u662f\u9488\u5bf9 SDXL \u6a21\u578b\uff0c\u56e0\u6b64 \u901a\u5e38\u4e0d\u9700\u8981\u6307\u5b9a\u8fd9\u4e9b\u53c2\u6570 \u3002","title":"\u6a21\u578b\u76f8\u5173"},{"location":"sd-scripts-docs/sdxl_train_network/#_3","text":"--dataset_config=\"<\u914d\u7f6e\u6587\u4ef6\u8def\u5f84>\" \u4e0e train_network.py \u76f8\u540c\u3002 SDXL \u4e2d\u901a\u5e38\u4f1a\u4f7f\u7528\u9ad8\u5206\u8fa8\u7387\u6570\u636e\u6216\u6876\u529f\u80fd\uff08\u5728 .toml \u4e2d\u8bbe\u7f6e enable_bucket = true \uff09\u3002","title":"\u6570\u636e\u96c6\u76f8\u5173"},{"location":"sd-scripts-docs/sdxl_train_network/#_4","text":"\u4e0e train_network.py \u76f8\u540c\u3002","title":"\u8f93\u51fa\u548c\u4fdd\u5b58\u76f8\u5173"},{"location":"sd-scripts-docs/sdxl_train_network/#lora","text":"\u4e0e train_network.py \u76f8\u540c\u3002","title":"LoRA \u53c2\u6570"},{"location":"sd-scripts-docs/sdxl_train_network/#_5","text":"--learning_rate=1e-4 \u5168\u5c40\u5b66\u4e60\u7387\u3002\u82e5\u672a\u6307\u5b9a unet_lr \u3001 text_encoder_lr1 \u548c text_encoder_lr2 \uff0c\u5219\u4f7f\u7528\u8be5\u503c\u3002 --unet_lr=1e-4 U-Net \u90e8\u5206 LoRA \u6a21\u5757\u7684\u5b66\u4e60\u7387\u3002\u82e5\u672a\u6307\u5b9a\uff0c\u5219\u4f7f\u7528 --learning_rate \u7684\u503c\u3002 --text_encoder_lr1=1e-5 Text Encoder 1 (OpenCLIP ViT-G/14) \u7684 LoRA \u6a21\u5757 \u7684\u5b66\u4e60\u7387\u3002\u901a\u5e38\u5efa\u8bae\u6bd4 U-Net \u7684\u5b66\u4e60\u7387\u5c0f\u3002 --text_encoder_lr2=1e-5 Text Encoder 2 (CLIP ViT-L/14) \u7684 LoRA \u6a21\u5757 \u7684\u5b66\u4e60\u7387\u3002\u901a\u5e38\u5efa\u8bae\u6bd4 U-Net \u7684\u5b66\u4e60\u7387\u5c0f\u3002 --optimizer_type=\"AdamW8bit\" \u4e0e train_network.py \u76f8\u540c\u3002 --lr_scheduler=\"constant\" \u4e0e train_network.py \u76f8\u540c\u3002 --lr_warmup_steps \u4e0e train_network.py \u76f8\u540c\u3002 --max_train_steps , --max_train_epochs \u4e0e train_network.py \u76f8\u540c\u3002 --mixed_precision=\"bf16\" \u6df7\u5408\u7cbe\u5ea6\u8bad\u7ec3\u7684\u8bbe\u7f6e\u3002SDXL \u4e2d\u63a8\u8350\u4f7f\u7528 bf16 \u6216 fp16 \u3002\u8bf7\u6839\u636e GPU \u7684\u652f\u6301\u60c5\u51b5\u9009\u62e9\uff0c\u4ee5\u51cf\u5c11 VRAM \u4f7f\u7528\u5e76\u63d0\u5347\u8bad\u7ec3\u901f\u5ea6\u3002 --gradient_accumulation_steps=1 \u4e0e train_network.py \u76f8\u540c\u3002 --gradient_checkpointing \u4e0e train_network.py \u76f8\u540c\u3002\u7531\u4e8e SDXL \u5185\u5b58\u6d88\u8017\u8f83\u5927\uff0c\u63a8\u8350\u542f\u7528\u6b64\u9009\u9879\u3002 --cache_latents \u5c06 VAE \u7684\u8f93\u51fa\u7f13\u5b58\u5230\u5185\u5b58\uff08\u6216\u6307\u5b9a --cache_latents_to_disk \u65f6\u7f13\u5b58\u5230\u78c1\u76d8\uff09\u3002\u53ef\u4ee5\u8df3\u8fc7 VAE \u8ba1\u7b97\uff0c\u4ece\u800c\u51cf\u5c11 VRAM \u4f7f\u7528\u5e76\u52a0\u901f\u8bad\u7ec3\u3002\u4f46\u4f1a\u7981\u7528\u56fe\u50cf\u589e\u5f3a\uff08\u5982 --color_aug \u3001 --flip_aug \u3001 --random_crop \u7b49\uff09\u3002SDXL \u8bad\u7ec3\u63a8\u8350\u4f7f\u7528\u6b64\u9009\u9879\u3002 --cache_latents_to_disk \u4e0e --cache_latents \u914d\u5408\u4f7f\u7528\uff0c\u5c06\u7f13\u5b58\u5b58\u50a8\u5230\u78c1\u76d8\u3002\u5728\u9996\u6b21\u52a0\u8f7d\u6570\u636e\u96c6\u65f6\uff0c\u4f1a\u5c06 VAE \u8f93\u51fa\u7f13\u5b58\u5230\u78c1\u76d8\u3002\u5728\u540e\u7eed\u8bad\u7ec3\u4e2d\u53ef\u4ee5\u8df3\u8fc7 VAE \u8ba1\u7b97\uff0c\u9002\u5408\u6570\u636e\u91cf\u8f83\u5927\u7684\u60c5\u51b5\u3002 --cache_text_encoder_outputs \u5c06 Text Encoder \u7684\u8f93\u51fa\u7f13\u5b58\u5230\u5185\u5b58\uff08\u6216\u6307\u5b9a --cache_text_encoder_outputs_to_disk \u65f6\u7f13\u5b58\u5230\u78c1\u76d8\uff09\u3002\u53ef\u4ee5\u51cf\u5c11 VRAM \u4f7f\u7528\u5e76\u52a0\u901f\u8bad\u7ec3\u3002\u4f46\u4f1a\u7981\u7528\u6587\u672c\u589e\u5f3a\uff08\u5982 --shuffle_caption \u3001 --caption_dropout_rate \u7b49\uff09\u3002 \u6ce8\u610f\uff1a \u4f7f\u7528\u6b64\u9009\u9879\u65f6\uff0cText Encoder \u7684 LoRA \u6a21\u5757\u5c06\u65e0\u6cd5\u8bad\u7ec3\uff08\u5fc5\u987b\u6307\u5b9a --network_train_unet_only \uff09\u3002 --cache_text_encoder_outputs_to_disk \u4e0e --cache_text_encoder_outputs \u914d\u5408\u4f7f\u7528\uff0c\u5c06\u7f13\u5b58\u5b58\u50a8\u5230\u78c1\u76d8\u3002 --no_half_vae \u5373\u4f7f\u5728\u4f7f\u7528\u6df7\u5408\u7cbe\u5ea6 ( fp16 / bf16 ) \u65f6\uff0c\u4e5f\u8ba9 VAE \u4ee5 float32 \u8fd0\u884c\u3002SDXL \u7684 VAE \u5728 float16 \u4e0b\u53ef\u80fd\u4e0d\u7a33\u5b9a\uff0c\u56e0\u6b64\u5728\u6307\u5b9a fp16 \u65f6\u5efa\u8bae\u542f\u7528\u6b64\u9009\u9879\u3002 --clip_skip SDXL \u901a\u5e38\u4e0d\u9700\u8981\u4f7f\u7528\uff0c\u63a8\u8350\u4e0d\u6307\u5b9a\u3002 --fused_backward_pass \u5c06\u68af\u5ea6\u8ba1\u7b97\u548c\u4f18\u5316\u5668\u6b65\u9aa4\u5408\u5e76\uff0c\u4ee5\u51cf\u5c11 VRAM \u4f7f\u7528\u91cf\u3002\u9002\u7528\u4e8e SDXL\uff08\u76ee\u524d\u4ec5\u652f\u6301 Adafactor \u4f18\u5316\u5668\uff09\u3002","title":"\u8bad\u7ec3\u53c2\u6570"},{"location":"sd-scripts-docs/sdxl_train_network/#_6","text":"--seed \u3001 --logging_dir \u3001 --log_prefix \u7b49\u53c2\u6570\u4e0e train_network.py \u76f8\u540c\u3002","title":"\u5176\u4ed6"},{"location":"sd-scripts-docs/sdxl_train_network/#32","text":"\u914d\u7f6e\u597d\u5fc5\u8981\u53c2\u6570\u540e\uff0c\u8fd0\u884c\u547d\u4ee4\u5373\u53ef\u5f00\u59cb\u8bad\u7ec3\u3002\u8bad\u7ec3\u8fdb\u5ea6\u4f1a\u8f93\u51fa\u5230\u63a7\u5236\u53f0\u3002\u57fa\u672c\u6d41\u7a0b\u4e0e train_network.py \u76f8\u540c\u3002","title":"3.2. \u5f00\u59cb\u8bad\u7ec3"},{"location":"sd-scripts-docs/sdxl_train_network/#4","text":"\u8bad\u7ec3\u5b8c\u6210\u540e\uff0c\u5728 --output_dir \u6307\u5b9a\u7684\u76ee\u5f55\u4e0b\u4f1a\u4fdd\u5b58\u4ee5 --output_name \u547d\u540d\u7684 LoRA \u6a21\u578b\u6587\u4ef6\uff08\u4f8b\u5982 .safetensors \uff09\u3002 \u8be5\u6587\u4ef6\u53ef\u7528\u4e8e\u652f\u6301 SDXL \u7684 GUI \u5de5\u5177\uff0c\u5982 AUTOMATIC1111/stable-diffusion-webui \u548c ComfyUI\u3002","title":"4. \u4f7f\u7528\u8bad\u7ec3\u597d\u7684\u6a21\u578b"},{"location":"sd-scripts-docs/sdxl_train_network/#5-train_networkpy","text":"\u76ee\u6807\u6a21\u578b\uff1a sdxl_train_network.py \u4e13\u95e8\u7528\u4e8e SDXL \u6a21\u578b\u3002 Text Encoder\uff1a SDXL \u6709\u4e24\u4e2a Text Encoder\uff0c\u56e0\u6b64\u5b66\u4e60\u7387\u7684\u6307\u5b9a\uff08 --text_encoder_lr1 \u3001 --text_encoder_lr2 \uff09\u6709\u6240\u4e0d\u540c\u3002 \u7f13\u5b58\u529f\u80fd\uff1a --cache_text_encoder_outputs \u5728 SDXL \u4e2d\u6548\u679c\u663e\u8457\uff0c\u63a8\u8350\u4f7f\u7528\u3002 \u63a8\u8350\u8bbe\u7f6e\uff1a \u7531\u4e8e SDXL \u5185\u5b58\u5360\u7528\u8f83\u5927\uff0c\u63a8\u8350\u4f7f\u7528 bf16 \u6216 fp16 \u6df7\u5408\u7cbe\u5ea6\u3001 gradient_checkpointing \uff0c\u4ee5\u53ca\u7f13\u5b58\u529f\u80fd\uff08 --cache_latents \u3001 --cache_text_encoder_outputs \uff09\u3002\u82e5\u4f7f\u7528 fp16 \uff0c\u5efa\u8bae\u642d\u914d --no_half_vae \u8ba9 VAE \u4ee5 float32 \u8fd0\u884c\u3002 \u66f4\u591a\u8be6\u7ec6\u9009\u9879\uff0c\u8bf7\u53c2\u8003\u811a\u672c\u7684\u5e2e\u52a9\u4fe1\u606f ( python sdxl_train_network.py --help ) \u6216\u4ed3\u5e93\u4e2d\u7684\u5176\u4ed6\u6587\u6863\u3002","title":"5. \u8865\u5145\uff1a\u4e0e train_network.py \u7684\u4e3b\u8981\u533a\u522b"},{"location":"sd-scripts-docs/train/","text":"\u7531\u4e8e\u6587\u6863\u6b63\u5728\u66f4\u65b0\u4e2d\uff0c\u53ef\u80fd\u5b58\u5728\u63cf\u8ff0\u9519\u8bef\u3002 \u5173\u4e8e\u5b66\u4e60\uff0c\u901a\u7528\u7bc7 \u672c\u4ed3\u5e93\u652f\u6301\u5bf9\u6a21\u578b\u7684 fine tuning\u3001DreamBooth\uff0c\u4ee5\u53ca LoRA \u548c Textual Inversion\uff08\u5305\u62ec XTI:P+ \uff09\u7684\u5b66\u4e60\u3002\u672c\u6587\u6863\u5c06\u4ecb\u7ecd\u5b83\u4eec\u5171\u901a\u7684\u5b66\u4e60\u6570\u636e\u51c6\u5907\u65b9\u6cd5\u548c\u9009\u9879\u7b49\u3002 \u6982\u8981 \u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u8bf7\u53c2\u8003\u672c\u4ed3\u5e93\u7684 README \u8fdb\u884c\u73af\u5883\u8bbe\u7f6e\u3002 \u672c\u6587\u6863\u5c06\u4ecb\u7ecd\u4ee5\u4e0b\u5185\u5bb9\uff1a \u5b66\u4e60\u6570\u636e\u7684\u51c6\u5907\u65b9\u6cd5\uff08\u4f7f\u7528\u8bbe\u7f6e\u6587\u4ef6\u7684\u65b0\u683c\u5f0f\uff09 \u5b66\u4e60\u4e2d\u4f7f\u7528\u7684\u672f\u8bed\u7684\u7b80\u8981\u8bf4\u660e \u4e4b\u524d\u7684\u6307\u5b9a\u683c\u5f0f\uff08\u4e0d\u4f7f\u7528\u8bbe\u7f6e\u6587\u4ef6\uff0c\u76f4\u63a5\u4ece\u547d\u4ee4\u884c\u6307\u5b9a\uff09 \u5728\u5b66\u4e60\u8fc7\u7a0b\u4e2d\u751f\u6210\u793a\u4f8b\u56fe\u50cf \u5404\u4e2a\u811a\u672c\u4e2d\u5171\u901a\u7684\u3001\u5e38\u7528\u7684\u9009\u9879 fine tuning \u65b9\u5f0f\u7684\u5143\u6570\u636e\u51c6\u5907\uff1a\u6807\u6ce8\u7b49 1.\u53ea\u9700\u6267\u884c\u6b65\u9aa41\u5c31\u53ef\u4ee5\u5f00\u59cb\u5b66\u4e60\u4e86\uff08\u5b66\u4e60\u8be6\u60c5\u8bf7\u53c2\u8003\u5404\u811a\u672c\u7684\u6587\u6863\uff09\u30022.\u6b65\u9aa42\u53ca\u4e4b\u540e\u7684\u5185\u5bb9\u8bf7\u6839\u636e\u9700\u8981\u53c2\u8003\u3002 \u5173\u4e8e\u5b66\u4e60\u6570\u636e\u7684\u51c6\u5907 \u8bf7\u5728\u4efb\u610f\u6587\u4ef6\u5939\uff08\u53ef\u4ee5\u662f\u591a\u4e2a\u6587\u4ef6\u5939\uff09\u4e2d\u51c6\u5907\u5b66\u4e60\u6570\u636e\u7684\u56fe\u50cf\u6587\u4ef6\u3002\u652f\u6301 .png \u3001 .jpg \u3001 .jpeg \u3001 .webp \u3001 .bmp \u683c\u5f0f\u3002\u57fa\u672c\u4e0a\u4e0d\u9700\u8981\u8fdb\u884c\u9884\u5904\u7406\uff0c\u5982\u8c03\u6574\u5927\u5c0f\u7b49\u3002 \u4f46\u662f\uff0c\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528\u6bd4\u5b66\u4e60\u5206\u8fa8\u7387\uff08\u540e\u8ff0\uff09\u660e\u663e\u5c0f\u7684\u56fe\u50cf\uff0c\u6216\u8005\u4e8b\u5148\u4f7f\u7528\u8d85\u5206\u8fa8\u7387 AI \u7b49\u8fdb\u884c\u653e\u5927\u3002\u53e6\u5916\uff0c\u6781\u5927\u7684\u56fe\u50cf\uff08\u7ea63000x3000\u50cf\u7d20\u6216\u66f4\u5927\uff09\u53ef\u80fd\u4f1a\u5bfc\u81f4\u9519\u8bef\uff0c\u56e0\u6b64\u8bf7\u4e8b\u5148\u7f29\u5c0f\u3002 \u5728\u5b66\u4e60\u65f6\uff0c\u9700\u8981\u6574\u7406\u8981\u8ba9\u6a21\u578b\u5b66\u4e60\u7684\u56fe\u7247\u6570\u636e\uff0c\u5e76\u5c06\u5176\u6307\u5b9a\u7ed9\u811a\u672c\u3002\u6839\u636e\u56fe\u7247\u6570\u636e\u7684\u6570\u91cf\u3001\u5b66\u4e60\u5bf9\u8c61\u3001\u662f\u5426\u6709\u6807\u9898\uff08\u56fe\u7247\u7684\u8bf4\u660e\uff09\u7b49\uff0c\u53ef\u4ee5\u901a\u8fc7\u51e0\u79cd\u65b9\u6cd5\u6307\u5b9a\u5b66\u4e60\u6570\u636e\u3002\u4ee5\u4e0b\u662f\u53ef\u7528\u7684\u65b9\u6cd5\uff08\u6bcf\u4e2a\u540d\u79f0\u5e76\u4e0d\u662f\u901a\u7528\u7684\uff0c\u800c\u662f\u672c\u4ed3\u5e93\u7684\u5b9a\u4e49\uff09\u3002\u5173\u4e8e\u6b63\u5219\u5316\u56fe\u7247\u5c06\u5728\u540e\u9762\u63cf\u8ff0\u3002 DreamBooth\u3001class+identifier \u65b9\u5f0f\uff08\u53ef\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff09 \u901a\u8fc7\u7279\u5b9a\u5355\u8bcd\uff08identifier\uff09\u4e0e\u5b66\u4e60\u5bf9\u8c61\u5173\u8054\u6765\u8fdb\u884c\u5b66\u4e60\u3002\u4e0d\u9700\u8981\u51c6\u5907\u6807\u9898\u3002\u4f8b\u5982\uff0c\u7528\u4e8e\u5b66\u4e60\u7279\u5b9a\u89d2\u8272\u65f6\uff0c\u7531\u4e8e\u4e0d\u9700\u8981\u51c6\u5907\u6807\u9898\uff0c\u56e0\u6b64\u6bd4\u8f83\u65b9\u4fbf\u3002\u4f46\u662f\uff0c\u7531\u4e8e\u5934\u53d1\u6837\u5f0f\u3001\u670d\u88c5\u3001\u80cc\u666f\u7b49\u5b66\u4e60\u6570\u636e\u4e2d\u7684\u6240\u6709\u5143\u7d20\u90fd\u4e0e identifier \u5173\u8054\uff0c\u56e0\u6b64\u5728\u751f\u6210\u56fe\u50cf\u65f6\u53ef\u80fd\u65e0\u6cd5\u66f4\u6539\u670d\u88c5\u7b49\u3002 DreamBooth\u3001\u6807\u9898\u65b9\u5f0f\uff08\u53ef\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff09 \u4e3a\u6bcf\u5f20\u56fe\u50cf\u51c6\u5907\u8bb0\u5f55\u6807\u9898\u7684\u6587\u672c\u6587\u4ef6\u6765\u8fdb\u884c\u5b66\u4e60\u3002\u4f8b\u5982\uff0c\u7528\u4e8e\u5b66\u4e60\u7279\u5b9a\u89d2\u8272\u65f6\uff0c\u901a\u8fc7\u5728\u6807\u9898\u4e2d\u63cf\u8ff0\u56fe\u50cf\u7684\u7ec6\u8282\uff08\u7a7f\u767d\u8863\u670d\u7684\u89d2\u8272A\u3001\u7a7f\u7ea2\u8863\u670d\u7684\u89d2\u8272A\u7b49\uff09\uff0c\u53ef\u4ee5\u5c06\u89d2\u8272\u4e0e\u5176\u4ed6\u5143\u7d20\u5206\u79bb\uff0c\u4ece\u800c\u66f4\u4e25\u683c\u5730\u5b66\u4e60\u89d2\u8272\u3002 fine tuning \u65b9\u5f0f\uff08\u4e0d\u53ef\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff09 \u4e8b\u5148\u5c06\u6807\u9898\u6c47\u603b\u5230\u5143\u6570\u636e\u6587\u4ef6\u4e2d\u3002\u652f\u6301\u5c06\u6807\u7b7e\u548c\u6807\u9898\u5206\u5f00\u7ba1\u7406\u3001\u9884\u5148\u7f13\u5b58latents\u4ee5\u52a0\u5feb\u5b66\u4e60\u901f\u5ea6\u7b49\u529f\u80fd\uff08\u5747\u5728\u5176\u4ed6\u6587\u6863\u4e2d\u8bf4\u660e\uff09\u3002\uff08\u867d\u7136\u79f0\u4e3afine tuning\u65b9\u5f0f\uff0c\u4f46\u4e0d\u4ec5\u9650\u4e8efine tuning\uff09\u3002 \u53ef\u7528\u4e8e\u5b66\u4e60\u7684\u5bf9\u8c61\u6216\u65b9\u6cd5\u4e0e\u53ef\u7528\u7684\u6307\u5b9a\u65b9\u6cd5\u7684\u7ec4\u5408\u5982\u4e0b\uff1a \u5b66\u4e60\u5bf9\u8c61\u6216\u65b9\u6cd5 \u811a\u672c DB / class+identifier DB / \u6807\u9898 fine tuning \u5bf9\u6a21\u578b\u8fdb\u884c fine tuning fine_tune.py x x o \u5bf9\u6a21\u578b\u8fdb\u884c DreamBooth train_db.py o o x LoRA train_network.py o o o Textual Inversion train_textual_inversion.py o o o \u9009\u62e9\u54ea\u79cd\u65b9\u5f0f \u5bf9\u4e8e LoRA \u548c Textual Inversion\uff0c\u82e5\u60f3\u7b80\u5355\u5730\u8fdb\u884c\u5b66\u4e60\u800c\u4e0d\u51c6\u5907\u6807\u9898\u6587\u4ef6\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 DreamBooth class+identifier \u65b9\u5f0f\uff1b\u82e5\u80fd\u51c6\u5907\u6807\u9898\u6587\u4ef6\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 DreamBooth \u6807\u9898\u65b9\u5f0f\u3002\u82e5\u5b66\u4e60\u6570\u636e\u91cf\u5927\u4e14\u4e0d\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff0c\u5219\u4e5f\u53ef\u4ee5\u8003\u8651 fine tuning \u65b9\u5f0f\u3002 \u5bf9\u4e8e DreamBooth \u4e5f\u662f\u540c\u6837\uff0c\u4f46\u4e0d\u80fd\u4f7f\u7528 fine tuning \u65b9\u5f0f\u3002fine tuning \u7684\u60c5\u51b5\u4e0b\uff0c\u53ea\u80fd\u4f7f\u7528 fine tuning \u65b9\u5f0f\u3002 \u5173\u4e8e\u5404\u79cd\u6307\u5b9a\u65b9\u6cd5\u7684\u8bf4\u660e \u8fd9\u91cc\u53ea\u4ecb\u7ecd\u6bcf\u79cd\u6307\u5b9a\u65b9\u6cd5\u7684\u5178\u578b\u6a21\u5f0f\u3002\u66f4\u8be6\u7ec6\u7684\u6307\u5b9a\u65b9\u6cd5\u8bf7\u53c2\u8003 \u6570\u636e\u96c6\u8bbe\u7f6e \u3002 DreamBooth\u3001class+identifier \u65b9\u5f0f\uff08\u53ef\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff09 \u5728\u8fd9\u79cd\u65b9\u5f0f\u4e2d\uff0c\u6bcf\u5f20\u56fe\u50cf\u90fd\u4e0e class identifier \u8fd9\u6837\u7684\u6807\u9898\u4e00\u8d77\u5b66\u4e60\uff08\u4f8b\u5982 shs dog \uff09\u3002 \u6b65\u9aa41\uff1a\u51b3\u5b9a identifier \u548c class \u786e\u5b9a\u8981\u4e0e\u5b66\u4e60\u5bf9\u8c61\u5173\u8054\u7684\u5355\u8bcd identifier \u548c\u5bf9\u8c61\u6240\u5c5e\u7684 class\u3002 \uff08\u867d\u7136\u6709\u5404\u79cd\u4e0d\u540c\u7684\u79f0\u547c\uff0c\u4f46\u8fd9\u91cc\u6309\u7167\u539f\u59cb\u8bba\u6587\u7684\u8bf4\u6cd5\uff09\u3002 \u4e0b\u9762\u7b80\u8981\u8bf4\u660e\uff08\u8be6\u60c5\u8bf7\u81ea\u884c\u67e5\u627e\uff09\u3002 class \u662f\u5b66\u4e60\u5bf9\u8c61\u7684\u4e00\u822c\u7c7b\u522b\u3002\u4f8b\u5982\uff0c\u82e5\u8981\u5b66\u4e60\u7279\u5b9a\u7684\u72ac\u79cd\uff0c\u5219 class \u4e3a dog\u3002\u82e5\u662f\u52a8\u6f2b\u89d2\u8272\uff0c\u5219 class \u53ef\u80fd\u662f boy \u6216 girl\u30011boy \u6216 1girl\uff0c\u53d6\u51b3\u4e8e\u6a21\u578b\u3002 identifier \u662f\u7528\u4e8e\u533a\u5206\u5b66\u4e60\u5bf9\u8c61\u7684\u4efb\u610f\u5355\u8bcd\uff0c\u4f46\u6839\u636e\u539f\u59cb\u8bba\u6587\uff0c\u5efa\u8bae\u4f7f\u7528\u201ctokenizer\u4e2d\u4e3a1\u4e2atoken\u76843\u4e2a\u5b57\u7b26\u4ee5\u4e0b\u3001\u4e14\u8f83\u5c11\u89c1\u7684\u5355\u8bcd\u201d\u3002 \u4f7f\u7528 identifier \u548c class\uff0c\u4f8b\u5982\u901a\u8fc7\u201cshs dog\u201d\u6765\u5b66\u4e60\u6a21\u578b\uff0c\u53ef\u4ee5\u5c06\u5b66\u4e60\u5bf9\u8c61\u4e0e class \u533a\u5206\u5f00\u6765\u3002 \u5728\u751f\u6210\u56fe\u50cf\u65f6\uff0c\u4f7f\u7528\u201cshs dog\u201d\u5373\u53ef\u751f\u6210\u6240\u5b66\u72ac\u79cd\u7684\u56fe\u50cf\u3002 \uff08\u6211\u6700\u8fd1\u4f7f\u7528\u7684 identifier \u4f8b\u5b50\u6709 shs sts scs cpc coc cic msm usu ici lvl cic dii muk ori hru rik koo yos wny \u7b49\u3002\u5b9e\u9645\u4e0a\uff0c\u6700\u597d\u4f7f\u7528 Danbooru Tag \u4e2d\u4e0d\u5305\u542b\u7684\u5355\u8bcd\uff09\u3002 \u6b65\u9aa42\uff1a\u51b3\u5b9a\u662f\u5426\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff0c\u82e5\u4f7f\u7528\uff0c\u5219\u751f\u6210\u6b63\u5219\u5316\u56fe\u50cf \u6b63\u5219\u5316\u56fe\u50cf\u662f\u9632\u6b62\u4e0a\u8ff0 class \u88ab\u5b66\u4e60\u5bf9\u8c61\u5f71\u54cd\u7684\u56fe\u50cf\uff08language drift\uff09\u3002\u82e5\u4e0d\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff0c\u5219\u4f8b\u5982\u4f7f\u7528 shs 1girl \u5b66\u4e60\u7279\u5b9a\u89d2\u8272\u65f6\uff0c\u5373\u4f7f\u4ec5\u4f7f\u7528 1girl \u4f5c\u4e3a\u63d0\u793a\uff0c\u4e5f\u4f1a\u751f\u6210\u4e0e\u8be5\u89d2\u8272\u76f8\u4f3c\u7684\u56fe\u50cf\u3002\u8fd9\u662f\u56e0\u4e3a 1girl \u5305\u542b\u5728\u5b66\u4e60\u7684\u6807\u9898\u4e2d\u3002 \u901a\u8fc7\u540c\u65f6\u5b66\u4e60\u5b66\u4e60\u5bf9\u8c61\u7684\u56fe\u50cf\u548c\u6b63\u5219\u5316\u56fe\u50cf\uff0c\u53ef\u4ee5\u4fdd\u6301 class \u7684\u539f\u6837\uff0c\u4ec5\u5728\u63d0\u793a\u4e2d\u4f7f\u7528 identifier \u65f6\u751f\u6210\u5b66\u4e60\u5bf9\u8c61\u3002 \u82e5\u4ec5\u9700\u5728 LoRA \u6216 DreamBooth \u4e2d\u751f\u6210\u7279\u5b9a\u89d2\u8272\uff0c\u5219\u53ef\u4ee5\u4e0d\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\u3002 \u5bf9\u4e8e Textual Inversion\uff0c\u53ef\u80fd\u4e5f\u4e0d\u9700\u8981\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff08\u56e0\u4e3a\u8981\u5b66\u4e60\u7684 token string \u4e0d\u5305\u542b\u5728\u6807\u9898\u4e2d\uff0c\u56e0\u6b64\u4e0d\u4f1a\u88ab\u5b66\u4e60\uff09\u3002 \u4f5c\u4e3a\u6b63\u5219\u5316\u56fe\u50cf\uff0c\u901a\u5e38\u4f7f\u7528\u5b66\u4e60\u5bf9\u8c61\u6a21\u578b\u901a\u8fc7 class \u540d\u79f0\u751f\u6210\u7684\u56fe\u50cf\uff08\u4f8b\u5982 1girl \uff09\u3002\u4f46\u82e5\u751f\u6210\u7684\u56fe\u50cf\u8d28\u91cf\u8f83\u5dee\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u6539\u8fdb\u63d0\u793a\u6216\u4ece\u7f51\u7edc\u4e0b\u8f7d\u5176\u4ed6\u56fe\u50cf\u6765\u4f7f\u7528\u3002 \uff08\u7531\u4e8e\u6b63\u5219\u5316\u56fe\u50cf\u4e5f\u4f1a\u88ab\u5b66\u4e60\uff0c\u56e0\u6b64\u5176\u8d28\u91cf\u4f1a\u5f71\u54cd\u6a21\u578b\uff09\u3002 \u901a\u5e38\uff0c\u5efa\u8bae\u51c6\u5907\u6570\u767e\u5f20\u5de6\u53f3\u7684\u6b63\u5219\u5316\u56fe\u50cf\uff08\u82e5\u6570\u91cf\u8f83\u5c11\uff0c\u5219 class \u56fe\u50cf\u4e0d\u4f1a\u88ab\u4e00\u822c\u5316\uff0c\u4ece\u800c\u4f1a\u5b66\u4e60\u5230\u5b83\u4eec\u7684\u7279\u5f81\uff09\u3002 \u4f7f\u7528\u751f\u6210\u7684\u56fe\u50cf\u65f6\uff0c\u901a\u5e38\u9700\u8981\u5c06\u5176\u5927\u5c0f\u8c03\u6574\u4e3a\u5b66\u4e60\u5206\u8fa8\u7387\uff08\u66f4\u51c6\u786e\u5730\u8bf4\uff0c\u662f bucket \u7684\u5206\u8fa8\u7387\uff0c\u540e\u8ff0\uff09\u3002 \u6b65\u9aa4 2. \u7f16\u5199\u914d\u7f6e\u6587\u4ef6 \u521b\u5efa\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\uff0c\u5c06\u5176\u6269\u5c55\u540d\u6539\u4e3a .toml \u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u65b9\u5f0f\u7f16\u5199\uff1a \uff08\u4ee5 # \u5f00\u5934\u7684\u90e8\u5206\u662f\u6ce8\u91ca\uff0c\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u590d\u5236\u7c98\u8d34\uff0c\u4e5f\u53ef\u4ee5\u5220\u9664\uff0c\u4e0d\u5f71\u54cd\u4f7f\u7528\u3002\uff09 [general] enable_bucket = true # \u662f\u5426\u4f7f\u7528\u5bbd\u9ad8\u6bd4\u6876 [[datasets]] resolution = 512 # \u8bad\u7ec3\u5206\u8fa8\u7387 batch_size = 4 # \u6279\u6b21\u5927\u5c0f [[datasets.subsets]] image_dir = 'C:\\hoge' # \u6307\u5b9a\u5305\u542b\u8bad\u7ec3\u56fe\u50cf\u7684\u6587\u4ef6\u5939 class_tokens = 'hoge girl' # \u6307\u5b9a\u6807\u8bc6\u7b26\u7c7b num_repeats = 10 # \u8bad\u7ec3\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570 # \u4ee5\u4e0b\u4ec5\u5728\u9700\u8981\u6b63\u5219\u5316\u56fe\u50cf\u65f6\u63cf\u8ff0\u3002\u5982\u679c\u4e0d\u4f7f\u7528\uff0c\u8bf7\u5220\u9664 [[datasets.subsets]] is_reg = true image_dir = 'C:\\reg' # \u6307\u5b9a\u5305\u542b\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6587\u4ef6\u5939 class_tokens = 'girl' # \u6307\u5b9a\u7c7b num_repeats = 1 # \u6b63\u5219\u5316\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570\uff0c\u57fa\u672c\u4e0a\u4e3a1\u5373\u53ef \u57fa\u672c\u4e0a\uff0c\u53ea\u9700\u66f4\u6539\u4ee5\u4e0b\u4f4d\u7f6e\u5373\u53ef\u8fdb\u884c\u8bad\u7ec3\uff1a \u8bad\u7ec3\u5206\u8fa8\u7387 \u6307\u5b9a\u4e00\u4e2a\u6570\u503c\u65f6\uff0c\u4e3a\u6b63\u65b9\u5f62\uff08\u4f8b\u5982 512 \u5373\u4e3a 512x512\uff09\uff0c\u7528\u65b9\u62ec\u53f7\u548c\u9017\u53f7\u5206\u9694\u4e24\u4e2a\u6570\u503c\u65f6\uff0c\u4e3a\u5bbd x \u9ad8\uff08\u4f8b\u5982 [512,768] \u5373\u4e3a 512x768\uff09\u3002\u5728 SD1.x \u7cfb\u5217\u4e2d\uff0c\u539f\u59cb\u8bad\u7ec3\u5206\u8fa8\u7387\u4e3a 512\u3002\u6307\u5b9a\u8f83\u5927\u7684\u5206\u8fa8\u7387\uff08\u5982 [512,768] \uff09\u53ef\u80fd\u6709\u52a9\u4e8e\u51cf\u5c11\u751f\u6210\u7eb5\u5411\u6216\u6a2a\u5411\u56fe\u50cf\u65f6\u7684\u5d29\u6e83\u3002SD2.x 768 \u7cfb\u5217\u4e2d\uff0c\u5206\u8fa8\u7387\u4e3a 768 \u3002 \u6279\u6b21\u5927\u5c0f \u6307\u5b9a\u540c\u65f6\u8bad\u7ec3\u591a\u5c11\u6570\u636e\u3002\u6839\u636e GPU \u7684\u663e\u5b58\u5927\u5c0f\u548c\u8bad\u7ec3\u5206\u8fa8\u7387\u800c\u6709\u6240\u4e0d\u540c\u3002\u8be6\u60c5\u8bf7\u53c2\u89c1\u540e\u6587\u3002\u6b64\u5916\uff0c\u6839\u636e\u5fae\u8c03/DreamBooth/LoRA \u7b49\u7684\u4e0d\u540c\uff0c\u4e5f\u4f1a\u6709\u6240\u4e0d\u540c\uff0c\u8bf7\u53c2\u9605\u5404\u811a\u672c\u7684\u8bf4\u660e\u3002 \u6587\u4ef6\u5939\u6307\u5b9a \u6307\u5b9a\u8bad\u7ec3\u56fe\u50cf\u548c\u6b63\u5219\u5316\u56fe\u50cf\uff08\u5982\u679c\u4f7f\u7528\uff09\u6240\u5728\u7684\u6587\u4ef6\u5939\u3002\u76f4\u63a5\u6307\u5b9a\u5305\u542b\u56fe\u50cf\u6570\u636e\u7684\u6587\u4ef6\u5939\u3002 \u6807\u8bc6\u7b26\u548c\u7c7b\u7684\u6307\u5b9a \u5982\u524d\u9762\u7684\u793a\u4f8b\u6240\u793a\u3002 \u91cd\u590d\u6b21\u6570 \u5728\u540e\u6587\u4e2d\u63cf\u8ff0\u3002 \u5173\u4e8e\u91cd\u590d\u6b21\u6570 \u91cd\u590d\u6b21\u6570\u7528\u4e8e\u8c03\u6574\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6570\u91cf\u548c\u8bad\u7ec3\u56fe\u50cf\u7684\u6570\u91cf\u3002\u7531\u4e8e\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6570\u91cf\u901a\u5e38\u591a\u4e8e\u8bad\u7ec3\u56fe\u50cf\uff0c\u56e0\u6b64\u901a\u8fc7\u91cd\u590d\u8bad\u7ec3\u56fe\u50cf\u6765\u5339\u914d\u6570\u91cf\uff0c\u4f7f\u5176\u4ee5 1:1 \u7684\u6bd4\u4f8b\u8fdb\u884c\u8bad\u7ec3\u3002 \u8bf7\u6307\u5b9a\u91cd\u590d\u6b21\u6570\uff0c\u4f7f\u5f97 \u8bad\u7ec3\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570 \u00d7 \u8bad\u7ec3\u56fe\u50cf\u7684\u6570\u91cf \u2265 \u6b63\u5219\u5316\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570 \u00d7 \u6b63\u5219\u5316\u56fe\u50cf\u7684\u6570\u91cf \u3002 \uff081 \u4e2a epoch\uff08\u6570\u636e\u5faa\u73af\u4e00\u6b21\u4e3a 1 \u4e2a epoch\uff09\u7684\u6570\u636e\u6570\u91cf\u4e3a\u300c\u8bad\u7ec3\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570 \u00d7 \u8bad\u7ec3\u56fe\u50cf\u7684\u6570\u91cf\u300d\u3002\u5982\u679c\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6570\u91cf\u8d85\u8fc7\u6b64\u6570\u91cf\uff0c\u591a\u4f59\u7684\u6b63\u5219\u5316\u56fe\u50cf\u5c06\u4e0d\u88ab\u4f7f\u7528\u3002\uff09 \u6b65\u9aa4 3. \u8fdb\u884c\u8bad\u7ec3 \u8bf7\u53c2\u8003\u5404\u81ea\u7684\u6587\u6863\u8fdb\u884c\u8bad\u7ec3\u3002 DreamBooth\u3001\u5b57\u5e55\u65b9\u5f0f\uff08\u53ef\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff09 \u5728\u8fd9\u79cd\u65b9\u5f0f\u4e2d\uff0c\u6bcf\u5f20\u56fe\u50cf\u90fd\u901a\u8fc7\u5b57\u5e55\u8fdb\u884c\u8bad\u7ec3\u3002 \u6b65\u9aa4 1. \u51c6\u5907\u5b57\u5e55\u6587\u4ef6 \u5728\u5305\u542b\u8bad\u7ec3\u56fe\u50cf\u7684\u6587\u4ef6\u5939\u4e2d\uff0c\u4e3a\u6bcf\u5f20\u56fe\u50cf\u521b\u5efa\u4e00\u4e2a\u5177\u6709\u76f8\u540c\u6587\u4ef6\u540d\u7684\u6587\u4ef6\uff0c\u6269\u5c55\u540d\u4e3a .caption \uff08\u53ef\u901a\u8fc7\u8bbe\u7f6e\u66f4\u6539\uff09\u3002\u6bcf\u4e2a\u6587\u4ef6\u5e94\u4ec5\u5305\u542b\u4e00\u884c\u6587\u672c\u3002\u7f16\u7801\u4e3a UTF-8 \u3002 \u6b65\u9aa4 2. \u786e\u5b9a\u662f\u5426\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff0c\u5e76\u751f\u6210\u6b63\u5219\u5316\u56fe\u50cf\uff08\u5982\u679c\u4f7f\u7528\uff09 \u4e0e\u7c7b+\u6807\u8bc6\u7b26\u5f62\u5f0f\u76f8\u540c\u3002\u540c\u6837\uff0c\u53ef\u4ee5\u4e3a\u6b63\u5219\u5316\u56fe\u50cf\u6dfb\u52a0\u5b57\u5e55\uff0c\u4f46\u901a\u5e38\u4e0d\u9700\u8981\u3002 \u6b65\u9aa4 2. \u7f16\u5199\u914d\u7f6e\u6587\u4ef6 \u521b\u5efa\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\uff0c\u5c06\u5176\u6269\u5c55\u540d\u6539\u4e3a .toml \u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u65b9\u5f0f\u7f16\u5199\uff1a [general] enable_bucket = true # \u662f\u5426\u4f7f\u7528\u5bbd\u9ad8\u6bd4\u6876 [[datasets]] resolution = 512 # \u8bad\u7ec3\u5206\u8fa8\u7387 batch_size = 4 # \u6279\u6b21\u5927\u5c0f [[datasets.subsets]] image_dir = 'C:\\hoge' # \u6307\u5b9a\u5305\u542b\u8bad\u7ec3\u56fe\u50cf\u7684\u6587\u4ef6\u5939 caption_extension = '.caption' # \u5b57\u5e55\u6587\u4ef6\u7684\u6269\u5c55\u540d\u3002\u5982\u679c\u4f7f\u7528 .txt\uff0c\u8bf7\u66f4\u6539\u6b64\u5904 num_repeats = 10 # \u8bad\u7ec3\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570 # \u4ee5\u4e0b\u4ec5\u5728\u9700\u8981\u6b63\u5219\u5316\u56fe\u50cf\u65f6\u63cf\u8ff0\u3002\u5982\u679c\u4e0d\u4f7f\u7528\uff0c\u8bf7\u5220\u9664 [[datasets.subsets]] is_reg = true image_dir = 'C:\\reg' # \u6307\u5b9a\u5305\u542b\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6587\u4ef6\u5939 class_tokens = 'girl' # \u6307\u5b9a\u7c7b num_repeats = 1 # \u6b63\u5219\u5316\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570\uff0c\u57fa\u672c\u4e0a\u4e3a1\u5373\u53ef \u57fa\u672c\u4e0a\uff0c\u53ea\u9700\u66f4\u6539\u4ee5\u4e0b\u4f4d\u7f6e\u5373\u53ef\u8fdb\u884c\u8bad\u7ec3\u3002\u6ca1\u6709\u7279\u522b\u8bf4\u660e\u7684\u90e8\u5206\u4e0e\u7c7b+\u6807\u8bc6\u7b26\u65b9\u5f0f\u76f8\u540c\u3002 \u8bad\u7ec3\u5206\u8fa8\u7387 \u6279\u6b21\u5927\u5c0f \u6587\u4ef6\u5939\u6307\u5b9a \u5b57\u5e55\u6587\u4ef6\u7684\u6269\u5c55\u540d \u53ef\u4ee5\u6307\u5b9a\u4efb\u610f\u6269\u5c55\u540d\u3002 5. \u91cd\u590d\u6b21\u6570 \u6b65\u9aa4 3. \u8fdb\u884c\u8bad\u7ec3 \u8bf7\u53c2\u8003\u5404\u81ea\u7684\u6587\u6863\u8fdb\u884c\u8bad\u7ec3\u3002 \u5fae\u8c03\u65b9\u5f0f \u6b65\u9aa4 1. \u51c6\u5907\u5143\u6570\u636e \u5c06\u5b57\u5e55\u548c\u6807\u7b7e\u6c47\u603b\u7684\u7ba1\u7406\u6587\u4ef6\u79f0\u4e3a\u5143\u6570\u636e\u3002\u91c7\u7528 json \u683c\u5f0f\uff0c\u6269\u5c55\u540d\u4e3a .json \u3002\u521b\u5efa\u65b9\u6cd5\u8f83\u957f\uff0c\u5df2\u5728\u672c\u6587\u6863\u672b\u5c3e\u8bf4\u660e\u3002 \u6b65\u9aa42. \u7f16\u5199\u8bbe\u5b9a\u6587\u4ef6 \u521b\u5efa\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u6269\u5c55\u540d\u6539\u4e3a .toml \u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u8fd9\u6837\u7f16\u5199\uff1a [general] shuffle_caption = true keep_tokens = 1 [[datasets]] resolution = 512 # \u5b66\u4e60\u5206\u8fa8\u7387 batch_size = 4 # \u6279\u6b21\u5927\u5c0f [[datasets.subsets]] image_dir = 'C:\\piyo' # \u6307\u5b9a\u5305\u542b\u5b66\u4e60\u7528\u56fe\u50cf\u7684\u6587\u4ef6\u5939 metadata_file = 'C:\\piyo\\piyo_md.json' # \u5143\u6570\u636e\u6587\u4ef6\u540d \u57fa\u672c\u4e0a\uff0c\u53ea\u9700\u66f4\u6539\u4ee5\u4e0b\u4f4d\u7f6e\u5373\u53ef\u8fdb\u884c\u5b66\u4e60\u3002\u6ca1\u6709\u7279\u522b\u8bf4\u660e\u7684\u90e8\u5206\u4e0eDreamBooth\u3001class+identifier\u65b9\u5f0f\u76f8\u540c\u3002 \u5b66\u4e60\u5206\u8fa8\u7387 \u6279\u6b21\u5927\u5c0f \u6587\u4ef6\u5939\u6307\u5b9a \u5143\u6570\u636e\u6587\u4ef6\u540d \u6307\u5b9a\u901a\u8fc7\u540e\u8ff0\u65b9\u6cd5\u521b\u5efa\u7684\u5143\u6570\u636e\u6587\u4ef6\u3002 \u6b65\u9aa43. \u5f00\u59cb\u5b66\u4e60 \u8bf7\u53c2\u8003\u5404\u81ea\u7684\u6587\u6863\u8fdb\u884c\u5b66\u4e60\u3002 \u5b66\u4e60\u4e2d\u4f7f\u7528\u7684\u672f\u8bed\u7b80\u8981\u8bf4\u660e \u8fd9\u91cc\u7701\u7565\u4e86\u7ec6\u8282\uff0c\u6211\u4e5f\u4e0d\u662f\u5b8c\u5168\u7406\u89e3\uff0c\u8bf7\u81ea\u884c\u67e5\u9605\u76f8\u5173\u8d44\u6599\u3002 \u5fae\u8c03\uff08fine tuning\uff09 \u6307\u5bf9\u6a21\u578b\u8fdb\u884c\u5b66\u4e60\u548c\u5fae\u8c03\u3002\u5728Stable Diffusion\u4e2d\uff0c\u72ed\u4e49\u7684fine tuning\u662f\u6307\u7528\u56fe\u50cf\u548c\u6807\u9898\u5bf9\u6a21\u578b\u8fdb\u884c\u5b66\u4e60\u3002DreamBooth\u53ef\u4ee5\u8bf4\u662f\u72ed\u4e49\u7684fine tuning\u7684\u4e00\u79cd\u7279\u6b8a\u65b9\u5f0f\u3002\u5e7f\u4e49\u7684fine tuning\u5305\u62ecLoRA\u3001Textual Inversion\u3001Hypernetworks\u7b49\uff0c\u6db5\u76d6\u4e86\u6240\u6709\u6a21\u578b\u5b66\u4e60\u7684\u8303\u7574\u3002 \u6b65\u9aa4\uff08step\uff09 \u7c97\u7565\u5730\u8bf4\uff0c\u7528\u5b66\u4e60\u6570\u636e\u8ba1\u7b97\u4e00\u6b21\u5c31\u662f\u4e00\u4e2a\u6b65\u9aa4\u3002\u201c\u5c06\u5b66\u4e60\u6570\u636e\u7684\u6807\u9898\u8f93\u5165\u5230\u5f53\u524d\u6a21\u578b\u4e2d\uff0c\u751f\u6210\u56fe\u50cf\u5e76\u5c06\u5176\u4e0e\u5b66\u4e60\u6570\u636e\u7684\u56fe\u50cf\u8fdb\u884c\u6bd4\u8f83\uff0c\u7136\u540e\u5bf9\u6a21\u578b\u8fdb\u884c\u5fae\u5c0f\u7684\u8c03\u6574\uff0c\u4f7f\u5176\u66f4\u63a5\u8fd1\u5b66\u4e60\u6570\u636e\u201d\uff0c\u8fd9\u5c31\u662f\u4e00\u4e2a\u6b65\u9aa4\u3002 \u6279\u6b21\u5927\u5c0f\uff08batch size\uff09 \u6279\u6b21\u5927\u5c0f\u662f\u6307\u5728\u4e00\u4e2a\u6b65\u9aa4\u4e2d\u540c\u65f6\u8ba1\u7b97\u7684\u6570\u636e\u6570\u91cf\u3002\u6279\u91cf\u8ba1\u7b97\u53ef\u4ee5\u76f8\u5bf9\u63d0\u9ad8\u901f\u5ea6\uff0c\u800c\u4e14\u4e00\u822c\u8ba4\u4e3a\u7cbe\u5ea6\u4e5f\u4f1a\u63d0\u9ad8\u3002 \u6279\u6b21\u5927\u5c0f \u00d7 \u6b65\u9aa4\u6570 \u7b49\u4e8e\u7528\u4e8e\u5b66\u4e60\u7684\u6570\u636e\u6570\u91cf\u3002\u56e0\u6b64\uff0c\u5982\u679c\u589e\u52a0\u6279\u6b21\u5927\u5c0f\uff0c\u6700\u597d\u76f8\u5e94\u5730\u51cf\u5c11\u6b65\u9aa4\u6570\u3002 \uff08\u4f46\u662f\uff0c\u4f8b\u5982\u201c\u6279\u6b21\u5927\u5c0f\u4e3a1\uff0c1600\u6b65\u201d\u548c\u201c\u6279\u6b21\u5927\u5c0f\u4e3a4\uff0c400\u6b65\u201d\u4e0d\u4f1a\u5f97\u5230\u76f8\u540c\u7684\u7ed3\u679c\u3002\u5982\u679c\u5b66\u4e60\u7387\u76f8\u540c\uff0c\u4e00\u822c\u6765\u8bf4\u540e\u8005\u4f1a\u5bfc\u81f4\u5b66\u4e60\u4e0d\u8db3\u3002\u53ef\u4ee5\u7a0d\u5fae\u63d0\u9ad8\u5b66\u4e60\u7387\uff08\u4f8b\u5982 2e-6 \uff09\uff0c\u6216\u8005\u5c06\u6b65\u9aa4\u6570\u589e\u52a0\u5230500\u6b65\u7b49\u8fdb\u884c\u8c03\u6574\u3002\uff09 \u589e\u52a0\u6279\u6b21\u5927\u5c0f\u4f1a\u76f8\u5e94\u5730\u6d88\u8017\u66f4\u591a\u7684GPU\u5185\u5b58\u3002\u5982\u679c\u5185\u5b58\u4e0d\u8db3\uff0c\u4f1a\u5bfc\u81f4\u9519\u8bef\uff0c\u800c\u4e14\u5373\u4f7f\u6ca1\u6709\u9519\u8bef\uff0c\u4e5f\u4f1a\u964d\u4f4e\u5b66\u4e60\u901f\u5ea6\u3002\u53ef\u4ee5\u901a\u8fc7\u4efb\u52a1\u7ba1\u7406\u5668\u6216 nvidia-smi \u547d\u4ee4\u67e5\u770b\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u8fdb\u884c\u8c03\u6574\u3002 \u987a\u4fbf\u8bf4\u4e00\u4e0b\uff0c\u201cbatch\u201d\u5927\u81f4\u610f\u5473\u7740\u201c\u4e00\u6279\u6570\u636e\u201d\u3002 \u5b66\u4e60\u7387\uff08learning rate\uff09 \u7c97\u7565\u5730\u8bf4\uff0c\u5b66\u4e60\u7387\u8868\u793a\u6bcf\u4e2a\u6b65\u9aa4\u6a21\u578b\u53d8\u5316\u7684\u7a0b\u5ea6\u3002\u6307\u5b9a\u8f83\u5927\u7684\u503c\u53ef\u4ee5\u52a0\u5feb\u5b66\u4e60\u901f\u5ea6\uff0c\u4f46\u4e5f\u53ef\u80fd\u5bfc\u81f4\u6a21\u578b\u8fc7\u5ea6\u53d8\u5316\u800c\u635f\u574f\uff0c\u6216\u8005\u65e0\u6cd5\u8fbe\u5230\u6700\u4f73\u72b6\u6001\u3002\u6307\u5b9a\u8f83\u5c0f\u7684\u503c\u4f1a\u51cf\u6162\u5b66\u4e60\u901f\u5ea6\uff0c\u4e5f\u53ef\u80fd\u65e0\u6cd5\u8fbe\u5230\u6700\u4f73\u72b6\u6001\u3002 fine tuning\u3001DreamBooth\u3001LoRA\u7684\u5b66\u4e60\u7387\u5404\u4e0d\u76f8\u540c\uff0c\u800c\u4e14\u8fd8\u4f1a\u53d7\u5230\u5b66\u4e60\u6570\u636e\u3001\u6a21\u578b\u3001\u6279\u6b21\u5927\u5c0f\u548c\u6b65\u9aa4\u6570\u7684\u5f71\u54cd\u3002\u53ef\u4ee5\u4ece\u4e00\u822c\u503c\u5f00\u59cb\uff0c\u6839\u636e\u5b66\u4e60\u72b6\u6001\u8fdb\u884c\u8c03\u6574\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6574\u4e2a\u5b66\u4e60\u8fc7\u7a0b\u4e2d\u7684\u5b66\u4e60\u7387\u662f\u56fa\u5b9a\u7684\u3002\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u8c03\u5ea6\u5668\u6765\u51b3\u5b9a\u5b66\u4e60\u7387\u5982\u4f55\u53d8\u5316\uff0c\u8fd9\u4e5f\u4f1a\u5f71\u54cd\u7ed3\u679c\u3002 \u5468\u671f\uff08epoch\uff09 \u5f53\u5b66\u4e60\u6570\u636e\u88ab\u5b8c\u6574\u5730\u5b66\u4e60\u4e00\u904d\uff08\u6570\u636e\u5faa\u73af\u4e00\u904d\uff09\u65f6\uff0c\u5c31\u79f0\u4e3a\u4e00\u4e2aepoch\u3002\u5982\u679c\u6307\u5b9a\u4e86\u91cd\u590d\u6b21\u6570\uff0c\u90a3\u4e48\u5728\u91cd\u590d\u540e\u7684\u6570\u636e\u5faa\u73af\u4e00\u904d\u4e5f\u79f0\u4e3a\u4e00\u4e2aepoch\u3002 \u4e00\u4e2aepoch\u7684\u6b65\u9aa4\u6570\u57fa\u672c\u4e0a\u662f \u6570\u636e\u6570\u91cf \u00f7 \u6279\u6b21\u5927\u5c0f \uff0c\u4f46\u5728\u4f7f\u7528Aspect Ratio Bucketing\u65f6\uff0c\u6b65\u9aa4\u6570\u4f1a\u7565\u5fae\u589e\u52a0\uff08\u56e0\u4e3a\u4e0d\u540cbucket\u7684\u6570\u636e\u4e0d\u80fd\u653e\u5728\u540c\u4e00\u4e2a\u6279\u6b21\u4e2d\uff09\u3002 \u5bbd\u9ad8\u6bd4\u5206\u6876\uff08Aspect Ratio Bucketing\uff09 Stable Diffusion v1\u662f\u5728512\u00d7512\u5206\u8fa8\u7387\u4e0b\u8bad\u7ec3\u7684\uff0c\u4f46\u9664\u4e86\u8fd9\u4e2a\u5206\u8fa8\u7387\uff0c\u8fd8\u4f1a\u5728256\u00d71024\u3001384\u00d7640\u7b49\u5176\u4ed6\u5206\u8fa8\u7387\u4e0b\u8fdb\u884c\u8bad\u7ec3\u3002\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u56fe\u50cf\u7684\u88c1\u526a\uff0c\u66f4\u51c6\u786e\u5730\u5b66\u4e60\u6807\u9898\u548c\u56fe\u50cf\u4e4b\u95f4\u7684\u5173\u7cfb\u3002 \u6b64\u5916\uff0c\u7531\u4e8e\u53ef\u4ee5\u5728\u4efb\u610f\u5206\u8fa8\u7387\u4e0b\u8fdb\u884c\u8bad\u7ec3\uff0c\u56e0\u6b64\u65e0\u9700\u4e8b\u5148\u7edf\u4e00\u56fe\u50cf\u6570\u636e\u7684\u5bbd\u9ad8\u6bd4\u3002 \u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u542f\u7528\u6216\u7981\u7528\u8be5\u529f\u80fd\uff0c\u5728\u4e0a\u8ff0\u8bbe\u5b9a\u6587\u4ef6\u7684\u4f8b\u5b50\u4e2d\u662f\u542f\u7528\u7684\uff08\u8bbe\u7f6e\u4e3a true \uff09\u3002 \u5b66\u4e60\u5206\u8fa8\u7387\u4f1a\u5728\u4e0d\u8d85\u8fc7\u7ed9\u5b9a\u53c2\u6570\u7684\u9762\u79ef\uff08\u5373\u5185\u5b58\u4f7f\u7528\u91cf\uff09\u7684\u8303\u56f4\u5185\uff0c\u4ee564\u50cf\u7d20\u4e3a\u5355\u4f4d\uff08\u9ed8\u8ba4\uff0c\u53ef\u66f4\u6539\uff09\u8fdb\u884c\u8c03\u6574\u548c\u751f\u6210\u3002 \u5728\u673a\u5668\u5b66\u4e60\u4e2d\uff0c\u901a\u5e38\u9700\u8981\u7edf\u4e00\u8f93\u5165\u6570\u636e\u7684\u5927\u5c0f\uff0c\u4f46\u5b9e\u9645\u4e0a\uff0c\u53ea\u8981\u5728\u540c\u4e00\u4e2a\u6279\u6b21\u5185\u4fdd\u6301\u4e00\u81f4\u5373\u53ef\u3002NovelAI\u6240\u8bf4\u7684bucketing\u4f3c\u4e4e\u662f\u6307\u4e8b\u5148\u6839\u636e\u5b66\u4e60\u6570\u636e\u7684\u5bbd\u9ad8\u6bd4\u5c06\u5176\u5206\u7c7b\u5230\u4e0d\u540c\u7684\u5b66\u4e60\u5206\u8fa8\u7387\u4e2d\uff0c\u7136\u540e\u5728\u6bcf\u4e2abucket\u5185\u521b\u5efa\u6279\u6b21\uff0c\u4ee5\u4fdd\u6301\u6279\u6b21\u5185\u56fe\u50cf\u5927\u5c0f\u7684\u4e00\u81f4\u3002 \u65e7\u7684\u6307\u5b9a\u5f62\u5f0f\uff08\u4e0d\u4f7f\u7528\u8bbe\u5b9a\u6587\u4ef6\uff0c\u76f4\u63a5\u901a\u8fc7\u547d\u4ee4\u884c\u6307\u5b9a\uff09 \u8fd9\u91cc\u4ecb\u7ecd\u4e0d\u4f7f\u7528 .toml \u6587\u4ef6\uff0c\u800c\u662f\u901a\u8fc7\u547d\u4ee4\u884c\u9009\u9879\u8fdb\u884c\u6307\u5b9a\u7684\u65b9\u6cd5\u3002\u6709DreamBooth class+identifier\u65b9\u5f0f\u3001DreamBooth\u6807\u9898\u65b9\u5f0f\u548cfine tuning\u65b9\u5f0f\u3002 DreamBooth\u3001class+identifier\u65b9\u5f0f \u901a\u8fc7\u6587\u4ef6\u5939\u540d\u79f0\u6307\u5b9a\u91cd\u590d\u6b21\u6570\uff0c\u5e76\u4f7f\u7528 train_data_dir \u9009\u9879\u548c reg_data_dir \u9009\u9879\u3002 \u6b65\u9aa41. \u51c6\u5907\u5b66\u4e60\u7528\u56fe\u50cf \u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u5939\u7528\u4e8e\u5b58\u653e\u5b66\u4e60\u7528\u56fe\u50cf\u3002 \u7136\u540e\u5728\u8be5\u6587\u4ef6\u5939\u5185 \uff0c\u6309\u7167\u4ee5\u4e0b\u683c\u5f0f\u521b\u5efa\u5b50\u6587\u4ef6\u5939\uff1a <\u91cd\u590d\u6b21\u6570>_<identifier> <class> \u6ce8\u610f\u4e0d\u8981\u5fd8\u8bb0\u4e2d\u95f4\u7684 _ \u3002 \u4f8b\u5982\uff0c\u5982\u679c\u8981\u4f7f\u7528\u201csls frog\u201d\u4f5c\u4e3a\u63d0\u793a\u8bcd\uff0c\u5e76\u91cd\u590d\u6570\u636e20\u6b21\uff0c\u5219\u6587\u4ef6\u5939\u540d\u4e3a\u201c20_sls frog\u201d\u3002\u5982\u4e0b\u6240\u793a\uff1a \u591a\u7c7b\u522b\u3001\u591a\u5bf9\u8c61\uff08identifier\uff09\u5b66\u4e60 \u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u5728\u8bad\u7ec3\u56fe\u50cf\u6587\u4ef6\u5939\u5185\u521b\u5efa\u591a\u4e2a\u540d\u4e3a \u91cd\u590d\u6b21\u6570_<identifier> <class> \u7684\u6587\u4ef6\u5939\uff0c\u5e76\u5728\u6b63\u5219\u5316\u56fe\u50cf\u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u591a\u4e2a\u540d\u4e3a \u91cd\u590d\u6b21\u6570_<class> \u7684\u6587\u4ef6\u5939\u3002 \u4f8b\u5982\uff0c\u8981\u540c\u65f6\u5b66\u4e60\u201csls frog\u201d\u548c\u201ccpc rabbit\u201d\uff0c\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u8bbe\u7f6e\uff1a \u5982\u679c\u7c7b\u522b\u53ea\u6709\u4e00\u4e2a\uff0c\u4f46\u5bf9\u8c61\u6709\u591a\u4e2a\uff0c\u5219\u6b63\u5219\u5316\u56fe\u50cf\u6587\u4ef6\u5939\u53ef\u4ee5\u53ea\u6709\u4e00\u4e2a\u3002\u4f8b\u5982\uff0c\u5982\u679c1girl\u6709\u4e24\u4e2a\u89d2\u8272A\u548cB\uff0c\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u8bbe\u7f6e\uff1a train_girls 10_sls 1girl 10_cpc 1girl reg_girls 1_1girl \u6b65\u9aa42\uff1a\u51c6\u5907\u6b63\u5219\u5316\u56fe\u50cf \u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6b65\u9aa4\u5982\u4e0b\uff1a \u521b\u5efa\u4e00\u4e2a\u5b58\u50a8\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6587\u4ef6\u5939\uff0c\u5e76\u5728\u5176\u4e2d\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a <\u91cd\u590d\u6b21\u6570>_<class> \u7684\u76ee\u5f55\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u4f7f\u7528\u201cfrog\u201d\u4f5c\u4e3a\u63d0\u793a\u8bcd\uff0c\u5e76\u4e14\u6570\u636e\u4e0d\u91cd\u590d\uff08\u53ea\u91cd\u590d\u4e00\u6b21\uff09\uff0c\u5219\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u8bbe\u7f6e\uff1a \u6b65\u9aa43\uff1a\u6267\u884c\u8bad\u7ec3 \u8fd0\u884c\u5404\u4e2a\u8bad\u7ec3\u811a\u672c\u3002\u4f7f\u7528 --train_data_dir \u9009\u9879\u6307\u5b9a\u4e0a\u8ff0\u8bad\u7ec3\u6570\u636e\u7684\u6587\u4ef6\u5939\uff08 \u4e0d\u662f\u5305\u542b\u56fe\u50cf\u7684\u6587\u4ef6\u5939\uff0c\u800c\u662f\u5176\u7236\u6587\u4ef6\u5939 \uff09\uff0c\u4f7f\u7528 --reg_data_dir \u9009\u9879\u6307\u5b9a\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6587\u4ef6\u5939\uff08 \u4e0d\u662f\u5305\u542b\u56fe\u50cf\u7684\u6587\u4ef6\u5939\uff0c\u800c\u662f\u5176\u7236\u6587\u4ef6\u5939 \uff09\u3002 DreamBooth\u3001\u6807\u9898\u65b9\u5f0f \u5728\u8bad\u7ec3\u56fe\u50cf\u548c\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6587\u4ef6\u5939\u4e2d\uff0c\u5982\u679c\u5b58\u5728\u4e0e\u56fe\u50cf\u6587\u4ef6\u540c\u540d\u3001\u6269\u5c55\u540d\u4e3a.caption\uff08\u53ef\u901a\u8fc7\u9009\u9879\u66f4\u6539\uff09\u7684\u6587\u4ef6\uff0c\u5219\u4f1a\u4ece\u8be5\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6807\u9898\u5e76\u4f5c\u4e3a\u63d0\u793a\u8bcd\u8fdb\u884c\u8bad\u7ec3\u3002 \u203b\u8fd9\u4e9b\u56fe\u50cf\u7684\u8bad\u7ec3\u5c06\u4e0d\u518d\u4f7f\u7528\u6587\u4ef6\u5939\u540d\uff08identifier class\uff09\u3002 \u6807\u9898\u6587\u4ef6\u7684\u6269\u5c55\u540d\u9ed8\u8ba4\u4e3a.caption\u3002\u53ef\u4ee5\u4f7f\u7528\u8bad\u7ec3\u811a\u672c\u7684 --caption_extension \u9009\u9879\u8fdb\u884c\u66f4\u6539\u3002\u4f7f\u7528 --shuffle_caption \u9009\u9879\u53ef\u4ee5\u5728\u8bad\u7ec3\u65f6\u5bf9\u4ee5\u9017\u53f7\u5206\u9694\u7684\u5404\u4e2a\u90e8\u5206\u8fdb\u884c\u968f\u673a\u6392\u5e8f\u3002 \u5fae\u8c03\u65b9\u5f0f \u76f4\u5230\u521b\u5efa\u5143\u6570\u636e\u7684\u8fc7\u7a0b\u90fd\u4e0e\u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\u65f6\u76f8\u540c\u3002\u4f7f\u7528 in_json \u9009\u9879\u6307\u5b9a\u5143\u6570\u636e\u6587\u4ef6\u3002 \u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u7684\u793a\u4f8b\u8f93\u51fa \u53ef\u4ee5\u4f7f\u7528\u8bad\u7ec3\u4e2d\u7684\u6a21\u578b\u5c1d\u8bd5\u751f\u6210\u56fe\u50cf\uff0c\u4ee5\u786e\u8ba4\u8bad\u7ec3\u8fdb\u5ea6\u3002\u5728\u8bad\u7ec3\u811a\u672c\u4e2d\u6307\u5b9a\u4ee5\u4e0b\u9009\u9879\uff1a --sample_every_n_steps / --sample_every_n_epochs \u6307\u5b9a\u6bcf\u9694\u591a\u5c11\u6b65\u9aa4\u6216\u591a\u5c11epoch\u8fdb\u884c\u4e00\u6b21\u793a\u4f8b\u8f93\u51fa\u3002\u5982\u679c\u540c\u65f6\u6307\u5b9a\uff0c\u5219\u4f18\u5148\u4f7f\u7528epoch\u3002 --sample_at_first \u5728\u8bad\u7ec3\u5f00\u59cb\u524d\u8fdb\u884c\u793a\u4f8b\u8f93\u51fa\u3002\u53ef\u4ee5\u4e0e\u8bad\u7ec3\u524d\u7684\u7ed3\u679c\u8fdb\u884c\u6bd4\u8f83\u3002 --sample_prompts \u6307\u5b9a\u793a\u4f8b\u8f93\u51fa\u63d0\u793a\u8bcd\u7684\u6587\u4ef6\u3002 --sample_sampler \u6307\u5b9a\u7528\u4e8e\u793a\u4f8b\u8f93\u51fa\u7684\u91c7\u6837\u5668\u3002 \u53ef\u9009\u503c\u4e3a 'ddim', 'pndm', 'heun', 'dpmsolver', 'dpmsolver++', 'dpmsingle', 'k_lms', 'k_euler', 'k_euler_a', 'k_dpm_2', 'k_dpm_2_a' \u3002 \u8981\u8fdb\u884c\u793a\u4f8b\u8f93\u51fa\uff0c\u9700\u8981\u4e8b\u5148\u51c6\u5907\u4e00\u4e2a\u5305\u542b\u63d0\u793a\u8bcd\u7684\u6587\u672c\u6587\u4ef6\u3002\u6bcf\u884c\u5199\u4e00\u4e2a\u63d0\u793a\u8bcd\u3002 \u4f8b\u5982\uff0c\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u8bbe\u7f6e\uff1a # \u63d0\u793a\u8bcd1 masterpiece, best quality, 1girl, in white shirts, upper body, looking at viewer, simple background --n low quality, worst quality, bad anatomy,bad composition, poor, low effort --w 768 --h 768 --d 1 --l 7.5 --s 28 # \u63d0\u793a\u8bcd2 masterpiece, best quality, 1boy, in business suit, standing at street, looking back --n low quality, worst quality, bad anatomy,bad composition, poor, low effort --w 576 --h 832 --d 2 --l 5.5 --s 40 \u4ee5 # \u5f00\u5934\u7684\u884c\u662f\u6ce8\u91ca\u3002\u4ee5 -- \u5f00\u5934\u7684\u90e8\u5206\uff08\u5982 --n \uff09\u53ef\u4ee5\u6307\u5b9a\u751f\u6210\u56fe\u50cf\u7684\u9009\u9879\u3002\u4ee5\u4e0b\u9009\u9879\u53ef\u7528\uff1a --n \u5c06\u4e4b\u540e\u7684\u9009\u9879\u89c6\u4e3a\u8d1f\u9762\u63d0\u793a\u8bcd\uff0c\u76f4\u5230\u4e0b\u4e00\u4e2a -- \u9009\u9879\u3002 --w \u6307\u5b9a\u751f\u6210\u56fe\u50cf\u7684\u5bbd\u5ea6\u3002 --h \u6307\u5b9a\u751f\u6210\u56fe\u50cf\u7684\u9ad8\u5ea6\u3002 --d \u6307\u5b9a\u751f\u6210\u56fe\u50cf\u7684\u79cd\u5b50\u3002 --l \u6307\u5b9a\u751f\u6210\u56fe\u50cf\u7684CFG scale\u3002 --s \u6307\u5b9a\u751f\u6210\u56fe\u50cf\u7684\u6b65\u6570\u3002 \u5404\u811a\u672c\u4e2d\u5e38\u89c1\u7684\u5e38\u7528\u9009\u9879 \u811a\u672c\u66f4\u65b0\u540e\uff0c\u6587\u6863\u53ef\u80fd\u6ca1\u6709\u53ca\u65f6\u66f4\u65b0\u3002\u5982\u679c\u9700\u8981\u67e5\u770b\u53ef\u7528\u9009\u9879\uff0c\u8bf7\u4f7f\u7528 --help \u9009\u9879\u3002 \u6307\u5b9a\u8bad\u7ec3\u4f7f\u7528\u7684\u6a21\u578b --v2 / --v_parameterization \u5982\u679c\u8981\u4f7f\u7528Hugging Face\u7684stable-diffusion-2-base\u6216\u4ece\u5b83\u6d3e\u751f\u7684\u5fae\u8c03\u6a21\u578b\uff08\u5728\u63a8\u7406\u65f6\u9700\u8981\u4f7f\u7528 v2-inference.yaml \u7684\u6a21\u578b\uff09\uff0c\u8bf7\u4f7f\u7528 --v2 \u9009\u9879\u3002\u5982\u679c\u8981\u4f7f\u7528stable-diffusion-2\u6216768-v-ema.ckpt\u53ca\u5176\u5fae\u8c03\u6a21\u578b\uff08\u5728\u63a8\u7406\u65f6\u9700\u8981\u4f7f\u7528 v2-inference-v.yaml \u7684\u6a21\u578b\uff09\uff0c\u8bf7\u540c\u65f6\u4f7f\u7528 --v2 \u548c --v_parameterization \u9009\u9879\u3002 Stable Diffusion 2.0\u7684\u4e3b\u8981\u53d8\u5316\u5982\u4e0b\uff1a \u4f7f\u7528\u7684Tokenizer \u4f7f\u7528\u7684Text Encoder\u4ee5\u53ca\u4f7f\u7528\u7684\u8f93\u51fa\u5c42\uff082.0\u4f7f\u7528\u5012\u6570\u7b2c\u4e8c\u5c42\uff09 Text Encoder\u7684\u8f93\u51fa\u7ef4\u5ea6\uff08768->1024\uff09 U-Net\u7684\u7ed3\u6784\uff08CrossAttention\u7684\u5934\u6570\u7b49\uff09 v-parameterization\uff08\u91c7\u6837\u65b9\u6cd5\u4f3c\u4e4e\u5df2\u66f4\u6539\uff09 \u5176\u4e2d\uff0cbase\u7248\u672c\u91c7\u7528\u4e861\uff5e4\u7684\u53d8\u5316\uff0c\u800c\u975ebase\u7248\u672c\uff08768-v\uff09\u91c7\u7528\u4e861\uff5e5\u7684\u53d8\u5316\u3002 --v2 \u9009\u9879\u542f\u75281\uff5e4\u7684\u53d8\u5316\uff0c --v_parameterization \u9009\u9879\u542f\u75285\u7684\u53d8\u5316\u3002 --pretrained_model_name_or_path \u6307\u5b9a\u7528\u4e8e\u8fdb\u884c\u989d\u5916\u8bad\u7ec3\u7684\u57fa\u7840\u6a21\u578b\u3002\u53ef\u4ee5\u6307\u5b9aStable Diffusion\u7684checkpoint\u6587\u4ef6\uff08.ckpt\u6216.safetensors\uff09\u3001Diffusers\u7684\u672c\u5730\u78c1\u76d8\u4e0a\u7684\u6a21\u578b\u76ee\u5f55\u6216Diffusers\u7684\u6a21\u578bID\uff08\u4f8b\u5982\"stabilityai/stable-diffusion-2\"\uff09\u3002 \u8bad\u7ec3\u8bbe\u5b9a --output_dir \u6307\u5b9a\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u4fdd\u5b58\u7684\u6587\u4ef6\u5939\u3002 --output_name \u6307\u5b9a\u6a21\u578b\u7684\u6587\u4ef6\u540d\uff0c\u4e0d\u5305\u542b\u6269\u5c55\u540d\u3002 --dataset_config \u6307\u5b9a\u5305\u542b\u6570\u636e\u96c6\u914d\u7f6e\u7684 .toml \u6587\u4ef6\u3002 --max_train_steps / --max_train_epochs \u6307\u5b9a\u8bad\u7ec3\u7684\u6b65\u6570\u6216 epoch \u6570\u3002\u5982\u679c\u540c\u65f6\u6307\u5b9a\uff0c\u5219 epoch \u6570\u7684\u4f18\u5148\u7ea7\u66f4\u9ad8\u3002 --mixed_precision \u4e3a\u4e86\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff0c\u4ee5\u6df7\u5408\u7cbe\u5ea6\uff08mixed precision\uff09\u8fdb\u884c\u8bad\u7ec3\u3002\u4f8b\u5982 --mixed_precision=\"fp16\" \u3002\u4e0e\u4e0d\u4f7f\u7528\u6df7\u5408\u7cbe\u5ea6\uff08\u9ed8\u8ba4\uff09\u76f8\u6bd4\uff0c\u7cbe\u5ea6\u53ef\u80fd\u4f1a\u964d\u4f4e\uff0c\u4f46\u53ef\u4ee5\u5927\u5e45\u51cf\u5c11\u8bad\u7ec3\u6240\u9700\u7684 GPU \u5185\u5b58\u3002 \uff08\u5bf9\u4e8e RTX30 \u7cfb\u5217\u53ca\u4e4b\u540e\u7684\u663e\u5361\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a bf16 \u3002\u8bf7\u786e\u4fdd\u4e0e\u4f7f\u7528 accelerate \u8fdb\u884c\u7684\u73af\u5883\u8bbe\u7f6e\u76f8\u4e00\u81f4\uff09\u3002 --gradient_checkpointing \u4e0d\u662f\u4e00\u6b21\u6027\u8fdb\u884c\u8bad\u7ec3\u65f6\u7684\u6743\u91cd\u8ba1\u7b97\uff0c\u800c\u662f\u5206\u6b65\u8fdb\u884c\uff0c\u4ee5\u51cf\u5c11\u8bad\u7ec3\u6240\u9700\u7684 GPU \u5185\u5b58\u91cf\u3002\u5f00\u542f\u6216\u5173\u95ed\u5bf9\u7cbe\u5ea6\u6ca1\u6709\u5f71\u54cd\uff0c\u4f46\u5f00\u542f\u540e\u53ef\u4ee5\u589e\u52a0\u6279\u5927\u5c0f\uff0c\u4ece\u800c\u5bf9\u8bad\u7ec3\u7ed3\u679c\u4ea7\u751f\u5f71\u54cd\u3002 \u901a\u5e38\uff0c\u5f00\u542f\u540e\u4f1a\u964d\u4f4e\u8bad\u7ec3\u901f\u5ea6\uff0c\u4f46\u7531\u4e8e\u53ef\u4ee5\u589e\u52a0\u6279\u5927\u5c0f\uff0c\u603b\u4f53\u7684\u8bad\u7ec3\u65f6\u95f4\u53ef\u80fd\u4f1a\u66f4\u5feb\u3002 --xformers / --mem_eff_attn \u6307\u5b9a xformers \u9009\u9879\u65f6\uff0c\u4f7f\u7528 xformers \u7684 CrossAttention\u3002\u5982\u679c\u672a\u5b89\u88c5 xformers \u6216\u51fa\u73b0\u9519\u8bef\uff08\u5728\u67d0\u4e9b\u73af\u5883\u4e0b\uff0c\u5982 mixed_precision=\"no\" \u65f6\uff09\uff0c\u53ef\u4ee5\u6307\u5b9a mem_eff_attn \u9009\u9879\u4ee5\u4f7f\u7528\u8282\u7701\u5185\u5b58\u7248\u672c\u7684 CrossAttention\uff08\u6bd4 xformers \u6162\uff09\u3002 --clip_skip \u6307\u5b9a 2 \u65f6\uff0c\u4f7f\u7528 Text Encoder (CLIP) \u7684\u5012\u6570\u7b2c\u4e8c\u5c42\u7684\u8f93\u51fa\u3002\u6307\u5b9a 1 \u6216\u7701\u7565\u8be5\u9009\u9879\u65f6\uff0c\u4f7f\u7528\u6700\u540e\u4e00\u5c42\u7684\u8f93\u51fa\u3002 \u203bSD2.0 \u9ed8\u8ba4\u4f7f\u7528\u5012\u6570\u7b2c\u4e8c\u5c42\u7684\u8f93\u51fa\uff0c\u56e0\u6b64\u5728 SD2.0 \u7684\u8bad\u7ec3\u4e2d\u4e0d\u8981\u6307\u5b9a\u6b64\u9009\u9879\u3002 \u5982\u679c\u8bad\u7ec3\u7684\u6a21\u578b\u539f\u672c\u5c31\u662f\u4f7f\u7528\u5012\u6570\u7b2c\u4e8c\u5c42\u8fdb\u884c\u8bad\u7ec3\u7684\uff0c\u90a3\u4e48\u6307\u5b9a 2 \u662f\u5408\u9002\u7684\u3002 \u5982\u679c\u539f\u672c\u4f7f\u7528\u6700\u540e\u4e00\u5c42\u8fdb\u884c\u8bad\u7ec3\uff0c\u7531\u4e8e\u6574\u4e2a\u6a21\u578b\u90fd\u662f\u57fa\u4e8e\u6b64\u8fdb\u884c\u8bad\u7ec3\u7684\uff0c\u56e0\u6b64\u5982\u679c\u6539\u7528\u5012\u6570\u7b2c\u4e8c\u5c42\u8fdb\u884c\u8bad\u7ec3\uff0c\u53ef\u80fd\u9700\u8981\u4e00\u5b9a\u6570\u91cf\u7684\u8bad\u7ec3\u6570\u636e\u548c\u8f83\u957f\u7684\u8bad\u7ec3\u65f6\u95f4\u624d\u80fd\u83b7\u5f97\u7406\u60f3\u7684\u8bad\u7ec3\u7ed3\u679c\u3002 --max_token_length \u9ed8\u8ba4\u503c\u4e3a 75\u3002\u6307\u5b9a 150 \u6216 225 \u53ef\u4ee5\u6269\u5c55 token \u957f\u5ea6\u8fdb\u884c\u8bad\u7ec3\u3002\u5982\u679c\u4f7f\u7528\u957f\u6807\u9898\u8fdb\u884c\u8bad\u7ec3\uff0c\u8bf7\u6307\u5b9a\u6b64\u9009\u9879\u3002 \u4f46\u662f\uff0c\u8bad\u7ec3\u65f6\u7684 token \u6269\u5c55\u89c4\u8303\u4e0e Automatic1111 \u7684 Web UI \u7565\u6709\u4e0d\u540c\uff08\u4f8b\u5982\uff0c\u5206\u8bcd\u7684\u89c4\u8303\uff09\uff0c\u56e0\u6b64\u5982\u679c\u6ca1\u6709\u5fc5\u8981\uff0c\u5efa\u8bae\u4f7f\u7528\u9ed8\u8ba4\u7684 75 \u8fdb\u884c\u8bad\u7ec3\u3002 \u4e0e clip_skip \u7c7b\u4f3c\uff0c\u5982\u679c\u8bad\u7ec3\u957f\u5ea6\u4e0e\u6a21\u578b\u7684\u539f\u59cb\u8bad\u7ec3\u72b6\u6001\u4e0d\u540c\uff0c\u53ef\u80fd\u9700\u8981\u4e00\u5b9a\u6570\u91cf\u7684\u8bad\u7ec3\u6570\u636e\u548c\u8f83\u957f\u7684\u8bad\u7ec3\u65f6\u95f4\u3002 --weighted_captions \u6307\u5b9a\u6b64\u9009\u9879\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0e Automatic1111 \u7684 Web UI \u7c7b\u4f3c\u7684\u52a0\u6743\u6807\u9898\u3002\u9664\u201cTextual Inversion \u548c XTI\u201d\u5916\u7684\u8bad\u7ec3\u5747\u53ef\u4f7f\u7528\u3002\u4e0d\u4ec5\u53ef\u4ee5\u7528\u4e8e\u6807\u9898\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e DreamBooth \u65b9\u6cd5\u7684 token \u5b57\u7b26\u4e32\u3002 \u52a0\u6743\u6807\u9898\u7684\u8bed\u6cd5\u4e0e Web UI \u51e0\u4e4e\u76f8\u540c\uff0c\u53ef\u4ee5\u4f7f\u7528 (abc)\u3001[abc]\u3001(abc:1.23) \u7b49\u3002\u4e5f\u53ef\u4ee5\u5d4c\u5957\u4f7f\u7528\u3002\u4f46\u8bf7\u6ce8\u610f\uff0c\u62ec\u53f7\u5185\u4e0d\u80fd\u5305\u542b\u9017\u53f7\uff0c\u5426\u5219\u5728 prompt \u7684 shuffle/dropout \u65f6\u4f1a\u5bfc\u81f4\u62ec\u53f7\u5339\u914d\u9519\u8bef\u3002 --persistent_data_loader_workers \u5728 Windows \u73af\u5883\u4e2d\u6307\u5b9a\u6b64\u9009\u9879\u53ef\u4ee5\u5927\u5e45\u51cf\u5c11 epoch \u4e4b\u95f4\u7684\u7b49\u5f85\u65f6\u95f4\u3002 --max_data_loader_n_workers \u6307\u5b9a\u6570\u636e\u52a0\u8f7d\u7684\u8fdb\u7a0b\u6570\u3002\u8fdb\u7a0b\u6570\u8d8a\u591a\uff0c\u6570\u636e\u52a0\u8f7d\u8d8a\u5feb\uff0cGPU \u5229\u7528\u7387\u8d8a\u9ad8\uff0c\u4f46\u4f1a\u6d88\u8017\u66f4\u591a\u7684\u4e3b\u5185\u5b58\u3002\u9ed8\u8ba4\u503c\u4e3a 8 \u6216 CPU \u540c\u65f6\u6267\u884c\u7ebf\u7a0b\u6570-1 \u4e2d\u7684\u8f83\u5c0f\u8005\u3002\u5982\u679c\u4e3b\u5185\u5b58\u4e0d\u8db3\u6216 GPU \u4f7f\u7528\u7387\u5df2\u7ecf\u8fbe\u5230 90% \u5de6\u53f3\uff0c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u964d\u4f4e\u6b64\u6570\u503c\uff0c\u4f8b\u5982\u8bbe\u7f6e\u4e3a 2 \u6216 1 \u3002 --logging_dir / --log_prefix \u4e0e\u8bad\u7ec3\u65e5\u5fd7\u4fdd\u5b58\u76f8\u5173\u7684\u9009\u9879\u3002 logging_dir \u9009\u9879\u6307\u5b9a\u65e5\u5fd7\u4fdd\u5b58\u7684\u6587\u4ef6\u5939\uff0c\u5c06\u4fdd\u5b58 TensorBoard \u683c\u5f0f\u7684\u65e5\u5fd7\u3002 \u4f8b\u5982\uff0c\u6307\u5b9a --logging_dir=logs \uff0c\u5c06\u5728\u5de5\u4f5c\u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u4e00\u4e2a logs \u6587\u4ef6\u5939\uff0c\u5e76\u5728\u5176\u4e0b\u7684\u65e5\u671f\u6587\u4ef6\u5939\u4e2d\u4fdd\u5b58\u65e5\u5fd7\u3002 \u5982\u679c\u6307\u5b9a --log_prefix \u9009\u9879\uff0c\u5c06\u5728\u65e5\u671f\u524d\u6dfb\u52a0\u6307\u5b9a\u7684\u5b57\u7b26\u4e32\u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u4f7f\u7528 --logging_dir=logs --log_prefix=db_style1_ \u6765\u6807\u8bc6\u65e5\u5fd7\u3002 \u8981\u5728 TensorBoard \u4e2d\u67e5\u770b\u65e5\u5fd7\uff0c\u9700\u8981\u6253\u5f00\u53e6\u4e00\u4e2a\u547d\u4ee4\u63d0\u793a\u7b26\uff0c\u5728\u5de5\u4f5c\u6587\u4ef6\u5939\u4e2d\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\uff1a tensorboard --logdir=logs \uff08tensorboard \u5e94\u8be5\u5728\u73af\u5883\u8bbe\u7f6e\u65f6\u5df2\u7ecf\u5b89\u88c5\u3002\u5982\u679c\u6ca1\u6709\uff0c\u53ef\u4ee5\u4f7f\u7528 pip install tensorboard \u5b89\u88c5\u3002\uff09 \u7136\u540e\u6253\u5f00\u6d4f\u89c8\u5668\uff0c\u8bbf\u95ee http://localhost:6006/ \u5373\u53ef\u67e5\u770b\u65e5\u5fd7\u3002 --log_with / --log_tracker_name \u4e0e\u8bad\u7ec3\u65e5\u5fd7\u4fdd\u5b58\u76f8\u5173\u7684\u9009\u9879\u3002\u9664\u4e86 tensorboard \u5916\uff0c\u8fd8\u652f\u6301\u4fdd\u5b58\u5230 wandb \u3002\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u89c1 PR#428 \u3002 --noise_offset \u5b9e\u73b0\u53c2\u8003\uff1ahttps://www.crosslabs.org//blog/diffusion-with-offset-noise \u4f3c\u4e4e\u53ef\u4ee5\u6539\u5584\u6574\u4f53\u504f\u6697\u6216\u504f\u4eae\u7684\u56fe\u50cf\u751f\u6210\u7ed3\u679c\u3002\u5728 LoRA \u8bad\u7ec3\u4e2d\u4f3c\u4e4e\u4e5f\u6709\u6548\u3002\u5efa\u8bae\u6307\u5b9a 0.1 \u5de6\u53f3\u7684\u503c\u3002 --adaptive_noise_scale \uff08\u5b9e\u9a8c\u6027\u9009\u9879\uff09 \u6839\u636e latents \u7684\u5404\u901a\u9053\u7684\u5e73\u5747\u503c\u7684\u7edd\u5bf9\u503c\u81ea\u52a8\u8c03\u6574 Noise offset \u7684\u503c\u3002\u4e0e --noise_offset \u540c\u65f6\u6307\u5b9a\u65f6\u751f\u6548\u3002Noise offset \u7684\u503c\u901a\u8fc7 noise_offset + abs(mean(latents, dim=(2,3))) * adaptive_noise_scale \u8ba1\u7b97\u3002\u7531\u4e8e latent \u63a5\u8fd1\u6b63\u6001\u5206\u5e03\uff0c\u56e0\u6b64\u5efa\u8bae\u6307\u5b9a noise_offset \u7684 1/10 \u5230\u76f8\u540c\u91cf\u7ea7\u7684\u503c\u3002 \u4e5f\u53ef\u4ee5\u6307\u5b9a\u8d1f\u503c\uff0c\u6b64\u65f6 Noise offset \u5c06\u88ab\u9650\u5236\u5728 0 \u4ee5\u4e0a\u3002 --multires_noise_iterations / --multires_noise_discount Multi resolution noise\uff08pyramid noise\uff09\u7684\u8bbe\u7f6e\u3002\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u89c1 PR#471 \u548c Multi-Resolution Noise for Diffusion Model Training \u3002 \u6307\u5b9a --multires_noise_iterations \u7684\u6570\u503c\u5373\u53ef\u542f\u7528\u3002\u5efa\u8bae\u503c\u4e3a 6~10\u3002 --multires_noise_discount \u7684\u503c\u53ef\u4ee5\u8bbe\u4e3a 0.1~0.3\uff08LoRA \u8bad\u7ec3\u7b49\u6570\u636e\u96c6\u8f83\u5c0f\u7684\u60c5\u51b5\u4e0b\u7684\u4f5c\u8005\u63a8\u8350\u503c\uff09\uff0c\u6216 0.8\uff08\u539f\u59cb\u6587\u7ae0\u7684\u63a8\u8350\u503c\uff09\uff08\u9ed8\u8ba4\u503c\u4e3a 0.3\uff09\u3002 --debug_dataset \u6dfb\u52a0\u6b64\u9009\u9879\u540e\uff0c\u53ef\u4ee5\u5728\u5f00\u59cb\u8bad\u7ec3\u524d\u9884\u89c8\u5c06\u8981\u8bad\u7ec3\u7684\u56fe\u50cf\u6570\u636e\u548c\u6807\u9898\u3002\u6309 Esc \u952e\u9000\u51fa\u9884\u89c8\uff0c\u6309 S \u952e\u8fdb\u5165\u4e0b\u4e00\u6b65\uff08\u6279\u6b21\uff09\uff0c\u6309 E \u952e\u8fdb\u5165\u4e0b\u4e00\u4e2a epoch\u3002 \u203b\u5728 Linux \u73af\u5883\uff08\u5305\u62ec Colab\uff09\u4e2d\uff0c\u56fe\u50cf\u4e0d\u4f1a\u663e\u793a\u3002 --vae \u6307\u5b9a Stable Diffusion \u7684 checkpoint\u3001VAE \u7684 checkpoint \u6587\u4ef6\u3001Diffusers \u7684\u6a21\u578b\u6216 VAE\uff08\u5747\u53ef\u4e3a\u672c\u5730\u6587\u4ef6\u6216 Hugging Face \u6a21\u578b ID\uff09\uff0c\u5c06\u4f7f\u7528\u6307\u5b9a\u7684 VAE \u8fdb\u884c\u8bad\u7ec3\uff08\u5728 latents \u7f13\u5b58\u65f6\u6216\u8bad\u7ec3\u4e2d\u7684 latents \u83b7\u53d6\u65f6\uff09\u3002 \u5728 DreamBooth \u548c fine tuning \u4e2d\uff0c\u4fdd\u5b58\u7684\u6a21\u578b\u5c06\u5d4c\u5165\u6307\u5b9a\u7684 VAE\u3002 --cache_latents / --cache_latents_to_disk \u5c06 VAE \u7684\u8f93\u51fa\u7f13\u5b58\u5230\u4e3b\u5185\u5b58\uff0c\u4ee5\u51cf\u5c11\u4f7f\u7528\u7684 VRAM\u3002\u542f\u7528\u540e\uff0c\u9664 flip_aug \u5916\u7684\u5176\u4ed6\u6570\u636e\u589e\u5f3a\u65b9\u6cd5\u5c06\u4e0d\u53ef\u7528\u3002\u540c\u65f6\uff0c\u6574\u4f53\u8bad\u7ec3\u901f\u5ea6\u4f1a\u7565\u5fae\u52a0\u5feb\u3002 \u6307\u5b9a cache_latents_to_disk \u540e\uff0c\u7f13\u5b58\u5c06\u88ab\u4fdd\u5b58\u5230\u78c1\u76d8\u3002\u5373\u4f7f\u811a\u672c\u7ed3\u675f\u5e76\u518d\u6b21\u542f\u52a8\uff0c\u7f13\u5b58\u4ecd\u7136\u6709\u6548\u3002 --min_snr_gamma \u6307\u5b9aMin-SNR\u52a0\u6743\u7b56\u7565\u3002\u8be6\u60c5\u8bf7\u53c2\u8003 \u6b64\u5904 \u3002\u8bba\u6587\u4e2d\u63a8\u8350\u503c\u4e3a 5 \u3002 \u6a21\u578b\u4fdd\u5b58\u8bbe\u7f6e --save_precision \u6307\u5b9a\u4fdd\u5b58\u65f6\u7684\u6570\u636e\u7cbe\u5ea6\u3002\u5982\u679c\u6307\u5b9a save_precision \u9009\u9879\u4e3a float \u3001 fp16 \u6216 bf16 \uff0c\u5219\u4ee5\u76f8\u5e94\u683c\u5f0f\u4fdd\u5b58\u6a21\u578b\uff08\u5728DreamBooth\u548cfine tuning\u4e2d\u4ee5Diffusers\u683c\u5f0f\u4fdd\u5b58\u6a21\u578b\u65f6\u65e0\u6548\uff09\u3002\u5982\u679c\u60a8\u60f3\u51cf\u5c0f\u6a21\u578b\u7684\u5927\u5c0f\uff0c\u53ef\u4ee5\u4f7f\u7528\u6b64\u9009\u9879\u3002 --save_every_n_epochs / --save_state / --resume \u5982\u679c\u4e3a save_every_n_epochs \u9009\u9879\u6307\u5b9a\u4e00\u4e2a\u6570\u503c\uff0c\u5219\u6bcf\u9694\u6307\u5b9aepoch\u6570\u4fdd\u5b58\u4e00\u6b21\u5b66\u4e60\u8fc7\u7a0b\u4e2d\u7684\u6a21\u578b\u3002 \u5982\u679c\u540c\u65f6\u6307\u5b9a save_state \u9009\u9879\uff0c\u5219\u8fd8\u4f1a\u4fdd\u5b58\u5305\u62ec\u4f18\u5316\u5668\u72b6\u6001\u5728\u5185\u7684\u5b66\u4e60\u72b6\u6001\uff08\u4e0e\u4ece\u4fdd\u5b58\u7684\u6a21\u578b\u4e2d\u6062\u590d\u5b66\u4e60\u76f8\u6bd4\uff0c\u53ef\u4ee5\u9884\u671f\u7cbe\u5ea6\u63d0\u9ad8\u548c\u5b66\u4e60\u65f6\u95f4\u7f29\u77ed\uff09\u3002\u4fdd\u5b58\u76ee\u6807\u662f\u4e00\u4e2a\u6587\u4ef6\u5939\u3002 \u5b66\u4e60\u72b6\u6001\u5c06\u4ee5 <output_name>-??????-state \uff08??????\u662fepoch\u6570\uff09\u4e3a\u540d\u7684\u6587\u4ef6\u5939\u4fdd\u5b58\u5728\u8f93\u51fa\u76ee\u5f55\u4e2d\u3002\u5728\u957f\u65f6\u95f4\u5b66\u4e60\u65f6\u8bf7\u4f7f\u7528\u6b64\u529f\u80fd\u3002 \u8981\u4ece\u4fdd\u5b58\u7684\u5b66\u4e60\u72b6\u6001\u6062\u590d\u5b66\u4e60\uff0c\u8bf7\u4f7f\u7528 resume \u9009\u9879\u3002\u9700\u6307\u5b9a\u4fdd\u5b58\u7684\u5b66\u4e60\u72b6\u6001\u6587\u4ef6\u5939\uff08\u4e0d\u662f output_dir \uff0c\u800c\u662f\u5176\u4e2d\u7684state\u6587\u4ef6\u5939\uff09\u3002 \u8bf7\u6ce8\u610f\uff0c\u7531\u4e8eAccelerator\u7684\u9650\u5236\uff0cepoch\u6570\u548cglobal step\u4e0d\u4f1a\u88ab\u4fdd\u5b58\uff0c\u6062\u590d\u65f6\u4e5f\u4f1a\u4ece1\u5f00\u59cb\u3002 --save_every_n_steps \u5982\u679c\u4e3a save_every_n_steps \u9009\u9879\u6307\u5b9a\u4e00\u4e2a\u6570\u503c\uff0c\u5219\u6bcf\u9694\u6307\u5b9astep\u6570\u4fdd\u5b58\u4e00\u6b21\u5b66\u4e60\u8fc7\u7a0b\u4e2d\u7684\u6a21\u578b\u3002\u53ef\u4ee5\u4e0e save_every_n_epochs \u540c\u65f6\u6307\u5b9a\u3002 --save_model_as \uff08\u4ec5\u9650DreamBooth\u548cfine tuning\uff09 \u53ef\u4ee5\u4ece ckpt \u3001 safetensors \u3001 diffusers \u3001 diffusers_safetensors \u4e2d\u9009\u62e9\u6a21\u578b\u7684\u4fdd\u5b58\u683c\u5f0f\u3002 \u6307\u5b9a\u65b9\u5f0f\u4e3a --save_model_as=safetensors \u3002\u5982\u679c\u4ee5Stable Diffusion\u683c\u5f0f\uff08ckpt\u6216safetensors\uff09\u8bfb\u53d6\u5e76\u4ee5Diffusers\u683c\u5f0f\u4fdd\u5b58\uff0c\u5219\u4f1a\u4eceHugging Face\u4e0b\u8f7dv1.5\u6216v2.1\u7684\u4fe1\u606f\u6765\u8865\u5145\u7f3a\u5931\u7684\u4fe1\u606f\u3002 --huggingface_repo_id \u7b49 \u5982\u679c\u6307\u5b9a\u4e86 huggingface_repo_id \uff0c\u5219\u5728\u4fdd\u5b58\u6a21\u578b\u65f6\u540c\u65f6\u4e0a\u4f20\u5230HuggingFace\u3002\u8bf7\u6ce8\u610f\u8bbf\u95ee\u4ee4\u724c\u7684\u5904\u7406\uff08\u8bf7\u53c2\u8003HuggingFace\u7684\u6587\u6863\uff09\u3002 \u5176\u4ed6\u53c2\u6570\u8bf7\u6309\u5982\u4e0b\u65b9\u5f0f\u6307\u5b9a\u3002 --huggingface_repo_id \"your-hf-name/your-model\" --huggingface_path_in_repo \"path\" --huggingface_repo_type model --huggingface_repo_visibility private --huggingface_token hf_YourAccessTokenHere \u5982\u679c huggingface_repo_visibility \u6307\u5b9a\u4e3a public \uff0c\u5219\u4ed3\u5e93\u5c06\u516c\u5f00\u3002\u5982\u679c\u7701\u7565\u6216\u6307\u5b9a\u4e3a private \uff08\u6216\u5176\u4ed6\u975epublic\u503c\uff09\uff0c\u5219\u4ed3\u5e93\u5c06\u4e3a\u79c1\u6709\u3002 \u5982\u679c\u5728\u6307\u5b9a --save_state \u65f6\u6dfb\u52a0 --save_state_to_huggingface \uff0c\u5219\u8fd8\u4f1a\u4e0a\u4f20state\u3002 \u5982\u679c\u5728\u6307\u5b9a --resume \u65f6\u6dfb\u52a0 --resume_from_huggingface \uff0c\u5219\u4f1a\u4eceHuggingFace\u4e0b\u8f7dstate\u5e76\u6062\u590d\u5b66\u4e60\u3002\u6b64\u65f6\u7684 --resume \u9009\u9879\u5e94\u4e3a --resume {repo_id}/{path_in_repo}:{revision}:{repo_type} \u3002 \u4f8b: --resume_from_huggingface --resume your-hf-name/your-model/path/test-000002-state:main:model \u5982\u679c\u6307\u5b9a --async_upload \u9009\u9879\uff0c\u5219\u4f1a\u5f02\u6b65\u4e0a\u4f20\u3002 \u4f18\u5316\u5668\u76f8\u5173\u8bbe\u7f6e --optimizer_type \u6307\u5b9a\u4f18\u5316\u5668\u7c7b\u578b\u3002\u53ef\u9009\u4ee5\u4e0b\u7c7b\u578b\u3002 AdamW : torch.optim.AdamW \u4e0e\u8fc7\u53bb\u7248\u672c\u7684\u672a\u6307\u5b9a\u65f6\u76f8\u540c AdamW8bit : \u53c2\u6570\u540c\u4e0a PagedAdamW8bit : \u53c2\u6570\u540c\u4e0a \u4e0e\u8fc7\u53bb\u7248\u672c\u7684 --use_8bit_adam \u6307\u5b9a\u65f6\u76f8\u540c Lion : https://github.com/lucidrains/lion-pytorch \u4e0e\u8fc7\u53bb\u7248\u672c\u7684 --use_lion_optimizer \u6307\u5b9a\u65f6\u76f8\u540c Lion8bit : \u53c2\u6570\u540c\u4e0a PagedLion8bit : \u53c2\u6570\u540c\u4e0a SGDNesterov : torch.optim.SGD , nesterov=True SGDNesterov8bit : \u53c2\u6570\u540c\u4e0a DAdaptation(DAdaptAdamPreprint) : https://github.com/facebookresearch/dadaptation DAdaptAdam : \u53c2\u6570\u540c\u4e0a DAdaptAdaGrad : \u53c2\u6570\u540c\u4e0a DAdaptAdan : \u53c2\u6570\u540c\u4e0a DAdaptAdanIP : \u53c2\u6570\u540c\u4e0a DAdaptLion : \u53c2\u6570\u540c\u4e0a DAdaptSGD : \u53c2\u6570\u540c\u4e0a Prodigy : https://github.com/konstmish/prodigy AdaFactor : Transformers AdaFactor \u81ea\u5b9a\u4e49\u4f18\u5316\u5668 --learning_rate \u6307\u5b9a\u5b66\u4e60\u7387\u3002\u9002\u5f53\u7684\u5b66\u4e60\u7387\u56e0\u5b66\u4e60\u811a\u672c\u800c\u5f02\uff0c\u8bf7\u53c2\u8003\u5404\u81ea\u7684\u8bf4\u660e\u3002 --lr_scheduler / --lr_warmup_steps / --lr_scheduler_num_cycles / --lr_scheduler_power \u5b66\u4e60\u7387\u8c03\u5ea6\u5668\u76f8\u5173\u7684\u6307\u5b9a\u3002 lr_scheduler \u9009\u9879\u53ef\u4ecelinear\u3001cosine\u3001cosine_with_restarts\u3001polynomial\u3001constant\u3001constant_with_warmup\u3001\u81ea\u5b9a\u4e49\u8c03\u5ea6\u5668\u4e2d\u9009\u62e9\u3002\u9ed8\u8ba4\u503c\u4e3aconstant\u3002 lr_warmup_steps \u53ef\u6307\u5b9a\u8c03\u5ea6\u5668\u7684\u9884\u70ed\u6b65\u6570\u3002 lr_scheduler_num_cycles \u662fcosine with restarts\u8c03\u5ea6\u5668\u7684\u91cd\u542f\u6b21\u6570\uff0c lr_scheduler_power \u662fpolynomial\u8c03\u5ea6\u5668\u7684\u591a\u9879\u5f0f\u5e42\u3002 \u8be6\u60c5\u8bf7\u81ea\u884c\u67e5\u9605\u3002 \u4f7f\u7528\u81ea\u5b9a\u4e49\u8c03\u5ea6\u5668\u65f6\uff0c\u4e0e\u81ea\u5b9a\u4e49\u4f18\u5316\u5668\u4e00\u6837\uff0c\u901a\u8fc7 --lr_scheduler_args \u6307\u5b9a\u9009\u9879\u53c2\u6570\u3002 \u4f18\u5316\u5668\u7684\u6307\u5b9a \u4f18\u5316\u5668\u7684\u9009\u9879\u53c2\u6570\u901a\u8fc7 --optimizer_args \u9009\u9879\u6307\u5b9a\u3002\u91c7\u7528key=value\u7684\u5f62\u5f0f\uff0c\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\u503c\u3002\u6b64\u5916\uff0cvalue\u53ef\u4ee5\u901a\u8fc7\u9017\u53f7\u5206\u9694\u6307\u5b9a\u591a\u4e2a\u503c\u3002\u4f8b\u5982\uff0c\u4e3aAdamW\u4f18\u5316\u5668\u6307\u5b9a\u53c2\u6570\u65f6\uff0c\u5e94\u4e3a --optimizer_args weight_decay=0.01 betas=.9,.999 \u3002 \u6307\u5b9a\u9009\u9879\u53c2\u6570\u65f6\uff0c\u8bf7\u786e\u8ba4\u5404\u81ea\u4f18\u5316\u5668\u7684\u89c4\u683c\u3002 \u90e8\u5206\u4f18\u5316\u5668\u6709\u5fc5\u9700\u53c2\u6570\uff0c\u5982\u679c\u7701\u7565\u5219\u4f1a\u81ea\u52a8\u6dfb\u52a0\uff08\u4f8b\u5982SGDNesterov\u7684momentum\uff09\u3002\u8bf7\u67e5\u770b\u63a7\u5236\u53f0\u8f93\u51fa\u3002 D-Adaptation\u4f18\u5316\u5668\u4f1a\u81ea\u52a8\u8c03\u6574\u5b66\u4e60\u7387\u3002\u5b66\u4e60\u7387\u9009\u9879\u4e2d\u6307\u5b9a\u7684\u503c\u4e0d\u662f\u5b66\u4e60\u7387\u672c\u8eab\uff0c\u800c\u662fD-Adaptation\u51b3\u5b9a\u7684\u5b66\u4e60\u7387\u7684\u5e94\u7528\u7387\uff0c\u56e0\u6b64\u901a\u5e38\u5e94\u6307\u5b9a\u4e3a1.0\u3002\u5982\u679c\u60f3\u4e3aText Encoder\u6307\u5b9aU-Net\u4e00\u534a\u7684\u5b66\u4e60\u7387\uff0c\u5e94\u6307\u5b9a --text_encoder_lr=0.5 --unet_lr=1.0 \u3002 AdaFactor\u4f18\u5316\u5668\u5982\u679c\u6307\u5b9a relative_step=True \uff0c\u5219\u53ef\u4ee5\u81ea\u52a8\u8c03\u6574\u5b66\u4e60\u7387\uff08\u7701\u7565\u65f6\u9ed8\u8ba4\u6dfb\u52a0\uff09\u3002\u81ea\u52a8\u8c03\u6574\u65f6\uff0c\u5b66\u4e60\u7387\u8c03\u5ea6\u5668\u5f3a\u5236\u4f7f\u7528adafactor_scheduler\u3002\u6b64\u5916\uff0c\u4f3c\u4e4e\u6307\u5b9a scale_parameter \u548c warmup_init \u662f\u6709\u6548\u7684\u3002 \u81ea\u52a8\u8c03\u6574\u65f6\u7684\u9009\u9879\u6307\u5b9a\u4f8b\u5982\u4e3a --optimizer_args \"relative_step=True\" \"scale_parameter=True\" \"warmup_init=True\" \u3002 \u5982\u679c\u4e0d\u81ea\u52a8\u8c03\u6574\u5b66\u4e60\u7387\uff0c\u5219\u9700\u6dfb\u52a0\u9009\u9879\u53c2\u6570 relative_step=False \u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b66\u4e60\u7387\u8c03\u5ea6\u5668\u5efa\u8bae\u4f7f\u7528constant_with_warmup\uff0c\u5e76\u4e14\u4f3c\u4e4e\u4e0d\u5efa\u8bae\u8fdb\u884c\u68af\u5ea6clip norm\u3002\u56e0\u6b64\uff0c\u53c2\u6570\u5e94\u4e3a --optimizer_type=adafactor --optimizer_args \"relative_step=False\" --lr_scheduler=\"constant_with_warmup\" --max_grad_norm=0.0 \u3002 \u4f7f\u7528\u4efb\u610f\u7684\u4f18\u5316\u5668 \u5982\u679c\u4f7f\u7528 torch.optim \u4e2d\u7684\u4f18\u5316\u5668\uff0c\u8bf7\u4ec5\u6307\u5b9a\u7c7b\u540d\uff08\u4f8b\u5982 --optimizer_type=RMSprop \uff09\uff1b\u5982\u679c\u4f7f\u7528\u5176\u4ed6\u6a21\u5757\u7684\u4f18\u5316\u5668\uff0c\u8bf7\u4ee5\u201c\u6a21\u5757\u540d.\u7c7b\u540d\u201d\u7684\u5f62\u5f0f\u6307\u5b9a\uff08\u4f8b\u5982 --optimizer_type=bitsandbytes.optim.lamb.LAMB \uff09\u3002 \uff08\u5185\u90e8\u901a\u8fc7importlib\u5b9e\u73b0\uff0c\u5b9e\u9645\u6548\u679c\u672a\u9a8c\u8bc1\u3002\u5982\u6709\u9700\u8981\uff0c\u8bf7\u81ea\u884c\u5b89\u88c5\u76f8\u5e94\u5305\u3002\uff09 \u521b\u5efa\u5143\u6570\u636e\u6587\u4ef6 \u51c6\u5907\u8bad\u7ec3\u6570\u636e \u5982\u524d\u6240\u8ff0\uff0c\u8bf7\u51c6\u5907\u597d\u60f3\u8981\u8bad\u7ec3\u7684\u56fe\u50cf\u6570\u636e\uff0c\u5e76\u5c06\u5176\u653e\u5165\u4efb\u610f\u6587\u4ef6\u5939\u4e2d\u3002 \u4f8b\u5982\uff0c\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u65b9\u5f0f\u7ec4\u7ec7\u56fe\u50cf\u6570\u636e\uff1a \u81ea\u52a8\u6807\u6ce8\uff08\u53ef\u9009\uff09 \u5982\u679c\u4ec5\u4f7f\u7528\u6807\u7b7e\u8fdb\u884c\u8bad\u7ec3\u800c\u4e0d\u9700\u8981\u4f7f\u7528\u6807\u9898\uff08caption\uff09\uff0c\u8bf7\u8df3\u8fc7\u6b64\u6b65\u9aa4\u3002 \u5982\u679c\u624b\u52a8\u51c6\u5907\u6807\u9898\uff08caption\uff09\uff0c\u8bf7\u5c06\u6807\u9898\u6587\u4ef6\u4e0e\u8bad\u7ec3\u56fe\u50cf\u653e\u5728\u540c\u4e00\u76ee\u5f55\u4e0b\uff0c\u6587\u4ef6\u540d\u76f8\u540c\uff0c\u6269\u5c55\u540d\u4e3a.caption\u7b49\u3002\u6bcf\u4e2a\u6807\u9898\u6587\u4ef6\u5e94\u4e3a\u5355\u884c\u6587\u672c\u6587\u4ef6\u3002 \u4f7f\u7528BLIP\u8fdb\u884c\u56fe\u50cf\u6807\u6ce8 \u6700\u65b0\u7248\u7684\u7a0b\u5e8f\u5df2\u7ecf\u5305\u542b\u4e86BLIP\u6a21\u578b\u53ca\u5176\u6743\u91cd\uff0c\u65e0\u9700\u989d\u5916\u4e0b\u8f7d\u3002 \u8fd0\u884cfinetune\u76ee\u5f55\u4e0b\u7684make_captions.py\u811a\u672c\uff1a python finetune\\make_captions.py --batch_size <\u6279\u6b21\u5927\u5c0f> <\u8bad\u7ec3\u6570\u636e\u76ee\u5f55> \u4f8b\u5982\uff0c\u5982\u679c\u6279\u6b21\u5927\u5c0f\u4e3a8\uff0c\u8bad\u7ec3\u6570\u636e\u5b58\u653e\u5728\u4e0a\u7ea7\u76ee\u5f55\u7684train_data\u6587\u4ef6\u5939\u4e2d\uff0c\u53ef\u4ee5\u8fd0\u884c\uff1a python finetune\\make_captions.py --batch_size 8 ..\\train_data \u6807\u6ce8\u6587\u4ef6\u5c06\u4ee5.caption\u4e3a\u6269\u5c55\u540d\uff0c\u4e0e\u8bad\u7ec3\u56fe\u50cf\u5b58\u653e\u5728\u540c\u4e00\u76ee\u5f55\u4e0b\uff0c\u6587\u4ef6\u540d\u76f8\u540c\u3002 \u6279\u6b21\u5927\u5c0f\uff08batch_size\uff09\u53ef\u4ee5\u6839\u636eGPU\u7684VRAM\u5bb9\u91cf\u8fdb\u884c\u8c03\u6574\u3002\u8f83\u5927\u7684\u6279\u6b21\u5927\u5c0f\u53ef\u4ee5\u63d0\u9ad8\u5904\u7406\u901f\u5ea6\uff08\u5373\u4f7fVRAM\u4e3a12GB\uff0c\u4e5f\u53ef\u80fd\u53ef\u4ee5\u8fdb\u4e00\u6b65\u589e\u52a0\u6279\u6b21\u5927\u5c0f\uff09\u3002 \u53ef\u4ee5\u901a\u8fc7max_length\u9009\u9879\u6307\u5b9a\u6807\u9898\u7684\u6700\u5927\u957f\u5ea6\uff0c\u9ed8\u8ba4\u4e3a75\u3002\u5982\u679c\u6a21\u578b\u4ee5225\u7684token\u957f\u5ea6\u8fdb\u884c\u8bad\u7ec3\uff0c\u53ef\u4ee5\u8003\u8651\u589e\u52a0\u6b64\u503c\u3002 \u901a\u8fc7caption_extension\u9009\u9879\u53ef\u4ee5\u66f4\u6539\u6807\u6ce8\u6587\u4ef6\u7684\u6269\u5c55\u540d\uff0c\u9ed8\u8ba4\u4e3a.caption\uff08\u5982\u679c\u66f4\u6539\u4e3a.txt\uff0c\u53ef\u80fd\u4f1a\u4e0eDeepDanbooru\u7684\u8f93\u51fa\u6587\u4ef6\u51b2\u7a81\uff09\u3002 \u5982\u679c\u6709\u591a\u4e2a\u8bad\u7ec3\u6570\u636e\u76ee\u5f55\uff0c\u9700\u8981\u5206\u522b\u5bf9\u6bcf\u4e2a\u76ee\u5f55\u8fd0\u884c\u8be5\u811a\u672c\u3002 \u7531\u4e8eBLIP\u6a21\u578b\u7684\u63a8\u65ad\u7ed3\u679c\u5177\u6709\u4e00\u5b9a\u7684\u968f\u673a\u6027\uff0c\u591a\u6b21\u8fd0\u884c\u7684\u7ed3\u679c\u53ef\u80fd\u4f1a\u6709\u6240\u4e0d\u540c\u3002\u5982\u679c\u9700\u8981\u56fa\u5b9a\u7ed3\u679c\uff0c\u53ef\u4ee5\u901a\u8fc7--seed\u9009\u9879\u6307\u5b9a\u968f\u673a\u79cd\u5b50\uff0c\u4f8b\u5982 --seed 42 \u3002 \u66f4\u591a\u9009\u9879\u7684\u8bf4\u660e\u53ef\u4ee5\u901a\u8fc7 --help \u53c2\u6570\u67e5\u770b\uff08\u7531\u4e8e\u76f8\u5173\u6587\u6863\u4e0d\u5b8c\u5584\uff0c\u53ef\u80fd\u9700\u8981\u76f4\u63a5\u67e5\u770b\u6e90\u7801\u4e86\u89e3\u53c2\u6570\u542b\u4e49\uff09\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6807\u6ce8\u6587\u4ef6\u7684\u6269\u5c55\u540d\u4e3a.caption\u3002 \u4f8b\u5982\uff0c\u751f\u6210\u7684\u6807\u6ce8\u6587\u4ef6\u53ef\u80fd\u5982\u4e0b\u6240\u793a\uff1a \u4f7f\u7528DeepDanbooru\u8fdb\u884c\u56fe\u50cf\u6807\u7b7e\u63d0\u53d6\uff08\u53ef\u9009\uff09 \u5982\u679c\u4e0d\u9700\u8981\u63d0\u53d6danbooru\u6807\u7b7e\uff0c\u53ef\u4ee5\u76f4\u63a5\u8df3\u5230\u201c\u6807\u9898\u548c\u6807\u7b7e\u4fe1\u606f\u9884\u5904\u7406\u201d\u7ae0\u8282\u3002 \u53ef\u4ee5\u4f7f\u7528DeepDanbooru\u6216WD14Tagger\u8fdb\u884c\u56fe\u50cf\u6807\u7b7e\u63d0\u53d6\u3002\u636e\u79f0WD14Tagger\u7684\u51c6\u786e\u7387\u66f4\u9ad8\u3002\u5982\u679c\u8981\u4f7f\u7528WD14Tagger\uff0c\u8bf7\u76f4\u63a5\u8df3\u8f6c\u5230\u4e0b\u4e00\u7ae0\u8282\u3002 \u73af\u5883\u51c6\u5907 \u5c06 DeepDanbooru https://github.com/KichangKim/DeepDanbooru \u514b\u9686\u5230\u5de5\u4f5c\u6587\u4ef6\u5939\uff0c\u6216\u8005\u4e0b\u8f7d zip \u6587\u4ef6\u5e76\u89e3\u538b\u3002\u6211\u662f\u901a\u8fc7 zip \u6587\u4ef6\u89e3\u538b\u7684\u3002 \u540c\u65f6\uff0c\u4ece DeepDanbooru \u7684 Releases \u9875\u9762 https://github.com/KichangKim/DeepDanbooru/releases \u7684 \"DeepDanbooru Pretrained Model v3-20211112-sgd-e28\" \u7684 Assets \u4e2d\u4e0b\u8f7d deepdanbooru-v3-20211112-sgd-e28.zip\uff0c\u5e76\u5c06\u5176\u89e3\u538b\u5230 DeepDanbooru \u6587\u4ef6\u5939\u4e2d\u3002 \u4ece\u4ee5\u4e0b\u4f4d\u7f6e\u4e0b\u8f7d\u3002\u70b9\u51fb Assets \u6253\u5f00\uff0c\u7136\u540e\u4ece\u90a3\u91cc\u4e0b\u8f7d\u3002 \u8bf7\u521b\u5efa\u5982\u4e0b\u6240\u793a\u7684\u76ee\u5f55\u7ed3\u6784\u3002 \u5b89\u88c5 Diffusers \u73af\u5883\u6240\u9700\u7684\u5e93\u3002\u79fb\u52a8\u5230 DeepDanbooru \u6587\u4ef6\u5939\u5e76\u5b89\u88c5\uff08\u5b9e\u9645\u4e0a\u53ea\u662f\u6dfb\u52a0\u4e86 tensorflow-io\uff09\u3002 pip install -r requirements.txt \u63a5\u4e0b\u6765\uff0c\u5b89\u88c5 DeepDanbooru \u672c\u8eab\u3002 pip install . \u81f3\u6b64\uff0c\u6807\u7b7e\u73af\u5883\u7684\u51c6\u5907\u5de5\u4f5c\u5df2\u7ecf\u5b8c\u6210\u3002 \u6267\u884c\u6807\u7b7e \u79fb\u52a8\u5230 DeepDanbooru \u6587\u4ef6\u5939\uff0c\u6267\u884c deepdanbooru \u8fdb\u884c\u6807\u7b7e\u3002 deepdanbooru evaluate <\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939> --project-path deepdanbooru-v3-20211112-sgd-e28 --allow-folder --save-txt \u5982\u679c\u5c06\u8bad\u7ec3\u6570\u636e\u653e\u5728\u7236\u6587\u4ef6\u5939\u7684 train_data \u4e2d\uff0c\u5219\u5982\u4e0b\u6240\u793a\u3002 deepdanbooru evaluate ../train_data --project-path deepdanbooru-v3-20211112-sgd-e28 --allow-folder --save-txt \u6807\u7b7e\u6587\u4ef6\u5c06\u5728\u4e0e\u8bad\u7ec3\u6570\u636e\u56fe\u50cf\u76f8\u540c\u7684\u76ee\u5f55\u4e2d\u521b\u5efa\uff0c\u6587\u4ef6\u540d\u76f8\u540c\uff0c\u6269\u5c55\u540d\u4e3a .txt\u3002\u7531\u4e8e\u662f\u4e00\u4ef6\u4e00\u4ef6\u5904\u7406\u7684\uff0c\u6240\u4ee5\u6bd4\u8f83\u6162\u3002 \u5982\u679c\u6709\u591a\u4e2a\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939\uff0c\u8bf7\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u5939\u6267\u884c\u6b64\u64cd\u4f5c\u3002 \u751f\u6210\u7684\u6587\u4ef6\u5982\u4e0b\u6240\u793a\u3002 \u6807\u7b7e\u5982\u4e0b\u6240\u793a\uff08\u4fe1\u606f\u91cf\u5f88\u5927\u2026\u2026\uff09\u3002 \u4f7f\u7528 WD14Tagger \u8fdb\u884c\u6807\u7b7e \u8fd9\u662f\u4f7f\u7528 WD14Tagger \u4ee3\u66ff DeepDanbooru \u7684\u6b65\u9aa4\u3002 \u4f7f\u7528 Automatic1111 \u5148\u751f\u7684 WebUI \u4e2d\u7684 tagger\u3002\u53c2\u8003\u4e86github\u9875\u9762\uff08https://github.com/toriato/stable-diffusion-webui-wd14-tagger#mrsmilingwolfs-model-aka-waifu-diffusion-14-tagger \uff09\u7684\u4fe1\u606f\u3002 \u521d\u59cb\u73af\u5883\u51c6\u5907\u65f6\u6240\u9700\u7684\u6a21\u5757\u5df2\u7ecf\u5b89\u88c5\u5b8c\u6bd5\u3002\u540c\u65f6\uff0c\u6743\u91cd\u5c06\u4ece Hugging Face \u81ea\u52a8\u4e0b\u8f7d\u3002 \u6267\u884c\u6807\u7b7e \u6267\u884c\u811a\u672c\u8fdb\u884c\u6807\u7b7e\u3002 python tag_images_by_wd14_tagger.py --batch_size <\u6279\u5904\u7406\u5927\u5c0f> <\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939> \u5982\u679c\u5c06\u8bad\u7ec3\u6570\u636e\u653e\u5728\u7236\u6587\u4ef6\u5939\u7684 train_data \u4e2d\uff0c\u5219\u5982\u4e0b\u6240\u793a\u3002 python tag_images_by_wd14_tagger.py --batch_size 4 ..\\train_data \u9996\u6b21\u8fd0\u884c\u65f6\uff0c\u6a21\u578b\u6587\u4ef6\u5c06\u81ea\u52a8\u4e0b\u8f7d\u5230 wd14_tagger_model \u6587\u4ef6\u5939\u4e2d\uff08\u6587\u4ef6\u5939\u53ef\u4ee5\u901a\u8fc7\u9009\u9879\u66f4\u6539\uff09\u3002\u5982\u4e0b\u6240\u793a\u3002 \u6807\u7b7e\u6587\u4ef6\u5c06\u5728\u4e0e\u8bad\u7ec3\u6570\u636e\u56fe\u50cf\u76f8\u540c\u7684\u76ee\u5f55\u4e2d\u521b\u5efa\uff0c\u6587\u4ef6\u540d\u76f8\u540c\uff0c\u6269\u5c55\u540d\u4e3a .txt\u3002 \u901a\u8fc7 thresh \u9009\u9879\uff0c\u53ef\u4ee5\u6307\u5b9a\u88ab\u5224\u5b9a\u4e3a\u6807\u7b7e\u7684 confidence\uff08\u7f6e\u4fe1\u5ea6\uff09\u8fbe\u5230\u591a\u5c11\u4ee5\u4e0a\u3002\u9ed8\u8ba4\u503c\u4e0e WD14Tagger \u793a\u4f8b\u76f8\u540c\uff0c\u4e3a 0.35\u3002\u964d\u4f4e\u8be5\u503c\u4f1a\u6dfb\u52a0\u66f4\u591a\u6807\u7b7e\uff0c\u4f46\u51c6\u786e\u7387\u4f1a\u964d\u4f4e\u3002 batch_size \u8bf7\u6839\u636e GPU \u7684 VRAM \u5bb9\u91cf\u8fdb\u884c\u8c03\u6574\u3002\u8f83\u5927\u7684\u503c\u4f1a\u66f4\u5feb\uff08\u5373\u4f7f VRAM \u4e3a 12GB\uff0c\u4e5f\u53ef\u4ee5\u518d\u5927\u4e00\u4e9b\uff09\u3002\u901a\u8fc7 caption_extension \u9009\u9879\uff0c\u53ef\u4ee5\u66f4\u6539\u6807\u7b7e\u6587\u4ef6\u7684\u6269\u5c55\u540d\u3002\u9ed8\u8ba4\u503c\u4e3a .txt\u3002 \u901a\u8fc7 model_dir \u9009\u9879\uff0c\u53ef\u4ee5\u6307\u5b9a\u6a21\u578b\u7684\u4fdd\u5b58\u6587\u4ef6\u5939\u3002 \u5982\u679c\u6307\u5b9a force_download \u9009\u9879\uff0c\u5373\u4f7f\u4fdd\u5b58\u6587\u4ef6\u5939\u5b58\u5728\uff0c\u4e5f\u4f1a\u91cd\u65b0\u4e0b\u8f7d\u6a21\u578b\u3002 \u5982\u679c\u6709\u591a\u4e2a\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939\uff0c\u8bf7\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u5939\u6267\u884c\u6b64\u64cd\u4f5c\u3002 \u9884\u5904\u7406\u6807\u9898\u548c\u6807\u7b7e\u4fe1\u606f \u4e3a\u4e86\u65b9\u4fbf\u4ece\u811a\u672c\u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u5c06\u6807\u9898\u548c\u6807\u7b7e\u5408\u5e76\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d\u4f5c\u4e3a\u5143\u6570\u636e\u3002 \u5b57\u5e55\u9884\u5904\u7406 \u8981\u5c06\u5b57\u5e55\u653e\u5165\u5143\u6570\u636e\u4e2d\uff0c\u8bf7\u5728\u5de5\u4f5c\u6587\u4ef6\u5939\u5185\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff08\u5982\u679c\u4e0d\u4f7f\u7528\u5b57\u5e55\u8fdb\u884c\u8bad\u7ec3\uff0c\u5219\u65e0\u9700\u6267\u884c\uff09\uff1a\uff08\u5b9e\u9645\u4e0a\u662f\u5728\u4e00\u884c\u4e2d\u63cf\u8ff0\u7684\uff0c\u4f9d\u6b64\u7c7b\u63a8\uff09\u3002\u6307\u5b9a --full_path \u9009\u9879\u4ee5\u5c06\u56fe\u50cf\u6587\u4ef6\u7684\u4f4d\u7f6e\u4ee5\u5b8c\u6574\u8def\u5f84\u5b58\u50a8\u5728\u5143\u6570\u636e\u4e2d\u3002\u5982\u679c\u7701\u7565\u6b64\u9009\u9879\uff0c\u5219\u4f1a\u4ee5\u76f8\u5bf9\u8def\u5f84\u8bb0\u5f55\uff0c\u4f46\u9700\u8981\u5728 .toml \u6587\u4ef6\u4e2d\u53e6\u5916\u6307\u5b9a\u6587\u4ef6\u5939\u3002 python merge_captions_to_metadata.py --full_path <\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939> --in_json <\u8981\u8bfb\u53d6\u7684\u5143\u6570\u636e\u6587\u4ef6\u540d> <\u5143\u6570\u636e\u6587\u4ef6\u540d> \u5143\u6570\u636e\u6587\u4ef6\u540d\u53ef\u4ee5\u662f\u4efb\u610f\u540d\u79f0\u3002 \u5982\u679c\u8bad\u7ec3\u6570\u636e\u662f train_data \uff0c\u6ca1\u6709\u8981\u8bfb\u53d6\u7684\u5143\u6570\u636e\u6587\u4ef6\uff0c\u5143\u6570\u636e\u6587\u4ef6\u662f meta_cap.json \uff0c\u5219\u5982\u4e0b\u6240\u793a\u3002 python merge_captions_to_metadata.py --full_path train_data meta_cap.json \u53ef\u4ee5\u4f7f\u7528 caption_extension \u9009\u9879\u6307\u5b9a\u5b57\u5e55\u7684\u6269\u5c55\u540d\u3002 \u5982\u679c\u6709\u591a\u4e2a\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939\uff0c\u5219\u9700\u8981\u6307\u5b9a full_path \u53c2\u6570\uff0c\u5e76\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u5939\u6267\u884c\u3002 python merge_captions_to_metadata.py --full_path train_data1 meta_cap1.json python merge_captions_to_metadata.py --full_path --in_json meta_cap1.json train_data2 meta_cap2.json \u5982\u679c\u7701\u7565 in_json \uff0c\u5219\u5982\u679c\u5b58\u5728\u5199\u5165\u76ee\u6807\u5143\u6570\u636e\u6587\u4ef6\uff0c\u5219\u4ece\u90a3\u91cc\u8bfb\u53d6\u5e76\u8986\u76d6\u3002 \u203b\u6bcf\u6b21\u66f4\u6539 in_json \u9009\u9879\u548c\u5199\u5165\u76ee\u6807\u4ee5\u8f93\u51fa\u5230\u4e0d\u540c\u7684\u5143\u6570\u636e\u6587\u4ef6\u4f1a\u66f4\u5b89\u5168\u3002 \u6807\u7b7e\u9884\u5904\u7406 \u540c\u6837\uff0c\u5c06\u6807\u7b7e\u6c47\u603b\u5230\u5143\u6570\u636e\u4e2d\uff08\u5982\u679c\u4e0d\u4f7f\u7528\u6807\u7b7e\u8fdb\u884c\u8bad\u7ec3\uff0c\u5219\u65e0\u9700\u6267\u884c\uff09\u3002 python merge_dd_tags_to_metadata.py --full_path <\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939> --in_json <\u8981\u8bfb\u53d6\u7684\u5143\u6570\u636e\u6587\u4ef6\u540d> <\u8981\u5199\u5165\u7684\u5143\u6570\u636e\u6587\u4ef6\u540d> \u5728\u4e0e\u4e4b\u524d\u76f8\u540c\u7684\u76ee\u5f55\u7ed3\u6784\u4e2d\uff0c\u8bfb\u53d6 meta_cap.json \u5e76\u5199\u5165 meta_cap_dd.json \u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u4e0b\u6240\u793a\u3002 python merge_dd_tags_to_metadata.py --full_path train_data --in_json meta_cap.json meta_cap_dd.json \u5982\u679c\u6709\u591a\u4e2a\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939\uff0c\u5219\u9700\u8981\u6307\u5b9a full_path \u53c2\u6570\uff0c\u5e76\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u5939\u6267\u884c\u3002 python merge_dd_tags_to_metadata.py --full_path --in_json meta_cap2.json train_data1 meta_cap_dd1.json python merge_dd_tags_to_metadata.py --full_path --in_json meta_cap_dd1.json train_data2 meta_cap_dd2.json \u5982\u679c\u7701\u7565 in_json \uff0c\u5219\u5982\u679c\u5b58\u5728\u5199\u5165\u76ee\u6807\u5143\u6570\u636e\u6587\u4ef6\uff0c\u5219\u4ece\u90a3\u91cc\u8bfb\u53d6\u5e76\u8986\u76d6\u3002 \u203b\u6bcf\u6b21\u66f4\u6539 in_json \u9009\u9879\u548c\u5199\u5165\u76ee\u6807\u4ee5\u8f93\u51fa\u5230\u4e0d\u540c\u7684\u5143\u6570\u636e\u6587\u4ef6\u4f1a\u66f4\u5b89\u5168\u3002 \u5b57\u5e55\u548c\u6807\u7b7e\u6e05\u7406 \u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u5143\u6570\u636e\u6587\u4ef6\u4e2d\u5305\u542b\u4e86\u5b57\u5e55\u548c DeepDanbooru \u7684\u6807\u7b7e\u3002\u4f46\u662f\u81ea\u52a8\u5b57\u5e55\u53ef\u80fd\u4f1a\u6709\u4e00\u4e9b\u8868\u8ff0\u4e0a\u7684\u5dee\u5f02\uff08\u203b\uff09\uff0c\u6807\u7b7e\u4e2d\u53ef\u80fd\u5305\u542b\u4e0b\u5212\u7ebf\u6216\u8bc4\u7ea7\uff08\u5982\u679c\u662f DeepDanbooru\uff09\uff0c\u56e0\u6b64\u6700\u597d\u4f7f\u7528\u7f16\u8f91\u5668\u7684\u66ff\u6362\u529f\u80fd\u6e05\u7406\u5b57\u5e55\u548c\u6807\u7b7e\u3002 \u203b\u4f8b\u5982\uff0c\u5982\u679c\u8981\u8bad\u7ec3\u52a8\u6f2b\u98ce\u683c\u7684\u5c11\u5973\u56fe\u50cf\uff0c\u5b57\u5e55\u4e2d\u53ef\u80fd\u4f1a\u6709 girl / girls / woman / women \u7b49\u4e0d\u540c\u7684\u8868\u8ff0\u3002\u5c06 \u201canime girl\u201d \u7b80\u5316\u4e3a \u201cgirl\u201d \u53ef\u80fd\u66f4\u5408\u9002\u3002 \u6211\u4eec\u51c6\u5907\u4e86\u4e00\u4e2a\u7528\u4e8e\u6e05\u7406\u7684\u811a\u672c\uff0c\u8bf7\u6839\u636e\u60c5\u51b5\u7f16\u8f91\u811a\u672c\u5185\u5bb9\u540e\u4f7f\u7528\u3002 \uff08\u4e0d\u518d\u9700\u8981\u6307\u5b9a\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939\u3002\u5143\u6570\u636e\u4e2d\u7684\u6240\u6709\u6570\u636e\u90fd\u5c06\u88ab\u6e05\u7406\u3002\uff09 python clean_captions_and_tags.py <\u8981\u8bfb\u53d6\u7684\u5143\u6570\u636e\u6587\u4ef6\u540d> <\u8981\u5199\u5165\u7684\u5143\u6570\u636e\u6587\u4ef6\u540d> \u8bf7\u6ce8\u610f\uff0c\u8fd9\u91cc\u6ca1\u6709 --in_json \u3002\u4f8b\u5982\uff1a python clean_captions_and_tags.py meta_cap_dd.json meta_clean.json \u81f3\u6b64\uff0c\u5b57\u5e55\u548c\u6807\u7b7e\u7684\u9884\u5904\u7406\u5df2\u7ecf\u5b8c\u6210\u3002 latents\u7684\u9884\u5148\u83b7\u53d6 \u6b64\u6b65\u9aa4\u4e0d\u662f\u5fc5\u987b\u7684\u3002\u5373\u4f7f\u7701\u7565\uff0c\u4e5f\u53ef\u4ee5\u5728\u8bad\u7ec3\u65f6\u83b7\u53d6latents\u5e76\u8fdb\u884c\u5b66\u4e60\u3002 \u53e6\u5916\uff0c\u5982\u679c\u5728\u8bad\u7ec3\u65f6\u8fdb\u884c random_crop \u6216 color_aug \u7b49\u64cd\u4f5c\uff0c\u5219\u65e0\u6cd5\u9884\u5148\u83b7\u53d6latents\uff08\u56e0\u4e3a\u6bcf\u6b21\u90fd\u4f1a\u6539\u53d8\u56fe\u50cf\uff09\u3002\u5982\u679c\u4e0d\u8fdb\u884c\u9884\u5148\u83b7\u53d6\uff0c\u53ef\u4ee5\u4f7f\u7528\u5230\u76ee\u524d\u4e3a\u6b62\u7684\u5143\u6570\u636e\u8fdb\u884c\u5b66\u4e60\u3002 \u9884\u5148\u83b7\u53d6\u56fe\u50cf\u7684\u6f5c\u5728\u8868\u793a\u5e76\u5c06\u5176\u4fdd\u5b58\u5230\u78c1\u76d8\u3002\u8fd9\u6837\u53ef\u4ee5\u52a0\u5feb\u5b66\u4e60\u901f\u5ea6\u3002\u540c\u65f6\uff0c\u8fd8\u4f1a\u8fdb\u884cbucketing\uff08\u6839\u636e\u957f\u5bbd\u6bd4\u5bf9\u8bad\u7ec3\u6570\u636e\u8fdb\u884c\u5206\u7c7b\uff09\u3002 \u8bf7\u5728\u5de5\u4f5c\u6587\u4ef6\u5939\u4e2d\u8f93\u5165\u4ee5\u4e0b\u5185\u5bb9\uff1a python prepare_buckets_latents.py --full_path <\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939> <\u8bfb\u53d6\u7684\u5143\u6570\u636e\u6587\u4ef6\u540d> <\u5199\u5165\u7684\u5143\u6570\u636e\u6587\u4ef6\u540d> <fine tuning\u7684\u6a21\u578b\u540d\u6216checkpoint> --batch_size <\u6279\u6b21\u5927\u5c0f> --max_resolution <\u5206\u8fa8\u7387 \u5bbd\u5ea6,\u9ad8\u5ea6> --mixed_precision <\u7cbe\u5ea6> \u5982\u679c\u6a21\u578b\u662fmodel.ckpt\uff0c\u6279\u6b21\u5927\u5c0f\u4e3a4\uff0c\u5b66\u4e60\u5206\u8fa8\u7387\u4e3a512*512\uff0c\u7cbe\u5ea6\u4e3ano\uff08float32\uff09\uff0c\u4ecemeta_clean.json\u8bfb\u53d6\u5143\u6570\u636e\u5e76\u5199\u5165meta_lat.json\uff0c\u5219\u5982\u4e0b\u6240\u793a\uff1a python prepare_buckets_latents.py --full_path train_data meta_clean.json meta_lat.json model.ckpt --batch_size 4 --max_resolution 512,512 --mixed_precision no \u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939\u4e2d\u4f1a\u4ee5numpy\u7684npz\u683c\u5f0f\u4fdd\u5b58latents\u3002 \u53ef\u4ee5\u4f7f\u7528--min_bucket_reso\u9009\u9879\u6307\u5b9a\u5206\u8fa8\u7387\u7684\u6700\u5c0f\u5927\u5c0f\uff0c\u4f7f\u7528--max_bucket_reso\u6307\u5b9a\u6700\u5927\u5927\u5c0f\u3002\u9ed8\u8ba4\u5206\u522b\u4e3a256\u548c1024\u3002\u4f8b\u5982\uff0c\u5982\u679c\u6307\u5b9a\u6700\u5c0f\u5927\u5c0f\u4e3a384\uff0c\u5219\u4e0d\u4f1a\u4f7f\u7528256 1024\u6216320 768\u7b49\u5206\u8fa8\u7387\u3002 \u5982\u679c\u5c06\u5206\u8fa8\u7387\u63d0\u9ad8\u5230768*768\u7b49\u8f83\u5927\u7684\u503c\uff0c\u53ef\u4ee5\u5c06\u6700\u5927\u5927\u5c0f\u6307\u5b9a\u4e3a1280\u7b49\u3002 \u5982\u679c\u6307\u5b9a--flip_aug\u9009\u9879\uff0c\u5219\u4f1a\u8fdb\u884c\u5de6\u53f3\u7ffb\u8f6c\u7684\u6570\u636e\u589e\u5f3a\uff08Data Augmentation\uff09\u3002\u8fd9\u53ef\u4ee5\u4f7f\u6570\u636e\u91cf\u4f2a\u88c5\u6210\u4e24\u500d\uff0c\u4f46\u5982\u679c\u6570\u636e\u4e0d\u662f\u5de6\u53f3\u5bf9\u79f0\u7684\uff08\u4f8b\u5982\u89d2\u8272\u7684\u5916\u89c2\u3001\u53d1\u578b\u7b49\uff09\uff0c\u5219\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5b66\u4e60\u5931\u8d25\u3002 \uff08\u5bf9\u4e8e\u7ffb\u8f6c\u7684\u56fe\u50cf\uff0c\u4e5f\u4f1a\u83b7\u53d6latents\u5e76\u4fdd\u5b58*_flip.npz\u6587\u4ef6\u3002\u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u5b9e\u73b0\uff0c\u4e0d\u9700\u8981\u5728fine_tune.py\u4e2d\u6307\u5b9a\u4efb\u4f55\u9009\u9879\u3002\u5982\u679c\u5b58\u5728\u5e26\u6709_flip\u7684\u6587\u4ef6\uff0c\u5219\u4f1a\u968f\u673a\u8bfb\u53d6\u5e26\u6709flip\u548c\u4e0d\u5e26flip\u7684\u6587\u4ef6\u3002\uff09 \u6279\u6b21\u5927\u5c0f\u5373\u4f7f\u5728VRAM 12GB\u7684\u60c5\u51b5\u4e0b\u4e5f\u53ef\u4ee5\u5c1d\u8bd5\u589e\u52a0\u4e00\u4e9b\u3002 \u5206\u8fa8\u7387\u9700\u8981\u662f64\u7684\u500d\u6570\uff0c\u4ee5\"\u5bbd\u5ea6,\u9ad8\u5ea6\"\u7684\u683c\u5f0f\u6307\u5b9a\u3002\u5206\u8fa8\u7387\u76f4\u63a5\u5f71\u54cdfine tuning\u65f6\u7684\u5185\u5b58\u5927\u5c0f\u3002VRAM 12GB\u7684\u60c5\u51b5\u4e0b\uff0c512,512\u4f3c\u4e4e\u662f\u6781\u9650\uff08*\uff09\u300216GB\u7684VRAM\u53ef\u80fd\u53ef\u4ee5\u63d0\u9ad8\u5230512,704\u6216512,768\u3002\u4f46\u662f\uff0c\u5373\u4f7f\u662f256,256\u7b49\uff0c\u5728VRAM 8GB\u7684\u60c5\u51b5\u4e0b\u4f3c\u4e4e\u4e5f\u6bd4\u8f83\u5403\u529b\uff08\u56e0\u4e3a\u53c2\u6570\u548c\u4f18\u5316\u5668\u7b49\u9700\u8981\u4e00\u5b9a\u7684\u5185\u5b58\uff0c\u4e0e\u5206\u8fa8\u7387\u65e0\u5173\uff09\u3002 *\u6709\u62a5\u544a\u79f0\uff0c\u5728batch size\u4e3a1\u7684\u60c5\u51b5\u4e0b\uff0c12GB VRAM\uff0c640,640\u4e5f\u53ef\u4ee5\u8fd0\u884c\u3002 \u5982\u4e0b\u6240\u793a\uff0c\u4f1a\u663e\u793abucketing\u7684\u7ed3\u679c\uff1a \u5982\u679c\u6709\u591a\u4e2a\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939\uff0c\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9afull_path\u53c2\u6570\uff0c\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u5939\u5206\u522b\u6267\u884c\uff1a python prepare_buckets_latents.py --full_path train_data1 meta_clean.json meta_lat1.json model.ckpt --batch_size 4 --max_resolution 512,512 --mixed_precision no python prepare_buckets_latents.py --full_path train_data2 meta_lat1.json meta_lat2.json model.ckpt --batch_size 4 --max_resolution 512,512 --mixed_precision no \u53ef\u4ee5\u5c06\u8bfb\u53d6\u6e90\u548c\u5199\u5165\u76ee\u6807\u6307\u5b9a\u4e3a\u76f8\u540c\u7684\u6587\u4ef6\uff0c\u4f46\u4e3a\u4e86\u5b89\u5168\u8d77\u89c1\uff0c\u6700\u597d\u5206\u522b\u6307\u5b9a\u4e0d\u540c\u7684\u6587\u4ef6\u3002 \u4e3a\u4e86\u5b89\u5168\u8d77\u89c1\uff0c\u6bcf\u6b21\u66f4\u6539\u53c2\u6570\u5e76\u5199\u5165\u4e0d\u540c\u7684\u5143\u6570\u636e\u6587\u4ef6\u3002","title":"\u6a21\u578b\u8bad\u7ec3"},{"location":"sd-scripts-docs/train/#_1","text":"\u672c\u4ed3\u5e93\u652f\u6301\u5bf9\u6a21\u578b\u7684 fine tuning\u3001DreamBooth\uff0c\u4ee5\u53ca LoRA \u548c Textual Inversion\uff08\u5305\u62ec XTI:P+ \uff09\u7684\u5b66\u4e60\u3002\u672c\u6587\u6863\u5c06\u4ecb\u7ecd\u5b83\u4eec\u5171\u901a\u7684\u5b66\u4e60\u6570\u636e\u51c6\u5907\u65b9\u6cd5\u548c\u9009\u9879\u7b49\u3002","title":"\u5173\u4e8e\u5b66\u4e60\uff0c\u901a\u7528\u7bc7"},{"location":"sd-scripts-docs/train/#_2","text":"\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u8bf7\u53c2\u8003\u672c\u4ed3\u5e93\u7684 README \u8fdb\u884c\u73af\u5883\u8bbe\u7f6e\u3002 \u672c\u6587\u6863\u5c06\u4ecb\u7ecd\u4ee5\u4e0b\u5185\u5bb9\uff1a \u5b66\u4e60\u6570\u636e\u7684\u51c6\u5907\u65b9\u6cd5\uff08\u4f7f\u7528\u8bbe\u7f6e\u6587\u4ef6\u7684\u65b0\u683c\u5f0f\uff09 \u5b66\u4e60\u4e2d\u4f7f\u7528\u7684\u672f\u8bed\u7684\u7b80\u8981\u8bf4\u660e \u4e4b\u524d\u7684\u6307\u5b9a\u683c\u5f0f\uff08\u4e0d\u4f7f\u7528\u8bbe\u7f6e\u6587\u4ef6\uff0c\u76f4\u63a5\u4ece\u547d\u4ee4\u884c\u6307\u5b9a\uff09 \u5728\u5b66\u4e60\u8fc7\u7a0b\u4e2d\u751f\u6210\u793a\u4f8b\u56fe\u50cf \u5404\u4e2a\u811a\u672c\u4e2d\u5171\u901a\u7684\u3001\u5e38\u7528\u7684\u9009\u9879 fine tuning \u65b9\u5f0f\u7684\u5143\u6570\u636e\u51c6\u5907\uff1a\u6807\u6ce8\u7b49 1.\u53ea\u9700\u6267\u884c\u6b65\u9aa41\u5c31\u53ef\u4ee5\u5f00\u59cb\u5b66\u4e60\u4e86\uff08\u5b66\u4e60\u8be6\u60c5\u8bf7\u53c2\u8003\u5404\u811a\u672c\u7684\u6587\u6863\uff09\u30022.\u6b65\u9aa42\u53ca\u4e4b\u540e\u7684\u5185\u5bb9\u8bf7\u6839\u636e\u9700\u8981\u53c2\u8003\u3002","title":"\u6982\u8981"},{"location":"sd-scripts-docs/train/#_3","text":"\u8bf7\u5728\u4efb\u610f\u6587\u4ef6\u5939\uff08\u53ef\u4ee5\u662f\u591a\u4e2a\u6587\u4ef6\u5939\uff09\u4e2d\u51c6\u5907\u5b66\u4e60\u6570\u636e\u7684\u56fe\u50cf\u6587\u4ef6\u3002\u652f\u6301 .png \u3001 .jpg \u3001 .jpeg \u3001 .webp \u3001 .bmp \u683c\u5f0f\u3002\u57fa\u672c\u4e0a\u4e0d\u9700\u8981\u8fdb\u884c\u9884\u5904\u7406\uff0c\u5982\u8c03\u6574\u5927\u5c0f\u7b49\u3002 \u4f46\u662f\uff0c\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528\u6bd4\u5b66\u4e60\u5206\u8fa8\u7387\uff08\u540e\u8ff0\uff09\u660e\u663e\u5c0f\u7684\u56fe\u50cf\uff0c\u6216\u8005\u4e8b\u5148\u4f7f\u7528\u8d85\u5206\u8fa8\u7387 AI \u7b49\u8fdb\u884c\u653e\u5927\u3002\u53e6\u5916\uff0c\u6781\u5927\u7684\u56fe\u50cf\uff08\u7ea63000x3000\u50cf\u7d20\u6216\u66f4\u5927\uff09\u53ef\u80fd\u4f1a\u5bfc\u81f4\u9519\u8bef\uff0c\u56e0\u6b64\u8bf7\u4e8b\u5148\u7f29\u5c0f\u3002 \u5728\u5b66\u4e60\u65f6\uff0c\u9700\u8981\u6574\u7406\u8981\u8ba9\u6a21\u578b\u5b66\u4e60\u7684\u56fe\u7247\u6570\u636e\uff0c\u5e76\u5c06\u5176\u6307\u5b9a\u7ed9\u811a\u672c\u3002\u6839\u636e\u56fe\u7247\u6570\u636e\u7684\u6570\u91cf\u3001\u5b66\u4e60\u5bf9\u8c61\u3001\u662f\u5426\u6709\u6807\u9898\uff08\u56fe\u7247\u7684\u8bf4\u660e\uff09\u7b49\uff0c\u53ef\u4ee5\u901a\u8fc7\u51e0\u79cd\u65b9\u6cd5\u6307\u5b9a\u5b66\u4e60\u6570\u636e\u3002\u4ee5\u4e0b\u662f\u53ef\u7528\u7684\u65b9\u6cd5\uff08\u6bcf\u4e2a\u540d\u79f0\u5e76\u4e0d\u662f\u901a\u7528\u7684\uff0c\u800c\u662f\u672c\u4ed3\u5e93\u7684\u5b9a\u4e49\uff09\u3002\u5173\u4e8e\u6b63\u5219\u5316\u56fe\u7247\u5c06\u5728\u540e\u9762\u63cf\u8ff0\u3002 DreamBooth\u3001class+identifier \u65b9\u5f0f\uff08\u53ef\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff09 \u901a\u8fc7\u7279\u5b9a\u5355\u8bcd\uff08identifier\uff09\u4e0e\u5b66\u4e60\u5bf9\u8c61\u5173\u8054\u6765\u8fdb\u884c\u5b66\u4e60\u3002\u4e0d\u9700\u8981\u51c6\u5907\u6807\u9898\u3002\u4f8b\u5982\uff0c\u7528\u4e8e\u5b66\u4e60\u7279\u5b9a\u89d2\u8272\u65f6\uff0c\u7531\u4e8e\u4e0d\u9700\u8981\u51c6\u5907\u6807\u9898\uff0c\u56e0\u6b64\u6bd4\u8f83\u65b9\u4fbf\u3002\u4f46\u662f\uff0c\u7531\u4e8e\u5934\u53d1\u6837\u5f0f\u3001\u670d\u88c5\u3001\u80cc\u666f\u7b49\u5b66\u4e60\u6570\u636e\u4e2d\u7684\u6240\u6709\u5143\u7d20\u90fd\u4e0e identifier \u5173\u8054\uff0c\u56e0\u6b64\u5728\u751f\u6210\u56fe\u50cf\u65f6\u53ef\u80fd\u65e0\u6cd5\u66f4\u6539\u670d\u88c5\u7b49\u3002 DreamBooth\u3001\u6807\u9898\u65b9\u5f0f\uff08\u53ef\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff09 \u4e3a\u6bcf\u5f20\u56fe\u50cf\u51c6\u5907\u8bb0\u5f55\u6807\u9898\u7684\u6587\u672c\u6587\u4ef6\u6765\u8fdb\u884c\u5b66\u4e60\u3002\u4f8b\u5982\uff0c\u7528\u4e8e\u5b66\u4e60\u7279\u5b9a\u89d2\u8272\u65f6\uff0c\u901a\u8fc7\u5728\u6807\u9898\u4e2d\u63cf\u8ff0\u56fe\u50cf\u7684\u7ec6\u8282\uff08\u7a7f\u767d\u8863\u670d\u7684\u89d2\u8272A\u3001\u7a7f\u7ea2\u8863\u670d\u7684\u89d2\u8272A\u7b49\uff09\uff0c\u53ef\u4ee5\u5c06\u89d2\u8272\u4e0e\u5176\u4ed6\u5143\u7d20\u5206\u79bb\uff0c\u4ece\u800c\u66f4\u4e25\u683c\u5730\u5b66\u4e60\u89d2\u8272\u3002 fine tuning \u65b9\u5f0f\uff08\u4e0d\u53ef\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff09 \u4e8b\u5148\u5c06\u6807\u9898\u6c47\u603b\u5230\u5143\u6570\u636e\u6587\u4ef6\u4e2d\u3002\u652f\u6301\u5c06\u6807\u7b7e\u548c\u6807\u9898\u5206\u5f00\u7ba1\u7406\u3001\u9884\u5148\u7f13\u5b58latents\u4ee5\u52a0\u5feb\u5b66\u4e60\u901f\u5ea6\u7b49\u529f\u80fd\uff08\u5747\u5728\u5176\u4ed6\u6587\u6863\u4e2d\u8bf4\u660e\uff09\u3002\uff08\u867d\u7136\u79f0\u4e3afine tuning\u65b9\u5f0f\uff0c\u4f46\u4e0d\u4ec5\u9650\u4e8efine tuning\uff09\u3002 \u53ef\u7528\u4e8e\u5b66\u4e60\u7684\u5bf9\u8c61\u6216\u65b9\u6cd5\u4e0e\u53ef\u7528\u7684\u6307\u5b9a\u65b9\u6cd5\u7684\u7ec4\u5408\u5982\u4e0b\uff1a \u5b66\u4e60\u5bf9\u8c61\u6216\u65b9\u6cd5 \u811a\u672c DB / class+identifier DB / \u6807\u9898 fine tuning \u5bf9\u6a21\u578b\u8fdb\u884c fine tuning fine_tune.py x x o \u5bf9\u6a21\u578b\u8fdb\u884c DreamBooth train_db.py o o x LoRA train_network.py o o o Textual Inversion train_textual_inversion.py o o o","title":"\u5173\u4e8e\u5b66\u4e60\u6570\u636e\u7684\u51c6\u5907"},{"location":"sd-scripts-docs/train/#_4","text":"\u5bf9\u4e8e LoRA \u548c Textual Inversion\uff0c\u82e5\u60f3\u7b80\u5355\u5730\u8fdb\u884c\u5b66\u4e60\u800c\u4e0d\u51c6\u5907\u6807\u9898\u6587\u4ef6\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 DreamBooth class+identifier \u65b9\u5f0f\uff1b\u82e5\u80fd\u51c6\u5907\u6807\u9898\u6587\u4ef6\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 DreamBooth \u6807\u9898\u65b9\u5f0f\u3002\u82e5\u5b66\u4e60\u6570\u636e\u91cf\u5927\u4e14\u4e0d\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff0c\u5219\u4e5f\u53ef\u4ee5\u8003\u8651 fine tuning \u65b9\u5f0f\u3002 \u5bf9\u4e8e DreamBooth \u4e5f\u662f\u540c\u6837\uff0c\u4f46\u4e0d\u80fd\u4f7f\u7528 fine tuning \u65b9\u5f0f\u3002fine tuning \u7684\u60c5\u51b5\u4e0b\uff0c\u53ea\u80fd\u4f7f\u7528 fine tuning \u65b9\u5f0f\u3002","title":"\u9009\u62e9\u54ea\u79cd\u65b9\u5f0f"},{"location":"sd-scripts-docs/train/#_5","text":"\u8fd9\u91cc\u53ea\u4ecb\u7ecd\u6bcf\u79cd\u6307\u5b9a\u65b9\u6cd5\u7684\u5178\u578b\u6a21\u5f0f\u3002\u66f4\u8be6\u7ec6\u7684\u6307\u5b9a\u65b9\u6cd5\u8bf7\u53c2\u8003 \u6570\u636e\u96c6\u8bbe\u7f6e \u3002","title":"\u5173\u4e8e\u5404\u79cd\u6307\u5b9a\u65b9\u6cd5\u7684\u8bf4\u660e"},{"location":"sd-scripts-docs/train/#dreamboothclassidentifier","text":"\u5728\u8fd9\u79cd\u65b9\u5f0f\u4e2d\uff0c\u6bcf\u5f20\u56fe\u50cf\u90fd\u4e0e class identifier \u8fd9\u6837\u7684\u6807\u9898\u4e00\u8d77\u5b66\u4e60\uff08\u4f8b\u5982 shs dog \uff09\u3002","title":"DreamBooth\u3001class+identifier \u65b9\u5f0f\uff08\u53ef\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff09"},{"location":"sd-scripts-docs/train/#1-identifier-class","text":"\u786e\u5b9a\u8981\u4e0e\u5b66\u4e60\u5bf9\u8c61\u5173\u8054\u7684\u5355\u8bcd identifier \u548c\u5bf9\u8c61\u6240\u5c5e\u7684 class\u3002 \uff08\u867d\u7136\u6709\u5404\u79cd\u4e0d\u540c\u7684\u79f0\u547c\uff0c\u4f46\u8fd9\u91cc\u6309\u7167\u539f\u59cb\u8bba\u6587\u7684\u8bf4\u6cd5\uff09\u3002 \u4e0b\u9762\u7b80\u8981\u8bf4\u660e\uff08\u8be6\u60c5\u8bf7\u81ea\u884c\u67e5\u627e\uff09\u3002 class \u662f\u5b66\u4e60\u5bf9\u8c61\u7684\u4e00\u822c\u7c7b\u522b\u3002\u4f8b\u5982\uff0c\u82e5\u8981\u5b66\u4e60\u7279\u5b9a\u7684\u72ac\u79cd\uff0c\u5219 class \u4e3a dog\u3002\u82e5\u662f\u52a8\u6f2b\u89d2\u8272\uff0c\u5219 class \u53ef\u80fd\u662f boy \u6216 girl\u30011boy \u6216 1girl\uff0c\u53d6\u51b3\u4e8e\u6a21\u578b\u3002 identifier \u662f\u7528\u4e8e\u533a\u5206\u5b66\u4e60\u5bf9\u8c61\u7684\u4efb\u610f\u5355\u8bcd\uff0c\u4f46\u6839\u636e\u539f\u59cb\u8bba\u6587\uff0c\u5efa\u8bae\u4f7f\u7528\u201ctokenizer\u4e2d\u4e3a1\u4e2atoken\u76843\u4e2a\u5b57\u7b26\u4ee5\u4e0b\u3001\u4e14\u8f83\u5c11\u89c1\u7684\u5355\u8bcd\u201d\u3002 \u4f7f\u7528 identifier \u548c class\uff0c\u4f8b\u5982\u901a\u8fc7\u201cshs dog\u201d\u6765\u5b66\u4e60\u6a21\u578b\uff0c\u53ef\u4ee5\u5c06\u5b66\u4e60\u5bf9\u8c61\u4e0e class \u533a\u5206\u5f00\u6765\u3002 \u5728\u751f\u6210\u56fe\u50cf\u65f6\uff0c\u4f7f\u7528\u201cshs dog\u201d\u5373\u53ef\u751f\u6210\u6240\u5b66\u72ac\u79cd\u7684\u56fe\u50cf\u3002 \uff08\u6211\u6700\u8fd1\u4f7f\u7528\u7684 identifier \u4f8b\u5b50\u6709 shs sts scs cpc coc cic msm usu ici lvl cic dii muk ori hru rik koo yos wny \u7b49\u3002\u5b9e\u9645\u4e0a\uff0c\u6700\u597d\u4f7f\u7528 Danbooru Tag \u4e2d\u4e0d\u5305\u542b\u7684\u5355\u8bcd\uff09\u3002","title":"\u6b65\u9aa41\uff1a\u51b3\u5b9a identifier \u548c class"},{"location":"sd-scripts-docs/train/#2","text":"\u6b63\u5219\u5316\u56fe\u50cf\u662f\u9632\u6b62\u4e0a\u8ff0 class \u88ab\u5b66\u4e60\u5bf9\u8c61\u5f71\u54cd\u7684\u56fe\u50cf\uff08language drift\uff09\u3002\u82e5\u4e0d\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff0c\u5219\u4f8b\u5982\u4f7f\u7528 shs 1girl \u5b66\u4e60\u7279\u5b9a\u89d2\u8272\u65f6\uff0c\u5373\u4f7f\u4ec5\u4f7f\u7528 1girl \u4f5c\u4e3a\u63d0\u793a\uff0c\u4e5f\u4f1a\u751f\u6210\u4e0e\u8be5\u89d2\u8272\u76f8\u4f3c\u7684\u56fe\u50cf\u3002\u8fd9\u662f\u56e0\u4e3a 1girl \u5305\u542b\u5728\u5b66\u4e60\u7684\u6807\u9898\u4e2d\u3002 \u901a\u8fc7\u540c\u65f6\u5b66\u4e60\u5b66\u4e60\u5bf9\u8c61\u7684\u56fe\u50cf\u548c\u6b63\u5219\u5316\u56fe\u50cf\uff0c\u53ef\u4ee5\u4fdd\u6301 class \u7684\u539f\u6837\uff0c\u4ec5\u5728\u63d0\u793a\u4e2d\u4f7f\u7528 identifier \u65f6\u751f\u6210\u5b66\u4e60\u5bf9\u8c61\u3002 \u82e5\u4ec5\u9700\u5728 LoRA \u6216 DreamBooth \u4e2d\u751f\u6210\u7279\u5b9a\u89d2\u8272\uff0c\u5219\u53ef\u4ee5\u4e0d\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\u3002 \u5bf9\u4e8e Textual Inversion\uff0c\u53ef\u80fd\u4e5f\u4e0d\u9700\u8981\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff08\u56e0\u4e3a\u8981\u5b66\u4e60\u7684 token string \u4e0d\u5305\u542b\u5728\u6807\u9898\u4e2d\uff0c\u56e0\u6b64\u4e0d\u4f1a\u88ab\u5b66\u4e60\uff09\u3002 \u4f5c\u4e3a\u6b63\u5219\u5316\u56fe\u50cf\uff0c\u901a\u5e38\u4f7f\u7528\u5b66\u4e60\u5bf9\u8c61\u6a21\u578b\u901a\u8fc7 class \u540d\u79f0\u751f\u6210\u7684\u56fe\u50cf\uff08\u4f8b\u5982 1girl \uff09\u3002\u4f46\u82e5\u751f\u6210\u7684\u56fe\u50cf\u8d28\u91cf\u8f83\u5dee\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u6539\u8fdb\u63d0\u793a\u6216\u4ece\u7f51\u7edc\u4e0b\u8f7d\u5176\u4ed6\u56fe\u50cf\u6765\u4f7f\u7528\u3002 \uff08\u7531\u4e8e\u6b63\u5219\u5316\u56fe\u50cf\u4e5f\u4f1a\u88ab\u5b66\u4e60\uff0c\u56e0\u6b64\u5176\u8d28\u91cf\u4f1a\u5f71\u54cd\u6a21\u578b\uff09\u3002 \u901a\u5e38\uff0c\u5efa\u8bae\u51c6\u5907\u6570\u767e\u5f20\u5de6\u53f3\u7684\u6b63\u5219\u5316\u56fe\u50cf\uff08\u82e5\u6570\u91cf\u8f83\u5c11\uff0c\u5219 class \u56fe\u50cf\u4e0d\u4f1a\u88ab\u4e00\u822c\u5316\uff0c\u4ece\u800c\u4f1a\u5b66\u4e60\u5230\u5b83\u4eec\u7684\u7279\u5f81\uff09\u3002 \u4f7f\u7528\u751f\u6210\u7684\u56fe\u50cf\u65f6\uff0c\u901a\u5e38\u9700\u8981\u5c06\u5176\u5927\u5c0f\u8c03\u6574\u4e3a\u5b66\u4e60\u5206\u8fa8\u7387\uff08\u66f4\u51c6\u786e\u5730\u8bf4\uff0c\u662f bucket \u7684\u5206\u8fa8\u7387\uff0c\u540e\u8ff0\uff09\u3002","title":"\u6b65\u9aa42\uff1a\u51b3\u5b9a\u662f\u5426\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff0c\u82e5\u4f7f\u7528\uff0c\u5219\u751f\u6210\u6b63\u5219\u5316\u56fe\u50cf"},{"location":"sd-scripts-docs/train/#2_1","text":"\u521b\u5efa\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\uff0c\u5c06\u5176\u6269\u5c55\u540d\u6539\u4e3a .toml \u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u65b9\u5f0f\u7f16\u5199\uff1a \uff08\u4ee5 # \u5f00\u5934\u7684\u90e8\u5206\u662f\u6ce8\u91ca\uff0c\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u590d\u5236\u7c98\u8d34\uff0c\u4e5f\u53ef\u4ee5\u5220\u9664\uff0c\u4e0d\u5f71\u54cd\u4f7f\u7528\u3002\uff09 [general] enable_bucket = true # \u662f\u5426\u4f7f\u7528\u5bbd\u9ad8\u6bd4\u6876 [[datasets]] resolution = 512 # \u8bad\u7ec3\u5206\u8fa8\u7387 batch_size = 4 # \u6279\u6b21\u5927\u5c0f [[datasets.subsets]] image_dir = 'C:\\hoge' # \u6307\u5b9a\u5305\u542b\u8bad\u7ec3\u56fe\u50cf\u7684\u6587\u4ef6\u5939 class_tokens = 'hoge girl' # \u6307\u5b9a\u6807\u8bc6\u7b26\u7c7b num_repeats = 10 # \u8bad\u7ec3\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570 # \u4ee5\u4e0b\u4ec5\u5728\u9700\u8981\u6b63\u5219\u5316\u56fe\u50cf\u65f6\u63cf\u8ff0\u3002\u5982\u679c\u4e0d\u4f7f\u7528\uff0c\u8bf7\u5220\u9664 [[datasets.subsets]] is_reg = true image_dir = 'C:\\reg' # \u6307\u5b9a\u5305\u542b\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6587\u4ef6\u5939 class_tokens = 'girl' # \u6307\u5b9a\u7c7b num_repeats = 1 # \u6b63\u5219\u5316\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570\uff0c\u57fa\u672c\u4e0a\u4e3a1\u5373\u53ef \u57fa\u672c\u4e0a\uff0c\u53ea\u9700\u66f4\u6539\u4ee5\u4e0b\u4f4d\u7f6e\u5373\u53ef\u8fdb\u884c\u8bad\u7ec3\uff1a \u8bad\u7ec3\u5206\u8fa8\u7387 \u6307\u5b9a\u4e00\u4e2a\u6570\u503c\u65f6\uff0c\u4e3a\u6b63\u65b9\u5f62\uff08\u4f8b\u5982 512 \u5373\u4e3a 512x512\uff09\uff0c\u7528\u65b9\u62ec\u53f7\u548c\u9017\u53f7\u5206\u9694\u4e24\u4e2a\u6570\u503c\u65f6\uff0c\u4e3a\u5bbd x \u9ad8\uff08\u4f8b\u5982 [512,768] \u5373\u4e3a 512x768\uff09\u3002\u5728 SD1.x \u7cfb\u5217\u4e2d\uff0c\u539f\u59cb\u8bad\u7ec3\u5206\u8fa8\u7387\u4e3a 512\u3002\u6307\u5b9a\u8f83\u5927\u7684\u5206\u8fa8\u7387\uff08\u5982 [512,768] \uff09\u53ef\u80fd\u6709\u52a9\u4e8e\u51cf\u5c11\u751f\u6210\u7eb5\u5411\u6216\u6a2a\u5411\u56fe\u50cf\u65f6\u7684\u5d29\u6e83\u3002SD2.x 768 \u7cfb\u5217\u4e2d\uff0c\u5206\u8fa8\u7387\u4e3a 768 \u3002 \u6279\u6b21\u5927\u5c0f \u6307\u5b9a\u540c\u65f6\u8bad\u7ec3\u591a\u5c11\u6570\u636e\u3002\u6839\u636e GPU \u7684\u663e\u5b58\u5927\u5c0f\u548c\u8bad\u7ec3\u5206\u8fa8\u7387\u800c\u6709\u6240\u4e0d\u540c\u3002\u8be6\u60c5\u8bf7\u53c2\u89c1\u540e\u6587\u3002\u6b64\u5916\uff0c\u6839\u636e\u5fae\u8c03/DreamBooth/LoRA \u7b49\u7684\u4e0d\u540c\uff0c\u4e5f\u4f1a\u6709\u6240\u4e0d\u540c\uff0c\u8bf7\u53c2\u9605\u5404\u811a\u672c\u7684\u8bf4\u660e\u3002 \u6587\u4ef6\u5939\u6307\u5b9a \u6307\u5b9a\u8bad\u7ec3\u56fe\u50cf\u548c\u6b63\u5219\u5316\u56fe\u50cf\uff08\u5982\u679c\u4f7f\u7528\uff09\u6240\u5728\u7684\u6587\u4ef6\u5939\u3002\u76f4\u63a5\u6307\u5b9a\u5305\u542b\u56fe\u50cf\u6570\u636e\u7684\u6587\u4ef6\u5939\u3002 \u6807\u8bc6\u7b26\u548c\u7c7b\u7684\u6307\u5b9a \u5982\u524d\u9762\u7684\u793a\u4f8b\u6240\u793a\u3002 \u91cd\u590d\u6b21\u6570 \u5728\u540e\u6587\u4e2d\u63cf\u8ff0\u3002","title":"\u6b65\u9aa4 2. \u7f16\u5199\u914d\u7f6e\u6587\u4ef6"},{"location":"sd-scripts-docs/train/#_6","text":"\u91cd\u590d\u6b21\u6570\u7528\u4e8e\u8c03\u6574\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6570\u91cf\u548c\u8bad\u7ec3\u56fe\u50cf\u7684\u6570\u91cf\u3002\u7531\u4e8e\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6570\u91cf\u901a\u5e38\u591a\u4e8e\u8bad\u7ec3\u56fe\u50cf\uff0c\u56e0\u6b64\u901a\u8fc7\u91cd\u590d\u8bad\u7ec3\u56fe\u50cf\u6765\u5339\u914d\u6570\u91cf\uff0c\u4f7f\u5176\u4ee5 1:1 \u7684\u6bd4\u4f8b\u8fdb\u884c\u8bad\u7ec3\u3002 \u8bf7\u6307\u5b9a\u91cd\u590d\u6b21\u6570\uff0c\u4f7f\u5f97 \u8bad\u7ec3\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570 \u00d7 \u8bad\u7ec3\u56fe\u50cf\u7684\u6570\u91cf \u2265 \u6b63\u5219\u5316\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570 \u00d7 \u6b63\u5219\u5316\u56fe\u50cf\u7684\u6570\u91cf \u3002 \uff081 \u4e2a epoch\uff08\u6570\u636e\u5faa\u73af\u4e00\u6b21\u4e3a 1 \u4e2a epoch\uff09\u7684\u6570\u636e\u6570\u91cf\u4e3a\u300c\u8bad\u7ec3\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570 \u00d7 \u8bad\u7ec3\u56fe\u50cf\u7684\u6570\u91cf\u300d\u3002\u5982\u679c\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6570\u91cf\u8d85\u8fc7\u6b64\u6570\u91cf\uff0c\u591a\u4f59\u7684\u6b63\u5219\u5316\u56fe\u50cf\u5c06\u4e0d\u88ab\u4f7f\u7528\u3002\uff09","title":"\u5173\u4e8e\u91cd\u590d\u6b21\u6570"},{"location":"sd-scripts-docs/train/#3","text":"\u8bf7\u53c2\u8003\u5404\u81ea\u7684\u6587\u6863\u8fdb\u884c\u8bad\u7ec3\u3002","title":"\u6b65\u9aa4 3. \u8fdb\u884c\u8bad\u7ec3"},{"location":"sd-scripts-docs/train/#dreambooth","text":"\u5728\u8fd9\u79cd\u65b9\u5f0f\u4e2d\uff0c\u6bcf\u5f20\u56fe\u50cf\u90fd\u901a\u8fc7\u5b57\u5e55\u8fdb\u884c\u8bad\u7ec3\u3002","title":"DreamBooth\u3001\u5b57\u5e55\u65b9\u5f0f\uff08\u53ef\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff09"},{"location":"sd-scripts-docs/train/#1","text":"\u5728\u5305\u542b\u8bad\u7ec3\u56fe\u50cf\u7684\u6587\u4ef6\u5939\u4e2d\uff0c\u4e3a\u6bcf\u5f20\u56fe\u50cf\u521b\u5efa\u4e00\u4e2a\u5177\u6709\u76f8\u540c\u6587\u4ef6\u540d\u7684\u6587\u4ef6\uff0c\u6269\u5c55\u540d\u4e3a .caption \uff08\u53ef\u901a\u8fc7\u8bbe\u7f6e\u66f4\u6539\uff09\u3002\u6bcf\u4e2a\u6587\u4ef6\u5e94\u4ec5\u5305\u542b\u4e00\u884c\u6587\u672c\u3002\u7f16\u7801\u4e3a UTF-8 \u3002","title":"\u6b65\u9aa4 1. \u51c6\u5907\u5b57\u5e55\u6587\u4ef6"},{"location":"sd-scripts-docs/train/#2_2","text":"\u4e0e\u7c7b+\u6807\u8bc6\u7b26\u5f62\u5f0f\u76f8\u540c\u3002\u540c\u6837\uff0c\u53ef\u4ee5\u4e3a\u6b63\u5219\u5316\u56fe\u50cf\u6dfb\u52a0\u5b57\u5e55\uff0c\u4f46\u901a\u5e38\u4e0d\u9700\u8981\u3002","title":"\u6b65\u9aa4 2. \u786e\u5b9a\u662f\u5426\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\uff0c\u5e76\u751f\u6210\u6b63\u5219\u5316\u56fe\u50cf\uff08\u5982\u679c\u4f7f\u7528\uff09"},{"location":"sd-scripts-docs/train/#2_3","text":"\u521b\u5efa\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\uff0c\u5c06\u5176\u6269\u5c55\u540d\u6539\u4e3a .toml \u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u65b9\u5f0f\u7f16\u5199\uff1a [general] enable_bucket = true # \u662f\u5426\u4f7f\u7528\u5bbd\u9ad8\u6bd4\u6876 [[datasets]] resolution = 512 # \u8bad\u7ec3\u5206\u8fa8\u7387 batch_size = 4 # \u6279\u6b21\u5927\u5c0f [[datasets.subsets]] image_dir = 'C:\\hoge' # \u6307\u5b9a\u5305\u542b\u8bad\u7ec3\u56fe\u50cf\u7684\u6587\u4ef6\u5939 caption_extension = '.caption' # \u5b57\u5e55\u6587\u4ef6\u7684\u6269\u5c55\u540d\u3002\u5982\u679c\u4f7f\u7528 .txt\uff0c\u8bf7\u66f4\u6539\u6b64\u5904 num_repeats = 10 # \u8bad\u7ec3\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570 # \u4ee5\u4e0b\u4ec5\u5728\u9700\u8981\u6b63\u5219\u5316\u56fe\u50cf\u65f6\u63cf\u8ff0\u3002\u5982\u679c\u4e0d\u4f7f\u7528\uff0c\u8bf7\u5220\u9664 [[datasets.subsets]] is_reg = true image_dir = 'C:\\reg' # \u6307\u5b9a\u5305\u542b\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6587\u4ef6\u5939 class_tokens = 'girl' # \u6307\u5b9a\u7c7b num_repeats = 1 # \u6b63\u5219\u5316\u56fe\u50cf\u7684\u91cd\u590d\u6b21\u6570\uff0c\u57fa\u672c\u4e0a\u4e3a1\u5373\u53ef \u57fa\u672c\u4e0a\uff0c\u53ea\u9700\u66f4\u6539\u4ee5\u4e0b\u4f4d\u7f6e\u5373\u53ef\u8fdb\u884c\u8bad\u7ec3\u3002\u6ca1\u6709\u7279\u522b\u8bf4\u660e\u7684\u90e8\u5206\u4e0e\u7c7b+\u6807\u8bc6\u7b26\u65b9\u5f0f\u76f8\u540c\u3002 \u8bad\u7ec3\u5206\u8fa8\u7387 \u6279\u6b21\u5927\u5c0f \u6587\u4ef6\u5939\u6307\u5b9a \u5b57\u5e55\u6587\u4ef6\u7684\u6269\u5c55\u540d \u53ef\u4ee5\u6307\u5b9a\u4efb\u610f\u6269\u5c55\u540d\u3002 5. \u91cd\u590d\u6b21\u6570","title":"\u6b65\u9aa4 2. \u7f16\u5199\u914d\u7f6e\u6587\u4ef6"},{"location":"sd-scripts-docs/train/#3_1","text":"\u8bf7\u53c2\u8003\u5404\u81ea\u7684\u6587\u6863\u8fdb\u884c\u8bad\u7ec3\u3002","title":"\u6b65\u9aa4 3. \u8fdb\u884c\u8bad\u7ec3"},{"location":"sd-scripts-docs/train/#_7","text":"","title":"\u5fae\u8c03\u65b9\u5f0f"},{"location":"sd-scripts-docs/train/#1_1","text":"\u5c06\u5b57\u5e55\u548c\u6807\u7b7e\u6c47\u603b\u7684\u7ba1\u7406\u6587\u4ef6\u79f0\u4e3a\u5143\u6570\u636e\u3002\u91c7\u7528 json \u683c\u5f0f\uff0c\u6269\u5c55\u540d\u4e3a .json \u3002\u521b\u5efa\u65b9\u6cd5\u8f83\u957f\uff0c\u5df2\u5728\u672c\u6587\u6863\u672b\u5c3e\u8bf4\u660e\u3002","title":"\u6b65\u9aa4 1. \u51c6\u5907\u5143\u6570\u636e"},{"location":"sd-scripts-docs/train/#2_4","text":"\u521b\u5efa\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u6269\u5c55\u540d\u6539\u4e3a .toml \u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u8fd9\u6837\u7f16\u5199\uff1a [general] shuffle_caption = true keep_tokens = 1 [[datasets]] resolution = 512 # \u5b66\u4e60\u5206\u8fa8\u7387 batch_size = 4 # \u6279\u6b21\u5927\u5c0f [[datasets.subsets]] image_dir = 'C:\\piyo' # \u6307\u5b9a\u5305\u542b\u5b66\u4e60\u7528\u56fe\u50cf\u7684\u6587\u4ef6\u5939 metadata_file = 'C:\\piyo\\piyo_md.json' # \u5143\u6570\u636e\u6587\u4ef6\u540d \u57fa\u672c\u4e0a\uff0c\u53ea\u9700\u66f4\u6539\u4ee5\u4e0b\u4f4d\u7f6e\u5373\u53ef\u8fdb\u884c\u5b66\u4e60\u3002\u6ca1\u6709\u7279\u522b\u8bf4\u660e\u7684\u90e8\u5206\u4e0eDreamBooth\u3001class+identifier\u65b9\u5f0f\u76f8\u540c\u3002 \u5b66\u4e60\u5206\u8fa8\u7387 \u6279\u6b21\u5927\u5c0f \u6587\u4ef6\u5939\u6307\u5b9a \u5143\u6570\u636e\u6587\u4ef6\u540d \u6307\u5b9a\u901a\u8fc7\u540e\u8ff0\u65b9\u6cd5\u521b\u5efa\u7684\u5143\u6570\u636e\u6587\u4ef6\u3002","title":"\u6b65\u9aa42. \u7f16\u5199\u8bbe\u5b9a\u6587\u4ef6"},{"location":"sd-scripts-docs/train/#3_2","text":"\u8bf7\u53c2\u8003\u5404\u81ea\u7684\u6587\u6863\u8fdb\u884c\u5b66\u4e60\u3002","title":"\u6b65\u9aa43. \u5f00\u59cb\u5b66\u4e60"},{"location":"sd-scripts-docs/train/#_8","text":"\u8fd9\u91cc\u7701\u7565\u4e86\u7ec6\u8282\uff0c\u6211\u4e5f\u4e0d\u662f\u5b8c\u5168\u7406\u89e3\uff0c\u8bf7\u81ea\u884c\u67e5\u9605\u76f8\u5173\u8d44\u6599\u3002","title":"\u5b66\u4e60\u4e2d\u4f7f\u7528\u7684\u672f\u8bed\u7b80\u8981\u8bf4\u660e"},{"location":"sd-scripts-docs/train/#fine-tuning","text":"\u6307\u5bf9\u6a21\u578b\u8fdb\u884c\u5b66\u4e60\u548c\u5fae\u8c03\u3002\u5728Stable Diffusion\u4e2d\uff0c\u72ed\u4e49\u7684fine tuning\u662f\u6307\u7528\u56fe\u50cf\u548c\u6807\u9898\u5bf9\u6a21\u578b\u8fdb\u884c\u5b66\u4e60\u3002DreamBooth\u53ef\u4ee5\u8bf4\u662f\u72ed\u4e49\u7684fine tuning\u7684\u4e00\u79cd\u7279\u6b8a\u65b9\u5f0f\u3002\u5e7f\u4e49\u7684fine tuning\u5305\u62ecLoRA\u3001Textual Inversion\u3001Hypernetworks\u7b49\uff0c\u6db5\u76d6\u4e86\u6240\u6709\u6a21\u578b\u5b66\u4e60\u7684\u8303\u7574\u3002","title":"\u5fae\u8c03\uff08fine tuning\uff09"},{"location":"sd-scripts-docs/train/#step","text":"\u7c97\u7565\u5730\u8bf4\uff0c\u7528\u5b66\u4e60\u6570\u636e\u8ba1\u7b97\u4e00\u6b21\u5c31\u662f\u4e00\u4e2a\u6b65\u9aa4\u3002\u201c\u5c06\u5b66\u4e60\u6570\u636e\u7684\u6807\u9898\u8f93\u5165\u5230\u5f53\u524d\u6a21\u578b\u4e2d\uff0c\u751f\u6210\u56fe\u50cf\u5e76\u5c06\u5176\u4e0e\u5b66\u4e60\u6570\u636e\u7684\u56fe\u50cf\u8fdb\u884c\u6bd4\u8f83\uff0c\u7136\u540e\u5bf9\u6a21\u578b\u8fdb\u884c\u5fae\u5c0f\u7684\u8c03\u6574\uff0c\u4f7f\u5176\u66f4\u63a5\u8fd1\u5b66\u4e60\u6570\u636e\u201d\uff0c\u8fd9\u5c31\u662f\u4e00\u4e2a\u6b65\u9aa4\u3002","title":"\u6b65\u9aa4\uff08step\uff09"},{"location":"sd-scripts-docs/train/#batch-size","text":"\u6279\u6b21\u5927\u5c0f\u662f\u6307\u5728\u4e00\u4e2a\u6b65\u9aa4\u4e2d\u540c\u65f6\u8ba1\u7b97\u7684\u6570\u636e\u6570\u91cf\u3002\u6279\u91cf\u8ba1\u7b97\u53ef\u4ee5\u76f8\u5bf9\u63d0\u9ad8\u901f\u5ea6\uff0c\u800c\u4e14\u4e00\u822c\u8ba4\u4e3a\u7cbe\u5ea6\u4e5f\u4f1a\u63d0\u9ad8\u3002 \u6279\u6b21\u5927\u5c0f \u00d7 \u6b65\u9aa4\u6570 \u7b49\u4e8e\u7528\u4e8e\u5b66\u4e60\u7684\u6570\u636e\u6570\u91cf\u3002\u56e0\u6b64\uff0c\u5982\u679c\u589e\u52a0\u6279\u6b21\u5927\u5c0f\uff0c\u6700\u597d\u76f8\u5e94\u5730\u51cf\u5c11\u6b65\u9aa4\u6570\u3002 \uff08\u4f46\u662f\uff0c\u4f8b\u5982\u201c\u6279\u6b21\u5927\u5c0f\u4e3a1\uff0c1600\u6b65\u201d\u548c\u201c\u6279\u6b21\u5927\u5c0f\u4e3a4\uff0c400\u6b65\u201d\u4e0d\u4f1a\u5f97\u5230\u76f8\u540c\u7684\u7ed3\u679c\u3002\u5982\u679c\u5b66\u4e60\u7387\u76f8\u540c\uff0c\u4e00\u822c\u6765\u8bf4\u540e\u8005\u4f1a\u5bfc\u81f4\u5b66\u4e60\u4e0d\u8db3\u3002\u53ef\u4ee5\u7a0d\u5fae\u63d0\u9ad8\u5b66\u4e60\u7387\uff08\u4f8b\u5982 2e-6 \uff09\uff0c\u6216\u8005\u5c06\u6b65\u9aa4\u6570\u589e\u52a0\u5230500\u6b65\u7b49\u8fdb\u884c\u8c03\u6574\u3002\uff09 \u589e\u52a0\u6279\u6b21\u5927\u5c0f\u4f1a\u76f8\u5e94\u5730\u6d88\u8017\u66f4\u591a\u7684GPU\u5185\u5b58\u3002\u5982\u679c\u5185\u5b58\u4e0d\u8db3\uff0c\u4f1a\u5bfc\u81f4\u9519\u8bef\uff0c\u800c\u4e14\u5373\u4f7f\u6ca1\u6709\u9519\u8bef\uff0c\u4e5f\u4f1a\u964d\u4f4e\u5b66\u4e60\u901f\u5ea6\u3002\u53ef\u4ee5\u901a\u8fc7\u4efb\u52a1\u7ba1\u7406\u5668\u6216 nvidia-smi \u547d\u4ee4\u67e5\u770b\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u8fdb\u884c\u8c03\u6574\u3002 \u987a\u4fbf\u8bf4\u4e00\u4e0b\uff0c\u201cbatch\u201d\u5927\u81f4\u610f\u5473\u7740\u201c\u4e00\u6279\u6570\u636e\u201d\u3002","title":"\u6279\u6b21\u5927\u5c0f\uff08batch size\uff09"},{"location":"sd-scripts-docs/train/#learning-rate","text":"\u7c97\u7565\u5730\u8bf4\uff0c\u5b66\u4e60\u7387\u8868\u793a\u6bcf\u4e2a\u6b65\u9aa4\u6a21\u578b\u53d8\u5316\u7684\u7a0b\u5ea6\u3002\u6307\u5b9a\u8f83\u5927\u7684\u503c\u53ef\u4ee5\u52a0\u5feb\u5b66\u4e60\u901f\u5ea6\uff0c\u4f46\u4e5f\u53ef\u80fd\u5bfc\u81f4\u6a21\u578b\u8fc7\u5ea6\u53d8\u5316\u800c\u635f\u574f\uff0c\u6216\u8005\u65e0\u6cd5\u8fbe\u5230\u6700\u4f73\u72b6\u6001\u3002\u6307\u5b9a\u8f83\u5c0f\u7684\u503c\u4f1a\u51cf\u6162\u5b66\u4e60\u901f\u5ea6\uff0c\u4e5f\u53ef\u80fd\u65e0\u6cd5\u8fbe\u5230\u6700\u4f73\u72b6\u6001\u3002 fine tuning\u3001DreamBooth\u3001LoRA\u7684\u5b66\u4e60\u7387\u5404\u4e0d\u76f8\u540c\uff0c\u800c\u4e14\u8fd8\u4f1a\u53d7\u5230\u5b66\u4e60\u6570\u636e\u3001\u6a21\u578b\u3001\u6279\u6b21\u5927\u5c0f\u548c\u6b65\u9aa4\u6570\u7684\u5f71\u54cd\u3002\u53ef\u4ee5\u4ece\u4e00\u822c\u503c\u5f00\u59cb\uff0c\u6839\u636e\u5b66\u4e60\u72b6\u6001\u8fdb\u884c\u8c03\u6574\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6574\u4e2a\u5b66\u4e60\u8fc7\u7a0b\u4e2d\u7684\u5b66\u4e60\u7387\u662f\u56fa\u5b9a\u7684\u3002\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u8c03\u5ea6\u5668\u6765\u51b3\u5b9a\u5b66\u4e60\u7387\u5982\u4f55\u53d8\u5316\uff0c\u8fd9\u4e5f\u4f1a\u5f71\u54cd\u7ed3\u679c\u3002","title":"\u5b66\u4e60\u7387\uff08learning rate\uff09"},{"location":"sd-scripts-docs/train/#epoch","text":"\u5f53\u5b66\u4e60\u6570\u636e\u88ab\u5b8c\u6574\u5730\u5b66\u4e60\u4e00\u904d\uff08\u6570\u636e\u5faa\u73af\u4e00\u904d\uff09\u65f6\uff0c\u5c31\u79f0\u4e3a\u4e00\u4e2aepoch\u3002\u5982\u679c\u6307\u5b9a\u4e86\u91cd\u590d\u6b21\u6570\uff0c\u90a3\u4e48\u5728\u91cd\u590d\u540e\u7684\u6570\u636e\u5faa\u73af\u4e00\u904d\u4e5f\u79f0\u4e3a\u4e00\u4e2aepoch\u3002 \u4e00\u4e2aepoch\u7684\u6b65\u9aa4\u6570\u57fa\u672c\u4e0a\u662f \u6570\u636e\u6570\u91cf \u00f7 \u6279\u6b21\u5927\u5c0f \uff0c\u4f46\u5728\u4f7f\u7528Aspect Ratio Bucketing\u65f6\uff0c\u6b65\u9aa4\u6570\u4f1a\u7565\u5fae\u589e\u52a0\uff08\u56e0\u4e3a\u4e0d\u540cbucket\u7684\u6570\u636e\u4e0d\u80fd\u653e\u5728\u540c\u4e00\u4e2a\u6279\u6b21\u4e2d\uff09\u3002","title":"\u5468\u671f\uff08epoch\uff09"},{"location":"sd-scripts-docs/train/#aspect-ratio-bucketing","text":"Stable Diffusion v1\u662f\u5728512\u00d7512\u5206\u8fa8\u7387\u4e0b\u8bad\u7ec3\u7684\uff0c\u4f46\u9664\u4e86\u8fd9\u4e2a\u5206\u8fa8\u7387\uff0c\u8fd8\u4f1a\u5728256\u00d71024\u3001384\u00d7640\u7b49\u5176\u4ed6\u5206\u8fa8\u7387\u4e0b\u8fdb\u884c\u8bad\u7ec3\u3002\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u56fe\u50cf\u7684\u88c1\u526a\uff0c\u66f4\u51c6\u786e\u5730\u5b66\u4e60\u6807\u9898\u548c\u56fe\u50cf\u4e4b\u95f4\u7684\u5173\u7cfb\u3002 \u6b64\u5916\uff0c\u7531\u4e8e\u53ef\u4ee5\u5728\u4efb\u610f\u5206\u8fa8\u7387\u4e0b\u8fdb\u884c\u8bad\u7ec3\uff0c\u56e0\u6b64\u65e0\u9700\u4e8b\u5148\u7edf\u4e00\u56fe\u50cf\u6570\u636e\u7684\u5bbd\u9ad8\u6bd4\u3002 \u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u542f\u7528\u6216\u7981\u7528\u8be5\u529f\u80fd\uff0c\u5728\u4e0a\u8ff0\u8bbe\u5b9a\u6587\u4ef6\u7684\u4f8b\u5b50\u4e2d\u662f\u542f\u7528\u7684\uff08\u8bbe\u7f6e\u4e3a true \uff09\u3002 \u5b66\u4e60\u5206\u8fa8\u7387\u4f1a\u5728\u4e0d\u8d85\u8fc7\u7ed9\u5b9a\u53c2\u6570\u7684\u9762\u79ef\uff08\u5373\u5185\u5b58\u4f7f\u7528\u91cf\uff09\u7684\u8303\u56f4\u5185\uff0c\u4ee564\u50cf\u7d20\u4e3a\u5355\u4f4d\uff08\u9ed8\u8ba4\uff0c\u53ef\u66f4\u6539\uff09\u8fdb\u884c\u8c03\u6574\u548c\u751f\u6210\u3002 \u5728\u673a\u5668\u5b66\u4e60\u4e2d\uff0c\u901a\u5e38\u9700\u8981\u7edf\u4e00\u8f93\u5165\u6570\u636e\u7684\u5927\u5c0f\uff0c\u4f46\u5b9e\u9645\u4e0a\uff0c\u53ea\u8981\u5728\u540c\u4e00\u4e2a\u6279\u6b21\u5185\u4fdd\u6301\u4e00\u81f4\u5373\u53ef\u3002NovelAI\u6240\u8bf4\u7684bucketing\u4f3c\u4e4e\u662f\u6307\u4e8b\u5148\u6839\u636e\u5b66\u4e60\u6570\u636e\u7684\u5bbd\u9ad8\u6bd4\u5c06\u5176\u5206\u7c7b\u5230\u4e0d\u540c\u7684\u5b66\u4e60\u5206\u8fa8\u7387\u4e2d\uff0c\u7136\u540e\u5728\u6bcf\u4e2abucket\u5185\u521b\u5efa\u6279\u6b21\uff0c\u4ee5\u4fdd\u6301\u6279\u6b21\u5185\u56fe\u50cf\u5927\u5c0f\u7684\u4e00\u81f4\u3002","title":"\u5bbd\u9ad8\u6bd4\u5206\u6876\uff08Aspect Ratio Bucketing\uff09"},{"location":"sd-scripts-docs/train/#_9","text":"\u8fd9\u91cc\u4ecb\u7ecd\u4e0d\u4f7f\u7528 .toml \u6587\u4ef6\uff0c\u800c\u662f\u901a\u8fc7\u547d\u4ee4\u884c\u9009\u9879\u8fdb\u884c\u6307\u5b9a\u7684\u65b9\u6cd5\u3002\u6709DreamBooth class+identifier\u65b9\u5f0f\u3001DreamBooth\u6807\u9898\u65b9\u5f0f\u548cfine tuning\u65b9\u5f0f\u3002","title":"\u65e7\u7684\u6307\u5b9a\u5f62\u5f0f\uff08\u4e0d\u4f7f\u7528\u8bbe\u5b9a\u6587\u4ef6\uff0c\u76f4\u63a5\u901a\u8fc7\u547d\u4ee4\u884c\u6307\u5b9a\uff09"},{"location":"sd-scripts-docs/train/#dreamboothclassidentifier_1","text":"\u901a\u8fc7\u6587\u4ef6\u5939\u540d\u79f0\u6307\u5b9a\u91cd\u590d\u6b21\u6570\uff0c\u5e76\u4f7f\u7528 train_data_dir \u9009\u9879\u548c reg_data_dir \u9009\u9879\u3002","title":"DreamBooth\u3001class+identifier\u65b9\u5f0f"},{"location":"sd-scripts-docs/train/#1_2","text":"\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u5939\u7528\u4e8e\u5b58\u653e\u5b66\u4e60\u7528\u56fe\u50cf\u3002 \u7136\u540e\u5728\u8be5\u6587\u4ef6\u5939\u5185 \uff0c\u6309\u7167\u4ee5\u4e0b\u683c\u5f0f\u521b\u5efa\u5b50\u6587\u4ef6\u5939\uff1a <\u91cd\u590d\u6b21\u6570>_<identifier> <class> \u6ce8\u610f\u4e0d\u8981\u5fd8\u8bb0\u4e2d\u95f4\u7684 _ \u3002 \u4f8b\u5982\uff0c\u5982\u679c\u8981\u4f7f\u7528\u201csls frog\u201d\u4f5c\u4e3a\u63d0\u793a\u8bcd\uff0c\u5e76\u91cd\u590d\u6570\u636e20\u6b21\uff0c\u5219\u6587\u4ef6\u5939\u540d\u4e3a\u201c20_sls frog\u201d\u3002\u5982\u4e0b\u6240\u793a\uff1a","title":"\u6b65\u9aa41. \u51c6\u5907\u5b66\u4e60\u7528\u56fe\u50cf"},{"location":"sd-scripts-docs/train/#identifier","text":"\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u5728\u8bad\u7ec3\u56fe\u50cf\u6587\u4ef6\u5939\u5185\u521b\u5efa\u591a\u4e2a\u540d\u4e3a \u91cd\u590d\u6b21\u6570_<identifier> <class> \u7684\u6587\u4ef6\u5939\uff0c\u5e76\u5728\u6b63\u5219\u5316\u56fe\u50cf\u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u591a\u4e2a\u540d\u4e3a \u91cd\u590d\u6b21\u6570_<class> \u7684\u6587\u4ef6\u5939\u3002 \u4f8b\u5982\uff0c\u8981\u540c\u65f6\u5b66\u4e60\u201csls frog\u201d\u548c\u201ccpc rabbit\u201d\uff0c\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u8bbe\u7f6e\uff1a \u5982\u679c\u7c7b\u522b\u53ea\u6709\u4e00\u4e2a\uff0c\u4f46\u5bf9\u8c61\u6709\u591a\u4e2a\uff0c\u5219\u6b63\u5219\u5316\u56fe\u50cf\u6587\u4ef6\u5939\u53ef\u4ee5\u53ea\u6709\u4e00\u4e2a\u3002\u4f8b\u5982\uff0c\u5982\u679c1girl\u6709\u4e24\u4e2a\u89d2\u8272A\u548cB\uff0c\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u8bbe\u7f6e\uff1a train_girls 10_sls 1girl 10_cpc 1girl reg_girls 1_1girl","title":"\u591a\u7c7b\u522b\u3001\u591a\u5bf9\u8c61\uff08identifier\uff09\u5b66\u4e60"},{"location":"sd-scripts-docs/train/#2_5","text":"\u4f7f\u7528\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6b65\u9aa4\u5982\u4e0b\uff1a \u521b\u5efa\u4e00\u4e2a\u5b58\u50a8\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6587\u4ef6\u5939\uff0c\u5e76\u5728\u5176\u4e2d\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a <\u91cd\u590d\u6b21\u6570>_<class> \u7684\u76ee\u5f55\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u4f7f\u7528\u201cfrog\u201d\u4f5c\u4e3a\u63d0\u793a\u8bcd\uff0c\u5e76\u4e14\u6570\u636e\u4e0d\u91cd\u590d\uff08\u53ea\u91cd\u590d\u4e00\u6b21\uff09\uff0c\u5219\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u8bbe\u7f6e\uff1a","title":"\u6b65\u9aa42\uff1a\u51c6\u5907\u6b63\u5219\u5316\u56fe\u50cf"},{"location":"sd-scripts-docs/train/#3_3","text":"\u8fd0\u884c\u5404\u4e2a\u8bad\u7ec3\u811a\u672c\u3002\u4f7f\u7528 --train_data_dir \u9009\u9879\u6307\u5b9a\u4e0a\u8ff0\u8bad\u7ec3\u6570\u636e\u7684\u6587\u4ef6\u5939\uff08 \u4e0d\u662f\u5305\u542b\u56fe\u50cf\u7684\u6587\u4ef6\u5939\uff0c\u800c\u662f\u5176\u7236\u6587\u4ef6\u5939 \uff09\uff0c\u4f7f\u7528 --reg_data_dir \u9009\u9879\u6307\u5b9a\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6587\u4ef6\u5939\uff08 \u4e0d\u662f\u5305\u542b\u56fe\u50cf\u7684\u6587\u4ef6\u5939\uff0c\u800c\u662f\u5176\u7236\u6587\u4ef6\u5939 \uff09\u3002","title":"\u6b65\u9aa43\uff1a\u6267\u884c\u8bad\u7ec3"},{"location":"sd-scripts-docs/train/#dreambooth_1","text":"\u5728\u8bad\u7ec3\u56fe\u50cf\u548c\u6b63\u5219\u5316\u56fe\u50cf\u7684\u6587\u4ef6\u5939\u4e2d\uff0c\u5982\u679c\u5b58\u5728\u4e0e\u56fe\u50cf\u6587\u4ef6\u540c\u540d\u3001\u6269\u5c55\u540d\u4e3a.caption\uff08\u53ef\u901a\u8fc7\u9009\u9879\u66f4\u6539\uff09\u7684\u6587\u4ef6\uff0c\u5219\u4f1a\u4ece\u8be5\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6807\u9898\u5e76\u4f5c\u4e3a\u63d0\u793a\u8bcd\u8fdb\u884c\u8bad\u7ec3\u3002 \u203b\u8fd9\u4e9b\u56fe\u50cf\u7684\u8bad\u7ec3\u5c06\u4e0d\u518d\u4f7f\u7528\u6587\u4ef6\u5939\u540d\uff08identifier class\uff09\u3002 \u6807\u9898\u6587\u4ef6\u7684\u6269\u5c55\u540d\u9ed8\u8ba4\u4e3a.caption\u3002\u53ef\u4ee5\u4f7f\u7528\u8bad\u7ec3\u811a\u672c\u7684 --caption_extension \u9009\u9879\u8fdb\u884c\u66f4\u6539\u3002\u4f7f\u7528 --shuffle_caption \u9009\u9879\u53ef\u4ee5\u5728\u8bad\u7ec3\u65f6\u5bf9\u4ee5\u9017\u53f7\u5206\u9694\u7684\u5404\u4e2a\u90e8\u5206\u8fdb\u884c\u968f\u673a\u6392\u5e8f\u3002","title":"DreamBooth\u3001\u6807\u9898\u65b9\u5f0f"},{"location":"sd-scripts-docs/train/#_10","text":"\u76f4\u5230\u521b\u5efa\u5143\u6570\u636e\u7684\u8fc7\u7a0b\u90fd\u4e0e\u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\u65f6\u76f8\u540c\u3002\u4f7f\u7528 in_json \u9009\u9879\u6307\u5b9a\u5143\u6570\u636e\u6587\u4ef6\u3002","title":"\u5fae\u8c03\u65b9\u5f0f"},{"location":"sd-scripts-docs/train/#_11","text":"\u53ef\u4ee5\u4f7f\u7528\u8bad\u7ec3\u4e2d\u7684\u6a21\u578b\u5c1d\u8bd5\u751f\u6210\u56fe\u50cf\uff0c\u4ee5\u786e\u8ba4\u8bad\u7ec3\u8fdb\u5ea6\u3002\u5728\u8bad\u7ec3\u811a\u672c\u4e2d\u6307\u5b9a\u4ee5\u4e0b\u9009\u9879\uff1a --sample_every_n_steps / --sample_every_n_epochs \u6307\u5b9a\u6bcf\u9694\u591a\u5c11\u6b65\u9aa4\u6216\u591a\u5c11epoch\u8fdb\u884c\u4e00\u6b21\u793a\u4f8b\u8f93\u51fa\u3002\u5982\u679c\u540c\u65f6\u6307\u5b9a\uff0c\u5219\u4f18\u5148\u4f7f\u7528epoch\u3002 --sample_at_first \u5728\u8bad\u7ec3\u5f00\u59cb\u524d\u8fdb\u884c\u793a\u4f8b\u8f93\u51fa\u3002\u53ef\u4ee5\u4e0e\u8bad\u7ec3\u524d\u7684\u7ed3\u679c\u8fdb\u884c\u6bd4\u8f83\u3002 --sample_prompts \u6307\u5b9a\u793a\u4f8b\u8f93\u51fa\u63d0\u793a\u8bcd\u7684\u6587\u4ef6\u3002 --sample_sampler \u6307\u5b9a\u7528\u4e8e\u793a\u4f8b\u8f93\u51fa\u7684\u91c7\u6837\u5668\u3002 \u53ef\u9009\u503c\u4e3a 'ddim', 'pndm', 'heun', 'dpmsolver', 'dpmsolver++', 'dpmsingle', 'k_lms', 'k_euler', 'k_euler_a', 'k_dpm_2', 'k_dpm_2_a' \u3002 \u8981\u8fdb\u884c\u793a\u4f8b\u8f93\u51fa\uff0c\u9700\u8981\u4e8b\u5148\u51c6\u5907\u4e00\u4e2a\u5305\u542b\u63d0\u793a\u8bcd\u7684\u6587\u672c\u6587\u4ef6\u3002\u6bcf\u884c\u5199\u4e00\u4e2a\u63d0\u793a\u8bcd\u3002 \u4f8b\u5982\uff0c\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u8bbe\u7f6e\uff1a # \u63d0\u793a\u8bcd1 masterpiece, best quality, 1girl, in white shirts, upper body, looking at viewer, simple background --n low quality, worst quality, bad anatomy,bad composition, poor, low effort --w 768 --h 768 --d 1 --l 7.5 --s 28 # \u63d0\u793a\u8bcd2 masterpiece, best quality, 1boy, in business suit, standing at street, looking back --n low quality, worst quality, bad anatomy,bad composition, poor, low effort --w 576 --h 832 --d 2 --l 5.5 --s 40 \u4ee5 # \u5f00\u5934\u7684\u884c\u662f\u6ce8\u91ca\u3002\u4ee5 -- \u5f00\u5934\u7684\u90e8\u5206\uff08\u5982 --n \uff09\u53ef\u4ee5\u6307\u5b9a\u751f\u6210\u56fe\u50cf\u7684\u9009\u9879\u3002\u4ee5\u4e0b\u9009\u9879\u53ef\u7528\uff1a --n \u5c06\u4e4b\u540e\u7684\u9009\u9879\u89c6\u4e3a\u8d1f\u9762\u63d0\u793a\u8bcd\uff0c\u76f4\u5230\u4e0b\u4e00\u4e2a -- \u9009\u9879\u3002 --w \u6307\u5b9a\u751f\u6210\u56fe\u50cf\u7684\u5bbd\u5ea6\u3002 --h \u6307\u5b9a\u751f\u6210\u56fe\u50cf\u7684\u9ad8\u5ea6\u3002 --d \u6307\u5b9a\u751f\u6210\u56fe\u50cf\u7684\u79cd\u5b50\u3002 --l \u6307\u5b9a\u751f\u6210\u56fe\u50cf\u7684CFG scale\u3002 --s \u6307\u5b9a\u751f\u6210\u56fe\u50cf\u7684\u6b65\u6570\u3002","title":"\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u7684\u793a\u4f8b\u8f93\u51fa"},{"location":"sd-scripts-docs/train/#_12","text":"\u811a\u672c\u66f4\u65b0\u540e\uff0c\u6587\u6863\u53ef\u80fd\u6ca1\u6709\u53ca\u65f6\u66f4\u65b0\u3002\u5982\u679c\u9700\u8981\u67e5\u770b\u53ef\u7528\u9009\u9879\uff0c\u8bf7\u4f7f\u7528 --help \u9009\u9879\u3002","title":"\u5404\u811a\u672c\u4e2d\u5e38\u89c1\u7684\u5e38\u7528\u9009\u9879"},{"location":"sd-scripts-docs/train/#_13","text":"--v2 / --v_parameterization \u5982\u679c\u8981\u4f7f\u7528Hugging Face\u7684stable-diffusion-2-base\u6216\u4ece\u5b83\u6d3e\u751f\u7684\u5fae\u8c03\u6a21\u578b\uff08\u5728\u63a8\u7406\u65f6\u9700\u8981\u4f7f\u7528 v2-inference.yaml \u7684\u6a21\u578b\uff09\uff0c\u8bf7\u4f7f\u7528 --v2 \u9009\u9879\u3002\u5982\u679c\u8981\u4f7f\u7528stable-diffusion-2\u6216768-v-ema.ckpt\u53ca\u5176\u5fae\u8c03\u6a21\u578b\uff08\u5728\u63a8\u7406\u65f6\u9700\u8981\u4f7f\u7528 v2-inference-v.yaml \u7684\u6a21\u578b\uff09\uff0c\u8bf7\u540c\u65f6\u4f7f\u7528 --v2 \u548c --v_parameterization \u9009\u9879\u3002 Stable Diffusion 2.0\u7684\u4e3b\u8981\u53d8\u5316\u5982\u4e0b\uff1a \u4f7f\u7528\u7684Tokenizer \u4f7f\u7528\u7684Text Encoder\u4ee5\u53ca\u4f7f\u7528\u7684\u8f93\u51fa\u5c42\uff082.0\u4f7f\u7528\u5012\u6570\u7b2c\u4e8c\u5c42\uff09 Text Encoder\u7684\u8f93\u51fa\u7ef4\u5ea6\uff08768->1024\uff09 U-Net\u7684\u7ed3\u6784\uff08CrossAttention\u7684\u5934\u6570\u7b49\uff09 v-parameterization\uff08\u91c7\u6837\u65b9\u6cd5\u4f3c\u4e4e\u5df2\u66f4\u6539\uff09 \u5176\u4e2d\uff0cbase\u7248\u672c\u91c7\u7528\u4e861\uff5e4\u7684\u53d8\u5316\uff0c\u800c\u975ebase\u7248\u672c\uff08768-v\uff09\u91c7\u7528\u4e861\uff5e5\u7684\u53d8\u5316\u3002 --v2 \u9009\u9879\u542f\u75281\uff5e4\u7684\u53d8\u5316\uff0c --v_parameterization \u9009\u9879\u542f\u75285\u7684\u53d8\u5316\u3002 --pretrained_model_name_or_path \u6307\u5b9a\u7528\u4e8e\u8fdb\u884c\u989d\u5916\u8bad\u7ec3\u7684\u57fa\u7840\u6a21\u578b\u3002\u53ef\u4ee5\u6307\u5b9aStable Diffusion\u7684checkpoint\u6587\u4ef6\uff08.ckpt\u6216.safetensors\uff09\u3001Diffusers\u7684\u672c\u5730\u78c1\u76d8\u4e0a\u7684\u6a21\u578b\u76ee\u5f55\u6216Diffusers\u7684\u6a21\u578bID\uff08\u4f8b\u5982\"stabilityai/stable-diffusion-2\"\uff09\u3002","title":"\u6307\u5b9a\u8bad\u7ec3\u4f7f\u7528\u7684\u6a21\u578b"},{"location":"sd-scripts-docs/train/#_14","text":"--output_dir \u6307\u5b9a\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u4fdd\u5b58\u7684\u6587\u4ef6\u5939\u3002 --output_name \u6307\u5b9a\u6a21\u578b\u7684\u6587\u4ef6\u540d\uff0c\u4e0d\u5305\u542b\u6269\u5c55\u540d\u3002 --dataset_config \u6307\u5b9a\u5305\u542b\u6570\u636e\u96c6\u914d\u7f6e\u7684 .toml \u6587\u4ef6\u3002 --max_train_steps / --max_train_epochs \u6307\u5b9a\u8bad\u7ec3\u7684\u6b65\u6570\u6216 epoch \u6570\u3002\u5982\u679c\u540c\u65f6\u6307\u5b9a\uff0c\u5219 epoch \u6570\u7684\u4f18\u5148\u7ea7\u66f4\u9ad8\u3002 --mixed_precision \u4e3a\u4e86\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff0c\u4ee5\u6df7\u5408\u7cbe\u5ea6\uff08mixed precision\uff09\u8fdb\u884c\u8bad\u7ec3\u3002\u4f8b\u5982 --mixed_precision=\"fp16\" \u3002\u4e0e\u4e0d\u4f7f\u7528\u6df7\u5408\u7cbe\u5ea6\uff08\u9ed8\u8ba4\uff09\u76f8\u6bd4\uff0c\u7cbe\u5ea6\u53ef\u80fd\u4f1a\u964d\u4f4e\uff0c\u4f46\u53ef\u4ee5\u5927\u5e45\u51cf\u5c11\u8bad\u7ec3\u6240\u9700\u7684 GPU \u5185\u5b58\u3002 \uff08\u5bf9\u4e8e RTX30 \u7cfb\u5217\u53ca\u4e4b\u540e\u7684\u663e\u5361\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a bf16 \u3002\u8bf7\u786e\u4fdd\u4e0e\u4f7f\u7528 accelerate \u8fdb\u884c\u7684\u73af\u5883\u8bbe\u7f6e\u76f8\u4e00\u81f4\uff09\u3002 --gradient_checkpointing \u4e0d\u662f\u4e00\u6b21\u6027\u8fdb\u884c\u8bad\u7ec3\u65f6\u7684\u6743\u91cd\u8ba1\u7b97\uff0c\u800c\u662f\u5206\u6b65\u8fdb\u884c\uff0c\u4ee5\u51cf\u5c11\u8bad\u7ec3\u6240\u9700\u7684 GPU \u5185\u5b58\u91cf\u3002\u5f00\u542f\u6216\u5173\u95ed\u5bf9\u7cbe\u5ea6\u6ca1\u6709\u5f71\u54cd\uff0c\u4f46\u5f00\u542f\u540e\u53ef\u4ee5\u589e\u52a0\u6279\u5927\u5c0f\uff0c\u4ece\u800c\u5bf9\u8bad\u7ec3\u7ed3\u679c\u4ea7\u751f\u5f71\u54cd\u3002 \u901a\u5e38\uff0c\u5f00\u542f\u540e\u4f1a\u964d\u4f4e\u8bad\u7ec3\u901f\u5ea6\uff0c\u4f46\u7531\u4e8e\u53ef\u4ee5\u589e\u52a0\u6279\u5927\u5c0f\uff0c\u603b\u4f53\u7684\u8bad\u7ec3\u65f6\u95f4\u53ef\u80fd\u4f1a\u66f4\u5feb\u3002 --xformers / --mem_eff_attn \u6307\u5b9a xformers \u9009\u9879\u65f6\uff0c\u4f7f\u7528 xformers \u7684 CrossAttention\u3002\u5982\u679c\u672a\u5b89\u88c5 xformers \u6216\u51fa\u73b0\u9519\u8bef\uff08\u5728\u67d0\u4e9b\u73af\u5883\u4e0b\uff0c\u5982 mixed_precision=\"no\" \u65f6\uff09\uff0c\u53ef\u4ee5\u6307\u5b9a mem_eff_attn \u9009\u9879\u4ee5\u4f7f\u7528\u8282\u7701\u5185\u5b58\u7248\u672c\u7684 CrossAttention\uff08\u6bd4 xformers \u6162\uff09\u3002 --clip_skip \u6307\u5b9a 2 \u65f6\uff0c\u4f7f\u7528 Text Encoder (CLIP) \u7684\u5012\u6570\u7b2c\u4e8c\u5c42\u7684\u8f93\u51fa\u3002\u6307\u5b9a 1 \u6216\u7701\u7565\u8be5\u9009\u9879\u65f6\uff0c\u4f7f\u7528\u6700\u540e\u4e00\u5c42\u7684\u8f93\u51fa\u3002 \u203bSD2.0 \u9ed8\u8ba4\u4f7f\u7528\u5012\u6570\u7b2c\u4e8c\u5c42\u7684\u8f93\u51fa\uff0c\u56e0\u6b64\u5728 SD2.0 \u7684\u8bad\u7ec3\u4e2d\u4e0d\u8981\u6307\u5b9a\u6b64\u9009\u9879\u3002 \u5982\u679c\u8bad\u7ec3\u7684\u6a21\u578b\u539f\u672c\u5c31\u662f\u4f7f\u7528\u5012\u6570\u7b2c\u4e8c\u5c42\u8fdb\u884c\u8bad\u7ec3\u7684\uff0c\u90a3\u4e48\u6307\u5b9a 2 \u662f\u5408\u9002\u7684\u3002 \u5982\u679c\u539f\u672c\u4f7f\u7528\u6700\u540e\u4e00\u5c42\u8fdb\u884c\u8bad\u7ec3\uff0c\u7531\u4e8e\u6574\u4e2a\u6a21\u578b\u90fd\u662f\u57fa\u4e8e\u6b64\u8fdb\u884c\u8bad\u7ec3\u7684\uff0c\u56e0\u6b64\u5982\u679c\u6539\u7528\u5012\u6570\u7b2c\u4e8c\u5c42\u8fdb\u884c\u8bad\u7ec3\uff0c\u53ef\u80fd\u9700\u8981\u4e00\u5b9a\u6570\u91cf\u7684\u8bad\u7ec3\u6570\u636e\u548c\u8f83\u957f\u7684\u8bad\u7ec3\u65f6\u95f4\u624d\u80fd\u83b7\u5f97\u7406\u60f3\u7684\u8bad\u7ec3\u7ed3\u679c\u3002 --max_token_length \u9ed8\u8ba4\u503c\u4e3a 75\u3002\u6307\u5b9a 150 \u6216 225 \u53ef\u4ee5\u6269\u5c55 token \u957f\u5ea6\u8fdb\u884c\u8bad\u7ec3\u3002\u5982\u679c\u4f7f\u7528\u957f\u6807\u9898\u8fdb\u884c\u8bad\u7ec3\uff0c\u8bf7\u6307\u5b9a\u6b64\u9009\u9879\u3002 \u4f46\u662f\uff0c\u8bad\u7ec3\u65f6\u7684 token \u6269\u5c55\u89c4\u8303\u4e0e Automatic1111 \u7684 Web UI \u7565\u6709\u4e0d\u540c\uff08\u4f8b\u5982\uff0c\u5206\u8bcd\u7684\u89c4\u8303\uff09\uff0c\u56e0\u6b64\u5982\u679c\u6ca1\u6709\u5fc5\u8981\uff0c\u5efa\u8bae\u4f7f\u7528\u9ed8\u8ba4\u7684 75 \u8fdb\u884c\u8bad\u7ec3\u3002 \u4e0e clip_skip \u7c7b\u4f3c\uff0c\u5982\u679c\u8bad\u7ec3\u957f\u5ea6\u4e0e\u6a21\u578b\u7684\u539f\u59cb\u8bad\u7ec3\u72b6\u6001\u4e0d\u540c\uff0c\u53ef\u80fd\u9700\u8981\u4e00\u5b9a\u6570\u91cf\u7684\u8bad\u7ec3\u6570\u636e\u548c\u8f83\u957f\u7684\u8bad\u7ec3\u65f6\u95f4\u3002 --weighted_captions \u6307\u5b9a\u6b64\u9009\u9879\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0e Automatic1111 \u7684 Web UI \u7c7b\u4f3c\u7684\u52a0\u6743\u6807\u9898\u3002\u9664\u201cTextual Inversion \u548c XTI\u201d\u5916\u7684\u8bad\u7ec3\u5747\u53ef\u4f7f\u7528\u3002\u4e0d\u4ec5\u53ef\u4ee5\u7528\u4e8e\u6807\u9898\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e DreamBooth \u65b9\u6cd5\u7684 token \u5b57\u7b26\u4e32\u3002 \u52a0\u6743\u6807\u9898\u7684\u8bed\u6cd5\u4e0e Web UI \u51e0\u4e4e\u76f8\u540c\uff0c\u53ef\u4ee5\u4f7f\u7528 (abc)\u3001[abc]\u3001(abc:1.23) \u7b49\u3002\u4e5f\u53ef\u4ee5\u5d4c\u5957\u4f7f\u7528\u3002\u4f46\u8bf7\u6ce8\u610f\uff0c\u62ec\u53f7\u5185\u4e0d\u80fd\u5305\u542b\u9017\u53f7\uff0c\u5426\u5219\u5728 prompt \u7684 shuffle/dropout \u65f6\u4f1a\u5bfc\u81f4\u62ec\u53f7\u5339\u914d\u9519\u8bef\u3002 --persistent_data_loader_workers \u5728 Windows \u73af\u5883\u4e2d\u6307\u5b9a\u6b64\u9009\u9879\u53ef\u4ee5\u5927\u5e45\u51cf\u5c11 epoch \u4e4b\u95f4\u7684\u7b49\u5f85\u65f6\u95f4\u3002 --max_data_loader_n_workers \u6307\u5b9a\u6570\u636e\u52a0\u8f7d\u7684\u8fdb\u7a0b\u6570\u3002\u8fdb\u7a0b\u6570\u8d8a\u591a\uff0c\u6570\u636e\u52a0\u8f7d\u8d8a\u5feb\uff0cGPU \u5229\u7528\u7387\u8d8a\u9ad8\uff0c\u4f46\u4f1a\u6d88\u8017\u66f4\u591a\u7684\u4e3b\u5185\u5b58\u3002\u9ed8\u8ba4\u503c\u4e3a 8 \u6216 CPU \u540c\u65f6\u6267\u884c\u7ebf\u7a0b\u6570-1 \u4e2d\u7684\u8f83\u5c0f\u8005\u3002\u5982\u679c\u4e3b\u5185\u5b58\u4e0d\u8db3\u6216 GPU \u4f7f\u7528\u7387\u5df2\u7ecf\u8fbe\u5230 90% \u5de6\u53f3\uff0c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u964d\u4f4e\u6b64\u6570\u503c\uff0c\u4f8b\u5982\u8bbe\u7f6e\u4e3a 2 \u6216 1 \u3002 --logging_dir / --log_prefix \u4e0e\u8bad\u7ec3\u65e5\u5fd7\u4fdd\u5b58\u76f8\u5173\u7684\u9009\u9879\u3002 logging_dir \u9009\u9879\u6307\u5b9a\u65e5\u5fd7\u4fdd\u5b58\u7684\u6587\u4ef6\u5939\uff0c\u5c06\u4fdd\u5b58 TensorBoard \u683c\u5f0f\u7684\u65e5\u5fd7\u3002 \u4f8b\u5982\uff0c\u6307\u5b9a --logging_dir=logs \uff0c\u5c06\u5728\u5de5\u4f5c\u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u4e00\u4e2a logs \u6587\u4ef6\u5939\uff0c\u5e76\u5728\u5176\u4e0b\u7684\u65e5\u671f\u6587\u4ef6\u5939\u4e2d\u4fdd\u5b58\u65e5\u5fd7\u3002 \u5982\u679c\u6307\u5b9a --log_prefix \u9009\u9879\uff0c\u5c06\u5728\u65e5\u671f\u524d\u6dfb\u52a0\u6307\u5b9a\u7684\u5b57\u7b26\u4e32\u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u4f7f\u7528 --logging_dir=logs --log_prefix=db_style1_ \u6765\u6807\u8bc6\u65e5\u5fd7\u3002 \u8981\u5728 TensorBoard \u4e2d\u67e5\u770b\u65e5\u5fd7\uff0c\u9700\u8981\u6253\u5f00\u53e6\u4e00\u4e2a\u547d\u4ee4\u63d0\u793a\u7b26\uff0c\u5728\u5de5\u4f5c\u6587\u4ef6\u5939\u4e2d\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\uff1a tensorboard --logdir=logs \uff08tensorboard \u5e94\u8be5\u5728\u73af\u5883\u8bbe\u7f6e\u65f6\u5df2\u7ecf\u5b89\u88c5\u3002\u5982\u679c\u6ca1\u6709\uff0c\u53ef\u4ee5\u4f7f\u7528 pip install tensorboard \u5b89\u88c5\u3002\uff09 \u7136\u540e\u6253\u5f00\u6d4f\u89c8\u5668\uff0c\u8bbf\u95ee http://localhost:6006/ \u5373\u53ef\u67e5\u770b\u65e5\u5fd7\u3002 --log_with / --log_tracker_name \u4e0e\u8bad\u7ec3\u65e5\u5fd7\u4fdd\u5b58\u76f8\u5173\u7684\u9009\u9879\u3002\u9664\u4e86 tensorboard \u5916\uff0c\u8fd8\u652f\u6301\u4fdd\u5b58\u5230 wandb \u3002\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u89c1 PR#428 \u3002 --noise_offset \u5b9e\u73b0\u53c2\u8003\uff1ahttps://www.crosslabs.org//blog/diffusion-with-offset-noise \u4f3c\u4e4e\u53ef\u4ee5\u6539\u5584\u6574\u4f53\u504f\u6697\u6216\u504f\u4eae\u7684\u56fe\u50cf\u751f\u6210\u7ed3\u679c\u3002\u5728 LoRA \u8bad\u7ec3\u4e2d\u4f3c\u4e4e\u4e5f\u6709\u6548\u3002\u5efa\u8bae\u6307\u5b9a 0.1 \u5de6\u53f3\u7684\u503c\u3002 --adaptive_noise_scale \uff08\u5b9e\u9a8c\u6027\u9009\u9879\uff09 \u6839\u636e latents \u7684\u5404\u901a\u9053\u7684\u5e73\u5747\u503c\u7684\u7edd\u5bf9\u503c\u81ea\u52a8\u8c03\u6574 Noise offset \u7684\u503c\u3002\u4e0e --noise_offset \u540c\u65f6\u6307\u5b9a\u65f6\u751f\u6548\u3002Noise offset \u7684\u503c\u901a\u8fc7 noise_offset + abs(mean(latents, dim=(2,3))) * adaptive_noise_scale \u8ba1\u7b97\u3002\u7531\u4e8e latent \u63a5\u8fd1\u6b63\u6001\u5206\u5e03\uff0c\u56e0\u6b64\u5efa\u8bae\u6307\u5b9a noise_offset \u7684 1/10 \u5230\u76f8\u540c\u91cf\u7ea7\u7684\u503c\u3002 \u4e5f\u53ef\u4ee5\u6307\u5b9a\u8d1f\u503c\uff0c\u6b64\u65f6 Noise offset \u5c06\u88ab\u9650\u5236\u5728 0 \u4ee5\u4e0a\u3002 --multires_noise_iterations / --multires_noise_discount Multi resolution noise\uff08pyramid noise\uff09\u7684\u8bbe\u7f6e\u3002\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u89c1 PR#471 \u548c Multi-Resolution Noise for Diffusion Model Training \u3002 \u6307\u5b9a --multires_noise_iterations \u7684\u6570\u503c\u5373\u53ef\u542f\u7528\u3002\u5efa\u8bae\u503c\u4e3a 6~10\u3002 --multires_noise_discount \u7684\u503c\u53ef\u4ee5\u8bbe\u4e3a 0.1~0.3\uff08LoRA \u8bad\u7ec3\u7b49\u6570\u636e\u96c6\u8f83\u5c0f\u7684\u60c5\u51b5\u4e0b\u7684\u4f5c\u8005\u63a8\u8350\u503c\uff09\uff0c\u6216 0.8\uff08\u539f\u59cb\u6587\u7ae0\u7684\u63a8\u8350\u503c\uff09\uff08\u9ed8\u8ba4\u503c\u4e3a 0.3\uff09\u3002 --debug_dataset \u6dfb\u52a0\u6b64\u9009\u9879\u540e\uff0c\u53ef\u4ee5\u5728\u5f00\u59cb\u8bad\u7ec3\u524d\u9884\u89c8\u5c06\u8981\u8bad\u7ec3\u7684\u56fe\u50cf\u6570\u636e\u548c\u6807\u9898\u3002\u6309 Esc \u952e\u9000\u51fa\u9884\u89c8\uff0c\u6309 S \u952e\u8fdb\u5165\u4e0b\u4e00\u6b65\uff08\u6279\u6b21\uff09\uff0c\u6309 E \u952e\u8fdb\u5165\u4e0b\u4e00\u4e2a epoch\u3002 \u203b\u5728 Linux \u73af\u5883\uff08\u5305\u62ec Colab\uff09\u4e2d\uff0c\u56fe\u50cf\u4e0d\u4f1a\u663e\u793a\u3002 --vae \u6307\u5b9a Stable Diffusion \u7684 checkpoint\u3001VAE \u7684 checkpoint \u6587\u4ef6\u3001Diffusers \u7684\u6a21\u578b\u6216 VAE\uff08\u5747\u53ef\u4e3a\u672c\u5730\u6587\u4ef6\u6216 Hugging Face \u6a21\u578b ID\uff09\uff0c\u5c06\u4f7f\u7528\u6307\u5b9a\u7684 VAE \u8fdb\u884c\u8bad\u7ec3\uff08\u5728 latents \u7f13\u5b58\u65f6\u6216\u8bad\u7ec3\u4e2d\u7684 latents \u83b7\u53d6\u65f6\uff09\u3002 \u5728 DreamBooth \u548c fine tuning \u4e2d\uff0c\u4fdd\u5b58\u7684\u6a21\u578b\u5c06\u5d4c\u5165\u6307\u5b9a\u7684 VAE\u3002 --cache_latents / --cache_latents_to_disk \u5c06 VAE \u7684\u8f93\u51fa\u7f13\u5b58\u5230\u4e3b\u5185\u5b58\uff0c\u4ee5\u51cf\u5c11\u4f7f\u7528\u7684 VRAM\u3002\u542f\u7528\u540e\uff0c\u9664 flip_aug \u5916\u7684\u5176\u4ed6\u6570\u636e\u589e\u5f3a\u65b9\u6cd5\u5c06\u4e0d\u53ef\u7528\u3002\u540c\u65f6\uff0c\u6574\u4f53\u8bad\u7ec3\u901f\u5ea6\u4f1a\u7565\u5fae\u52a0\u5feb\u3002 \u6307\u5b9a cache_latents_to_disk \u540e\uff0c\u7f13\u5b58\u5c06\u88ab\u4fdd\u5b58\u5230\u78c1\u76d8\u3002\u5373\u4f7f\u811a\u672c\u7ed3\u675f\u5e76\u518d\u6b21\u542f\u52a8\uff0c\u7f13\u5b58\u4ecd\u7136\u6709\u6548\u3002 --min_snr_gamma \u6307\u5b9aMin-SNR\u52a0\u6743\u7b56\u7565\u3002\u8be6\u60c5\u8bf7\u53c2\u8003 \u6b64\u5904 \u3002\u8bba\u6587\u4e2d\u63a8\u8350\u503c\u4e3a 5 \u3002","title":"\u8bad\u7ec3\u8bbe\u5b9a"},{"location":"sd-scripts-docs/train/#_15","text":"--save_precision \u6307\u5b9a\u4fdd\u5b58\u65f6\u7684\u6570\u636e\u7cbe\u5ea6\u3002\u5982\u679c\u6307\u5b9a save_precision \u9009\u9879\u4e3a float \u3001 fp16 \u6216 bf16 \uff0c\u5219\u4ee5\u76f8\u5e94\u683c\u5f0f\u4fdd\u5b58\u6a21\u578b\uff08\u5728DreamBooth\u548cfine tuning\u4e2d\u4ee5Diffusers\u683c\u5f0f\u4fdd\u5b58\u6a21\u578b\u65f6\u65e0\u6548\uff09\u3002\u5982\u679c\u60a8\u60f3\u51cf\u5c0f\u6a21\u578b\u7684\u5927\u5c0f\uff0c\u53ef\u4ee5\u4f7f\u7528\u6b64\u9009\u9879\u3002 --save_every_n_epochs / --save_state / --resume \u5982\u679c\u4e3a save_every_n_epochs \u9009\u9879\u6307\u5b9a\u4e00\u4e2a\u6570\u503c\uff0c\u5219\u6bcf\u9694\u6307\u5b9aepoch\u6570\u4fdd\u5b58\u4e00\u6b21\u5b66\u4e60\u8fc7\u7a0b\u4e2d\u7684\u6a21\u578b\u3002 \u5982\u679c\u540c\u65f6\u6307\u5b9a save_state \u9009\u9879\uff0c\u5219\u8fd8\u4f1a\u4fdd\u5b58\u5305\u62ec\u4f18\u5316\u5668\u72b6\u6001\u5728\u5185\u7684\u5b66\u4e60\u72b6\u6001\uff08\u4e0e\u4ece\u4fdd\u5b58\u7684\u6a21\u578b\u4e2d\u6062\u590d\u5b66\u4e60\u76f8\u6bd4\uff0c\u53ef\u4ee5\u9884\u671f\u7cbe\u5ea6\u63d0\u9ad8\u548c\u5b66\u4e60\u65f6\u95f4\u7f29\u77ed\uff09\u3002\u4fdd\u5b58\u76ee\u6807\u662f\u4e00\u4e2a\u6587\u4ef6\u5939\u3002 \u5b66\u4e60\u72b6\u6001\u5c06\u4ee5 <output_name>-??????-state \uff08??????\u662fepoch\u6570\uff09\u4e3a\u540d\u7684\u6587\u4ef6\u5939\u4fdd\u5b58\u5728\u8f93\u51fa\u76ee\u5f55\u4e2d\u3002\u5728\u957f\u65f6\u95f4\u5b66\u4e60\u65f6\u8bf7\u4f7f\u7528\u6b64\u529f\u80fd\u3002 \u8981\u4ece\u4fdd\u5b58\u7684\u5b66\u4e60\u72b6\u6001\u6062\u590d\u5b66\u4e60\uff0c\u8bf7\u4f7f\u7528 resume \u9009\u9879\u3002\u9700\u6307\u5b9a\u4fdd\u5b58\u7684\u5b66\u4e60\u72b6\u6001\u6587\u4ef6\u5939\uff08\u4e0d\u662f output_dir \uff0c\u800c\u662f\u5176\u4e2d\u7684state\u6587\u4ef6\u5939\uff09\u3002 \u8bf7\u6ce8\u610f\uff0c\u7531\u4e8eAccelerator\u7684\u9650\u5236\uff0cepoch\u6570\u548cglobal step\u4e0d\u4f1a\u88ab\u4fdd\u5b58\uff0c\u6062\u590d\u65f6\u4e5f\u4f1a\u4ece1\u5f00\u59cb\u3002 --save_every_n_steps \u5982\u679c\u4e3a save_every_n_steps \u9009\u9879\u6307\u5b9a\u4e00\u4e2a\u6570\u503c\uff0c\u5219\u6bcf\u9694\u6307\u5b9astep\u6570\u4fdd\u5b58\u4e00\u6b21\u5b66\u4e60\u8fc7\u7a0b\u4e2d\u7684\u6a21\u578b\u3002\u53ef\u4ee5\u4e0e save_every_n_epochs \u540c\u65f6\u6307\u5b9a\u3002 --save_model_as \uff08\u4ec5\u9650DreamBooth\u548cfine tuning\uff09 \u53ef\u4ee5\u4ece ckpt \u3001 safetensors \u3001 diffusers \u3001 diffusers_safetensors \u4e2d\u9009\u62e9\u6a21\u578b\u7684\u4fdd\u5b58\u683c\u5f0f\u3002 \u6307\u5b9a\u65b9\u5f0f\u4e3a --save_model_as=safetensors \u3002\u5982\u679c\u4ee5Stable Diffusion\u683c\u5f0f\uff08ckpt\u6216safetensors\uff09\u8bfb\u53d6\u5e76\u4ee5Diffusers\u683c\u5f0f\u4fdd\u5b58\uff0c\u5219\u4f1a\u4eceHugging Face\u4e0b\u8f7dv1.5\u6216v2.1\u7684\u4fe1\u606f\u6765\u8865\u5145\u7f3a\u5931\u7684\u4fe1\u606f\u3002 --huggingface_repo_id \u7b49 \u5982\u679c\u6307\u5b9a\u4e86 huggingface_repo_id \uff0c\u5219\u5728\u4fdd\u5b58\u6a21\u578b\u65f6\u540c\u65f6\u4e0a\u4f20\u5230HuggingFace\u3002\u8bf7\u6ce8\u610f\u8bbf\u95ee\u4ee4\u724c\u7684\u5904\u7406\uff08\u8bf7\u53c2\u8003HuggingFace\u7684\u6587\u6863\uff09\u3002 \u5176\u4ed6\u53c2\u6570\u8bf7\u6309\u5982\u4e0b\u65b9\u5f0f\u6307\u5b9a\u3002 --huggingface_repo_id \"your-hf-name/your-model\" --huggingface_path_in_repo \"path\" --huggingface_repo_type model --huggingface_repo_visibility private --huggingface_token hf_YourAccessTokenHere \u5982\u679c huggingface_repo_visibility \u6307\u5b9a\u4e3a public \uff0c\u5219\u4ed3\u5e93\u5c06\u516c\u5f00\u3002\u5982\u679c\u7701\u7565\u6216\u6307\u5b9a\u4e3a private \uff08\u6216\u5176\u4ed6\u975epublic\u503c\uff09\uff0c\u5219\u4ed3\u5e93\u5c06\u4e3a\u79c1\u6709\u3002 \u5982\u679c\u5728\u6307\u5b9a --save_state \u65f6\u6dfb\u52a0 --save_state_to_huggingface \uff0c\u5219\u8fd8\u4f1a\u4e0a\u4f20state\u3002 \u5982\u679c\u5728\u6307\u5b9a --resume \u65f6\u6dfb\u52a0 --resume_from_huggingface \uff0c\u5219\u4f1a\u4eceHuggingFace\u4e0b\u8f7dstate\u5e76\u6062\u590d\u5b66\u4e60\u3002\u6b64\u65f6\u7684 --resume \u9009\u9879\u5e94\u4e3a --resume {repo_id}/{path_in_repo}:{revision}:{repo_type} \u3002 \u4f8b: --resume_from_huggingface --resume your-hf-name/your-model/path/test-000002-state:main:model \u5982\u679c\u6307\u5b9a --async_upload \u9009\u9879\uff0c\u5219\u4f1a\u5f02\u6b65\u4e0a\u4f20\u3002","title":"\u6a21\u578b\u4fdd\u5b58\u8bbe\u7f6e"},{"location":"sd-scripts-docs/train/#_16","text":"--optimizer_type \u6307\u5b9a\u4f18\u5316\u5668\u7c7b\u578b\u3002\u53ef\u9009\u4ee5\u4e0b\u7c7b\u578b\u3002 AdamW : torch.optim.AdamW \u4e0e\u8fc7\u53bb\u7248\u672c\u7684\u672a\u6307\u5b9a\u65f6\u76f8\u540c AdamW8bit : \u53c2\u6570\u540c\u4e0a PagedAdamW8bit : \u53c2\u6570\u540c\u4e0a \u4e0e\u8fc7\u53bb\u7248\u672c\u7684 --use_8bit_adam \u6307\u5b9a\u65f6\u76f8\u540c Lion : https://github.com/lucidrains/lion-pytorch \u4e0e\u8fc7\u53bb\u7248\u672c\u7684 --use_lion_optimizer \u6307\u5b9a\u65f6\u76f8\u540c Lion8bit : \u53c2\u6570\u540c\u4e0a PagedLion8bit : \u53c2\u6570\u540c\u4e0a SGDNesterov : torch.optim.SGD , nesterov=True SGDNesterov8bit : \u53c2\u6570\u540c\u4e0a DAdaptation(DAdaptAdamPreprint) : https://github.com/facebookresearch/dadaptation DAdaptAdam : \u53c2\u6570\u540c\u4e0a DAdaptAdaGrad : \u53c2\u6570\u540c\u4e0a DAdaptAdan : \u53c2\u6570\u540c\u4e0a DAdaptAdanIP : \u53c2\u6570\u540c\u4e0a DAdaptLion : \u53c2\u6570\u540c\u4e0a DAdaptSGD : \u53c2\u6570\u540c\u4e0a Prodigy : https://github.com/konstmish/prodigy AdaFactor : Transformers AdaFactor \u81ea\u5b9a\u4e49\u4f18\u5316\u5668 --learning_rate \u6307\u5b9a\u5b66\u4e60\u7387\u3002\u9002\u5f53\u7684\u5b66\u4e60\u7387\u56e0\u5b66\u4e60\u811a\u672c\u800c\u5f02\uff0c\u8bf7\u53c2\u8003\u5404\u81ea\u7684\u8bf4\u660e\u3002 --lr_scheduler / --lr_warmup_steps / --lr_scheduler_num_cycles / --lr_scheduler_power \u5b66\u4e60\u7387\u8c03\u5ea6\u5668\u76f8\u5173\u7684\u6307\u5b9a\u3002 lr_scheduler \u9009\u9879\u53ef\u4ecelinear\u3001cosine\u3001cosine_with_restarts\u3001polynomial\u3001constant\u3001constant_with_warmup\u3001\u81ea\u5b9a\u4e49\u8c03\u5ea6\u5668\u4e2d\u9009\u62e9\u3002\u9ed8\u8ba4\u503c\u4e3aconstant\u3002 lr_warmup_steps \u53ef\u6307\u5b9a\u8c03\u5ea6\u5668\u7684\u9884\u70ed\u6b65\u6570\u3002 lr_scheduler_num_cycles \u662fcosine with restarts\u8c03\u5ea6\u5668\u7684\u91cd\u542f\u6b21\u6570\uff0c lr_scheduler_power \u662fpolynomial\u8c03\u5ea6\u5668\u7684\u591a\u9879\u5f0f\u5e42\u3002 \u8be6\u60c5\u8bf7\u81ea\u884c\u67e5\u9605\u3002 \u4f7f\u7528\u81ea\u5b9a\u4e49\u8c03\u5ea6\u5668\u65f6\uff0c\u4e0e\u81ea\u5b9a\u4e49\u4f18\u5316\u5668\u4e00\u6837\uff0c\u901a\u8fc7 --lr_scheduler_args \u6307\u5b9a\u9009\u9879\u53c2\u6570\u3002","title":"\u4f18\u5316\u5668\u76f8\u5173\u8bbe\u7f6e"},{"location":"sd-scripts-docs/train/#_17","text":"\u4f18\u5316\u5668\u7684\u9009\u9879\u53c2\u6570\u901a\u8fc7 --optimizer_args \u9009\u9879\u6307\u5b9a\u3002\u91c7\u7528key=value\u7684\u5f62\u5f0f\uff0c\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\u503c\u3002\u6b64\u5916\uff0cvalue\u53ef\u4ee5\u901a\u8fc7\u9017\u53f7\u5206\u9694\u6307\u5b9a\u591a\u4e2a\u503c\u3002\u4f8b\u5982\uff0c\u4e3aAdamW\u4f18\u5316\u5668\u6307\u5b9a\u53c2\u6570\u65f6\uff0c\u5e94\u4e3a --optimizer_args weight_decay=0.01 betas=.9,.999 \u3002 \u6307\u5b9a\u9009\u9879\u53c2\u6570\u65f6\uff0c\u8bf7\u786e\u8ba4\u5404\u81ea\u4f18\u5316\u5668\u7684\u89c4\u683c\u3002 \u90e8\u5206\u4f18\u5316\u5668\u6709\u5fc5\u9700\u53c2\u6570\uff0c\u5982\u679c\u7701\u7565\u5219\u4f1a\u81ea\u52a8\u6dfb\u52a0\uff08\u4f8b\u5982SGDNesterov\u7684momentum\uff09\u3002\u8bf7\u67e5\u770b\u63a7\u5236\u53f0\u8f93\u51fa\u3002 D-Adaptation\u4f18\u5316\u5668\u4f1a\u81ea\u52a8\u8c03\u6574\u5b66\u4e60\u7387\u3002\u5b66\u4e60\u7387\u9009\u9879\u4e2d\u6307\u5b9a\u7684\u503c\u4e0d\u662f\u5b66\u4e60\u7387\u672c\u8eab\uff0c\u800c\u662fD-Adaptation\u51b3\u5b9a\u7684\u5b66\u4e60\u7387\u7684\u5e94\u7528\u7387\uff0c\u56e0\u6b64\u901a\u5e38\u5e94\u6307\u5b9a\u4e3a1.0\u3002\u5982\u679c\u60f3\u4e3aText Encoder\u6307\u5b9aU-Net\u4e00\u534a\u7684\u5b66\u4e60\u7387\uff0c\u5e94\u6307\u5b9a --text_encoder_lr=0.5 --unet_lr=1.0 \u3002 AdaFactor\u4f18\u5316\u5668\u5982\u679c\u6307\u5b9a relative_step=True \uff0c\u5219\u53ef\u4ee5\u81ea\u52a8\u8c03\u6574\u5b66\u4e60\u7387\uff08\u7701\u7565\u65f6\u9ed8\u8ba4\u6dfb\u52a0\uff09\u3002\u81ea\u52a8\u8c03\u6574\u65f6\uff0c\u5b66\u4e60\u7387\u8c03\u5ea6\u5668\u5f3a\u5236\u4f7f\u7528adafactor_scheduler\u3002\u6b64\u5916\uff0c\u4f3c\u4e4e\u6307\u5b9a scale_parameter \u548c warmup_init \u662f\u6709\u6548\u7684\u3002 \u81ea\u52a8\u8c03\u6574\u65f6\u7684\u9009\u9879\u6307\u5b9a\u4f8b\u5982\u4e3a --optimizer_args \"relative_step=True\" \"scale_parameter=True\" \"warmup_init=True\" \u3002 \u5982\u679c\u4e0d\u81ea\u52a8\u8c03\u6574\u5b66\u4e60\u7387\uff0c\u5219\u9700\u6dfb\u52a0\u9009\u9879\u53c2\u6570 relative_step=False \u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b66\u4e60\u7387\u8c03\u5ea6\u5668\u5efa\u8bae\u4f7f\u7528constant_with_warmup\uff0c\u5e76\u4e14\u4f3c\u4e4e\u4e0d\u5efa\u8bae\u8fdb\u884c\u68af\u5ea6clip norm\u3002\u56e0\u6b64\uff0c\u53c2\u6570\u5e94\u4e3a --optimizer_type=adafactor --optimizer_args \"relative_step=False\" --lr_scheduler=\"constant_with_warmup\" --max_grad_norm=0.0 \u3002","title":"\u4f18\u5316\u5668\u7684\u6307\u5b9a"},{"location":"sd-scripts-docs/train/#_18","text":"\u5982\u679c\u4f7f\u7528 torch.optim \u4e2d\u7684\u4f18\u5316\u5668\uff0c\u8bf7\u4ec5\u6307\u5b9a\u7c7b\u540d\uff08\u4f8b\u5982 --optimizer_type=RMSprop \uff09\uff1b\u5982\u679c\u4f7f\u7528\u5176\u4ed6\u6a21\u5757\u7684\u4f18\u5316\u5668\uff0c\u8bf7\u4ee5\u201c\u6a21\u5757\u540d.\u7c7b\u540d\u201d\u7684\u5f62\u5f0f\u6307\u5b9a\uff08\u4f8b\u5982 --optimizer_type=bitsandbytes.optim.lamb.LAMB \uff09\u3002 \uff08\u5185\u90e8\u901a\u8fc7importlib\u5b9e\u73b0\uff0c\u5b9e\u9645\u6548\u679c\u672a\u9a8c\u8bc1\u3002\u5982\u6709\u9700\u8981\uff0c\u8bf7\u81ea\u884c\u5b89\u88c5\u76f8\u5e94\u5305\u3002\uff09","title":"\u4f7f\u7528\u4efb\u610f\u7684\u4f18\u5316\u5668"},{"location":"sd-scripts-docs/train/#_19","text":"","title":"\u521b\u5efa\u5143\u6570\u636e\u6587\u4ef6"},{"location":"sd-scripts-docs/train/#_20","text":"\u5982\u524d\u6240\u8ff0\uff0c\u8bf7\u51c6\u5907\u597d\u60f3\u8981\u8bad\u7ec3\u7684\u56fe\u50cf\u6570\u636e\uff0c\u5e76\u5c06\u5176\u653e\u5165\u4efb\u610f\u6587\u4ef6\u5939\u4e2d\u3002 \u4f8b\u5982\uff0c\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u65b9\u5f0f\u7ec4\u7ec7\u56fe\u50cf\u6570\u636e\uff1a","title":"\u51c6\u5907\u8bad\u7ec3\u6570\u636e"},{"location":"sd-scripts-docs/train/#_21","text":"\u5982\u679c\u4ec5\u4f7f\u7528\u6807\u7b7e\u8fdb\u884c\u8bad\u7ec3\u800c\u4e0d\u9700\u8981\u4f7f\u7528\u6807\u9898\uff08caption\uff09\uff0c\u8bf7\u8df3\u8fc7\u6b64\u6b65\u9aa4\u3002 \u5982\u679c\u624b\u52a8\u51c6\u5907\u6807\u9898\uff08caption\uff09\uff0c\u8bf7\u5c06\u6807\u9898\u6587\u4ef6\u4e0e\u8bad\u7ec3\u56fe\u50cf\u653e\u5728\u540c\u4e00\u76ee\u5f55\u4e0b\uff0c\u6587\u4ef6\u540d\u76f8\u540c\uff0c\u6269\u5c55\u540d\u4e3a.caption\u7b49\u3002\u6bcf\u4e2a\u6807\u9898\u6587\u4ef6\u5e94\u4e3a\u5355\u884c\u6587\u672c\u6587\u4ef6\u3002","title":"\u81ea\u52a8\u6807\u6ce8\uff08\u53ef\u9009\uff09"},{"location":"sd-scripts-docs/train/#blip","text":"\u6700\u65b0\u7248\u7684\u7a0b\u5e8f\u5df2\u7ecf\u5305\u542b\u4e86BLIP\u6a21\u578b\u53ca\u5176\u6743\u91cd\uff0c\u65e0\u9700\u989d\u5916\u4e0b\u8f7d\u3002 \u8fd0\u884cfinetune\u76ee\u5f55\u4e0b\u7684make_captions.py\u811a\u672c\uff1a python finetune\\make_captions.py --batch_size <\u6279\u6b21\u5927\u5c0f> <\u8bad\u7ec3\u6570\u636e\u76ee\u5f55> \u4f8b\u5982\uff0c\u5982\u679c\u6279\u6b21\u5927\u5c0f\u4e3a8\uff0c\u8bad\u7ec3\u6570\u636e\u5b58\u653e\u5728\u4e0a\u7ea7\u76ee\u5f55\u7684train_data\u6587\u4ef6\u5939\u4e2d\uff0c\u53ef\u4ee5\u8fd0\u884c\uff1a python finetune\\make_captions.py --batch_size 8 ..\\train_data \u6807\u6ce8\u6587\u4ef6\u5c06\u4ee5.caption\u4e3a\u6269\u5c55\u540d\uff0c\u4e0e\u8bad\u7ec3\u56fe\u50cf\u5b58\u653e\u5728\u540c\u4e00\u76ee\u5f55\u4e0b\uff0c\u6587\u4ef6\u540d\u76f8\u540c\u3002 \u6279\u6b21\u5927\u5c0f\uff08batch_size\uff09\u53ef\u4ee5\u6839\u636eGPU\u7684VRAM\u5bb9\u91cf\u8fdb\u884c\u8c03\u6574\u3002\u8f83\u5927\u7684\u6279\u6b21\u5927\u5c0f\u53ef\u4ee5\u63d0\u9ad8\u5904\u7406\u901f\u5ea6\uff08\u5373\u4f7fVRAM\u4e3a12GB\uff0c\u4e5f\u53ef\u80fd\u53ef\u4ee5\u8fdb\u4e00\u6b65\u589e\u52a0\u6279\u6b21\u5927\u5c0f\uff09\u3002 \u53ef\u4ee5\u901a\u8fc7max_length\u9009\u9879\u6307\u5b9a\u6807\u9898\u7684\u6700\u5927\u957f\u5ea6\uff0c\u9ed8\u8ba4\u4e3a75\u3002\u5982\u679c\u6a21\u578b\u4ee5225\u7684token\u957f\u5ea6\u8fdb\u884c\u8bad\u7ec3\uff0c\u53ef\u4ee5\u8003\u8651\u589e\u52a0\u6b64\u503c\u3002 \u901a\u8fc7caption_extension\u9009\u9879\u53ef\u4ee5\u66f4\u6539\u6807\u6ce8\u6587\u4ef6\u7684\u6269\u5c55\u540d\uff0c\u9ed8\u8ba4\u4e3a.caption\uff08\u5982\u679c\u66f4\u6539\u4e3a.txt\uff0c\u53ef\u80fd\u4f1a\u4e0eDeepDanbooru\u7684\u8f93\u51fa\u6587\u4ef6\u51b2\u7a81\uff09\u3002 \u5982\u679c\u6709\u591a\u4e2a\u8bad\u7ec3\u6570\u636e\u76ee\u5f55\uff0c\u9700\u8981\u5206\u522b\u5bf9\u6bcf\u4e2a\u76ee\u5f55\u8fd0\u884c\u8be5\u811a\u672c\u3002 \u7531\u4e8eBLIP\u6a21\u578b\u7684\u63a8\u65ad\u7ed3\u679c\u5177\u6709\u4e00\u5b9a\u7684\u968f\u673a\u6027\uff0c\u591a\u6b21\u8fd0\u884c\u7684\u7ed3\u679c\u53ef\u80fd\u4f1a\u6709\u6240\u4e0d\u540c\u3002\u5982\u679c\u9700\u8981\u56fa\u5b9a\u7ed3\u679c\uff0c\u53ef\u4ee5\u901a\u8fc7--seed\u9009\u9879\u6307\u5b9a\u968f\u673a\u79cd\u5b50\uff0c\u4f8b\u5982 --seed 42 \u3002 \u66f4\u591a\u9009\u9879\u7684\u8bf4\u660e\u53ef\u4ee5\u901a\u8fc7 --help \u53c2\u6570\u67e5\u770b\uff08\u7531\u4e8e\u76f8\u5173\u6587\u6863\u4e0d\u5b8c\u5584\uff0c\u53ef\u80fd\u9700\u8981\u76f4\u63a5\u67e5\u770b\u6e90\u7801\u4e86\u89e3\u53c2\u6570\u542b\u4e49\uff09\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6807\u6ce8\u6587\u4ef6\u7684\u6269\u5c55\u540d\u4e3a.caption\u3002 \u4f8b\u5982\uff0c\u751f\u6210\u7684\u6807\u6ce8\u6587\u4ef6\u53ef\u80fd\u5982\u4e0b\u6240\u793a\uff1a","title":"\u4f7f\u7528BLIP\u8fdb\u884c\u56fe\u50cf\u6807\u6ce8"},{"location":"sd-scripts-docs/train/#deepdanbooru","text":"\u5982\u679c\u4e0d\u9700\u8981\u63d0\u53d6danbooru\u6807\u7b7e\uff0c\u53ef\u4ee5\u76f4\u63a5\u8df3\u5230\u201c\u6807\u9898\u548c\u6807\u7b7e\u4fe1\u606f\u9884\u5904\u7406\u201d\u7ae0\u8282\u3002 \u53ef\u4ee5\u4f7f\u7528DeepDanbooru\u6216WD14Tagger\u8fdb\u884c\u56fe\u50cf\u6807\u7b7e\u63d0\u53d6\u3002\u636e\u79f0WD14Tagger\u7684\u51c6\u786e\u7387\u66f4\u9ad8\u3002\u5982\u679c\u8981\u4f7f\u7528WD14Tagger\uff0c\u8bf7\u76f4\u63a5\u8df3\u8f6c\u5230\u4e0b\u4e00\u7ae0\u8282\u3002","title":"\u4f7f\u7528DeepDanbooru\u8fdb\u884c\u56fe\u50cf\u6807\u7b7e\u63d0\u53d6\uff08\u53ef\u9009\uff09"},{"location":"sd-scripts-docs/train/#_22","text":"\u5c06 DeepDanbooru https://github.com/KichangKim/DeepDanbooru \u514b\u9686\u5230\u5de5\u4f5c\u6587\u4ef6\u5939\uff0c\u6216\u8005\u4e0b\u8f7d zip \u6587\u4ef6\u5e76\u89e3\u538b\u3002\u6211\u662f\u901a\u8fc7 zip \u6587\u4ef6\u89e3\u538b\u7684\u3002 \u540c\u65f6\uff0c\u4ece DeepDanbooru \u7684 Releases \u9875\u9762 https://github.com/KichangKim/DeepDanbooru/releases \u7684 \"DeepDanbooru Pretrained Model v3-20211112-sgd-e28\" \u7684 Assets \u4e2d\u4e0b\u8f7d deepdanbooru-v3-20211112-sgd-e28.zip\uff0c\u5e76\u5c06\u5176\u89e3\u538b\u5230 DeepDanbooru \u6587\u4ef6\u5939\u4e2d\u3002 \u4ece\u4ee5\u4e0b\u4f4d\u7f6e\u4e0b\u8f7d\u3002\u70b9\u51fb Assets \u6253\u5f00\uff0c\u7136\u540e\u4ece\u90a3\u91cc\u4e0b\u8f7d\u3002 \u8bf7\u521b\u5efa\u5982\u4e0b\u6240\u793a\u7684\u76ee\u5f55\u7ed3\u6784\u3002 \u5b89\u88c5 Diffusers \u73af\u5883\u6240\u9700\u7684\u5e93\u3002\u79fb\u52a8\u5230 DeepDanbooru \u6587\u4ef6\u5939\u5e76\u5b89\u88c5\uff08\u5b9e\u9645\u4e0a\u53ea\u662f\u6dfb\u52a0\u4e86 tensorflow-io\uff09\u3002 pip install -r requirements.txt \u63a5\u4e0b\u6765\uff0c\u5b89\u88c5 DeepDanbooru \u672c\u8eab\u3002 pip install . \u81f3\u6b64\uff0c\u6807\u7b7e\u73af\u5883\u7684\u51c6\u5907\u5de5\u4f5c\u5df2\u7ecf\u5b8c\u6210\u3002","title":"\u73af\u5883\u51c6\u5907"},{"location":"sd-scripts-docs/train/#_23","text":"\u79fb\u52a8\u5230 DeepDanbooru \u6587\u4ef6\u5939\uff0c\u6267\u884c deepdanbooru \u8fdb\u884c\u6807\u7b7e\u3002 deepdanbooru evaluate <\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939> --project-path deepdanbooru-v3-20211112-sgd-e28 --allow-folder --save-txt \u5982\u679c\u5c06\u8bad\u7ec3\u6570\u636e\u653e\u5728\u7236\u6587\u4ef6\u5939\u7684 train_data \u4e2d\uff0c\u5219\u5982\u4e0b\u6240\u793a\u3002 deepdanbooru evaluate ../train_data --project-path deepdanbooru-v3-20211112-sgd-e28 --allow-folder --save-txt \u6807\u7b7e\u6587\u4ef6\u5c06\u5728\u4e0e\u8bad\u7ec3\u6570\u636e\u56fe\u50cf\u76f8\u540c\u7684\u76ee\u5f55\u4e2d\u521b\u5efa\uff0c\u6587\u4ef6\u540d\u76f8\u540c\uff0c\u6269\u5c55\u540d\u4e3a .txt\u3002\u7531\u4e8e\u662f\u4e00\u4ef6\u4e00\u4ef6\u5904\u7406\u7684\uff0c\u6240\u4ee5\u6bd4\u8f83\u6162\u3002 \u5982\u679c\u6709\u591a\u4e2a\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939\uff0c\u8bf7\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u5939\u6267\u884c\u6b64\u64cd\u4f5c\u3002 \u751f\u6210\u7684\u6587\u4ef6\u5982\u4e0b\u6240\u793a\u3002 \u6807\u7b7e\u5982\u4e0b\u6240\u793a\uff08\u4fe1\u606f\u91cf\u5f88\u5927\u2026\u2026\uff09\u3002","title":"\u6267\u884c\u6807\u7b7e"},{"location":"sd-scripts-docs/train/#wd14tagger","text":"\u8fd9\u662f\u4f7f\u7528 WD14Tagger \u4ee3\u66ff DeepDanbooru \u7684\u6b65\u9aa4\u3002 \u4f7f\u7528 Automatic1111 \u5148\u751f\u7684 WebUI \u4e2d\u7684 tagger\u3002\u53c2\u8003\u4e86github\u9875\u9762\uff08https://github.com/toriato/stable-diffusion-webui-wd14-tagger#mrsmilingwolfs-model-aka-waifu-diffusion-14-tagger \uff09\u7684\u4fe1\u606f\u3002 \u521d\u59cb\u73af\u5883\u51c6\u5907\u65f6\u6240\u9700\u7684\u6a21\u5757\u5df2\u7ecf\u5b89\u88c5\u5b8c\u6bd5\u3002\u540c\u65f6\uff0c\u6743\u91cd\u5c06\u4ece Hugging Face \u81ea\u52a8\u4e0b\u8f7d\u3002","title":"\u4f7f\u7528 WD14Tagger \u8fdb\u884c\u6807\u7b7e"},{"location":"sd-scripts-docs/train/#_24","text":"\u6267\u884c\u811a\u672c\u8fdb\u884c\u6807\u7b7e\u3002 python tag_images_by_wd14_tagger.py --batch_size <\u6279\u5904\u7406\u5927\u5c0f> <\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939> \u5982\u679c\u5c06\u8bad\u7ec3\u6570\u636e\u653e\u5728\u7236\u6587\u4ef6\u5939\u7684 train_data \u4e2d\uff0c\u5219\u5982\u4e0b\u6240\u793a\u3002 python tag_images_by_wd14_tagger.py --batch_size 4 ..\\train_data \u9996\u6b21\u8fd0\u884c\u65f6\uff0c\u6a21\u578b\u6587\u4ef6\u5c06\u81ea\u52a8\u4e0b\u8f7d\u5230 wd14_tagger_model \u6587\u4ef6\u5939\u4e2d\uff08\u6587\u4ef6\u5939\u53ef\u4ee5\u901a\u8fc7\u9009\u9879\u66f4\u6539\uff09\u3002\u5982\u4e0b\u6240\u793a\u3002 \u6807\u7b7e\u6587\u4ef6\u5c06\u5728\u4e0e\u8bad\u7ec3\u6570\u636e\u56fe\u50cf\u76f8\u540c\u7684\u76ee\u5f55\u4e2d\u521b\u5efa\uff0c\u6587\u4ef6\u540d\u76f8\u540c\uff0c\u6269\u5c55\u540d\u4e3a .txt\u3002 \u901a\u8fc7 thresh \u9009\u9879\uff0c\u53ef\u4ee5\u6307\u5b9a\u88ab\u5224\u5b9a\u4e3a\u6807\u7b7e\u7684 confidence\uff08\u7f6e\u4fe1\u5ea6\uff09\u8fbe\u5230\u591a\u5c11\u4ee5\u4e0a\u3002\u9ed8\u8ba4\u503c\u4e0e WD14Tagger \u793a\u4f8b\u76f8\u540c\uff0c\u4e3a 0.35\u3002\u964d\u4f4e\u8be5\u503c\u4f1a\u6dfb\u52a0\u66f4\u591a\u6807\u7b7e\uff0c\u4f46\u51c6\u786e\u7387\u4f1a\u964d\u4f4e\u3002 batch_size \u8bf7\u6839\u636e GPU \u7684 VRAM \u5bb9\u91cf\u8fdb\u884c\u8c03\u6574\u3002\u8f83\u5927\u7684\u503c\u4f1a\u66f4\u5feb\uff08\u5373\u4f7f VRAM \u4e3a 12GB\uff0c\u4e5f\u53ef\u4ee5\u518d\u5927\u4e00\u4e9b\uff09\u3002\u901a\u8fc7 caption_extension \u9009\u9879\uff0c\u53ef\u4ee5\u66f4\u6539\u6807\u7b7e\u6587\u4ef6\u7684\u6269\u5c55\u540d\u3002\u9ed8\u8ba4\u503c\u4e3a .txt\u3002 \u901a\u8fc7 model_dir \u9009\u9879\uff0c\u53ef\u4ee5\u6307\u5b9a\u6a21\u578b\u7684\u4fdd\u5b58\u6587\u4ef6\u5939\u3002 \u5982\u679c\u6307\u5b9a force_download \u9009\u9879\uff0c\u5373\u4f7f\u4fdd\u5b58\u6587\u4ef6\u5939\u5b58\u5728\uff0c\u4e5f\u4f1a\u91cd\u65b0\u4e0b\u8f7d\u6a21\u578b\u3002 \u5982\u679c\u6709\u591a\u4e2a\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939\uff0c\u8bf7\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u5939\u6267\u884c\u6b64\u64cd\u4f5c\u3002","title":"\u6267\u884c\u6807\u7b7e"},{"location":"sd-scripts-docs/train/#_25","text":"\u4e3a\u4e86\u65b9\u4fbf\u4ece\u811a\u672c\u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u5c06\u6807\u9898\u548c\u6807\u7b7e\u5408\u5e76\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d\u4f5c\u4e3a\u5143\u6570\u636e\u3002","title":"\u9884\u5904\u7406\u6807\u9898\u548c\u6807\u7b7e\u4fe1\u606f"},{"location":"sd-scripts-docs/train/#_26","text":"\u8981\u5c06\u5b57\u5e55\u653e\u5165\u5143\u6570\u636e\u4e2d\uff0c\u8bf7\u5728\u5de5\u4f5c\u6587\u4ef6\u5939\u5185\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff08\u5982\u679c\u4e0d\u4f7f\u7528\u5b57\u5e55\u8fdb\u884c\u8bad\u7ec3\uff0c\u5219\u65e0\u9700\u6267\u884c\uff09\uff1a\uff08\u5b9e\u9645\u4e0a\u662f\u5728\u4e00\u884c\u4e2d\u63cf\u8ff0\u7684\uff0c\u4f9d\u6b64\u7c7b\u63a8\uff09\u3002\u6307\u5b9a --full_path \u9009\u9879\u4ee5\u5c06\u56fe\u50cf\u6587\u4ef6\u7684\u4f4d\u7f6e\u4ee5\u5b8c\u6574\u8def\u5f84\u5b58\u50a8\u5728\u5143\u6570\u636e\u4e2d\u3002\u5982\u679c\u7701\u7565\u6b64\u9009\u9879\uff0c\u5219\u4f1a\u4ee5\u76f8\u5bf9\u8def\u5f84\u8bb0\u5f55\uff0c\u4f46\u9700\u8981\u5728 .toml \u6587\u4ef6\u4e2d\u53e6\u5916\u6307\u5b9a\u6587\u4ef6\u5939\u3002 python merge_captions_to_metadata.py --full_path <\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939> --in_json <\u8981\u8bfb\u53d6\u7684\u5143\u6570\u636e\u6587\u4ef6\u540d> <\u5143\u6570\u636e\u6587\u4ef6\u540d> \u5143\u6570\u636e\u6587\u4ef6\u540d\u53ef\u4ee5\u662f\u4efb\u610f\u540d\u79f0\u3002 \u5982\u679c\u8bad\u7ec3\u6570\u636e\u662f train_data \uff0c\u6ca1\u6709\u8981\u8bfb\u53d6\u7684\u5143\u6570\u636e\u6587\u4ef6\uff0c\u5143\u6570\u636e\u6587\u4ef6\u662f meta_cap.json \uff0c\u5219\u5982\u4e0b\u6240\u793a\u3002 python merge_captions_to_metadata.py --full_path train_data meta_cap.json \u53ef\u4ee5\u4f7f\u7528 caption_extension \u9009\u9879\u6307\u5b9a\u5b57\u5e55\u7684\u6269\u5c55\u540d\u3002 \u5982\u679c\u6709\u591a\u4e2a\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939\uff0c\u5219\u9700\u8981\u6307\u5b9a full_path \u53c2\u6570\uff0c\u5e76\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u5939\u6267\u884c\u3002 python merge_captions_to_metadata.py --full_path train_data1 meta_cap1.json python merge_captions_to_metadata.py --full_path --in_json meta_cap1.json train_data2 meta_cap2.json \u5982\u679c\u7701\u7565 in_json \uff0c\u5219\u5982\u679c\u5b58\u5728\u5199\u5165\u76ee\u6807\u5143\u6570\u636e\u6587\u4ef6\uff0c\u5219\u4ece\u90a3\u91cc\u8bfb\u53d6\u5e76\u8986\u76d6\u3002 \u203b\u6bcf\u6b21\u66f4\u6539 in_json \u9009\u9879\u548c\u5199\u5165\u76ee\u6807\u4ee5\u8f93\u51fa\u5230\u4e0d\u540c\u7684\u5143\u6570\u636e\u6587\u4ef6\u4f1a\u66f4\u5b89\u5168\u3002","title":"\u5b57\u5e55\u9884\u5904\u7406"},{"location":"sd-scripts-docs/train/#_27","text":"\u540c\u6837\uff0c\u5c06\u6807\u7b7e\u6c47\u603b\u5230\u5143\u6570\u636e\u4e2d\uff08\u5982\u679c\u4e0d\u4f7f\u7528\u6807\u7b7e\u8fdb\u884c\u8bad\u7ec3\uff0c\u5219\u65e0\u9700\u6267\u884c\uff09\u3002 python merge_dd_tags_to_metadata.py --full_path <\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939> --in_json <\u8981\u8bfb\u53d6\u7684\u5143\u6570\u636e\u6587\u4ef6\u540d> <\u8981\u5199\u5165\u7684\u5143\u6570\u636e\u6587\u4ef6\u540d> \u5728\u4e0e\u4e4b\u524d\u76f8\u540c\u7684\u76ee\u5f55\u7ed3\u6784\u4e2d\uff0c\u8bfb\u53d6 meta_cap.json \u5e76\u5199\u5165 meta_cap_dd.json \u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u4e0b\u6240\u793a\u3002 python merge_dd_tags_to_metadata.py --full_path train_data --in_json meta_cap.json meta_cap_dd.json \u5982\u679c\u6709\u591a\u4e2a\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939\uff0c\u5219\u9700\u8981\u6307\u5b9a full_path \u53c2\u6570\uff0c\u5e76\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u5939\u6267\u884c\u3002 python merge_dd_tags_to_metadata.py --full_path --in_json meta_cap2.json train_data1 meta_cap_dd1.json python merge_dd_tags_to_metadata.py --full_path --in_json meta_cap_dd1.json train_data2 meta_cap_dd2.json \u5982\u679c\u7701\u7565 in_json \uff0c\u5219\u5982\u679c\u5b58\u5728\u5199\u5165\u76ee\u6807\u5143\u6570\u636e\u6587\u4ef6\uff0c\u5219\u4ece\u90a3\u91cc\u8bfb\u53d6\u5e76\u8986\u76d6\u3002 \u203b\u6bcf\u6b21\u66f4\u6539 in_json \u9009\u9879\u548c\u5199\u5165\u76ee\u6807\u4ee5\u8f93\u51fa\u5230\u4e0d\u540c\u7684\u5143\u6570\u636e\u6587\u4ef6\u4f1a\u66f4\u5b89\u5168\u3002","title":"\u6807\u7b7e\u9884\u5904\u7406"},{"location":"sd-scripts-docs/train/#_28","text":"\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u5143\u6570\u636e\u6587\u4ef6\u4e2d\u5305\u542b\u4e86\u5b57\u5e55\u548c DeepDanbooru \u7684\u6807\u7b7e\u3002\u4f46\u662f\u81ea\u52a8\u5b57\u5e55\u53ef\u80fd\u4f1a\u6709\u4e00\u4e9b\u8868\u8ff0\u4e0a\u7684\u5dee\u5f02\uff08\u203b\uff09\uff0c\u6807\u7b7e\u4e2d\u53ef\u80fd\u5305\u542b\u4e0b\u5212\u7ebf\u6216\u8bc4\u7ea7\uff08\u5982\u679c\u662f DeepDanbooru\uff09\uff0c\u56e0\u6b64\u6700\u597d\u4f7f\u7528\u7f16\u8f91\u5668\u7684\u66ff\u6362\u529f\u80fd\u6e05\u7406\u5b57\u5e55\u548c\u6807\u7b7e\u3002 \u203b\u4f8b\u5982\uff0c\u5982\u679c\u8981\u8bad\u7ec3\u52a8\u6f2b\u98ce\u683c\u7684\u5c11\u5973\u56fe\u50cf\uff0c\u5b57\u5e55\u4e2d\u53ef\u80fd\u4f1a\u6709 girl / girls / woman / women \u7b49\u4e0d\u540c\u7684\u8868\u8ff0\u3002\u5c06 \u201canime girl\u201d \u7b80\u5316\u4e3a \u201cgirl\u201d \u53ef\u80fd\u66f4\u5408\u9002\u3002 \u6211\u4eec\u51c6\u5907\u4e86\u4e00\u4e2a\u7528\u4e8e\u6e05\u7406\u7684\u811a\u672c\uff0c\u8bf7\u6839\u636e\u60c5\u51b5\u7f16\u8f91\u811a\u672c\u5185\u5bb9\u540e\u4f7f\u7528\u3002 \uff08\u4e0d\u518d\u9700\u8981\u6307\u5b9a\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939\u3002\u5143\u6570\u636e\u4e2d\u7684\u6240\u6709\u6570\u636e\u90fd\u5c06\u88ab\u6e05\u7406\u3002\uff09 python clean_captions_and_tags.py <\u8981\u8bfb\u53d6\u7684\u5143\u6570\u636e\u6587\u4ef6\u540d> <\u8981\u5199\u5165\u7684\u5143\u6570\u636e\u6587\u4ef6\u540d> \u8bf7\u6ce8\u610f\uff0c\u8fd9\u91cc\u6ca1\u6709 --in_json \u3002\u4f8b\u5982\uff1a python clean_captions_and_tags.py meta_cap_dd.json meta_clean.json \u81f3\u6b64\uff0c\u5b57\u5e55\u548c\u6807\u7b7e\u7684\u9884\u5904\u7406\u5df2\u7ecf\u5b8c\u6210\u3002","title":"\u5b57\u5e55\u548c\u6807\u7b7e\u6e05\u7406"},{"location":"sd-scripts-docs/train/#latents","text":"\u6b64\u6b65\u9aa4\u4e0d\u662f\u5fc5\u987b\u7684\u3002\u5373\u4f7f\u7701\u7565\uff0c\u4e5f\u53ef\u4ee5\u5728\u8bad\u7ec3\u65f6\u83b7\u53d6latents\u5e76\u8fdb\u884c\u5b66\u4e60\u3002 \u53e6\u5916\uff0c\u5982\u679c\u5728\u8bad\u7ec3\u65f6\u8fdb\u884c random_crop \u6216 color_aug \u7b49\u64cd\u4f5c\uff0c\u5219\u65e0\u6cd5\u9884\u5148\u83b7\u53d6latents\uff08\u56e0\u4e3a\u6bcf\u6b21\u90fd\u4f1a\u6539\u53d8\u56fe\u50cf\uff09\u3002\u5982\u679c\u4e0d\u8fdb\u884c\u9884\u5148\u83b7\u53d6\uff0c\u53ef\u4ee5\u4f7f\u7528\u5230\u76ee\u524d\u4e3a\u6b62\u7684\u5143\u6570\u636e\u8fdb\u884c\u5b66\u4e60\u3002 \u9884\u5148\u83b7\u53d6\u56fe\u50cf\u7684\u6f5c\u5728\u8868\u793a\u5e76\u5c06\u5176\u4fdd\u5b58\u5230\u78c1\u76d8\u3002\u8fd9\u6837\u53ef\u4ee5\u52a0\u5feb\u5b66\u4e60\u901f\u5ea6\u3002\u540c\u65f6\uff0c\u8fd8\u4f1a\u8fdb\u884cbucketing\uff08\u6839\u636e\u957f\u5bbd\u6bd4\u5bf9\u8bad\u7ec3\u6570\u636e\u8fdb\u884c\u5206\u7c7b\uff09\u3002 \u8bf7\u5728\u5de5\u4f5c\u6587\u4ef6\u5939\u4e2d\u8f93\u5165\u4ee5\u4e0b\u5185\u5bb9\uff1a python prepare_buckets_latents.py --full_path <\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939> <\u8bfb\u53d6\u7684\u5143\u6570\u636e\u6587\u4ef6\u540d> <\u5199\u5165\u7684\u5143\u6570\u636e\u6587\u4ef6\u540d> <fine tuning\u7684\u6a21\u578b\u540d\u6216checkpoint> --batch_size <\u6279\u6b21\u5927\u5c0f> --max_resolution <\u5206\u8fa8\u7387 \u5bbd\u5ea6,\u9ad8\u5ea6> --mixed_precision <\u7cbe\u5ea6> \u5982\u679c\u6a21\u578b\u662fmodel.ckpt\uff0c\u6279\u6b21\u5927\u5c0f\u4e3a4\uff0c\u5b66\u4e60\u5206\u8fa8\u7387\u4e3a512*512\uff0c\u7cbe\u5ea6\u4e3ano\uff08float32\uff09\uff0c\u4ecemeta_clean.json\u8bfb\u53d6\u5143\u6570\u636e\u5e76\u5199\u5165meta_lat.json\uff0c\u5219\u5982\u4e0b\u6240\u793a\uff1a python prepare_buckets_latents.py --full_path train_data meta_clean.json meta_lat.json model.ckpt --batch_size 4 --max_resolution 512,512 --mixed_precision no \u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939\u4e2d\u4f1a\u4ee5numpy\u7684npz\u683c\u5f0f\u4fdd\u5b58latents\u3002 \u53ef\u4ee5\u4f7f\u7528--min_bucket_reso\u9009\u9879\u6307\u5b9a\u5206\u8fa8\u7387\u7684\u6700\u5c0f\u5927\u5c0f\uff0c\u4f7f\u7528--max_bucket_reso\u6307\u5b9a\u6700\u5927\u5927\u5c0f\u3002\u9ed8\u8ba4\u5206\u522b\u4e3a256\u548c1024\u3002\u4f8b\u5982\uff0c\u5982\u679c\u6307\u5b9a\u6700\u5c0f\u5927\u5c0f\u4e3a384\uff0c\u5219\u4e0d\u4f1a\u4f7f\u7528256 1024\u6216320 768\u7b49\u5206\u8fa8\u7387\u3002 \u5982\u679c\u5c06\u5206\u8fa8\u7387\u63d0\u9ad8\u5230768*768\u7b49\u8f83\u5927\u7684\u503c\uff0c\u53ef\u4ee5\u5c06\u6700\u5927\u5927\u5c0f\u6307\u5b9a\u4e3a1280\u7b49\u3002 \u5982\u679c\u6307\u5b9a--flip_aug\u9009\u9879\uff0c\u5219\u4f1a\u8fdb\u884c\u5de6\u53f3\u7ffb\u8f6c\u7684\u6570\u636e\u589e\u5f3a\uff08Data Augmentation\uff09\u3002\u8fd9\u53ef\u4ee5\u4f7f\u6570\u636e\u91cf\u4f2a\u88c5\u6210\u4e24\u500d\uff0c\u4f46\u5982\u679c\u6570\u636e\u4e0d\u662f\u5de6\u53f3\u5bf9\u79f0\u7684\uff08\u4f8b\u5982\u89d2\u8272\u7684\u5916\u89c2\u3001\u53d1\u578b\u7b49\uff09\uff0c\u5219\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5b66\u4e60\u5931\u8d25\u3002 \uff08\u5bf9\u4e8e\u7ffb\u8f6c\u7684\u56fe\u50cf\uff0c\u4e5f\u4f1a\u83b7\u53d6latents\u5e76\u4fdd\u5b58*_flip.npz\u6587\u4ef6\u3002\u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u5b9e\u73b0\uff0c\u4e0d\u9700\u8981\u5728fine_tune.py\u4e2d\u6307\u5b9a\u4efb\u4f55\u9009\u9879\u3002\u5982\u679c\u5b58\u5728\u5e26\u6709_flip\u7684\u6587\u4ef6\uff0c\u5219\u4f1a\u968f\u673a\u8bfb\u53d6\u5e26\u6709flip\u548c\u4e0d\u5e26flip\u7684\u6587\u4ef6\u3002\uff09 \u6279\u6b21\u5927\u5c0f\u5373\u4f7f\u5728VRAM 12GB\u7684\u60c5\u51b5\u4e0b\u4e5f\u53ef\u4ee5\u5c1d\u8bd5\u589e\u52a0\u4e00\u4e9b\u3002 \u5206\u8fa8\u7387\u9700\u8981\u662f64\u7684\u500d\u6570\uff0c\u4ee5\"\u5bbd\u5ea6,\u9ad8\u5ea6\"\u7684\u683c\u5f0f\u6307\u5b9a\u3002\u5206\u8fa8\u7387\u76f4\u63a5\u5f71\u54cdfine tuning\u65f6\u7684\u5185\u5b58\u5927\u5c0f\u3002VRAM 12GB\u7684\u60c5\u51b5\u4e0b\uff0c512,512\u4f3c\u4e4e\u662f\u6781\u9650\uff08*\uff09\u300216GB\u7684VRAM\u53ef\u80fd\u53ef\u4ee5\u63d0\u9ad8\u5230512,704\u6216512,768\u3002\u4f46\u662f\uff0c\u5373\u4f7f\u662f256,256\u7b49\uff0c\u5728VRAM 8GB\u7684\u60c5\u51b5\u4e0b\u4f3c\u4e4e\u4e5f\u6bd4\u8f83\u5403\u529b\uff08\u56e0\u4e3a\u53c2\u6570\u548c\u4f18\u5316\u5668\u7b49\u9700\u8981\u4e00\u5b9a\u7684\u5185\u5b58\uff0c\u4e0e\u5206\u8fa8\u7387\u65e0\u5173\uff09\u3002 *\u6709\u62a5\u544a\u79f0\uff0c\u5728batch size\u4e3a1\u7684\u60c5\u51b5\u4e0b\uff0c12GB VRAM\uff0c640,640\u4e5f\u53ef\u4ee5\u8fd0\u884c\u3002 \u5982\u4e0b\u6240\u793a\uff0c\u4f1a\u663e\u793abucketing\u7684\u7ed3\u679c\uff1a \u5982\u679c\u6709\u591a\u4e2a\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939\uff0c\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9afull_path\u53c2\u6570\uff0c\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u5939\u5206\u522b\u6267\u884c\uff1a python prepare_buckets_latents.py --full_path train_data1 meta_clean.json meta_lat1.json model.ckpt --batch_size 4 --max_resolution 512,512 --mixed_precision no python prepare_buckets_latents.py --full_path train_data2 meta_lat1.json meta_lat2.json model.ckpt --batch_size 4 --max_resolution 512,512 --mixed_precision no \u53ef\u4ee5\u5c06\u8bfb\u53d6\u6e90\u548c\u5199\u5165\u76ee\u6807\u6307\u5b9a\u4e3a\u76f8\u540c\u7684\u6587\u4ef6\uff0c\u4f46\u4e3a\u4e86\u5b89\u5168\u8d77\u89c1\uff0c\u6700\u597d\u5206\u522b\u6307\u5b9a\u4e0d\u540c\u7684\u6587\u4ef6\u3002 \u4e3a\u4e86\u5b89\u5168\u8d77\u89c1\uff0c\u6bcf\u6b21\u66f4\u6539\u53c2\u6570\u5e76\u5199\u5165\u4e0d\u540c\u7684\u5143\u6570\u636e\u6587\u4ef6\u3002","title":"latents\u7684\u9884\u5148\u83b7\u53d6"},{"location":"sd-scripts-docs/train_SDXL/","text":"SDXL \u8bad\u7ec3 \u672a\u6765\uff0c\u8be5\u6587\u6863\u5c06\u88ab\u79fb\u52a8\u5230\u8bad\u7ec3\u6587\u6863\u4e2d\u3002\u4ee5\u4e0b\u662f\u5173\u4e8e SDXL \u8bad\u7ec3\u811a\u672c\u7684\u7b80\u8981\u8bf4\u660e\u3002 SDXL \u8bad\u7ec3\u811a\u672c sdxl_train.py \u662f\u4e00\u4e2a\u7528\u4e8e SDXL \u5fae\u8c03\u7684\u811a\u672c\uff0c\u5176\u7528\u6cd5\u4e0e fine_tune.py \u51e0\u4e4e\u76f8\u540c\uff0c\u4f46\u4e5f\u652f\u6301 DreamBooth \u6570\u636e\u96c6\u3002 \u65b0\u589e\u4e86 --full_bf16 \u9009\u9879\u3002\u611f\u8c22 KohakuBlueleaf\uff01 \u8be5\u9009\u9879\u542f\u7528\u5168 bfloat16 \u8bad\u7ec3\uff08\u5305\u62ec\u68af\u5ea6\uff09\u3002\u6b64\u9009\u9879\u6709\u52a9\u4e8e\u51cf\u5c11 GPU \u5185\u5b58\u4f7f\u7528\u3002 \u5168 bfloat16 \u8bad\u7ec3\u53ef\u80fd\u4e0d\u7a33\u5b9a\uff0c\u8bf7\u8c28\u614e\u4f7f\u7528\u3002 \u73b0\u5728\uff0c sdxl_train.py \u652f\u6301\u4e3a\u6bcf\u4e2a U-Net \u5757\u8bbe\u7f6e\u4e0d\u540c\u7684\u5b66\u4e60\u7387\u3002\u4f7f\u7528 --block_lr \u9009\u9879\u6307\u5b9a\uff0c\u683c\u5f0f\u4e3a\u7528\u9017\u53f7\u5206\u9694\u7684 23 \u4e2a\u503c\uff0c\u5982 --block_lr 1e-3,1e-3 ... 1e-3 \u3002 \u8fd9 23 \u4e2a\u503c\u5206\u522b\u5bf9\u5e94 0: time/label embed, 1-9: input blocks 0-8, 10-12: mid blocks 0-2, 13-21: output blocks 0-8, 22: out \u3002 prepare_buckets_latents.py \u73b0\u5728\u652f\u6301 SDXL \u5fae\u8c03\u3002 sdxl_train_network.py \u662f\u4e00\u4e2a\u7528\u4e8e SDXL LoRA \u8bad\u7ec3\u7684\u811a\u672c\uff0c\u5176\u7528\u6cd5\u4e0e train_network.py \u51e0\u4e4e\u76f8\u540c\u3002 \u4e24\u4e2a\u811a\u672c\u90fd\u6709\u4ee5\u4e0b\u9644\u52a0\u9009\u9879\uff1a --cache_text_encoder_outputs \u548c --cache_text_encoder_outputs_to_disk \uff1a\u7f13\u5b58\u6587\u672c\u7f16\u7801\u5668\u7684\u8f93\u51fa\u3002\u6b64\u9009\u9879\u6709\u52a9\u4e8e\u51cf\u5c11 GPU \u5185\u5b58\u4f7f\u7528\u3002\u4f46\u4e0d\u80fd\u4e0e\u968f\u673a\u6253\u4e71\u6216\u4e22\u5f03\u6807\u9898\u7684\u9009\u9879\u4e00\u8d77\u4f7f\u7528\u3002 --no_half_vae \uff1a\u7981\u7528\u534a\u7cbe\u5ea6\uff08\u6df7\u5408\u7cbe\u5ea6\uff09VAE\u3002SDXL \u7684 VAE \u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u4f3c\u4e4e\u4f1a\u4ea7\u751f NaN\u3002\u6b64\u9009\u9879\u6709\u52a9\u4e8e\u907f\u514d NaN\u3002 --weighted_captions \u9009\u9879\u5c1a\u4e0d\u652f\u6301\u8fd9\u4e24\u4e2a\u811a\u672c\u3002 sdxl_train_textual_inversion.py \u662f\u4e00\u4e2a\u7528\u4e8e SDXL Textual Inversion \u8bad\u7ec3\u7684\u811a\u672c\uff0c\u5176\u7528\u6cd5\u4e0e train_textual_inversion.py \u51e0\u4e4e\u76f8\u540c\u3002 \u4e0d\u652f\u6301 --cache_text_encoder_outputs \u3002 \u6709\u4e24\u79cd\u6807\u9898\u9009\u9879\uff1a \u4f7f\u7528\u6807\u9898\u8fdb\u884c\u8bad\u7ec3\u3002\u6240\u6709\u6807\u9898\u5fc5\u987b\u5305\u542b\u6807\u8bb0\u5b57\u7b26\u4e32\u3002\u6807\u8bb0\u5b57\u7b26\u4e32\u5c06\u88ab\u66ff\u6362\u4e3a\u591a\u4e2a\u6807\u8bb0\u3002 \u4f7f\u7528 --use_object_template \u6216 --use_style_template \u9009\u9879\u3002\u6807\u9898\u5c06\u4ece\u6a21\u677f\u751f\u6210\u3002\u73b0\u6709\u7684\u6807\u9898\u5c06\u88ab\u5ffd\u7565\u3002 \u4e0b\u9762\u662f\u5d4c\u5165\u7684\u683c\u5f0f\u3002 --min_timestep \u548c --max_timestep \u9009\u9879\u5df2\u6dfb\u52a0\u5230\u6bcf\u4e2a\u8bad\u7ec3\u811a\u672c\u4e2d\u3002\u8fd9\u4e9b\u9009\u9879\u53ef\u7528\u4e8e\u4f7f\u7528\u4e0d\u540c\u7684\u65f6\u95f4\u6b65\u8bad\u7ec3 U-Net\u3002\u9ed8\u8ba4\u503c\u4e3a 0 \u548c 1000\u3002 SDXL \u5b9e\u7528\u811a\u672c \u65b0\u589e\u4e86 tools/cache_latents.py \u3002\u8be5\u811a\u672c\u53ef\u7528\u4e8e\u63d0\u524d\u5c06\u6f5c\u53d8\u91cf\u7f13\u5b58\u5230\u78c1\u76d8\u3002 \u9009\u9879\u4e0e sdxl_train.py \u51e0\u4e4e\u76f8\u540c\u3002\u6709\u5173\u7528\u6cd5\uff0c\u8bf7\u53c2\u89c1\u5e2e\u52a9\u6d88\u606f\u3002 \u8bf7\u6309\u4ee5\u4e0b\u65b9\u5f0f\u542f\u52a8\u811a\u672c\uff1a accelerate launch --num_cpu_threads_per_process 1 tools/cache_latents.py ... \u8be5\u811a\u672c\u5e94\u8be5\u53ef\u4ee5\u5728\u591a GPU \u4e0a\u5de5\u4f5c\uff0c\u4f46\u5c1a\u672a\u5728\u6211\u7684\u73af\u5883\u4e2d\u8fdb\u884c\u6d4b\u8bd5\u3002 \u65b0\u589e\u4e86 tools/cache_text_encoder_outputs.py \u3002\u8be5\u811a\u672c\u53ef\u7528\u4e8e\u63d0\u524d\u5c06\u6587\u672c\u7f16\u7801\u5668\u8f93\u51fa\u7f13\u5b58\u5230\u78c1\u76d8\u3002 \u9009\u9879\u4e0e cache_latents.py \u548c sdxl_train.py \u51e0\u4e4e\u76f8\u540c\u3002\u6709\u5173\u7528\u6cd5\uff0c\u8bf7\u53c2\u89c1\u5e2e\u52a9\u6d88\u606f\u3002 \u65b0\u589e\u4e86 sdxl_gen_img.py \u3002\u8be5\u811a\u672c\u53ef\u7528\u4e8e\u4f7f\u7528 SDXL\uff08\u5305\u62ec LoRA\u3001Textual Inversion \u548c ControlNet-LLLite\uff09\u751f\u6210\u56fe\u50cf\u3002\u6709\u5173\u7528\u6cd5\uff0c\u8bf7\u53c2\u89c1\u5e2e\u52a9\u6d88\u606f\u3002 SDXL \u8bad\u7ec3\u6280\u5de7 SDXL \u7684\u9ed8\u8ba4\u5206\u8fa8\u7387\u4e3a 1024x1024\u3002 \u5fae\u8c03\u53ef\u4ee5\u5728 24GB GPU \u5185\u5b58\u4e0b\u4ee5\u6279\u91cf\u5927\u5c0f\u4e3a 1 \u8fdb\u884c\u3002\u5bf9\u4e8e 24GB GPU\uff0c\u5efa\u8bae\u4f7f\u7528\u4ee5\u4e0b\u9009\u9879__\u8fdb\u884c 24GB GPU \u5185\u5b58\u4e0b\u7684\u5fae\u8c03__\uff1a \u4ec5\u8bad\u7ec3 U-Net\u3002 \u4f7f\u7528\u68af\u5ea6\u68c0\u67e5\u70b9\u3002 \u4f7f\u7528 --cache_text_encoder_outputs \u9009\u9879\u548c\u7f13\u5b58\u6f5c\u53d8\u91cf\u3002 \u4f7f\u7528 Adafactor \u4f18\u5316\u5668\u3002RMSprop 8bit \u6216 Adagrad 8bit \u53ef\u80fd\u6709\u6548\u3002AdamW 8bit \u4f3c\u4e4e\u65e0\u6548\u3002 LoRA \u8bad\u7ec3\u53ef\u4ee5\u5728 8GB GPU \u5185\u5b58\u4e0b\u8fdb\u884c\uff08\u63a8\u8350 10GB\uff09\u3002\u4e3a\u4e86\u51cf\u5c11 GPU \u5185\u5b58\u4f7f\u7528\uff0c\u5efa\u8bae\u4f7f\u7528\u4ee5\u4e0b\u9009\u9879\uff1a \u4ec5\u8bad\u7ec3 U-Net\u3002 \u4f7f\u7528\u68af\u5ea6\u68c0\u67e5\u70b9\u3002 \u4f7f\u7528 --cache_text_encoder_outputs \u9009\u9879\u548c\u7f13\u5b58\u6f5c\u53d8\u91cf\u3002 \u4f7f\u7528 8 \u4f4d\u4f18\u5316\u5668\u6216 Adafactor \u4f18\u5316\u5668\u4e4b\u4e00\u3002 \u4f7f\u7528\u8f83\u4f4e\u7684\u7ef4\u5ea6\uff08\u5bf9\u4e8e 8GB GPU \u4e3a 4 \u5230 8\uff09\u3002 \u5f3a\u70c8\u5efa\u8bae\u4e3a SDXL LoRA \u4f7f\u7528 --network_train_unet_only \u9009\u9879\u3002\u56e0\u4e3a SDXL \u6709\u4e24\u4e2a\u6587\u672c\u7f16\u7801\u5668\uff0c\u8bad\u7ec3\u7ed3\u679c\u53ef\u80fd\u4e0d\u7b26\u5408\u9884\u671f\u3002 PyTorch 2 \u4f3c\u4e4e\u6bd4 PyTorch 1 \u4f7f\u7528\u7684 GPU \u5185\u5b58\u7565\u5c11\u3002 --bucket_reso_steps \u53ef\u4ee5\u8bbe\u7f6e\u4e3a 32\uff0c\u800c\u4e0d\u662f\u9ed8\u8ba4\u503c 64\u3002\u5c0f\u4e8e 32 \u7684\u503c\u4e0d\u9002\u7528\u4e8e SDXL \u8bad\u7ec3\u3002 Adafactor \u4f18\u5316\u5668\u7684\u793a\u4f8b\u914d\u7f6e\uff08\u56fa\u5b9a\u5b66\u4e60\u7387\uff09\uff1a optimizer_type = \"adafactor\" optimizer_args = [ \"scale_parameter=False\", \"relative_step=False\", \"warmup_init=False\" ] lr_scheduler = \"constant_with_warmup\" lr_warmup_steps = 100 learning_rate = 4e-7 # SDXL \u539f\u59cb\u5b66\u4e60\u7387 SDXL Textual Inversion \u5d4c\u5165\u683c\u5f0f from safetensors.torch import save_file state_dict = {\"clip_g\": embs_for_text_encoder_1280, \"clip_l\": embs_for_text_encoder_768} save_file(state_dict, file) ControlNet-LLLite \u65b0\u589e\u4e86 ControlNet-LLLite\uff0c\u4e00\u79cd\u7528\u4e8e SDXL \u7684\u65b0\u578b ControlNet \u65b9\u6cd5\u3002\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u89c1 \u6587\u6863 \u3002","title":"SDXL-\u6a21\u578b\u8bad\u7ec3"},{"location":"sd-scripts-docs/train_SDXL/#sdxl","text":"\u672a\u6765\uff0c\u8be5\u6587\u6863\u5c06\u88ab\u79fb\u52a8\u5230\u8bad\u7ec3\u6587\u6863\u4e2d\u3002\u4ee5\u4e0b\u662f\u5173\u4e8e SDXL \u8bad\u7ec3\u811a\u672c\u7684\u7b80\u8981\u8bf4\u660e\u3002","title":"SDXL \u8bad\u7ec3"},{"location":"sd-scripts-docs/train_SDXL/#sdxl_1","text":"sdxl_train.py \u662f\u4e00\u4e2a\u7528\u4e8e SDXL \u5fae\u8c03\u7684\u811a\u672c\uff0c\u5176\u7528\u6cd5\u4e0e fine_tune.py \u51e0\u4e4e\u76f8\u540c\uff0c\u4f46\u4e5f\u652f\u6301 DreamBooth \u6570\u636e\u96c6\u3002 \u65b0\u589e\u4e86 --full_bf16 \u9009\u9879\u3002\u611f\u8c22 KohakuBlueleaf\uff01 \u8be5\u9009\u9879\u542f\u7528\u5168 bfloat16 \u8bad\u7ec3\uff08\u5305\u62ec\u68af\u5ea6\uff09\u3002\u6b64\u9009\u9879\u6709\u52a9\u4e8e\u51cf\u5c11 GPU \u5185\u5b58\u4f7f\u7528\u3002 \u5168 bfloat16 \u8bad\u7ec3\u53ef\u80fd\u4e0d\u7a33\u5b9a\uff0c\u8bf7\u8c28\u614e\u4f7f\u7528\u3002 \u73b0\u5728\uff0c sdxl_train.py \u652f\u6301\u4e3a\u6bcf\u4e2a U-Net \u5757\u8bbe\u7f6e\u4e0d\u540c\u7684\u5b66\u4e60\u7387\u3002\u4f7f\u7528 --block_lr \u9009\u9879\u6307\u5b9a\uff0c\u683c\u5f0f\u4e3a\u7528\u9017\u53f7\u5206\u9694\u7684 23 \u4e2a\u503c\uff0c\u5982 --block_lr 1e-3,1e-3 ... 1e-3 \u3002 \u8fd9 23 \u4e2a\u503c\u5206\u522b\u5bf9\u5e94 0: time/label embed, 1-9: input blocks 0-8, 10-12: mid blocks 0-2, 13-21: output blocks 0-8, 22: out \u3002 prepare_buckets_latents.py \u73b0\u5728\u652f\u6301 SDXL \u5fae\u8c03\u3002 sdxl_train_network.py \u662f\u4e00\u4e2a\u7528\u4e8e SDXL LoRA \u8bad\u7ec3\u7684\u811a\u672c\uff0c\u5176\u7528\u6cd5\u4e0e train_network.py \u51e0\u4e4e\u76f8\u540c\u3002 \u4e24\u4e2a\u811a\u672c\u90fd\u6709\u4ee5\u4e0b\u9644\u52a0\u9009\u9879\uff1a --cache_text_encoder_outputs \u548c --cache_text_encoder_outputs_to_disk \uff1a\u7f13\u5b58\u6587\u672c\u7f16\u7801\u5668\u7684\u8f93\u51fa\u3002\u6b64\u9009\u9879\u6709\u52a9\u4e8e\u51cf\u5c11 GPU \u5185\u5b58\u4f7f\u7528\u3002\u4f46\u4e0d\u80fd\u4e0e\u968f\u673a\u6253\u4e71\u6216\u4e22\u5f03\u6807\u9898\u7684\u9009\u9879\u4e00\u8d77\u4f7f\u7528\u3002 --no_half_vae \uff1a\u7981\u7528\u534a\u7cbe\u5ea6\uff08\u6df7\u5408\u7cbe\u5ea6\uff09VAE\u3002SDXL \u7684 VAE \u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u4f3c\u4e4e\u4f1a\u4ea7\u751f NaN\u3002\u6b64\u9009\u9879\u6709\u52a9\u4e8e\u907f\u514d NaN\u3002 --weighted_captions \u9009\u9879\u5c1a\u4e0d\u652f\u6301\u8fd9\u4e24\u4e2a\u811a\u672c\u3002 sdxl_train_textual_inversion.py \u662f\u4e00\u4e2a\u7528\u4e8e SDXL Textual Inversion \u8bad\u7ec3\u7684\u811a\u672c\uff0c\u5176\u7528\u6cd5\u4e0e train_textual_inversion.py \u51e0\u4e4e\u76f8\u540c\u3002 \u4e0d\u652f\u6301 --cache_text_encoder_outputs \u3002 \u6709\u4e24\u79cd\u6807\u9898\u9009\u9879\uff1a \u4f7f\u7528\u6807\u9898\u8fdb\u884c\u8bad\u7ec3\u3002\u6240\u6709\u6807\u9898\u5fc5\u987b\u5305\u542b\u6807\u8bb0\u5b57\u7b26\u4e32\u3002\u6807\u8bb0\u5b57\u7b26\u4e32\u5c06\u88ab\u66ff\u6362\u4e3a\u591a\u4e2a\u6807\u8bb0\u3002 \u4f7f\u7528 --use_object_template \u6216 --use_style_template \u9009\u9879\u3002\u6807\u9898\u5c06\u4ece\u6a21\u677f\u751f\u6210\u3002\u73b0\u6709\u7684\u6807\u9898\u5c06\u88ab\u5ffd\u7565\u3002 \u4e0b\u9762\u662f\u5d4c\u5165\u7684\u683c\u5f0f\u3002 --min_timestep \u548c --max_timestep \u9009\u9879\u5df2\u6dfb\u52a0\u5230\u6bcf\u4e2a\u8bad\u7ec3\u811a\u672c\u4e2d\u3002\u8fd9\u4e9b\u9009\u9879\u53ef\u7528\u4e8e\u4f7f\u7528\u4e0d\u540c\u7684\u65f6\u95f4\u6b65\u8bad\u7ec3 U-Net\u3002\u9ed8\u8ba4\u503c\u4e3a 0 \u548c 1000\u3002","title":"SDXL \u8bad\u7ec3\u811a\u672c"},{"location":"sd-scripts-docs/train_SDXL/#sdxl_2","text":"\u65b0\u589e\u4e86 tools/cache_latents.py \u3002\u8be5\u811a\u672c\u53ef\u7528\u4e8e\u63d0\u524d\u5c06\u6f5c\u53d8\u91cf\u7f13\u5b58\u5230\u78c1\u76d8\u3002 \u9009\u9879\u4e0e sdxl_train.py \u51e0\u4e4e\u76f8\u540c\u3002\u6709\u5173\u7528\u6cd5\uff0c\u8bf7\u53c2\u89c1\u5e2e\u52a9\u6d88\u606f\u3002 \u8bf7\u6309\u4ee5\u4e0b\u65b9\u5f0f\u542f\u52a8\u811a\u672c\uff1a accelerate launch --num_cpu_threads_per_process 1 tools/cache_latents.py ... \u8be5\u811a\u672c\u5e94\u8be5\u53ef\u4ee5\u5728\u591a GPU \u4e0a\u5de5\u4f5c\uff0c\u4f46\u5c1a\u672a\u5728\u6211\u7684\u73af\u5883\u4e2d\u8fdb\u884c\u6d4b\u8bd5\u3002 \u65b0\u589e\u4e86 tools/cache_text_encoder_outputs.py \u3002\u8be5\u811a\u672c\u53ef\u7528\u4e8e\u63d0\u524d\u5c06\u6587\u672c\u7f16\u7801\u5668\u8f93\u51fa\u7f13\u5b58\u5230\u78c1\u76d8\u3002 \u9009\u9879\u4e0e cache_latents.py \u548c sdxl_train.py \u51e0\u4e4e\u76f8\u540c\u3002\u6709\u5173\u7528\u6cd5\uff0c\u8bf7\u53c2\u89c1\u5e2e\u52a9\u6d88\u606f\u3002 \u65b0\u589e\u4e86 sdxl_gen_img.py \u3002\u8be5\u811a\u672c\u53ef\u7528\u4e8e\u4f7f\u7528 SDXL\uff08\u5305\u62ec LoRA\u3001Textual Inversion \u548c ControlNet-LLLite\uff09\u751f\u6210\u56fe\u50cf\u3002\u6709\u5173\u7528\u6cd5\uff0c\u8bf7\u53c2\u89c1\u5e2e\u52a9\u6d88\u606f\u3002","title":"SDXL \u5b9e\u7528\u811a\u672c"},{"location":"sd-scripts-docs/train_SDXL/#sdxl_3","text":"SDXL \u7684\u9ed8\u8ba4\u5206\u8fa8\u7387\u4e3a 1024x1024\u3002 \u5fae\u8c03\u53ef\u4ee5\u5728 24GB GPU \u5185\u5b58\u4e0b\u4ee5\u6279\u91cf\u5927\u5c0f\u4e3a 1 \u8fdb\u884c\u3002\u5bf9\u4e8e 24GB GPU\uff0c\u5efa\u8bae\u4f7f\u7528\u4ee5\u4e0b\u9009\u9879__\u8fdb\u884c 24GB GPU \u5185\u5b58\u4e0b\u7684\u5fae\u8c03__\uff1a \u4ec5\u8bad\u7ec3 U-Net\u3002 \u4f7f\u7528\u68af\u5ea6\u68c0\u67e5\u70b9\u3002 \u4f7f\u7528 --cache_text_encoder_outputs \u9009\u9879\u548c\u7f13\u5b58\u6f5c\u53d8\u91cf\u3002 \u4f7f\u7528 Adafactor \u4f18\u5316\u5668\u3002RMSprop 8bit \u6216 Adagrad 8bit \u53ef\u80fd\u6709\u6548\u3002AdamW 8bit \u4f3c\u4e4e\u65e0\u6548\u3002 LoRA \u8bad\u7ec3\u53ef\u4ee5\u5728 8GB GPU \u5185\u5b58\u4e0b\u8fdb\u884c\uff08\u63a8\u8350 10GB\uff09\u3002\u4e3a\u4e86\u51cf\u5c11 GPU \u5185\u5b58\u4f7f\u7528\uff0c\u5efa\u8bae\u4f7f\u7528\u4ee5\u4e0b\u9009\u9879\uff1a \u4ec5\u8bad\u7ec3 U-Net\u3002 \u4f7f\u7528\u68af\u5ea6\u68c0\u67e5\u70b9\u3002 \u4f7f\u7528 --cache_text_encoder_outputs \u9009\u9879\u548c\u7f13\u5b58\u6f5c\u53d8\u91cf\u3002 \u4f7f\u7528 8 \u4f4d\u4f18\u5316\u5668\u6216 Adafactor \u4f18\u5316\u5668\u4e4b\u4e00\u3002 \u4f7f\u7528\u8f83\u4f4e\u7684\u7ef4\u5ea6\uff08\u5bf9\u4e8e 8GB GPU \u4e3a 4 \u5230 8\uff09\u3002 \u5f3a\u70c8\u5efa\u8bae\u4e3a SDXL LoRA \u4f7f\u7528 --network_train_unet_only \u9009\u9879\u3002\u56e0\u4e3a SDXL \u6709\u4e24\u4e2a\u6587\u672c\u7f16\u7801\u5668\uff0c\u8bad\u7ec3\u7ed3\u679c\u53ef\u80fd\u4e0d\u7b26\u5408\u9884\u671f\u3002 PyTorch 2 \u4f3c\u4e4e\u6bd4 PyTorch 1 \u4f7f\u7528\u7684 GPU \u5185\u5b58\u7565\u5c11\u3002 --bucket_reso_steps \u53ef\u4ee5\u8bbe\u7f6e\u4e3a 32\uff0c\u800c\u4e0d\u662f\u9ed8\u8ba4\u503c 64\u3002\u5c0f\u4e8e 32 \u7684\u503c\u4e0d\u9002\u7528\u4e8e SDXL \u8bad\u7ec3\u3002 Adafactor \u4f18\u5316\u5668\u7684\u793a\u4f8b\u914d\u7f6e\uff08\u56fa\u5b9a\u5b66\u4e60\u7387\uff09\uff1a optimizer_type = \"adafactor\" optimizer_args = [ \"scale_parameter=False\", \"relative_step=False\", \"warmup_init=False\" ] lr_scheduler = \"constant_with_warmup\" lr_warmup_steps = 100 learning_rate = 4e-7 # SDXL \u539f\u59cb\u5b66\u4e60\u7387","title":"SDXL \u8bad\u7ec3\u6280\u5de7"},{"location":"sd-scripts-docs/train_SDXL/#sdxl-textual-inversion","text":"from safetensors.torch import save_file state_dict = {\"clip_g\": embs_for_text_encoder_1280, \"clip_l\": embs_for_text_encoder_768} save_file(state_dict, file)","title":"SDXL Textual Inversion \u5d4c\u5165\u683c\u5f0f"},{"location":"sd-scripts-docs/train_SDXL/#controlnet-lllite","text":"\u65b0\u589e\u4e86 ControlNet-LLLite\uff0c\u4e00\u79cd\u7528\u4e8e SDXL \u7684\u65b0\u578b ControlNet \u65b9\u6cd5\u3002\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u89c1 \u6587\u6863 \u3002","title":"ControlNet-LLLite"},{"location":"sd-scripts-docs/train_db/","text":"DreamBooth\u6307\u5357 \u8bf7\u540c\u65f6\u53c2\u8003\u5173\u4e8e\u8bad\u7ec3\u7684\u5171\u540c\u6587\u6863\u3002 \u6982\u8981 DreamBooth\u662f\u4e00\u79cd\u6280\u672f\uff0c\u901a\u8fc7\u5bf9\u56fe\u50cf\u751f\u6210\u6a21\u578b\u8fdb\u884c\u7279\u5b9a\u4e3b\u9898\u7684\u989d\u5916\u8bad\u7ec3\uff0c\u5e76\u4f7f\u7528\u7279\u5b9a\u7684\u6807\u8bc6\u7b26\u751f\u6210\u56fe\u50cf\u3002 \u76f8\u5173\u8bba\u6587\u5728\u6b64 \u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u53ef\u4ee5\u8ba9Stable Diffusion\u6a21\u578b\u5b66\u4e60\u7279\u5b9a\u7684\u89d2\u8272\u6216\u7ed8\u753b\u98ce\u683c\u7b49\uff0c\u5e76\u901a\u8fc7\u50cf shs \u8fd9\u6837\u7684\u7279\u5b9a\u5355\u8bcd\u6765\u8c03\u7528\uff08\u4f7f\u4e4b\u51fa\u73b0\u5728\u751f\u6210\u7684\u56fe\u50cf\u4e2d\uff09\u3002 \u8be5\u811a\u672c\u57fa\u4e8e Diffusers\u7684DreamBooth \uff0c\u4f46\u6dfb\u52a0\u4e86\u4ee5\u4e0b\u529f\u80fd\uff08\u5176\u4e2d\u4e00\u4e9b\u529f\u80fd\u540e\u6765\u4e5f\u88ab\u539f\u811a\u672c\u652f\u6301\uff09\u3002 \u811a\u672c\u7684\u4e3b\u8981\u529f\u80fd\u5982\u4e0b\uff1a \u901a\u8fc78\u4f4dAdam\u4f18\u5316\u5668\u548c\u6f5c\u5728\u53d8\u91cf\u7f13\u5b58\u6765\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff08\u4e0e Shivam Shrirao\u6c0f\u7248 \u7c7b\u4f3c\uff09\u3002 \u901a\u8fc7xformers\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\u3002 \u4e0d\u4ec5\u652f\u6301512x512\uff0c\u8fd8\u652f\u6301\u4efb\u610f\u5927\u5c0f\u7684\u8bad\u7ec3\u3002 \u901a\u8fc7\u6570\u636e\u589e\u5f3a\u63d0\u9ad8\u8d28\u91cf\u3002 \u4e0d\u4ec5\u652f\u6301DreamBooth\uff0c\u8fd8\u652f\u6301Text Encoder+U-Net\u7684\u5fae\u8c03\u3002 \u4ee5Stable Diffusion\u683c\u5f0f\u8bfb\u5199\u6a21\u578b\u3002 \u652f\u6301\u957f\u5bbd\u6bd4\u5b58\u50a8\u6876\uff08Aspect Ratio Bucketing\uff09\u3002 \u652f\u6301Stable Diffusion v2.0\u3002 \u8bad\u7ec3\u6b65\u9aa4 \u8bf7\u4e8b\u5148\u53c2\u8003\u672c\u4ed3\u5e93\u7684README\uff0c\u8fdb\u884c\u73af\u5883\u51c6\u5907\u3002 \u6570\u636e\u51c6\u5907 \u8bf7\u53c2\u8003 \u5173\u4e8e\u8bad\u7ec3\u6570\u636e\u51c6\u5907 \u3002 \u6267\u884c\u8bad\u7ec3 \u8fd0\u884c\u811a\u672c\u3002\u4ee5\u4e0b\u662f\u6700\u5927\u9650\u5ea6\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\u7684\u547d\u4ee4\u793a\u4f8b\uff08\u5b9e\u9645\u4e0a\u5e94\u8be5\u5728\u4e00\u884c\u4e2d\u8f93\u5165\uff09\u3002\u8bf7\u6839\u636e\u9700\u8981\u4fee\u6539\u6bcf\u4e00\u884c\u3002\u5927\u7ea612GB\u7684VRAM\u4f3c\u4e4e\u53ef\u4ee5\u8fd0\u884c\u3002 accelerate launch --num_cpu_threads_per_process 1 train_db.py --pretrained_model_name_or_path=<.ckpt\u6216.safetensors\u6216Diffusers\u683c\u5f0f\u7684\u6a21\u578b\u76ee\u5f55> --dataset_config=<\u6570\u636e\u51c6\u5907\u65f6\u521b\u5efa\u7684.toml\u6587\u4ef6> --output_dir=<\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u8f93\u51fa\u76ee\u5f55> --output_name=<\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u8f93\u51fa\u6587\u4ef6\u540d> --save_model_as=safetensors --prior_loss_weight=1.0 --max_train_steps=1600 --learning_rate=1e-6 --optimizer_type=\"AdamW8bit\" --xformers --mixed_precision=\"fp16\" --cache_latents --gradient_checkpointing \u901a\u5e38\uff0c num_cpu_threads_per_process \u8bbe\u7f6e\u4e3a1\u4f3c\u4e4e\u6bd4\u8f83\u5408\u9002\u3002 \u5728 pretrained_model_name_or_path \u4e2d\u6307\u5b9a\u7528\u4e8e\u989d\u5916\u8bad\u7ec3\u7684\u57fa\u7840\u6a21\u578b\u3002\u53ef\u4ee5\u6307\u5b9aStable Diffusion\u7684\u68c0\u67e5\u70b9\u6587\u4ef6\uff08 .ckpt \u6216 .safetensors \uff09\u3001Diffusers\u7684\u672c\u5730\u78c1\u76d8\u4e0a\u7684\u6a21\u578b\u76ee\u5f55\u6216Diffusers\u7684\u6a21\u578bID\uff08\u4f8b\u5982\"stabilityai/stable-diffusion-2\"\uff09\u3002 \u5728 output_dir \u4e2d\u6307\u5b9a\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u7684\u4fdd\u5b58\u76ee\u5f55\u3002\u5728 output_name \u4e2d\u6307\u5b9a\u6a21\u578b\u7684\u6587\u4ef6\u540d\uff08\u4e0d\u5305\u62ec\u6269\u5c55\u540d\uff09\u3002 save_model_as \u7528\u4e8e\u6307\u5b9a\u4ee5safetensors\u683c\u5f0f\u4fdd\u5b58\u6a21\u578b\u3002 \u5728 dataset_config \u4e2d\u6307\u5b9a .toml \u6587\u4ef6\u3002\u6587\u4ef6\u5185\u7684\u6279\u91cf\u5927\u5c0f\u6700\u521d\u5e94\u8bbe\u7f6e\u4e3a 1 \u4ee5\u51cf\u5c11\u5185\u5b58\u6d88\u8017\u3002 prior_loss_weight \u662f\u6b63\u5219\u5316\u56fe\u50cf\u635f\u5931\u7684\u6743\u91cd\u3002\u901a\u5e38\u6307\u5b9a\u4e3a1.0\u3002 \u5c06\u8bad\u7ec3\u6b65\u6570 max_train_steps \u8bbe\u7f6e\u4e3a1600\u3002\u8fd9\u91cc\u5c06\u5b66\u4e60\u7387 learning_rate \u6307\u5b9a\u4e3a1e-6\u3002 \u4e3a\u4e86\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff0c\u6307\u5b9a mixed_precision=\"fp16\" \uff08\u5bf9\u4e8eRTX30\u7cfb\u5217\u53ca\u4ee5\u540e\uff0c\u53ef\u4ee5\u6307\u5b9a bf16 \u3002\u8bf7\u4e0e\u5728\u73af\u5883\u51c6\u5907\u65f6\u5bf9accelerate\u8fdb\u884c\u7684\u8bbe\u7f6e\u4fdd\u6301\u4e00\u81f4\uff09\u3002\u540c\u65f6\u6307\u5b9a gradient_checkpointing \u3002 \u4e3a\u4e86\u4f7f\u7528\u5185\u5b58\u6d88\u8017\u8f83\u5c11\u76848\u4f4dAdamW\u4f5c\u4e3a\u4f18\u5316\u5668\uff08\u4f7f\u6a21\u578b\u9002\u5e94\u5b66\u4e60\u6570\u636e\uff09\uff0c\u6307\u5b9a optimizer_type=\"AdamW8bit\" \u3002 \u6307\u5b9a xformers \u9009\u9879\u4ee5\u4f7f\u7528xformers\u7684CrossAttention\u3002\u5982\u679c\u672a\u5b89\u88c5xformers\u6216\u51fa\u73b0\u9519\u8bef\uff08\u5728\u67d0\u4e9b\u73af\u5883\u4e0b\uff0c\u4f8b\u5982 mixed_precision=\"no\" \uff09\uff0c\u53ef\u4ee5\u6539\u4e3a\u6307\u5b9a mem_eff_attn \u9009\u9879\u4ee5\u4f7f\u7528\u8282\u7701\u5185\u5b58\u7684CrossAttention\uff08\u901f\u5ea6\u4f1a\u53d8\u6162\uff09\u3002 \u4e3a\u4e86\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff0c\u6307\u5b9a cache_latents \u9009\u9879\u4ee5\u7f13\u5b58VAE\u7684\u8f93\u51fa\u3002 \u5982\u679c\u6709\u8db3\u591f\u7684\u5185\u5b58\uff0c\u53ef\u4ee5\u7f16\u8f91 .toml \u6587\u4ef6\uff0c\u5c06\u6279\u91cf\u5927\u5c0f\u589e\u52a0\u5230\u4f8b\u5982 4 \uff08\u53ef\u80fd\u4f1a\u63d0\u9ad8\u901f\u5ea6\u548c\u51c6\u786e\u6027\uff09\u3002\u540c\u65f6\uff0c\u79fb\u9664 cache_latents \u53ef\u4ee5\u542f\u7528\u6570\u636e\u589e\u5f3a\u3002 \u5e38\u7528\u9009\u9879 \u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\uff0c\u8bf7\u53c2\u8003 \u8bad\u7ec3\u7684\u5171\u540c\u6587\u6863 \u4e2d\u7684\u201c\u5e38\u7528\u9009\u9879\u201d\u3002 \u8bad\u7ec3Stable Diffusion 2.x\u6216\u5176\u884d\u751f\u6a21\u578b \u8bad\u7ec3clip skip\u4e3a2\u6216\u4ee5\u4e0a\u7684\u6a21\u578b \u4f7f\u7528\u8d85\u8fc775\u4e2a\u6807\u8bb0\u7684\u6807\u9898\u8fdb\u884c\u8bad\u7ec3 \u5173\u4e8eDreamBooth\u7684\u8bad\u7ec3\u6b65\u6570 \u5728\u672c\u811a\u672c\u4e2d\uff0c\u4e3a\u4e86\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff0c\u6bcf\u6b65\u7684\u8bad\u7ec3\u6b21\u6570\u662f\u539f\u811a\u672c\u7684\u4e00\u534a\uff08\u5c06\u76ee\u6807\u56fe\u50cf\u548c\u6b63\u5219\u5316\u56fe\u50cf\u5206\u6210\u4e0d\u540c\u7684\u6279\u6b21\u8fdb\u884c\u8bad\u7ec3\uff09\u3002 \u4e3a\u4e86\u4e0e\u539f\u59cbDiffusers\u7248\u672c\u6216XavierXiao\u7684Stable Diffusion\u7248\u672c\u8fdb\u884c\u51e0\u4e4e\u76f8\u540c\u7684\u8bad\u7ec3\uff0c\u8bf7\u5c06\u8bad\u7ec3\u6b65\u6570\u52a0\u500d\u3002 \uff08\u7531\u4e8e\u5728\u6c47\u603b\u5b66\u4e60\u56fe\u50cf\u548c\u6b63\u5219\u5316\u56fe\u50cf\u540e\u8fdb\u884cshuffle\uff0c\u6570\u636e\u7684\u987a\u5e8f\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u4f46\u5bf9\u8bad\u7ec3\u7684\u5f71\u54cd\u5e94\u8be5\u4e0d\u5927\u3002\uff09 \u5173\u4e8eDreamBooth\u7684\u6279\u6b21\u5927\u5c0f \u7531\u4e8e\u9700\u8981\u8bad\u7ec3\u6574\u4e2a\u6a21\u578b\uff0c\u5185\u5b58\u6d88\u8017\u4f1a\u6bd4LoRA\u7b49\u8bad\u7ec3\u65b9\u6cd5\u66f4\u591a\uff08\u4e0e\u5fae\u8c03\u76f8\u540c\uff09\u3002 \u5173\u4e8e\u5b66\u4e60\u7387 Diffusers\u7248\u672c\u4f7f\u75285e-6\uff0c\u800cStable Diffusion\u7248\u672c\u4f7f\u75281e-6\uff0c\u56e0\u6b64\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\u4f7f\u75281e-6\u3002 \u4f7f\u7528\u65e7\u5f0f\u6570\u636e\u96c6\u6307\u5b9a\u65f6\u7684\u547d\u4ee4\u884c \u6307\u5b9a\u5206\u8fa8\u7387\u548c\u6279\u6b21\u5927\u5c0f\u4f5c\u4e3a\u9009\u9879\u3002\u547d\u4ee4\u884c\u793a\u4f8b\u5982\u4e0b\uff1a accelerate launch --num_cpu_threads_per_process 1 train_db.py --pretrained_model_name_or_path=<.ckpt\u6216.safetensors\u6216Diffusers\u683c\u5f0f\u7684\u6a21\u578b\u76ee\u5f55> --train_data_dir=<\u8bad\u7ec3\u6570\u636e\u76ee\u5f55> --reg_data_dir=<\u6b63\u5219\u5316\u56fe\u50cf\u76ee\u5f55> --output_dir=<\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u8f93\u51fa\u76ee\u5f55> --output_name=<\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u8f93\u51fa\u6587\u4ef6\u540d> --prior_loss_weight=1.0 --resolution=512 --train_batch_size=1 --learning_rate=1e-6 --max_train_steps=1600 --use_8bit_adam --xformers --mixed_precision=\"bf16\" --cache_latents --gradient_checkpointing \u7528\u8bad\u7ec3\u597d\u7684\u6a21\u578b\u751f\u6210\u56fe\u50cf \u8bad\u7ec3\u5b8c\u6210\u540e\uff0c\u6a21\u578b\u4f1a\u4ee5\u6307\u5b9a\u7684\u540d\u79f0\u4fdd\u5b58\u5230\u6307\u5b9a\u7684\u76ee\u5f55\u4e0b\u7684safetensors\u6587\u4ef6\u4e2d\u3002 \u5bf9\u4e8ev1.4/1.5\u4ee5\u53ca\u5176\u4ed6\u884d\u751f\u6a21\u578b\uff0c\u53ef\u4ee5\u5728Automatic1111\u7684WebUI\u7b49\u4e2d\u4f7f\u7528\u8be5\u6a21\u578b\u3002\u8bf7\u5c06\u5176\u653e\u5165models\\Stable-diffusion\u76ee\u5f55\u4e0b\u3002 \u5bf9\u4e8ev2.x\u6a21\u578b\uff0c\u5982\u679c\u8981\u5728WebUI\u4e2d\u751f\u6210\u56fe\u50cf\uff0c\u5219\u9700\u8981\u4e00\u4e2a\u63cf\u8ff0\u6a21\u578b\u89c4\u683c\u7684yaml\u6587\u4ef6\u3002\u5bf9\u4e8ev2.x base\uff0c\u9700\u8981\u5c06v2-inference.yaml\u653e\u5728\u540c\u4e00\u76ee\u5f55\u4e0b\uff1b\u5bf9\u4e8e768/v\uff0c\u9700\u8981\u5c06v2-inference-v.yaml\u653e\u5728\u540c\u4e00\u76ee\u5f55\u4e0b\uff0c\u5e76\u5c06\u6269\u5c55\u540d\u4e4b\u524d\u7684\u90e8\u5206\u547d\u540d\u4e3a\u4e0e\u6a21\u578b\u76f8\u540c\u7684\u540d\u79f0\u3002 \u5404\u4e2ayaml\u6587\u4ef6\u53ef\u4ee5\u5728 Stability AI\u7684SD2.0\u4ed3\u5e93 \u4e2d\u627e\u5230\u3002 DreamBooth\u7279\u6709\u7684\u5176\u4ed6\u4e3b\u8981\u9009\u9879 \u5173\u4e8e\u6240\u6709\u9009\u9879\uff0c\u8bf7\u53c2\u8003\u5176\u4ed6\u6587\u6863\u3002 \u4e0d\u4ece\u4e2d\u95f4\u5f00\u59cb\u8bad\u7ec3Text Encoder --stop_text_encoder_training \u901a\u8fc7\u6307\u5b9astop_text_encoder_training\u9009\u9879\u548c\u4e00\u4e2a\u6570\u503c\uff0c\u53ef\u4ee5\u5728\u8fbe\u5230\u8be5\u6b65\u6570\u540e\u505c\u6b62\u8bad\u7ec3Text Encoder\uff0c\u800c\u53ea\u8bad\u7ec3U-Net\u3002\u8fd9\u53ef\u80fd\u4f1a\u63d0\u9ad8\u7cbe\u5ea6\u3002 \uff08\u63a8\u6d4b\u53ef\u80fd\u662fText Encoder\u5148\u8fc7\u62df\u5408\uff0c\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u9632\u6b62\u8fc7\u62df\u5408\uff0c\u4f46\u5177\u4f53\u5f71\u54cd\u5c1a\u4e0d\u6e05\u695a\u3002\uff09 \u4e0d\u5bf9Tokenizer\u8fdb\u884c\u586b\u5145 --no_token_padding \u6307\u5b9ano_token_padding\u9009\u9879\u540e\uff0c\u4e0d\u4f1a\u5bf9Tokenizer\u7684\u8f93\u51fa\u8fdb\u884c\u586b\u5145\uff08\u4e0e\u65e7\u7248Diffusers\u7684DreamBooth\u884c\u4e3a\u76f8\u540c\uff09\u3002","title":"DreamBooth-\u6a21\u578b\u8bad\u7ec3"},{"location":"sd-scripts-docs/train_db/#_1","text":"DreamBooth\u662f\u4e00\u79cd\u6280\u672f\uff0c\u901a\u8fc7\u5bf9\u56fe\u50cf\u751f\u6210\u6a21\u578b\u8fdb\u884c\u7279\u5b9a\u4e3b\u9898\u7684\u989d\u5916\u8bad\u7ec3\uff0c\u5e76\u4f7f\u7528\u7279\u5b9a\u7684\u6807\u8bc6\u7b26\u751f\u6210\u56fe\u50cf\u3002 \u76f8\u5173\u8bba\u6587\u5728\u6b64 \u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u53ef\u4ee5\u8ba9Stable Diffusion\u6a21\u578b\u5b66\u4e60\u7279\u5b9a\u7684\u89d2\u8272\u6216\u7ed8\u753b\u98ce\u683c\u7b49\uff0c\u5e76\u901a\u8fc7\u50cf shs \u8fd9\u6837\u7684\u7279\u5b9a\u5355\u8bcd\u6765\u8c03\u7528\uff08\u4f7f\u4e4b\u51fa\u73b0\u5728\u751f\u6210\u7684\u56fe\u50cf\u4e2d\uff09\u3002 \u8be5\u811a\u672c\u57fa\u4e8e Diffusers\u7684DreamBooth \uff0c\u4f46\u6dfb\u52a0\u4e86\u4ee5\u4e0b\u529f\u80fd\uff08\u5176\u4e2d\u4e00\u4e9b\u529f\u80fd\u540e\u6765\u4e5f\u88ab\u539f\u811a\u672c\u652f\u6301\uff09\u3002 \u811a\u672c\u7684\u4e3b\u8981\u529f\u80fd\u5982\u4e0b\uff1a \u901a\u8fc78\u4f4dAdam\u4f18\u5316\u5668\u548c\u6f5c\u5728\u53d8\u91cf\u7f13\u5b58\u6765\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff08\u4e0e Shivam Shrirao\u6c0f\u7248 \u7c7b\u4f3c\uff09\u3002 \u901a\u8fc7xformers\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\u3002 \u4e0d\u4ec5\u652f\u6301512x512\uff0c\u8fd8\u652f\u6301\u4efb\u610f\u5927\u5c0f\u7684\u8bad\u7ec3\u3002 \u901a\u8fc7\u6570\u636e\u589e\u5f3a\u63d0\u9ad8\u8d28\u91cf\u3002 \u4e0d\u4ec5\u652f\u6301DreamBooth\uff0c\u8fd8\u652f\u6301Text Encoder+U-Net\u7684\u5fae\u8c03\u3002 \u4ee5Stable Diffusion\u683c\u5f0f\u8bfb\u5199\u6a21\u578b\u3002 \u652f\u6301\u957f\u5bbd\u6bd4\u5b58\u50a8\u6876\uff08Aspect Ratio Bucketing\uff09\u3002 \u652f\u6301Stable Diffusion v2.0\u3002","title":"\u6982\u8981"},{"location":"sd-scripts-docs/train_db/#_2","text":"\u8bf7\u4e8b\u5148\u53c2\u8003\u672c\u4ed3\u5e93\u7684README\uff0c\u8fdb\u884c\u73af\u5883\u51c6\u5907\u3002","title":"\u8bad\u7ec3\u6b65\u9aa4"},{"location":"sd-scripts-docs/train_db/#_3","text":"\u8bf7\u53c2\u8003 \u5173\u4e8e\u8bad\u7ec3\u6570\u636e\u51c6\u5907 \u3002","title":"\u6570\u636e\u51c6\u5907"},{"location":"sd-scripts-docs/train_db/#_4","text":"\u8fd0\u884c\u811a\u672c\u3002\u4ee5\u4e0b\u662f\u6700\u5927\u9650\u5ea6\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\u7684\u547d\u4ee4\u793a\u4f8b\uff08\u5b9e\u9645\u4e0a\u5e94\u8be5\u5728\u4e00\u884c\u4e2d\u8f93\u5165\uff09\u3002\u8bf7\u6839\u636e\u9700\u8981\u4fee\u6539\u6bcf\u4e00\u884c\u3002\u5927\u7ea612GB\u7684VRAM\u4f3c\u4e4e\u53ef\u4ee5\u8fd0\u884c\u3002 accelerate launch --num_cpu_threads_per_process 1 train_db.py --pretrained_model_name_or_path=<.ckpt\u6216.safetensors\u6216Diffusers\u683c\u5f0f\u7684\u6a21\u578b\u76ee\u5f55> --dataset_config=<\u6570\u636e\u51c6\u5907\u65f6\u521b\u5efa\u7684.toml\u6587\u4ef6> --output_dir=<\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u8f93\u51fa\u76ee\u5f55> --output_name=<\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u8f93\u51fa\u6587\u4ef6\u540d> --save_model_as=safetensors --prior_loss_weight=1.0 --max_train_steps=1600 --learning_rate=1e-6 --optimizer_type=\"AdamW8bit\" --xformers --mixed_precision=\"fp16\" --cache_latents --gradient_checkpointing \u901a\u5e38\uff0c num_cpu_threads_per_process \u8bbe\u7f6e\u4e3a1\u4f3c\u4e4e\u6bd4\u8f83\u5408\u9002\u3002 \u5728 pretrained_model_name_or_path \u4e2d\u6307\u5b9a\u7528\u4e8e\u989d\u5916\u8bad\u7ec3\u7684\u57fa\u7840\u6a21\u578b\u3002\u53ef\u4ee5\u6307\u5b9aStable Diffusion\u7684\u68c0\u67e5\u70b9\u6587\u4ef6\uff08 .ckpt \u6216 .safetensors \uff09\u3001Diffusers\u7684\u672c\u5730\u78c1\u76d8\u4e0a\u7684\u6a21\u578b\u76ee\u5f55\u6216Diffusers\u7684\u6a21\u578bID\uff08\u4f8b\u5982\"stabilityai/stable-diffusion-2\"\uff09\u3002 \u5728 output_dir \u4e2d\u6307\u5b9a\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u7684\u4fdd\u5b58\u76ee\u5f55\u3002\u5728 output_name \u4e2d\u6307\u5b9a\u6a21\u578b\u7684\u6587\u4ef6\u540d\uff08\u4e0d\u5305\u62ec\u6269\u5c55\u540d\uff09\u3002 save_model_as \u7528\u4e8e\u6307\u5b9a\u4ee5safetensors\u683c\u5f0f\u4fdd\u5b58\u6a21\u578b\u3002 \u5728 dataset_config \u4e2d\u6307\u5b9a .toml \u6587\u4ef6\u3002\u6587\u4ef6\u5185\u7684\u6279\u91cf\u5927\u5c0f\u6700\u521d\u5e94\u8bbe\u7f6e\u4e3a 1 \u4ee5\u51cf\u5c11\u5185\u5b58\u6d88\u8017\u3002 prior_loss_weight \u662f\u6b63\u5219\u5316\u56fe\u50cf\u635f\u5931\u7684\u6743\u91cd\u3002\u901a\u5e38\u6307\u5b9a\u4e3a1.0\u3002 \u5c06\u8bad\u7ec3\u6b65\u6570 max_train_steps \u8bbe\u7f6e\u4e3a1600\u3002\u8fd9\u91cc\u5c06\u5b66\u4e60\u7387 learning_rate \u6307\u5b9a\u4e3a1e-6\u3002 \u4e3a\u4e86\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff0c\u6307\u5b9a mixed_precision=\"fp16\" \uff08\u5bf9\u4e8eRTX30\u7cfb\u5217\u53ca\u4ee5\u540e\uff0c\u53ef\u4ee5\u6307\u5b9a bf16 \u3002\u8bf7\u4e0e\u5728\u73af\u5883\u51c6\u5907\u65f6\u5bf9accelerate\u8fdb\u884c\u7684\u8bbe\u7f6e\u4fdd\u6301\u4e00\u81f4\uff09\u3002\u540c\u65f6\u6307\u5b9a gradient_checkpointing \u3002 \u4e3a\u4e86\u4f7f\u7528\u5185\u5b58\u6d88\u8017\u8f83\u5c11\u76848\u4f4dAdamW\u4f5c\u4e3a\u4f18\u5316\u5668\uff08\u4f7f\u6a21\u578b\u9002\u5e94\u5b66\u4e60\u6570\u636e\uff09\uff0c\u6307\u5b9a optimizer_type=\"AdamW8bit\" \u3002 \u6307\u5b9a xformers \u9009\u9879\u4ee5\u4f7f\u7528xformers\u7684CrossAttention\u3002\u5982\u679c\u672a\u5b89\u88c5xformers\u6216\u51fa\u73b0\u9519\u8bef\uff08\u5728\u67d0\u4e9b\u73af\u5883\u4e0b\uff0c\u4f8b\u5982 mixed_precision=\"no\" \uff09\uff0c\u53ef\u4ee5\u6539\u4e3a\u6307\u5b9a mem_eff_attn \u9009\u9879\u4ee5\u4f7f\u7528\u8282\u7701\u5185\u5b58\u7684CrossAttention\uff08\u901f\u5ea6\u4f1a\u53d8\u6162\uff09\u3002 \u4e3a\u4e86\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff0c\u6307\u5b9a cache_latents \u9009\u9879\u4ee5\u7f13\u5b58VAE\u7684\u8f93\u51fa\u3002 \u5982\u679c\u6709\u8db3\u591f\u7684\u5185\u5b58\uff0c\u53ef\u4ee5\u7f16\u8f91 .toml \u6587\u4ef6\uff0c\u5c06\u6279\u91cf\u5927\u5c0f\u589e\u52a0\u5230\u4f8b\u5982 4 \uff08\u53ef\u80fd\u4f1a\u63d0\u9ad8\u901f\u5ea6\u548c\u51c6\u786e\u6027\uff09\u3002\u540c\u65f6\uff0c\u79fb\u9664 cache_latents \u53ef\u4ee5\u542f\u7528\u6570\u636e\u589e\u5f3a\u3002","title":"\u6267\u884c\u8bad\u7ec3"},{"location":"sd-scripts-docs/train_db/#_5","text":"\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\uff0c\u8bf7\u53c2\u8003 \u8bad\u7ec3\u7684\u5171\u540c\u6587\u6863 \u4e2d\u7684\u201c\u5e38\u7528\u9009\u9879\u201d\u3002 \u8bad\u7ec3Stable Diffusion 2.x\u6216\u5176\u884d\u751f\u6a21\u578b \u8bad\u7ec3clip skip\u4e3a2\u6216\u4ee5\u4e0a\u7684\u6a21\u578b \u4f7f\u7528\u8d85\u8fc775\u4e2a\u6807\u8bb0\u7684\u6807\u9898\u8fdb\u884c\u8bad\u7ec3","title":"\u5e38\u7528\u9009\u9879"},{"location":"sd-scripts-docs/train_db/#dreambooth","text":"\u5728\u672c\u811a\u672c\u4e2d\uff0c\u4e3a\u4e86\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff0c\u6bcf\u6b65\u7684\u8bad\u7ec3\u6b21\u6570\u662f\u539f\u811a\u672c\u7684\u4e00\u534a\uff08\u5c06\u76ee\u6807\u56fe\u50cf\u548c\u6b63\u5219\u5316\u56fe\u50cf\u5206\u6210\u4e0d\u540c\u7684\u6279\u6b21\u8fdb\u884c\u8bad\u7ec3\uff09\u3002 \u4e3a\u4e86\u4e0e\u539f\u59cbDiffusers\u7248\u672c\u6216XavierXiao\u7684Stable Diffusion\u7248\u672c\u8fdb\u884c\u51e0\u4e4e\u76f8\u540c\u7684\u8bad\u7ec3\uff0c\u8bf7\u5c06\u8bad\u7ec3\u6b65\u6570\u52a0\u500d\u3002 \uff08\u7531\u4e8e\u5728\u6c47\u603b\u5b66\u4e60\u56fe\u50cf\u548c\u6b63\u5219\u5316\u56fe\u50cf\u540e\u8fdb\u884cshuffle\uff0c\u6570\u636e\u7684\u987a\u5e8f\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u4f46\u5bf9\u8bad\u7ec3\u7684\u5f71\u54cd\u5e94\u8be5\u4e0d\u5927\u3002\uff09","title":"\u5173\u4e8eDreamBooth\u7684\u8bad\u7ec3\u6b65\u6570"},{"location":"sd-scripts-docs/train_db/#dreambooth_1","text":"\u7531\u4e8e\u9700\u8981\u8bad\u7ec3\u6574\u4e2a\u6a21\u578b\uff0c\u5185\u5b58\u6d88\u8017\u4f1a\u6bd4LoRA\u7b49\u8bad\u7ec3\u65b9\u6cd5\u66f4\u591a\uff08\u4e0e\u5fae\u8c03\u76f8\u540c\uff09\u3002","title":"\u5173\u4e8eDreamBooth\u7684\u6279\u6b21\u5927\u5c0f"},{"location":"sd-scripts-docs/train_db/#_6","text":"Diffusers\u7248\u672c\u4f7f\u75285e-6\uff0c\u800cStable Diffusion\u7248\u672c\u4f7f\u75281e-6\uff0c\u56e0\u6b64\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\u4f7f\u75281e-6\u3002","title":"\u5173\u4e8e\u5b66\u4e60\u7387"},{"location":"sd-scripts-docs/train_db/#_7","text":"\u6307\u5b9a\u5206\u8fa8\u7387\u548c\u6279\u6b21\u5927\u5c0f\u4f5c\u4e3a\u9009\u9879\u3002\u547d\u4ee4\u884c\u793a\u4f8b\u5982\u4e0b\uff1a accelerate launch --num_cpu_threads_per_process 1 train_db.py --pretrained_model_name_or_path=<.ckpt\u6216.safetensors\u6216Diffusers\u683c\u5f0f\u7684\u6a21\u578b\u76ee\u5f55> --train_data_dir=<\u8bad\u7ec3\u6570\u636e\u76ee\u5f55> --reg_data_dir=<\u6b63\u5219\u5316\u56fe\u50cf\u76ee\u5f55> --output_dir=<\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u8f93\u51fa\u76ee\u5f55> --output_name=<\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u8f93\u51fa\u6587\u4ef6\u540d> --prior_loss_weight=1.0 --resolution=512 --train_batch_size=1 --learning_rate=1e-6 --max_train_steps=1600 --use_8bit_adam --xformers --mixed_precision=\"bf16\" --cache_latents --gradient_checkpointing","title":"\u4f7f\u7528\u65e7\u5f0f\u6570\u636e\u96c6\u6307\u5b9a\u65f6\u7684\u547d\u4ee4\u884c"},{"location":"sd-scripts-docs/train_db/#_8","text":"\u8bad\u7ec3\u5b8c\u6210\u540e\uff0c\u6a21\u578b\u4f1a\u4ee5\u6307\u5b9a\u7684\u540d\u79f0\u4fdd\u5b58\u5230\u6307\u5b9a\u7684\u76ee\u5f55\u4e0b\u7684safetensors\u6587\u4ef6\u4e2d\u3002 \u5bf9\u4e8ev1.4/1.5\u4ee5\u53ca\u5176\u4ed6\u884d\u751f\u6a21\u578b\uff0c\u53ef\u4ee5\u5728Automatic1111\u7684WebUI\u7b49\u4e2d\u4f7f\u7528\u8be5\u6a21\u578b\u3002\u8bf7\u5c06\u5176\u653e\u5165models\\Stable-diffusion\u76ee\u5f55\u4e0b\u3002 \u5bf9\u4e8ev2.x\u6a21\u578b\uff0c\u5982\u679c\u8981\u5728WebUI\u4e2d\u751f\u6210\u56fe\u50cf\uff0c\u5219\u9700\u8981\u4e00\u4e2a\u63cf\u8ff0\u6a21\u578b\u89c4\u683c\u7684yaml\u6587\u4ef6\u3002\u5bf9\u4e8ev2.x base\uff0c\u9700\u8981\u5c06v2-inference.yaml\u653e\u5728\u540c\u4e00\u76ee\u5f55\u4e0b\uff1b\u5bf9\u4e8e768/v\uff0c\u9700\u8981\u5c06v2-inference-v.yaml\u653e\u5728\u540c\u4e00\u76ee\u5f55\u4e0b\uff0c\u5e76\u5c06\u6269\u5c55\u540d\u4e4b\u524d\u7684\u90e8\u5206\u547d\u540d\u4e3a\u4e0e\u6a21\u578b\u76f8\u540c\u7684\u540d\u79f0\u3002 \u5404\u4e2ayaml\u6587\u4ef6\u53ef\u4ee5\u5728 Stability AI\u7684SD2.0\u4ed3\u5e93 \u4e2d\u627e\u5230\u3002","title":"\u7528\u8bad\u7ec3\u597d\u7684\u6a21\u578b\u751f\u6210\u56fe\u50cf"},{"location":"sd-scripts-docs/train_db/#dreambooth_2","text":"\u5173\u4e8e\u6240\u6709\u9009\u9879\uff0c\u8bf7\u53c2\u8003\u5176\u4ed6\u6587\u6863\u3002","title":"DreamBooth\u7279\u6709\u7684\u5176\u4ed6\u4e3b\u8981\u9009\u9879"},{"location":"sd-scripts-docs/train_db/#text-encoder-stop_text_encoder_training","text":"\u901a\u8fc7\u6307\u5b9astop_text_encoder_training\u9009\u9879\u548c\u4e00\u4e2a\u6570\u503c\uff0c\u53ef\u4ee5\u5728\u8fbe\u5230\u8be5\u6b65\u6570\u540e\u505c\u6b62\u8bad\u7ec3Text Encoder\uff0c\u800c\u53ea\u8bad\u7ec3U-Net\u3002\u8fd9\u53ef\u80fd\u4f1a\u63d0\u9ad8\u7cbe\u5ea6\u3002 \uff08\u63a8\u6d4b\u53ef\u80fd\u662fText Encoder\u5148\u8fc7\u62df\u5408\uff0c\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u9632\u6b62\u8fc7\u62df\u5408\uff0c\u4f46\u5177\u4f53\u5f71\u54cd\u5c1a\u4e0d\u6e05\u695a\u3002\uff09","title":"\u4e0d\u4ece\u4e2d\u95f4\u5f00\u59cb\u8bad\u7ec3Text Encoder --stop_text_encoder_training"},{"location":"sd-scripts-docs/train_db/#tokenizer-no_token_padding","text":"\u6307\u5b9ano_token_padding\u9009\u9879\u540e\uff0c\u4e0d\u4f1a\u5bf9Tokenizer\u7684\u8f93\u51fa\u8fdb\u884c\u586b\u5145\uff08\u4e0e\u65e7\u7248Diffusers\u7684DreamBooth\u884c\u4e3a\u76f8\u540c\uff09\u3002","title":"\u4e0d\u5bf9Tokenizer\u8fdb\u884c\u586b\u5145 --no_token_padding"},{"location":"sd-scripts-docs/train_lllite/","text":"\u5173\u4e8e ControlNet-LLLite \u7531\u4e8e\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u5b9e\u9a8c\u6027\u7684\u5b9e\u73b0\uff0c\u56e0\u6b64\u5c06\u6765\u53ef\u80fd\u4f1a\u6709\u91cd\u5927\u53d8\u5316\u3002 \u6982\u8981 ControlNet-LLLite \u662f ControlNet \u7684\u8f7b\u91cf\u7248\u672c\u3002\u5b83\u662f LoRA Like Lite \u7684\u7f29\u5199\uff0c\u662f\u4e00\u79cd\u7075\u611f\u6765\u81ea LoRA \u7684\u8f7b\u91cf ControlNet\uff0c\u76ee\u524d\u4ec5\u652f\u6301 SDXL\u3002 \u793a\u4f8b\u6743\u91cd\u6587\u4ef6\u548c\u63a8\u7406 \u8bf7\u8bbf\u95ee\uff1ahttps://huggingface.co/kohya-ss/controlnet-lllite \u6211\u4eec\u4e3a ComfyUI \u63d0\u4f9b\u4e86\u81ea\u5b9a\u4e49\u8282\u70b9\uff1ahttps://github.com/kohya-ss/ControlNet-LLLite-ComfyUI \u751f\u6210\u7684\u793a\u4f8b\u4f4d\u4e8e\u672c\u9875\u672b\u5c3e\u3002 \u6a21\u578b\u7ed3\u6784 \u4e00\u4e2a LLLite \u6a21\u5757\u7531\u4e00\u4e2a\u5c06\u63a7\u5236\u56fe\u50cf\uff08\u4ee5\u4e0b\u7b80\u79f0 conditioning image\uff09\u6620\u5c04\u5230\u6f5c\u5728\u7a7a\u95f4\u7684 conditioning image embedding \u548c\u4e00\u4e2a\u7c7b\u4f3c\u4e8e LoRA \u7684\u5c0f\u578b\u7f51\u7edc\u7ec4\u6210\u3002LLLite \u6a21\u5757\u4e0e LoRA \u4e00\u6837\u88ab\u6dfb\u52a0\u5230 U-Net \u7684 Linear \u548c Conv \u4e2d\u3002\u8be6\u60c5\u8bf7\u53c2\u8003\u6e90\u4ee3\u7801\u3002 \u7531\u4e8e\u63a8\u7406\u73af\u5883\u7684\u9650\u5236\uff0c\u76ee\u524d\u4ec5\u6dfb\u52a0\u5230 CrossAttention\uff08attn1 \u7684 q/k/v\uff0cattn2 \u7684 q\uff09\u3002 \u6a21\u578b\u8bad\u7ec3 \u51c6\u5907\u6570\u636e\u96c6 \u4f7f\u7528 DreamBooth \u65b9\u5f0f\u7684\u6570\u636e\u96c6\uff0c\u5c06 conditioning image \u5b58\u50a8\u5728 conditioning_data_dir \u6307\u5b9a\u7684\u76ee\u5f55\u4e2d\u3002 \uff08finetuning \u65b9\u5f0f\u7684\u6570\u636e\u96c6\u6682\u4e0d\u652f\u6301\u3002\uff09 conditioning image \u5fc5\u987b\u4e0e\u8bad\u7ec3\u56fe\u50cf\u5177\u6709\u76f8\u540c\u7684 basename\uff0c\u5e76\u4e14\u4f1a\u81ea\u52a8\u8c03\u6574\u4e3a\u4e0e\u8bad\u7ec3\u56fe\u50cf\u76f8\u540c\u7684\u5927\u5c0f\u3002conditioning image \u4e0d\u9700\u8981 caption \u6587\u4ef6\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u4f7f\u7528 caption \u6587\u4ef6\u800c\u4e0d\u662f\u6587\u4ef6\u5939\u540d\u79f0\u4f5c\u4e3a caption\uff0c\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b\u6240\u793a\uff1a [[datasets.subsets]] image_dir = \"path/to/image/dir\" caption_extension = \".txt\" conditioning_data_dir = \"path/to/conditioning/image/dir\" \u76ee\u524d\u7684\u9650\u5236\u662f\u4e0d\u80fd\u4f7f\u7528 random_crop\u3002 \u4f5c\u4e3a\u8bad\u7ec3\u6570\u636e\uff0c\u6700\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u4f7f\u7528\u539f\u59cb\u6a21\u578b\u751f\u6210\u7684\u56fe\u50cf\u4f5c\u4e3a\u8bad\u7ec3\u56fe\u50cf\uff0c\u5e76\u5c06\u5176\u5904\u7406\u540e\u7684\u56fe\u50cf\u4f5c\u4e3a conditioning image\uff0c\u5f62\u6210\u5408\u6210\u6570\u636e\u96c6\uff08\u5c3d\u7ba1\u6570\u636e\u96c6\u7684\u8d28\u91cf\u53ef\u80fd\u5b58\u5728\u95ee\u9898\uff09\u3002\u5177\u4f53\u7684\u5408\u6210\u6570\u636e\u96c6\u65b9\u6cd5\u5c06\u5728\u540e\u9762\u63cf\u8ff0\u3002 \u5982\u679c\u4f7f\u7528\u4e0e\u539f\u59cb\u6a21\u578b\u98ce\u683c\u4e0d\u540c\u7684\u56fe\u50cf\u4f5c\u4e3a\u8bad\u7ec3\u56fe\u50cf\uff0c\u5219\u9664\u4e86\u63a7\u5236\u5916\uff0c\u8fd8\u9700\u8981\u5b66\u4e60\u8be5\u98ce\u683c\u3002\u7531\u4e8e ControlNet-LLLite \u5bb9\u91cf\u8f83\u5c0f\uff0c\u4e0d\u9002\u5408\u98ce\u683c\u5b66\u4e60\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8bf7\u589e\u52a0\u540e\u9762\u63cf\u8ff0\u7684\u7ef4\u5ea6\u6570\u3002 \u8bad\u7ec3 \u5982\u679c\u4f7f\u7528\u811a\u672c\u751f\u6210\uff0c\u8bf7\u8fd0\u884c sdxl_train_control_net_lllite.py \u3002\u53ef\u4ee5\u4f7f\u7528 --cond_emb_dim \u6307\u5b9a conditioning image embedding \u7684\u7ef4\u5ea6\u6570\uff0c\u4f7f\u7528 --network_dim \u6307\u5b9a LoRA \u5f0f\u6a21\u5757\u7684\u79e9\u3002\u5176\u4ed6\u9009\u9879\u9075\u5faa sdxl_train_network.py \uff0c\u4f46\u4e0d\u9700\u8981\u6307\u5b9a --network_module \u3002 \u8bad\u7ec3\u65f6\u5185\u5b58\u4f7f\u7528\u91cf\u8f83\u5927\uff0c\u56e0\u6b64\u8bf7\u542f\u7528\u7f13\u5b58\u6216 gradient checkpointing \u7b49\u5185\u5b58\u51cf\u5c11\u9009\u9879\u3002\u540c\u65f6\uff0c\u4f7f\u7528 --full_bf16 \u9009\u9879\u542f\u7528 BFloat16 \u4e5f\u6709\u6548\uff08\u9700\u8981 RTX 30 \u7cfb\u5217\u6216\u66f4\u9ad8\u7248\u672c\u7684 GPU\uff09\u3002\u5df2\u5728 24GB VRAM \u4e0a\u9a8c\u8bc1\u3002 conditioning image embedding \u7684\u7ef4\u5ea6\u6570\u5728\u793a\u4f8b Canny \u4e2d\u6307\u5b9a\u4e3a 32\u3002LoRA \u5f0f\u6a21\u5757\u7684\u79e9\u540c\u6837\u4e3a 64\u3002\u8bf7\u6839\u636e\u76ee\u6807 conditioning image \u7684\u7279\u5f81\u8fdb\u884c\u8c03\u6574\u3002 \uff08\u793a\u4f8b Canny \u53ef\u80fd\u76f8\u5f53\u56f0\u96be\u3002\u5bf9\u4e8e depth \u7b49\uff0c\u53ef\u80fd\u53ef\u4ee5\u51cf\u5c11\u5230\u4e00\u534a\u5de6\u53f3\u3002\uff09 \u4e0b\u9762\u662f .toml \u914d\u7f6e\u793a\u4f8b\uff1a pretrained_model_name_or_path = \"/path/to/model_trained_on.safetensors\" max_train_epochs = 12 max_data_loader_n_workers = 4 persistent_data_loader_workers = true seed = 42 gradient_checkpointing = true mixed_precision = \"bf16\" save_precision = \"bf16\" full_bf16 = true optimizer_type = \"adamw8bit\" learning_rate = 2e-4 xformers = true output_dir = \"/path/to/output/dir\" output_name = \"output_name\" save_every_n_epochs = 1 save_model_as = \"safetensors\" vae_batch_size = 4 cache_latents = true cache_latents_to_disk = true cache_text_encoder_outputs = true cache_text_encoder_outputs_to_disk = true network_dim = 64 cond_emb_dim = 32 dataset_config = \"/path/to/dataset.toml\" \u63a8\u7406 \u5982\u679c\u4f7f\u7528\u811a\u672c\u751f\u6210\uff0c\u8bf7\u8fd0\u884c sdxl_gen_img.py \u3002\u53ef\u4ee5\u4f7f\u7528 --control_net_lllite_models \u6307\u5b9a LLLite \u7684\u6a21\u578b\u6587\u4ef6\u3002\u7ef4\u5ea6\u6570\u4f1a\u81ea\u52a8\u4ece\u6a21\u578b\u6587\u4ef6\u4e2d\u83b7\u53d6\u3002 \u4f7f\u7528 --guide_image_path \u6307\u5b9a\u63a8\u7406\u7528\u7684 conditioning image\u3002\u8bf7\u6ce8\u610f\uff0c\u4e0d\u4f1a\u8fdb\u884c\u9884\u5904\u7406\uff0c\u56e0\u6b64\uff0c\u4f8b\u5982\u5bf9\u4e8e Canny\uff0c\u8bf7\u6307\u5b9a\u7ecf\u8fc7 Canny \u5904\u7406\u7684\u56fe\u50cf\uff08\u9ed1\u8272\u80cc\u666f\uff0c\u767d\u7ebf\uff09\u3002\u6682\u4e0d\u652f\u6301 --control_net_preps \u3001 --control_net_weights \u548c --control_net_ratios \u3002 \u5408\u6210\u6570\u636e\u96c6\u7684\u65b9\u6cd5 \u751f\u6210\u8bad\u7ec3\u56fe\u50cf \u4f7f\u7528\u57fa\u672c\u7684\u6a21\u578b\u751f\u6210\u56fe\u50cf\u3002\u53ef\u4ee5\u4f7f\u7528 Web UI \u6216 ComfyUI \u7b49\u751f\u6210\u3002\u56fe\u50cf\u5927\u5c0f\u53ef\u4ee5\u4f7f\u7528\u6a21\u578b\u7684\u9ed8\u8ba4\u5927\u5c0f\uff08\u4f8b\u5982 1024x1024\uff09\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528 bucketing\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8bf7\u4ee5\u9002\u5f53\u7684\u5206\u8fa8\u7387\u751f\u6210\u3002 \u751f\u6210\u65f6\u7684 caption \u7b49\u5e94\u4e0e\u4f7f\u7528 ControlNet-LLLite \u65f6\u8981\u751f\u6210\u7684\u56fe\u50cf\u76f8\u5339\u914d\u3002 \u5c06\u751f\u6210\u7684\u56fe\u50cf\u4fdd\u5b58\u5230\u4efb\u610f\u76ee\u5f55\uff0c\u5e76\u5728\u6570\u636e\u96c6\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u8be5\u76ee\u5f55\u3002 \u672c\u4ed3\u5e93\u4e2d\u7684 sdxl_gen_img.py \u4e5f\u53ef\u7528\u4e8e\u751f\u6210\u3002\u4f8b\u5982\uff0c\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a python sdxl_gen_img.py --ckpt path/to/model.safetensors --n_iter 1 --scale 10 --steps 36 --outdir path/to/output/dir --xformers --W 1024 --H 1024 --original_width 2048 --original_height 2048 --bf16 --sampler ddim --batch_size 4 --vae_batch_size 2 --images_per_prompt 512 --max_embeddings_multiples 1 --prompt \"{portrait|digital art|anime screen cap|detailed illustration} of 1girl, {standing|sitting|walking|running|dancing} on {classroom|street|town|beach|indoors|outdoors}, {looking at viewer|looking away|looking at another}, {in|wearing} {shirt and skirt|school uniform|casual wear} { |, dynamic pose}, (solo), teen age, {0-1$$smile,|blush,|kind smile,|expression less,|happy,|sadness,} {0-1$$upper body,|full body,|cowboy shot,|face focus,} trending on pixiv, {0-2$$depth of fields,|8k wallpaper,|highly detailed,|pov,} {0-1$$summer, |winter, |spring, |autumn, } beautiful face { |, from below|, from above|, from side|, from behind|, from back} --n nsfw, bad face, lowres, low quality, worst quality, low effort, watermark, signature, ugly, poorly drawn\" \u8fd9\u662f\u9488\u5bf9 24GB VRAM \u7684\u8bbe\u7f6e\u3002\u8bf7\u6839\u636e VRAM \u5927\u5c0f\u8c03\u6574 --batch_size \u548c --vae_batch_size \u3002 \u4f7f\u7528 --prompt \u4e2d\u7684\u901a\u914d\u7b26\u968f\u673a\u751f\u6210\u3002\u8bf7\u6839\u636e\u9700\u8981\u8fdb\u884c\u8c03\u6574\u3002 \u5904\u7406\u56fe\u50cf \u4f7f\u7528\u5916\u90e8\u7a0b\u5e8f\u5904\u7406\u751f\u6210\u7684\u56fe\u50cf\u3002\u5c06\u5904\u7406\u540e\u7684\u56fe\u50cf\u4fdd\u5b58\u5230\u4efb\u610f\u76ee\u5f55\uff0c\u8fd9\u4e9b\u56fe\u50cf\u5c06\u4f5c\u4e3a conditioning image\u3002 \u4f8b\u5982\uff0c\u5bf9\u4e8e Canny\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u811a\u672c\uff1a import glob import os import random import cv2 import numpy as np IMAGES_DIR = \"path/to/generated/images\" CANNY_DIR = \"path/to/canny/images\" os.makedirs(CANNY_DIR, exist_ok=True) img_files = glob.glob(IMAGES_DIR + \"/*.png\") for img_file in img_files: can_file = CANNY_DIR + \"/\" + os.path.basename(img_file) if os.path.exists(can_file): print(\"Skip: \" + img_file) continue print(img_file) img = cv2.imread(img_file) # \u968f\u673a\u9608\u503c # while True: # threshold1 = random.randint(0, 127) # threshold2 = random.randint(128, 255) # if threshold2 - threshold1 > 80: # break # \u56fa\u5b9a\u9608\u503c threshold1 = 100 threshold2 = 200 img = cv2.Canny(img, threshold1, threshold2) cv2.imwrite(can_file, img) \u521b\u5efa caption \u6587\u4ef6 \u4e3a\u6bcf\u4e2a\u8bad\u7ec3\u56fe\u50cf\u521b\u5efa\u4e0e\u5176 basename \u76f8\u540c\u7684 caption \u6587\u4ef6\u3002\u53ef\u4ee5\u4f7f\u7528\u751f\u6210\u65f6\u7684 prompt\u3002 \u5982\u679c\u4f7f\u7528 sdxl_gen_img.py \u751f\u6210\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u811a\u672c\u5728\u4e0e\u8bad\u7ec3\u56fe\u50cf\u76f8\u540c\u7684\u76ee\u5f55\u4e2d\u521b\u5efa caption \u6587\u4ef6\uff08\u6269\u5c55\u540d\u4e3a .txt \uff09\uff1a import glob import os from PIL import Image IMAGES_DIR = \"path/to/generated/images\" img_files = glob.glob(IMAGES_DIR + \"/*.png\") for img_file in img_files: cap_file = img_file.replace(\".png\", \".txt\") if os.path.exists(cap_file): print(f\"Skip: {img_file}\") continue print(img_file) img = Image.open(img_file) prompt = img.text[\"prompt\"] if \"prompt\" in img.text else \"\" if prompt == \"\": print(f\"Prompt not found in {img_file}\") with open(cap_file, \"w\") as f: f.write(prompt + \"\\n\") \u521b\u5efa\u6570\u636e\u96c6\u914d\u7f6e\u6587\u4ef6 \u9664\u4e86\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u884c\u9009\u9879\u6307\u5b9a\u5916\uff0c\u5982\u679c\u521b\u5efa .toml \u6587\u4ef6\uff0c\u8bf7\u5728 conditioning_data_dir \u4e2d\u6307\u5b9a\u4fdd\u5b58\u5904\u7406\u540e\u7684\u56fe\u50cf\u7684\u76ee\u5f55\u3002 \u4ee5\u4e0b\u662f\u914d\u7f6e\u6587\u4ef6\u7684\u793a\u4f8b\uff1a [general] flip_aug = false color_aug = false resolution = [1024,1024] [[datasets]] batch_size = 8 enable_bucket = false [[datasets.subsets]] image_dir = \"path/to/generated/image/dir\" caption_extension = \".txt\" conditioning_data_dir = \"path/to/canny/image/dir\" \u81f4\u8c22 \u611f\u8c22 ControlNet \u7684\u4f5c\u8005 lllyasviel\uff0c\u611f\u8c22 furusu \u63d0\u4f9b\u7684\u5b9e\u73b0\u5efa\u8bae\u548c\u6545\u969c\u6392\u9664\u5e2e\u52a9\uff0c\u611f\u8c22 ddPn08 \u5b9e\u73b0\u7684 ControlNet \u6570\u636e\u96c6\u3002 \u793a\u4f8b Canny","title":"ControlNet-LLLite-\u6a21\u578b\u8bad\u7ec3"},{"location":"sd-scripts-docs/train_lllite/#controlnet-lllite","text":"\u7531\u4e8e\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u5b9e\u9a8c\u6027\u7684\u5b9e\u73b0\uff0c\u56e0\u6b64\u5c06\u6765\u53ef\u80fd\u4f1a\u6709\u91cd\u5927\u53d8\u5316\u3002","title":"\u5173\u4e8e ControlNet-LLLite"},{"location":"sd-scripts-docs/train_lllite/#_1","text":"ControlNet-LLLite \u662f ControlNet \u7684\u8f7b\u91cf\u7248\u672c\u3002\u5b83\u662f LoRA Like Lite \u7684\u7f29\u5199\uff0c\u662f\u4e00\u79cd\u7075\u611f\u6765\u81ea LoRA \u7684\u8f7b\u91cf ControlNet\uff0c\u76ee\u524d\u4ec5\u652f\u6301 SDXL\u3002","title":"\u6982\u8981"},{"location":"sd-scripts-docs/train_lllite/#_2","text":"\u8bf7\u8bbf\u95ee\uff1ahttps://huggingface.co/kohya-ss/controlnet-lllite \u6211\u4eec\u4e3a ComfyUI \u63d0\u4f9b\u4e86\u81ea\u5b9a\u4e49\u8282\u70b9\uff1ahttps://github.com/kohya-ss/ControlNet-LLLite-ComfyUI \u751f\u6210\u7684\u793a\u4f8b\u4f4d\u4e8e\u672c\u9875\u672b\u5c3e\u3002","title":"\u793a\u4f8b\u6743\u91cd\u6587\u4ef6\u548c\u63a8\u7406"},{"location":"sd-scripts-docs/train_lllite/#_3","text":"\u4e00\u4e2a LLLite \u6a21\u5757\u7531\u4e00\u4e2a\u5c06\u63a7\u5236\u56fe\u50cf\uff08\u4ee5\u4e0b\u7b80\u79f0 conditioning image\uff09\u6620\u5c04\u5230\u6f5c\u5728\u7a7a\u95f4\u7684 conditioning image embedding \u548c\u4e00\u4e2a\u7c7b\u4f3c\u4e8e LoRA \u7684\u5c0f\u578b\u7f51\u7edc\u7ec4\u6210\u3002LLLite \u6a21\u5757\u4e0e LoRA \u4e00\u6837\u88ab\u6dfb\u52a0\u5230 U-Net \u7684 Linear \u548c Conv \u4e2d\u3002\u8be6\u60c5\u8bf7\u53c2\u8003\u6e90\u4ee3\u7801\u3002 \u7531\u4e8e\u63a8\u7406\u73af\u5883\u7684\u9650\u5236\uff0c\u76ee\u524d\u4ec5\u6dfb\u52a0\u5230 CrossAttention\uff08attn1 \u7684 q/k/v\uff0cattn2 \u7684 q\uff09\u3002","title":"\u6a21\u578b\u7ed3\u6784"},{"location":"sd-scripts-docs/train_lllite/#_4","text":"","title":"\u6a21\u578b\u8bad\u7ec3"},{"location":"sd-scripts-docs/train_lllite/#_5","text":"\u4f7f\u7528 DreamBooth \u65b9\u5f0f\u7684\u6570\u636e\u96c6\uff0c\u5c06 conditioning image \u5b58\u50a8\u5728 conditioning_data_dir \u6307\u5b9a\u7684\u76ee\u5f55\u4e2d\u3002 \uff08finetuning \u65b9\u5f0f\u7684\u6570\u636e\u96c6\u6682\u4e0d\u652f\u6301\u3002\uff09 conditioning image \u5fc5\u987b\u4e0e\u8bad\u7ec3\u56fe\u50cf\u5177\u6709\u76f8\u540c\u7684 basename\uff0c\u5e76\u4e14\u4f1a\u81ea\u52a8\u8c03\u6574\u4e3a\u4e0e\u8bad\u7ec3\u56fe\u50cf\u76f8\u540c\u7684\u5927\u5c0f\u3002conditioning image \u4e0d\u9700\u8981 caption \u6587\u4ef6\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u4f7f\u7528 caption \u6587\u4ef6\u800c\u4e0d\u662f\u6587\u4ef6\u5939\u540d\u79f0\u4f5c\u4e3a caption\uff0c\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b\u6240\u793a\uff1a [[datasets.subsets]] image_dir = \"path/to/image/dir\" caption_extension = \".txt\" conditioning_data_dir = \"path/to/conditioning/image/dir\" \u76ee\u524d\u7684\u9650\u5236\u662f\u4e0d\u80fd\u4f7f\u7528 random_crop\u3002 \u4f5c\u4e3a\u8bad\u7ec3\u6570\u636e\uff0c\u6700\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u4f7f\u7528\u539f\u59cb\u6a21\u578b\u751f\u6210\u7684\u56fe\u50cf\u4f5c\u4e3a\u8bad\u7ec3\u56fe\u50cf\uff0c\u5e76\u5c06\u5176\u5904\u7406\u540e\u7684\u56fe\u50cf\u4f5c\u4e3a conditioning image\uff0c\u5f62\u6210\u5408\u6210\u6570\u636e\u96c6\uff08\u5c3d\u7ba1\u6570\u636e\u96c6\u7684\u8d28\u91cf\u53ef\u80fd\u5b58\u5728\u95ee\u9898\uff09\u3002\u5177\u4f53\u7684\u5408\u6210\u6570\u636e\u96c6\u65b9\u6cd5\u5c06\u5728\u540e\u9762\u63cf\u8ff0\u3002 \u5982\u679c\u4f7f\u7528\u4e0e\u539f\u59cb\u6a21\u578b\u98ce\u683c\u4e0d\u540c\u7684\u56fe\u50cf\u4f5c\u4e3a\u8bad\u7ec3\u56fe\u50cf\uff0c\u5219\u9664\u4e86\u63a7\u5236\u5916\uff0c\u8fd8\u9700\u8981\u5b66\u4e60\u8be5\u98ce\u683c\u3002\u7531\u4e8e ControlNet-LLLite \u5bb9\u91cf\u8f83\u5c0f\uff0c\u4e0d\u9002\u5408\u98ce\u683c\u5b66\u4e60\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8bf7\u589e\u52a0\u540e\u9762\u63cf\u8ff0\u7684\u7ef4\u5ea6\u6570\u3002","title":"\u51c6\u5907\u6570\u636e\u96c6"},{"location":"sd-scripts-docs/train_lllite/#_6","text":"\u5982\u679c\u4f7f\u7528\u811a\u672c\u751f\u6210\uff0c\u8bf7\u8fd0\u884c sdxl_train_control_net_lllite.py \u3002\u53ef\u4ee5\u4f7f\u7528 --cond_emb_dim \u6307\u5b9a conditioning image embedding \u7684\u7ef4\u5ea6\u6570\uff0c\u4f7f\u7528 --network_dim \u6307\u5b9a LoRA \u5f0f\u6a21\u5757\u7684\u79e9\u3002\u5176\u4ed6\u9009\u9879\u9075\u5faa sdxl_train_network.py \uff0c\u4f46\u4e0d\u9700\u8981\u6307\u5b9a --network_module \u3002 \u8bad\u7ec3\u65f6\u5185\u5b58\u4f7f\u7528\u91cf\u8f83\u5927\uff0c\u56e0\u6b64\u8bf7\u542f\u7528\u7f13\u5b58\u6216 gradient checkpointing \u7b49\u5185\u5b58\u51cf\u5c11\u9009\u9879\u3002\u540c\u65f6\uff0c\u4f7f\u7528 --full_bf16 \u9009\u9879\u542f\u7528 BFloat16 \u4e5f\u6709\u6548\uff08\u9700\u8981 RTX 30 \u7cfb\u5217\u6216\u66f4\u9ad8\u7248\u672c\u7684 GPU\uff09\u3002\u5df2\u5728 24GB VRAM \u4e0a\u9a8c\u8bc1\u3002 conditioning image embedding \u7684\u7ef4\u5ea6\u6570\u5728\u793a\u4f8b Canny \u4e2d\u6307\u5b9a\u4e3a 32\u3002LoRA \u5f0f\u6a21\u5757\u7684\u79e9\u540c\u6837\u4e3a 64\u3002\u8bf7\u6839\u636e\u76ee\u6807 conditioning image \u7684\u7279\u5f81\u8fdb\u884c\u8c03\u6574\u3002 \uff08\u793a\u4f8b Canny \u53ef\u80fd\u76f8\u5f53\u56f0\u96be\u3002\u5bf9\u4e8e depth \u7b49\uff0c\u53ef\u80fd\u53ef\u4ee5\u51cf\u5c11\u5230\u4e00\u534a\u5de6\u53f3\u3002\uff09 \u4e0b\u9762\u662f .toml \u914d\u7f6e\u793a\u4f8b\uff1a pretrained_model_name_or_path = \"/path/to/model_trained_on.safetensors\" max_train_epochs = 12 max_data_loader_n_workers = 4 persistent_data_loader_workers = true seed = 42 gradient_checkpointing = true mixed_precision = \"bf16\" save_precision = \"bf16\" full_bf16 = true optimizer_type = \"adamw8bit\" learning_rate = 2e-4 xformers = true output_dir = \"/path/to/output/dir\" output_name = \"output_name\" save_every_n_epochs = 1 save_model_as = \"safetensors\" vae_batch_size = 4 cache_latents = true cache_latents_to_disk = true cache_text_encoder_outputs = true cache_text_encoder_outputs_to_disk = true network_dim = 64 cond_emb_dim = 32 dataset_config = \"/path/to/dataset.toml\"","title":"\u8bad\u7ec3"},{"location":"sd-scripts-docs/train_lllite/#_7","text":"\u5982\u679c\u4f7f\u7528\u811a\u672c\u751f\u6210\uff0c\u8bf7\u8fd0\u884c sdxl_gen_img.py \u3002\u53ef\u4ee5\u4f7f\u7528 --control_net_lllite_models \u6307\u5b9a LLLite \u7684\u6a21\u578b\u6587\u4ef6\u3002\u7ef4\u5ea6\u6570\u4f1a\u81ea\u52a8\u4ece\u6a21\u578b\u6587\u4ef6\u4e2d\u83b7\u53d6\u3002 \u4f7f\u7528 --guide_image_path \u6307\u5b9a\u63a8\u7406\u7528\u7684 conditioning image\u3002\u8bf7\u6ce8\u610f\uff0c\u4e0d\u4f1a\u8fdb\u884c\u9884\u5904\u7406\uff0c\u56e0\u6b64\uff0c\u4f8b\u5982\u5bf9\u4e8e Canny\uff0c\u8bf7\u6307\u5b9a\u7ecf\u8fc7 Canny \u5904\u7406\u7684\u56fe\u50cf\uff08\u9ed1\u8272\u80cc\u666f\uff0c\u767d\u7ebf\uff09\u3002\u6682\u4e0d\u652f\u6301 --control_net_preps \u3001 --control_net_weights \u548c --control_net_ratios \u3002","title":"\u63a8\u7406"},{"location":"sd-scripts-docs/train_lllite/#_8","text":"","title":"\u5408\u6210\u6570\u636e\u96c6\u7684\u65b9\u6cd5"},{"location":"sd-scripts-docs/train_lllite/#_9","text":"\u4f7f\u7528\u57fa\u672c\u7684\u6a21\u578b\u751f\u6210\u56fe\u50cf\u3002\u53ef\u4ee5\u4f7f\u7528 Web UI \u6216 ComfyUI \u7b49\u751f\u6210\u3002\u56fe\u50cf\u5927\u5c0f\u53ef\u4ee5\u4f7f\u7528\u6a21\u578b\u7684\u9ed8\u8ba4\u5927\u5c0f\uff08\u4f8b\u5982 1024x1024\uff09\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528 bucketing\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8bf7\u4ee5\u9002\u5f53\u7684\u5206\u8fa8\u7387\u751f\u6210\u3002 \u751f\u6210\u65f6\u7684 caption \u7b49\u5e94\u4e0e\u4f7f\u7528 ControlNet-LLLite \u65f6\u8981\u751f\u6210\u7684\u56fe\u50cf\u76f8\u5339\u914d\u3002 \u5c06\u751f\u6210\u7684\u56fe\u50cf\u4fdd\u5b58\u5230\u4efb\u610f\u76ee\u5f55\uff0c\u5e76\u5728\u6570\u636e\u96c6\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u8be5\u76ee\u5f55\u3002 \u672c\u4ed3\u5e93\u4e2d\u7684 sdxl_gen_img.py \u4e5f\u53ef\u7528\u4e8e\u751f\u6210\u3002\u4f8b\u5982\uff0c\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a python sdxl_gen_img.py --ckpt path/to/model.safetensors --n_iter 1 --scale 10 --steps 36 --outdir path/to/output/dir --xformers --W 1024 --H 1024 --original_width 2048 --original_height 2048 --bf16 --sampler ddim --batch_size 4 --vae_batch_size 2 --images_per_prompt 512 --max_embeddings_multiples 1 --prompt \"{portrait|digital art|anime screen cap|detailed illustration} of 1girl, {standing|sitting|walking|running|dancing} on {classroom|street|town|beach|indoors|outdoors}, {looking at viewer|looking away|looking at another}, {in|wearing} {shirt and skirt|school uniform|casual wear} { |, dynamic pose}, (solo), teen age, {0-1$$smile,|blush,|kind smile,|expression less,|happy,|sadness,} {0-1$$upper body,|full body,|cowboy shot,|face focus,} trending on pixiv, {0-2$$depth of fields,|8k wallpaper,|highly detailed,|pov,} {0-1$$summer, |winter, |spring, |autumn, } beautiful face { |, from below|, from above|, from side|, from behind|, from back} --n nsfw, bad face, lowres, low quality, worst quality, low effort, watermark, signature, ugly, poorly drawn\" \u8fd9\u662f\u9488\u5bf9 24GB VRAM \u7684\u8bbe\u7f6e\u3002\u8bf7\u6839\u636e VRAM \u5927\u5c0f\u8c03\u6574 --batch_size \u548c --vae_batch_size \u3002 \u4f7f\u7528 --prompt \u4e2d\u7684\u901a\u914d\u7b26\u968f\u673a\u751f\u6210\u3002\u8bf7\u6839\u636e\u9700\u8981\u8fdb\u884c\u8c03\u6574\u3002","title":"\u751f\u6210\u8bad\u7ec3\u56fe\u50cf"},{"location":"sd-scripts-docs/train_lllite/#_10","text":"\u4f7f\u7528\u5916\u90e8\u7a0b\u5e8f\u5904\u7406\u751f\u6210\u7684\u56fe\u50cf\u3002\u5c06\u5904\u7406\u540e\u7684\u56fe\u50cf\u4fdd\u5b58\u5230\u4efb\u610f\u76ee\u5f55\uff0c\u8fd9\u4e9b\u56fe\u50cf\u5c06\u4f5c\u4e3a conditioning image\u3002 \u4f8b\u5982\uff0c\u5bf9\u4e8e Canny\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u811a\u672c\uff1a import glob import os import random import cv2 import numpy as np IMAGES_DIR = \"path/to/generated/images\" CANNY_DIR = \"path/to/canny/images\" os.makedirs(CANNY_DIR, exist_ok=True) img_files = glob.glob(IMAGES_DIR + \"/*.png\") for img_file in img_files: can_file = CANNY_DIR + \"/\" + os.path.basename(img_file) if os.path.exists(can_file): print(\"Skip: \" + img_file) continue print(img_file) img = cv2.imread(img_file) # \u968f\u673a\u9608\u503c # while True: # threshold1 = random.randint(0, 127) # threshold2 = random.randint(128, 255) # if threshold2 - threshold1 > 80: # break # \u56fa\u5b9a\u9608\u503c threshold1 = 100 threshold2 = 200 img = cv2.Canny(img, threshold1, threshold2) cv2.imwrite(can_file, img)","title":"\u5904\u7406\u56fe\u50cf"},{"location":"sd-scripts-docs/train_lllite/#caption","text":"\u4e3a\u6bcf\u4e2a\u8bad\u7ec3\u56fe\u50cf\u521b\u5efa\u4e0e\u5176 basename \u76f8\u540c\u7684 caption \u6587\u4ef6\u3002\u53ef\u4ee5\u4f7f\u7528\u751f\u6210\u65f6\u7684 prompt\u3002 \u5982\u679c\u4f7f\u7528 sdxl_gen_img.py \u751f\u6210\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u811a\u672c\u5728\u4e0e\u8bad\u7ec3\u56fe\u50cf\u76f8\u540c\u7684\u76ee\u5f55\u4e2d\u521b\u5efa caption \u6587\u4ef6\uff08\u6269\u5c55\u540d\u4e3a .txt \uff09\uff1a import glob import os from PIL import Image IMAGES_DIR = \"path/to/generated/images\" img_files = glob.glob(IMAGES_DIR + \"/*.png\") for img_file in img_files: cap_file = img_file.replace(\".png\", \".txt\") if os.path.exists(cap_file): print(f\"Skip: {img_file}\") continue print(img_file) img = Image.open(img_file) prompt = img.text[\"prompt\"] if \"prompt\" in img.text else \"\" if prompt == \"\": print(f\"Prompt not found in {img_file}\") with open(cap_file, \"w\") as f: f.write(prompt + \"\\n\")","title":"\u521b\u5efa caption \u6587\u4ef6"},{"location":"sd-scripts-docs/train_lllite/#_11","text":"\u9664\u4e86\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u884c\u9009\u9879\u6307\u5b9a\u5916\uff0c\u5982\u679c\u521b\u5efa .toml \u6587\u4ef6\uff0c\u8bf7\u5728 conditioning_data_dir \u4e2d\u6307\u5b9a\u4fdd\u5b58\u5904\u7406\u540e\u7684\u56fe\u50cf\u7684\u76ee\u5f55\u3002 \u4ee5\u4e0b\u662f\u914d\u7f6e\u6587\u4ef6\u7684\u793a\u4f8b\uff1a [general] flip_aug = false color_aug = false resolution = [1024,1024] [[datasets]] batch_size = 8 enable_bucket = false [[datasets.subsets]] image_dir = \"path/to/generated/image/dir\" caption_extension = \".txt\" conditioning_data_dir = \"path/to/canny/image/dir\"","title":"\u521b\u5efa\u6570\u636e\u96c6\u914d\u7f6e\u6587\u4ef6"},{"location":"sd-scripts-docs/train_lllite/#_12","text":"\u611f\u8c22 ControlNet \u7684\u4f5c\u8005 lllyasviel\uff0c\u611f\u8c22 furusu \u63d0\u4f9b\u7684\u5b9e\u73b0\u5efa\u8bae\u548c\u6545\u969c\u6392\u9664\u5e2e\u52a9\uff0c\u611f\u8c22 ddPn08 \u5b9e\u73b0\u7684 ControlNet \u6570\u636e\u96c6\u3002","title":"\u81f4\u8c22"},{"location":"sd-scripts-docs/train_lllite/#_13","text":"Canny","title":"\u793a\u4f8b"},{"location":"sd-scripts-docs/train_network/","text":"LoRA\u7684\u8bad\u7ec3 \u8fd9\u662f\u5c06 LoRA: Low-Rank Adaptation of Large Language Models \uff08arxiv\uff09\u548c LoRA \uff08github\uff09\u5e94\u7528\u4e8eStable Diffusion\u7684\u7ed3\u679c\u3002 \u6211\u5927\u91cf\u53c2\u8003\u4e86 cloneofsimo\u7684\u4ed3\u5e93 \uff0c\u5728\u6b64\u8868\u793a\u611f\u8c22\u3002 \u901a\u5e38\u7684LoRA\u4ec5\u9002\u7528\u4e8eLinear\u548c\u5185\u6838\u5927\u5c0f\u4e3a1x1\u7684Conv2d\uff0c\u4f46\u4e5f\u53ef\u4ee5\u6269\u5c55\u5230\u5185\u6838\u5927\u5c0f\u4e3a3x3\u7684Conv2d\u3002 \u5c06Conv2d 3x3\u6269\u5c55\u5230LoRA\u662f\u7531 cloneofsimo \u9996\u5148\u53d1\u5e03\u7684\uff0c KohakuBlueleaf \u63ed\u793a\u4e86\u5176\u6709\u6548\u6027\u3002\u5728\u6b64\u5bf9KohakuBlueleaf\u8868\u793a\u6df1\u6df1\u7684\u611f\u8c22\u3002 \u5373\u4f7f\u57288GB VRAM\u4e0b\uff0c\u4f3c\u4e4e\u4e5f\u80fd\u52c9\u5f3a\u8fd0\u884c\u3002 \u8bf7\u540c\u65f6\u53c2\u9605 \u5173\u4e8e\u8bad\u7ec3\u7684\u5171\u540c\u6587\u6863 \u3002 \u53ef\u4ee5\u8bad\u7ec3\u7684LoRA\u7c7b\u578b \u652f\u6301\u4ee5\u4e0b\u4e24\u79cd\u7c7b\u578b\u3002\u4ee5\u4e0b\u662f\u5728\u672c\u4ed3\u5e93\u4e2d\u7684\u81ea\u5b9a\u4e49\u540d\u79f0\u3002 LoRA-LierLa \uff1a\uff08LoRA for Li__n __e__a __r La yers\uff0c\u8bfb\u4f5cLierLa\uff09 \u9002\u7528\u4e8eLinear\u548c\u5185\u6838\u5927\u5c0f\u4e3a1x1\u7684Conv2d\u7684LoRA\u3002 LoRA-C3Lier \uff1a\uff08LoRA for C__olutional layers with __3 x3 Kernel and Li__n __e__a __r layers\uff0c\u8bfb\u4f5cC3Lier\uff09 \u57281\u7684\u57fa\u7840\u4e0a\uff0c\u989d\u5916\u9002\u7528\u4e8e\u5185\u6838\u5927\u5c0f\u4e3a3x3\u7684Conv2d\u7684LoRA\u3002 \u4e0eLoRA-LierLa\u76f8\u6bd4\uff0cLoRA-C3Lier\u7531\u4e8e\u9002\u7528\u7684\u5c42\u589e\u52a0\uff0c\u53ef\u80fd\u671f\u5f85\u66f4\u9ad8\u7684\u7cbe\u5ea6\u3002 \u5728\u8bad\u7ec3\u65f6\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 DyLoRA \uff08\u540e\u8ff0\uff09\u3002 \u5173\u4e8e\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u7684\u6ce8\u610f\u4e8b\u9879 LoRA-LierLa\u53ef\u4ee5\u88abAUTOMATIC1111\u7684Web UI\u7684LoRA\u529f\u80fd\u4f7f\u7528\u3002 \u8981\u4f7f\u7528LoRA-C3Lier\u5728Web UI\u4e2d\u751f\u6210\u56fe\u50cf\uff0c\u8bf7\u4f7f\u7528\u8fd9\u4e2a WebUI\u6269\u5c55 \u3002 \u4e24\u8005\u90fd\u53ef\u4ee5\u4f7f\u7528\u672c\u4ed3\u5e93\u4e2d\u7684\u811a\u672c\u5c06\u8bad\u7ec3\u597d\u7684LoRA\u6a21\u578b\u4e0eStable Diffusion\u6a21\u578b\u5408\u5e76\u3002 \u76ee\u524d\u4e0ecloneofsimo\u7684\u4ed3\u5e93\u548cd8ahazard\u7684 Dreambooth Extension for Stable-Diffusion-WebUI \u4e0d\u517c\u5bb9\uff0c\u56e0\u4e3a\u8fdb\u884c\u4e86\u4e00\u4e9b\u529f\u80fd\u6269\u5c55\uff08\u540e\u8ff0\uff09\u3002 \u8bad\u7ec3\u6b65\u9aa4 \u8bf7\u5148\u53c2\u8003\u672c\u4ed3\u5e93\u7684README\uff0c\u8fdb\u884c\u73af\u5883\u51c6\u5907\u3002 \u6570\u636e\u51c6\u5907 \u8bf7\u53c2\u8003 \u5173\u4e8e\u8bad\u7ec3\u6570\u636e\u51c6\u5907 \u3002 \u6267\u884c\u8bad\u7ec3 \u4f7f\u7528 train_network.py \u3002 \u5728 train_network.py \u4e2d\uff0c\u901a\u8fc7 --network_module \u9009\u9879\u6307\u5b9a\u8981\u8bad\u7ec3\u7684\u6a21\u5757\u540d\u79f0\u3002\u5bf9\u4e8eLoRA\uff0c\u6307\u5b9a network.lora \u3002 \u5b66\u4e60\u7387\u4f3c\u4e4e\u6bd4\u901a\u5e38\u7684DreamBooth\u6216fine tuning\u8981\u9ad8\uff0c\u5efa\u8bae\u4f7f\u7528 1e-4 ~ 1e-3 \u5de6\u53f3\u7684\u503c\u3002 \u4ee5\u4e0b\u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u793a\u4f8b\u3002 accelerate launch --num_cpu_threads_per_process 1 train_network.py --pretrained_model_name_or_path=<.ckpt\u6216.safetensors\u6216Diffusers\u7248\u6a21\u578b\u7684\u76ee\u5f55> --dataset_config=<\u6570\u636e\u51c6\u5907\u65f6\u521b\u5efa\u7684.toml\u6587\u4ef6> --output_dir=<\u8bad\u7ec3\u597d\u7684\u6a21\u578b\u7684\u8f93\u51fa\u6587\u4ef6\u5939> --output_name=<\u8bad\u7ec3\u597d\u7684\u6a21\u578b\u8f93\u51fa\u65f6\u7684\u6587\u4ef6\u540d> --save_model_as=safetensors --prior_loss_weight=1.0 --max_train_steps=400 --learning_rate=1e-4 --optimizer_type=\"AdamW8bit\" --xformers --mixed_precision=\"fp16\" --cache_latents --gradient_checkpointing --save_every_n_epochs=1 --network_module=networks.lora \u8fd9\u4e2a\u547d\u4ee4\u884c\u5c06\u8bad\u7ec3LoRA-LierLa\u3002 LoRA\u6a21\u578b\u5c06\u88ab\u4fdd\u5b58\u5230 --output_dir \u9009\u9879\u6307\u5b9a\u7684\u6587\u4ef6\u5939\u4e2d\u3002\u5176\u4ed6\u9009\u9879\u548c\u4f18\u5316\u5668\u7b49\u8bf7\u53c2\u8003 \u8bad\u7ec3\u7684\u5171\u540c\u6587\u6863 \u7684\u201c\u5e38\u7528\u9009\u9879\u201d\u3002 \u6b64\u5916\uff0c\u8fd8\u53ef\u4ee5\u6307\u5b9a\u4ee5\u4e0b\u9009\u9879\u3002 --network_dim \u6307\u5b9aLoRA\u7684RANK\uff08\u4f8b\u5982 --network_dim=4 \uff09\u3002\u7701\u7565\u65f6\u9ed8\u8ba4\u4e3a4\u3002\u6570\u503c\u8d8a\u5927\u8868\u793a\u80fd\u529b\u8d8a\u5f3a\uff0c\u4f46\u8bad\u7ec3\u6240\u9700\u7684\u5185\u5b58\u548c\u65f6\u95f4\u4e5f\u4f1a\u589e\u52a0\u3002\u76f2\u76ee\u589e\u52a0\u6570\u503c\u4e5f\u4e0d\u4e00\u5b9a\u597d\u3002 --network_alpha \u6307\u5b9a\u7528\u4e8e\u9632\u6b62\u4e0b\u6ea2\u5e76\u7a33\u5b9a\u8bad\u7ec3\u7684 alpha \u503c\u3002\u9ed8\u8ba4\u4e3a1\u3002` \u5f53\u4e0e network_dim \u7684\u503c\u76f8\u540c\u6307\u5b9a\u65f6\uff0c\u884c\u4e3a\u4e0e\u4ee5\u524d\u7684\u7248\u672c\u76f8\u540c\u3002 --persistent_data_loader_workers \u5728Windows\u73af\u5883\u4e2d\u6307\u5b9a\u65f6\uff0cepoch\u4e4b\u95f4\u7684\u7b49\u5f85\u65f6\u95f4\u5c06\u5927\u5927\u7f29\u77ed\u3002 --max_data_loader_n_workers \u6307\u5b9a\u6570\u636e\u52a0\u8f7d\u7684\u8fdb\u7a0b\u6570\u3002\u8fdb\u7a0b\u6570\u8d8a\u591a\uff0c\u6570\u636e\u52a0\u8f7d\u8d8a\u5feb\uff0cGPU\u5229\u7528\u7387\u8d8a\u9ad8\uff0c\u4f46\u4f1a\u6d88\u8017\u4e3b\u5185\u5b58\u3002\u9ed8\u8ba4\u503c\u4e3a\u201c 8 \u6216 CPU\u5e76\u53d1\u7ebf\u7a0b\u6570-1 \u4e2d\u8f83\u5c0f\u7684\u4e00\u4e2a\u201d\uff0c\u56e0\u6b64\u5982\u679c\u4e3b\u5185\u5b58\u4e0d\u5145\u88d5\u6216GPU\u5229\u7528\u7387\u8fbe\u523090%\u5de6\u53f3\uff0c\u8bf7\u6839\u636e\u8fd9\u4e9b\u6570\u503c\uff0c\u5c06\u5176\u964d\u4f4e\u5230 2 \u6216 1 \u5de6\u53f3\u3002 --network_weights \u5728\u8bad\u7ec3\u524d\u52a0\u8f7d\u9884\u8bad\u7ec3\u7684LoRA\u6743\u91cd\uff0c\u5e76\u5728\u6b64\u57fa\u7840\u4e0a\u7ee7\u7eed\u8bad\u7ec3\u3002 --network_train_unet_only \u53ea\u542f\u7528\u4e0eU-Net\u76f8\u5173\u7684LoRA\u6a21\u5757\u3002\u5728fine tuning\u5f0f\u7684\u8bad\u7ec3\u4e2d\u6307\u5b9a\u53ef\u80fd\u6bd4\u8f83\u597d\u3002 --network_train_text_encoder_only \u53ea\u542f\u7528\u4e0eText Encoder\u76f8\u5173\u7684LoRA\u6a21\u5757\u3002\u53ef\u80fd\u4f1a\u671f\u5f85Textual Inversion\u5f0f\u7684\u6548\u679c\u3002 --unet_lr \u5728\u4e0eU-Net\u76f8\u5173\u7684LoRA\u6a21\u5757\u4e2d\u4f7f\u7528\u4e0e\u901a\u5e38\u7684\u5b66\u4e60\u7387\uff08\u901a\u8fc7 --learning_rate \u9009\u9879\u6307\u5b9a\uff09\u4e0d\u540c\u7684\u5b66\u4e60\u7387\u65f6\u6307\u5b9a\u3002 --text_encoder_lr \u5728\u4e0eText Encoder\u76f8\u5173\u7684LoRA\u6a21\u5757\u4e2d\u4f7f\u7528\u4e0e\u901a\u5e38\u7684\u5b66\u4e60\u7387\uff08\u901a\u8fc7 --learning_rate \u9009\u9879\u6307\u5b9a\uff09\u4e0d\u540c\u7684\u5b66\u4e60\u7387\u65f6\u6307\u5b9a\u3002Text Encoder\u7684\u5b66\u4e60\u7387\u7a0d\u5fae\u4f4e\u4e00\u4e9b\uff085e-5\u7b49\uff09\u53ef\u80fd\u6bd4\u8f83\u597d\u3002 --network_args \u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\u53c2\u6570\uff0c\u540e\u8ff0\u3002 --alpha_mask \u5c06\u56fe\u50cf\u7684alpha\u503c\u7528\u4f5c\u63a9\u7801\u3002\u5728\u8bad\u7ec3\u900f\u660e\u56fe\u50cf\u65f6\u4f7f\u7528\u3002 PR #1223 \u5f53 --network_train_unet_only \u548c --network_train_text_encoder_only \u90fd\u6ca1\u6709\u6307\u5b9a\uff08\u9ed8\u8ba4\uff09\u65f6\uff0cText Encoder\u548cU-Net\u7684LoRA\u6a21\u5757\u90fd\u4f1a\u88ab\u542f\u7528\u3002 \u5176\u4ed6\u8bad\u7ec3\u65b9\u6cd5 \u8bad\u7ec3LoRA-C3Lier \u8bf7\u6309\u5982\u4e0b\u65b9\u5f0f\u6307\u5b9a --network_args \u3002\u7528 conv_dim \u6307\u5b9aConv2d (3x3)\u7684rank\uff0c\u7528 conv_alpha \u6307\u5b9aalpha\u3002 --network_args \"conv_dim=4\" \"conv_alpha=1\" \u5728\u4ee5\u4e0b\u793a\u4f8b\u4e2d\uff0c\u7701\u7565 alpha \u65f6\u9ed8\u8ba4\u4e3a1\u3002 --network_args \"conv_dim=4\" DyLoRA DyLoRA\u662f \u8fd9\u7bc7\u8bba\u6587 \u4e2d\u63d0\u51fa\u7684\u3002\u5b98\u65b9\u5b9e\u73b0\u5728 \u8fd9\u91cc \u3002 \u6839\u636e\u8bba\u6587\uff0cLoRA\u7684rank\u4e0d\u4e00\u5b9a\u662f\u8d8a\u9ad8\u8d8a\u597d\uff0c\u9700\u8981\u6839\u636e\u76ee\u6807\u6a21\u578b\u3001\u6570\u636e\u96c6\u3001\u4efb\u52a1\u7b49\u5bfb\u627e\u5408\u9002\u7684rank\u3002\u4f7f\u7528DyLoRA\uff0c\u53ef\u4ee5\u540c\u65f6\u8bad\u7ec3\u591a\u4e2arank\u7684LoRA\uff0c\u4ece\u800c\u7701\u53bb\u5206\u522b\u8bad\u7ec3\u548c\u5bfb\u627e\u6700\u4f73rank\u7684\u9ebb\u70e6\u3002 \u672c\u4ed3\u5e93\u7684\u5b9e\u73b0\u57fa\u4e8e\u5b98\u65b9\u5b9e\u73b0\uff0c\u5e76\u8fdb\u884c\u4e86\u4e00\u4e9b\u6269\u5c55\uff08\u56e0\u6b64\u53ef\u80fd\u5b58\u5728bug\u7b49\uff09\u3002 \u672c\u4ed3\u5e93\u4e2dDyLoRA\u7684\u7279\u70b9 \u8bad\u7ec3\u540e\u7684DyLoRA\u6a21\u578b\u6587\u4ef6\u4e0eLoRA\u517c\u5bb9\u3002\u6b64\u5916\uff0c\u53ef\u4ee5\u4ece\u6a21\u578b\u6587\u4ef6\u4e2d\u63d0\u53d6\u51fa\u591a\u4e2adim\u7684LoRA\u3002 \u53ef\u4ee5\u8bad\u7ec3DyLoRA-LierLa\u548cDyLoRA-C3Lier\u3002 \u4f7f\u7528DyLoRA\u8bad\u7ec3 \u6307\u5b9a --network_module=networks.dylora \uff0c\u50cf\u8fd9\u6837\u4f7f\u7528DyLoRA\u5bf9\u5e94\u7684 network.dylora \u3002 \u6b64\u5916\uff0c\u901a\u8fc7 --network_args \u6307\u5b9a unit \uff0c\u4f8b\u5982 --network_args \"unit=4\" \u3002 unit \u662f\u5206\u5272rank\u7684\u5355\u4f4d\u3002\u4f8b\u5982\uff0c\u6307\u5b9a --network_dim=16 --network_args \"unit=4\" \u3002 unit \u5e94\u8be5\u662f network_dim \u7684\u56e0\u6570\uff08 network_dim \u662f unit \u7684\u500d\u6570\uff09\u3002 \u5982\u679c\u4e0d\u6307\u5b9a unit \uff0c\u5219\u88ab\u89c6\u4e3a unit=1 \u3002 \u793a\u4f8b\u5982\u4e0b\u3002 --network_module=networks.dylora --network_dim=16 --network_args \"unit=4\" --network_module=networks.dylora --network_dim=32 --network_alpha=16 --network_args \"unit=4\" \u5bf9\u4e8eDyLoRA-C3Lier\uff0c\u901a\u8fc7 --network_args \u6307\u5b9a conv_dim \uff0c\u4f8b\u5982 \"conv_dim=4\" \u3002\u4e0e\u901a\u5e38\u7684LoRA\u4e0d\u540c\uff0c conv_dim \u9700\u8981\u4e0e network_dim \u76f8\u540c\u3002\u793a\u4f8b\u5982\u4e0b\u3002 --network_module=networks.dylora --network_dim=16 --network_args \"conv_dim=16\" \"unit=4\" --network_module=networks.dylora --network_dim=32 --network_alpha=16 --network_args \"conv_dim=32\" \"conv_alpha=16\" \"unit=8\" \u4f8b\u5982\uff0c\u5f53dim=16\uff0cunit=4\u65f6\uff0c\u53ef\u4ee5\u8bad\u7ec3\u548c\u63d0\u53d64\u30018\u300112\u300116\u56db\u4e2arank\u7684LoRA\u3002\u901a\u8fc7\u6bd4\u8f83\u4e0d\u540crank\u7684LoRA\u751f\u6210\u7684\u56fe\u50cf\uff0c\u53ef\u4ee5\u9009\u62e9\u6700\u4f73\u7684rank\u3002 \u5176\u4ed6\u9009\u9879\u4e0e\u901a\u5e38\u7684LoRA\u76f8\u540c\u3002 \u203b unit \u662f\u672c\u4ed3\u5e93\u7684\u72ec\u6709\u6269\u5c55\u3002\u5728DyLoRA\u4e2d\uff0c\u4e0e\u76f8\u540cdim\u7684\u901a\u5e38LoRA\u76f8\u6bd4\uff0c\u8bad\u7ec3\u65f6\u95f4\u53ef\u80fd\u4f1a\u66f4\u957f\uff0c\u56e0\u6b64\u91c7\u7528\u4e86\u66f4\u5927\u7684\u5206\u5272\u5355\u4f4d\u3002 \u4eceDyLoRA\u6a21\u578b\u4e2d\u63d0\u53d6LoRA\u6a21\u578b \u4f7f\u7528 networks \u6587\u4ef6\u5939\u4e2d\u7684 extract_lora_from_dylora.py \u3002\u6309\u7167\u6307\u5b9a\u7684 unit \u5355\u4f4d\uff0c\u4eceDyLoRA\u6a21\u578b\u4e2d\u63d0\u53d6LoRA\u6a21\u578b\u3002 \u547d\u4ee4\u884c\u793a\u4f8b\uff1a python networks\\extract_lora_from_dylora.py --model \"foldername/dylora-model.safetensors\" --save_to \"foldername/dylora-model-split.safetensors\" --unit 4 --model \u6307\u5b9aDyLoRA\u6a21\u578b\u6587\u4ef6\uff0c --save_to \u6307\u5b9a\u63d0\u53d6\u7684LoRA\u6a21\u578b\u7684\u4fdd\u5b58\u6587\u4ef6\u540d\uff08\u5c06\u5728\u6587\u4ef6\u540d\u540e\u9644\u52a0rank\u6570\u503c\uff09\uff0c --unit \u6307\u5b9aDyLoRA\u8bad\u7ec3\u65f6\u7684 unit \u3002 \u5c42\u6b21\u522b\u5b66\u4e60\u7387 \u8be6\u60c5\u8bf7\u53c2\u9605 PR #355 \u3002 \u53ef\u4ee5\u4e3a\u5168\u90e825\u4e2afull\u6a21\u578b\u7684block\u6307\u5b9a\u6743\u91cd\u3002\u7b2c\u4e00\u4e2ablock\u5bf9\u5e94\u7684LoRA\u4e0d\u5b58\u5728\uff0c\u4f46\u4e3a\u4e86\u4e0e\u5c42\u6b21\u522bLoRA\u5e94\u7528\u7b49\u4fdd\u6301\u517c\u5bb9\u6027\uff0c\u6307\u5b9a\u4e3a25\u4e2a\u3002\u6b64\u5916\uff0c\u5373\u4f7f\u4e0d\u6269\u5c55\u5230conv2d3x3\uff0c\u4e00\u90e8\u5206block\u7684LoRA\u4e5f\u4e0d\u5b58\u5728\uff0c\u4f46\u4e3a\u4e86\u7edf\u4e00\u63cf\u8ff0\uff0c\u59cb\u7ec8\u6307\u5b9a25\u4e2a\u503c\u3002 \u5728SDXL\u4e2d\uff0c\u8bf7\u6307\u5b9adown/up 9\u4e2a\uff0cmiddle 3\u4e2a\u6570\u503c\u3002 \u901a\u8fc7 --network_args \u6307\u5b9a\u4ee5\u4e0b\u53c2\u6570\u3002 down_lr_weight \uff1a\u6307\u5b9aU-Net\u7684down blocks\u7684\u5b66\u4e60\u7387\u6743\u91cd\u3002\u53ef\u4ee5\u6307\u5b9a\uff1a \u6bcf\u4e2ablock\u7684\u6743\u91cd\uff1a\u4f8b\u5982 \"down_lr_weight=0,0,0,0,0,0,1,1,1,1,1,1\" \uff0c\u6307\u5b9a12\u4e2a\u6570\u503c\uff08SDXL\u4e2d\u4e3a9\u4e2a\uff09\u3002 \u4ece\u9884\u8bbe\u6307\u5b9a\uff1a\u4f8b\u5982 \"down_lr_weight=sine\" \uff0c\u4f7f\u7528sine\u66f2\u7ebf\u6307\u5b9a\u6743\u91cd\u3002\u53ef\u4ee5\u6307\u5b9asine\u3001cosine\u3001linear\u3001reverse_linear\u3001zeros\u3002\u6b64\u5916\uff0c\u901a\u8fc7\u6dfb\u52a0 +\u6570\u503c \uff08\u4f8b\u5982 \"down_lr_weight=cosine+.25\" \uff09\uff0c\u53ef\u4ee5\u52a0\u4e0a\u6307\u5b9a\u7684\u6570\u503c\uff08\u8303\u56f4\u5c06\u662f0.25~1.25\uff09\u3002 mid_lr_weight \uff1a\u6307\u5b9aU-Net\u7684mid block\u7684\u5b66\u4e60\u7387\u6743\u91cd\u3002\u4f8b\u5982 \"mid_lr_weight=0.5\" \uff0c\u6307\u5b9a\u4e00\u4e2a\u6570\u503c\uff08SDXL\u4e2d\u4e3a3\u4e2a\uff09\u3002 up_lr_weight \uff1a\u6307\u5b9aU-Net\u7684up blocks\u7684\u5b66\u4e60\u7387\u6743\u91cd\u3002\u4e0edown_lr_weight\u76f8\u540c\u3002 \u7701\u7565\u7684\u90e8\u5206\u5c06\u88ab\u89c6\u4e3a1.0\u3002\u5982\u679c\u6743\u91cd\u4e3a0\uff0c\u5219\u4e0d\u4f1a\u521b\u5efa\u8be5block\u7684LoRA\u6a21\u5757\u3002 block_lr_zero_threshold \uff1a\u5982\u679c\u6743\u91cd\u5c0f\u4e8e\u6216\u7b49\u4e8e\u6b64\u503c\uff0c\u5219\u4e0d\u4f1a\u521b\u5efaLoRA\u6a21\u5757\u3002\u9ed8\u8ba4\u4e3a0\u3002 \u5c42\u6b21\u522b\u5b66\u4e60\u7387\u547d\u4ee4\u884c\u793a\u4f8b\uff1a --network_args \"down_lr_weight=0.5,0.5,0.5,0.5,1.0,1.0,1.0,1.0,1.5,1.5,1.5,1.5\" \"mid_lr_weight=2.0\" \"up_lr_weight=1.5,1.5,1.5,1.5,1.0,1.0,1.0,1.0,0.5,0.5,0.5,0.5\" --network_args \"block_lr_zero_threshold=0.1\" \"down_lr_weight=sine+.5\" \"mid_lr_weight=1.5\" \"up_lr_weight=cosine+.5\" \u5c42\u6b21\u522b\u5b66\u4e60\u7387toml\u6587\u4ef6\u793a\u4f8b\uff1a network_args = [ \"down_lr_weight=0.5,0.5,0.5,0.5,1.0,1.0,1.0,1.0,1.5,1.5,1.5,1.5\", \"mid_lr_weight=2.0\", \"up_lr_weight=1.5,1.5,1.5,1.5,1.0,1.0,1.0,1.0,0.5,0.5,0.5,0.5\",] network_args = [ \"block_lr_zero_threshold=0.1\", \"down_lr_weight=sine+.5\", \"mid_lr_weight=1.5\", \"up_lr_weight=cosine+.5\", ] \u5c42\u6b21\u522bdim (rank) \u53ef\u4ee5\u4e3a\u5168\u90e825\u4e2afull\u6a21\u578b\u7684block\u6307\u5b9adim (rank)\u3002\u4e0e\u5c42\u6b21\u522b\u5b66\u4e60\u7387\u7c7b\u4f3c\uff0c\u4e00\u90e8\u5206block\u7684LoRA\u53ef\u80fd\u4e0d\u5b58\u5728\uff0c\u4f46\u59cb\u7ec8\u6307\u5b9a25\u4e2a\u503c\u3002 \u5728SDXL\u4e2d\uff0c\u8bf7\u6307\u5b9a23\u4e2a\u6570\u503c\u3002\u7531\u4e8e\u4e0e sdxl_train.py \u7684 \u5c42\u6b21\u522b\u5b66\u4e60\u7387 \u517c\u5bb9\uff0c\u56e0\u6b64\u4e00\u90e8\u5206block\u7684LoRA\u4e0d\u5b58\u5728\u3002\u5bf9\u5e94\u5173\u7cfb\u4e3a 0: time/label embed, 1-9: input blocks 0-8, 10-12: mid blocks 0-2, 13-21: output blocks 0-8, 22: out \u3002 \u901a\u8fc7 --network_args \u6307\u5b9a\u4ee5\u4e0b\u53c2\u6570\u3002 block_dims \uff1a\u6307\u5b9a\u6bcf\u4e2ablock\u7684dim (rank)\u3002\u4f8b\u5982 \"block_dims=2,2,2,2,4,4,4,4,6,6,6,6,8,6,6,6,6,4,4,4,4,2,2,2,2\" \uff0c\u6307\u5b9a25\u4e2a\u6570\u503c\u3002 block_alphas \uff1a\u6307\u5b9a\u6bcf\u4e2ablock\u7684alpha\u3002\u4e0eblock_dims\u7c7b\u4f3c\uff0c\u6307\u5b9a25\u4e2a\u6570\u503c\u3002\u7701\u7565\u65f6\u4f7f\u7528 network_alpha \u7684\u503c\u3002 conv_block_dims \uff1a\u5c06LoRA\u6269\u5c55\u5230Conv2d 3x3\u65f6\uff0c\u6307\u5b9a\u6bcf\u4e2ablock\u7684dim (rank)\u3002 conv_block_alphas \uff1a\u5c06LoRA\u6269\u5c55\u5230Conv2d 3x3\u65f6\uff0c\u6307\u5b9a\u6bcf\u4e2ablock\u7684alpha\u3002\u7701\u7565\u65f6\u4f7f\u7528 conv_alpha \u7684\u503c\u3002 \u5c42\u6b21\u522bdim (rank)\u547d\u4ee4\u884c\u793a\u4f8b\uff1a --network_args \"block_dims=2,4,4,4,8,8,8,8,12,12,12,12,16,12,12,12,12,8,8,8,8,4,4,4,2\" --network_args \"block_dims=2,4,4,4,8,8,8,8,12,12,12,12,16,12,12,12,12,8,8,8,8,4,4,4,2\" \"conv_block_dims=2,2,2,2,4,4,4,4,6,6,6,6,8,6,6,6,6,4,4,4,4,2,2,2,2\" --network_args \"block_dims=2,4,4,4,8,8,8,8,12,12,12,12,16,12,12,12,12,8,8,8,8,4,4,4,2\" \"block_alphas=2,2,2,2,4,4,4,4,6,6,6,6,8,6,6,6,6,4,4,4,4,2,2,2,2\" \u5c42\u6b21\u522bdim (rank)toml\u6587\u4ef6\u793a\u4f8b\uff1a network_args = [ \"block_dims=2,4,4,4,8,8,8,8,12,12,12,12,16,12,12,12,12,8,8,8,8,4,4,4,2\",] network_args = [ \"block_dims=2,4,4,4,8,8,8,8,12,12,12,12,16,12,12,12,12,8,8,8,8,4,4,4,2\", \"block_alphas=2,2,2,2,4,4,4,4,6,6,6,6,8,6,6,6,6,4,4,4,4,2,2,2,2\",] \u5176\u4ed6\u811a\u672c \u4e0eLoRA\u76f8\u5173\u7684\u811a\u672c\u7fa4\uff0c\u5982\u5408\u5e76\u7b49\u3002 \u5173\u4e8e\u5408\u5e76\u811a\u672c \u4f7f\u7528merge_lora.py\u53ef\u4ee5\u5c06LoRA\u7684\u8bad\u7ec3\u7ed3\u679c\u4e0eStable Diffusion\u6a21\u578b\u5408\u5e76\uff0c\u6216\u5c06\u591a\u4e2aLoRA\u6a21\u578b\u5408\u5e76\u3002 \u5bf9\u4e8eSDXL\uff0c\u6709sdxl_merge_lora.py\u53ef\u7528\u3002\u9009\u9879\u7b49\u76f8\u540c\uff0c\u56e0\u6b64\u8bf7\u5c06\u4ee5\u4e0bmerge_lora.py\u66ff\u6362\u4e3asdxl_merge_lora.py\u3002 \u5c06LoRA\u6a21\u578b\u4e0eStable Diffusion\u6a21\u578b\u5408\u5e76 \u5408\u5e76\u540e\u7684\u6a21\u578b\u53ef\u4ee5\u50cf\u666e\u901a\u7684Stable Diffusion\u7684ckpt\u4e00\u6837\u5904\u7406\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u662f\u547d\u4ee4\u884c\u793a\u4f8b\u3002 python networks\\merge_lora.py --sd_model ..\\model\\model.ckpt --save_to ..\\lora_train1\\model-char1-merged.safetensors --models ..\\lora_train1\\last.safetensors --ratios 0.8 \u4f7f\u7528Stable Diffusion v2.x\u6a21\u578b\u8fdb\u884c\u8bad\u7ec3\u5e76\u5408\u5e76\u65f6\uff0c\u8bf7\u6307\u5b9a--v2\u9009\u9879\u3002 \u901a\u8fc7--sd_model\u9009\u9879\u6307\u5b9a\u8981\u5408\u5e76\u7684Stable Diffusion\u6a21\u578b\u6587\u4ef6\uff08\u76ee\u524d\u4ec5\u652f\u6301.ckpt\u6216.safetensors\uff0c\u4e0d\u652f\u6301Diffusers\uff09\u3002 \u901a\u8fc7--save_to\u9009\u9879\u6307\u5b9a\u5408\u5e76\u540e\u7684\u6a21\u578b\u7684\u4fdd\u5b58\u8def\u5f84\uff08\u6839\u636e\u6269\u5c55\u540d\u81ea\u52a8\u5224\u65ad\u662f.ckpt\u8fd8\u662f.safetensors\uff09\u3002 \u901a\u8fc7--models\u6307\u5b9a\u8bad\u7ec3\u597d\u7684LoRA\u6a21\u578b\u6587\u4ef6\u3002\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\uff0c\u6309\u987a\u5e8f\u5408\u5e76\u3002 \u901a\u8fc7--ratios\u6307\u5b9a\u6bcf\u4e2a\u6a21\u578b\u7684\u9002\u7528\u7387\uff08\u5373\u6a21\u578b\u6743\u91cd\u5bf9\u539f\u6a21\u578b\u7684\u53cd\u6620\u7a0b\u5ea6\uff09\uff0c\u53d6\u503c\u4e3a0~1.0\u3002\u4f8b\u5982\uff0c\u5982\u679c\u8fc7\u62df\u5408\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u964d\u4f4e\u9002\u7528\u7387\u6765\u6539\u5584\u3002\u6a21\u578b\u7684\u6570\u91cf\u5e94\u4e0e\u6307\u5b9a\u7684\u6a21\u578b\u6570\u91cf\u76f8\u540c\u3002 \u591a\u4e2a\u6a21\u578b\u65f6\u7684\u793a\u4f8b\uff1a python networks\\merge_lora.py --sd_model ..\\model\\model.ckpt --save_to ..\\lora_train1\\model-char1-merged.safetensors --models ..\\lora_train1\\last.safetensors ..\\lora_train2\\last.safetensors --ratios 0.8 0.5 \u5408\u5e76\u591a\u4e2aLoRA\u6a21\u578b \u6307\u5b9a--concat\u9009\u9879\uff0c\u53ef\u4ee5\u7b80\u5355\u5730\u5c06\u591a\u4e2aLoRA\u5408\u5e76\u6210\u4e00\u4e2a\u65b0\u7684LoRA\u6a21\u578b\u3002\u6587\u4ef6\u5927\u5c0f\uff08\u4ee5\u53cadim/rank\uff09\u5c06\u662f\u6307\u5b9aLoRA\u7684\u603b\u5927\u5c0f\uff08\u5982\u679c\u8981\u5728\u5408\u5e76\u65f6\u6539\u53d8dim (rank)\uff0c\u8bf7\u4f7f\u7528 svd_merge_lora.py \uff09\u3002 \u4f8b\u5982\uff0c\u4ee5\u4e0b\u662f\u547d\u4ee4\u884c\u793a\u4f8b\u3002 python networks\\merge_lora.py --save_precision bf16 --save_to ..\\lora_train1\\model-char1-style1-merged.safetensors --models ..\\lora_train1\\last.safetensors ..\\lora_train2\\last.safetensors --ratios 1.0 -1.0 --concat --shuffle \u6307\u5b9a--concat\u9009\u9879\u3002 \u6b64\u5916\uff0c\u6dfb\u52a0--shuffle\u9009\u9879\uff0c\u6743\u91cd\u5c06\u88ab\u6253\u4e71\u3002\u5982\u679c\u4e0d\u6253\u4e71\uff0c\u5408\u5e76\u540e\u7684LoRA\u53ef\u4ee5\u88ab\u5206\u89e3\u56de\u539f\u6765\u7684LoRA\uff0c\u56e0\u6b64\u5728\u62f7\u8d1d\u5b66\u4e60\u7b49\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u539f\u59cb\u8bad\u7ec3\u6570\u636e\u88ab\u66b4\u9732\u3002\u8bf7\u6ce8\u610f\u3002 \u901a\u8fc7--save_to\u9009\u9879\u6307\u5b9a\u5408\u5e76\u540e\u7684LoRA\u6a21\u578b\u7684\u4fdd\u5b58\u8def\u5f84\uff08\u6839\u636e\u6269\u5c55\u540d\u81ea\u52a8\u5224\u65ad\u662f.ckpt\u8fd8\u662f.safetensors\uff09\u3002 \u901a\u8fc7--models\u6307\u5b9a\u8bad\u7ec3\u597d\u7684LoRA\u6a21\u578b\u6587\u4ef6\u3002\u53ef\u4ee5\u6307\u5b9a\u4e09\u4e2a\u4ee5\u4e0a\u3002 \u901a\u8fc7--ratios\u6307\u5b9a\u6bcf\u4e2a\u6a21\u578b\u7684\u6bd4\u7387\uff08\u5373\u6a21\u578b\u6743\u91cd\u5bf9\u539f\u6a21\u578b\u7684\u53cd\u6620\u7a0b\u5ea6\uff09\uff0c\u53d6\u503c\u4e3a0~1.0\u3002\u5c06\u4e24\u4e2a\u6a21\u578b\u4e00\u5bf9\u4e00\u5408\u5e76\u65f6\uff0c\u6bd4\u7387\u5e94\u4e3a\u201c0.5 0.5\u201d\u3002\u5982\u679c\u4f7f\u7528\u201c1.0 1.0\u201d\uff0c\u5219\u603b\u6743\u91cd\u5c06\u8fc7\u5927\uff0c\u7ed3\u679c\u53ef\u80fd\u4e0d\u7406\u60f3\u3002 \u4f7f\u7528v1\u8bad\u7ec3\u7684LoRA\u548cv2\u8bad\u7ec3\u7684LoRA\u3001\u6216\u8005rank\uff08\u7ef4\u5ea6\u6570\uff09\u4e0d\u540c\u7684LoRA\u4e0d\u80fd\u5408\u5e76\u3002U-Net alone\u7684LoRA\u548cU-Net+Text Encoder\u7684LoRA\u7406\u8bba\u4e0a\u53ef\u4ee5\u5408\u5e76\uff0c\u4f46\u7ed3\u679c\u672a\u77e5\u3002 \u5176\u4ed6\u9009\u9879 precision \u53ef\u4ee5\u6307\u5b9a\u5408\u5e76\u8ba1\u7b97\u65f6\u7684\u7cbe\u5ea6\uff0c\u6709float\u3001fp16\u3001bf16\u53ef\u9009\u3002\u7701\u7565\u65f6\u4e3a\u4e86\u786e\u4fdd\u7cbe\u5ea6\u9ed8\u8ba4\u4e3afloat\u3002\u5982\u679c\u8981\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\u91cf\uff0c\u53ef\u4ee5\u6307\u5b9afp16/bf16\u3002 save_precision \u53ef\u4ee5\u6307\u5b9a\u6a21\u578b\u4fdd\u5b58\u65f6\u7684\u7cbe\u5ea6\uff0c\u6709float\u3001fp16\u3001bf16\u53ef\u9009\u3002\u7701\u7565\u65f6\u4e0eprecision\u76f8\u540c\u3002 \u8fd8\u6709\u5176\u4ed6\u4e00\u4e9b\u9009\u9879\uff0c\u8bf7\u4f7f\u7528--help\u67e5\u770b\u3002 \u5408\u5e76\u591a\u4e2arank\u4e0d\u540c\u7684LoRA\u6a21\u578b \u4f7f\u7528 svd_merge_lora.py \u5c06\u591a\u4e2aLoRA\u8fd1\u4f3c\u4e3a\u4e00\u4e2aLoRA\uff08\u65e0\u6cd5\u5b8c\u5168\u518d\u73b0\uff09\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u662f\u547d\u4ee4\u884c\u793a\u4f8b\u3002 python networks\\svd_merge_lora.py --save_to ..\\lora_train1\\model-char1-style1-merged.safetensors --models ..\\lora_train1\\last.safetensors ..\\lora_train2\\last.safetensors --ratios 0.6 0.4 --new_rank 32 --device cuda merge_lora.py \u7684\u4e3b\u8981\u9009\u9879\u76f8\u540c\u3002\u4ee5\u4e0b\u9009\u9879\u662f\u65b0\u589e\u7684\u3002 --new_rank \u6307\u5b9a\u521b\u5efa\u7684LoRA\u7684rank\u3002 --new_conv_rank \u6307\u5b9a\u521b\u5efa\u7684 Conv2d 3x3 LoRA \u7684 rank\u3002\u7701\u7565\u65f6\u4e0e new_rank \u76f8\u540c\u3002 --device \u6307\u5b9a --device cuda \u4ee5\u5728GPU\u4e0a\u8fdb\u884c\u8ba1\u7b97\u3002\u5904\u7406\u901f\u5ea6\u66f4\u5feb\u3002 \u4f7f\u7528\u672c\u4ed3\u5e93\u4e2d\u7684\u56fe\u50cf\u751f\u6210\u811a\u672c\u751f\u6210 \u5728gen_img_diffusers.py\u4e2d\u6dfb\u52a0 --network_module \u548c --network_weights \u9009\u9879\u3002\u542b\u4e49\u4e0e\u8bad\u7ec3\u65f6\u76f8\u540c\u3002 \u901a\u8fc7 --network_mul \u9009\u9879\u6307\u5b9a0~1.0\u7684\u6570\u503c\uff0c\u53ef\u4ee5\u6539\u53d8LoRA\u7684\u5e94\u7528\u7387\u3002 \u5728Diffusers\u7684pipeline\u4e2d\u751f\u6210 \u8bf7\u53c2\u8003\u4ee5\u4e0b\u793a\u4f8b\u3002\u53ea\u9700\u8981networks/lora.py\u6587\u4ef6\u3002Diffusers\u7684\u7248\u672c\u53ef\u80fd\u9700\u8981\u662f0.10.2\u3002 import torch from diffusers import StableDiffusionPipeline from networks.lora import LoRAModule, create_network_from_weights from safetensors.torch import load_file # \u5982\u679cckpt\u662f\u57fa\u4e8eCompVis\u7684\uff0c\u8bf7\u4e8b\u5148\u4f7f\u7528tools/convert_diffusers20_original_sd.py\u8f6c\u6362\u4e3aDiffusers\u3002\u6709\u5173\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605--help\u3002 model_id_or_dir = r\"model_id_on_hugging_face_or_dir\" device = \"cuda\" # \u521b\u5efa\u7ba1\u9053 print(f\"\u4ece{model_id_or_dir}\u521b\u5efa\u7ba1\u9053...\") pipe = StableDiffusionPipeline.from_pretrained(model_id_or_dir, revision=\"fp16\", torch_dtype=torch.float16) pipe = pipe.to(device) vae = pipe.vae text_encoder = pipe.text_encoder unet = pipe.unet # \u52a0\u8f7dLoRA\u7f51\u7edc print(f\"\u52a0\u8f7dLoRA\u7f51\u7edc...\") lora_path1 = r\"lora1.safetensors\" sd = load_file(lora_path1) # \u5982\u679c\u6587\u4ef6\u662f.ckpt\uff0c\u8bf7\u4f7f\u7528torch.load\u3002 network1, sd = create_network_from_weights(0.5, None, vae, text_encoder,unet, sd) network1.apply_to(text_encoder, unet) network1.load_state_dict(sd) network1.to(device, dtype=torch.float16) # # \u60a8\u4e5f\u53ef\u4ee5\u5408\u5e76\u6743\u91cd\uff0c\u800c\u4e0d\u662fapply_to+load_state_dict\u3002network.set_multiplier\u4e0d\u8d77\u4f5c\u7528 # network.merge_to(text_encoder, unet, sd) lora_path2 = r\"lora2.safetensors\" sd = load_file(lora_path2) network2, sd = create_network_from_weights(0.7, None, vae, text_encoder,unet, sd) network2.apply_to(text_encoder, unet) network2.load_state_dict(sd) network2.to(device, dtype=torch.float16) lora_path3 = r\"lora3.safetensors\" sd = load_file(lora_path3) network3, sd = create_network_from_weights(0.5, None, vae, text_encoder,unet, sd) network3.apply_to(text_encoder, unet) network3.load_state_dict(sd) network3.to(device, dtype=torch.float16) # \u63d0\u793a prompt = \"\u6770\u4f5c\uff0c\u6700\u4f73\u8d28\u91cf\uff0c1\u4e2a\u5973\u5b69\uff0c\u7a7f\u7740\u767d\u886c\u886b\uff0c\u770b\u7740\u89c2\u4f17\" negative_prompt = \"\u7cdf\u7cd5\u7684\u8d28\u91cf\uff0c\u6700\u5dee\u7684\u8d28\u91cf\uff0c\u7cdf\u7cd5\u7684\u89e3\u5256\u7ed3\u6784\uff0c\u7cdf\u7cd5\u7684\u624b\" # \u6267\u884c\u7ba1\u9053 print(\"\u751f\u6210\u56fe\u50cf...\") with torch.autocast(\"cuda\"): image = pipe(prompt, guidance_scale=7.5, negative_prompt=negative_prompt).images[0] # \u5982\u679c\u672a\u5408\u5e76\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528set_multiplier # network1.set_multiplier(0.8) # \u5e76\u518d\u6b21\u751f\u6210\u56fe\u50cf... # \u4fdd\u5b58\u56fe\u50cf image.save(r\"\u7531Diffusers\u751f\u6210\u7684\u56fe\u50cf.png\") \u4ece\u4e24\u4e2a\u6a21\u578b\u5dee\u5f02\u521b\u5efaLoRA\u6a21\u578b \u8fd9\u662f\u53c2\u8003 \u8fd9\u4e2a\u8ba8\u8bba \u5b9e\u73b0\u7684\u3002\u516c\u5f0f\u76f4\u63a5\u4f7f\u7528\uff08\u4f3c\u4e4e\u4f7f\u7528\u5947\u5f02\u503c\u5206\u89e3\u8fdb\u884c\u8fd1\u4f3c\uff09\u3002 \u5c06\u4e24\u4e2a\u6a21\u578b\uff08\u4f8b\u5982fine tuning\u524d\u7684\u6a21\u578b\u548cfine tuning\u540e\u7684\u6a21\u578b\uff09\u7684\u5dee\u5f02\u8fd1\u4f3c\u4e3aLoRA\u3002 \u811a\u672c\u6267\u884c\u65b9\u6cd5 \u8bf7\u6309\u5982\u4e0b\u65b9\u5f0f\u6307\u5b9a\u3002 python networks\\extract_lora_from_models.py --model_org base-model.ckpt --model_tuned fine-tuned-model.ckpt --save_to lora-weights.safetensors --dim 4 \u901a\u8fc7 --model_org \u9009\u9879\u6307\u5b9a\u539f\u59cb\u7684Stable Diffusion\u6a21\u578b\u3002\u5e94\u7528\u521b\u5efa\u7684LoRA\u6a21\u578b\u65f6\uff0c\u5c06\u4f7f\u7528\u6b64\u6a21\u578b\u3002.ckpt\u6216.safetensors\u53ef\u4ee5\u6307\u5b9a\u3002 \u901a\u8fc7 --model_tuned \u9009\u9879\u6307\u5b9a\u8981\u63d0\u53d6\u5dee\u5f02\u7684\u76ee\u6807Stable Diffusion\u6a21\u578b\u3002\u4f8b\u5982\uff0cfine tuning\u6216DreamBooth\u540e\u7684\u6a21\u578b\u3002.ckpt\u6216.safetensors\u53ef\u4ee5\u6307\u5b9a\u3002 \u901a\u8fc7 --save_to \u6307\u5b9aLoRA\u6a21\u578b\u7684\u4fdd\u5b58\u8def\u5f84\u3002 --dim \u6307\u5b9aLoRA\u7684\u7ef4\u5ea6\u6570\u3002 \u751f\u6210\u7684LoRA\u6a21\u578b\u53ef\u4ee5\u50cf\u8bad\u7ec3\u597d\u7684LoRA\u6a21\u578b\u4e00\u6837\u4f7f\u7528\u3002 \u5982\u679c\u4e24\u4e2a\u6a21\u578b\u7684Text Encoder\u76f8\u540c\uff0c\u5219LoRA\u5c06\u4ec5\u4e3aU-Net\u7684LoRA\u3002 \u5176\u4ed6\u9009\u9879 --v2 \u4f7f\u7528v2.x\u7684Stable Diffusion\u6a21\u578b\u65f6\u6307\u5b9a\u3002 --device \u6307\u5b9a --device cuda \u4ee5\u5728GPU\u4e0a\u8fdb\u884c\u8ba1\u7b97\u3002\u5904\u7406\u901f\u5ea6\u66f4\u5feb\uff08CPU\u4e0b\u4e5f\u4e0d\u592a\u6162\uff0c\u5927\u7ea6\u662f2~\u6570\u500d\uff09\u3002 --save_precision \u6307\u5b9aLoRA\u7684\u4fdd\u5b58\u683c\u5f0f\uff0c\u6709\"float\"\u3001\"fp16\"\u3001\"bf16\"\u53ef\u9009\u3002\u7701\u7565\u65f6\u9ed8\u8ba4\u4e3afloat\u3002 --conv_dim \u6307\u5b9a\u65f6\u5c06LoRA\u7684\u5e94\u7528\u8303\u56f4\u6269\u5c55\u5230Conv2d 3x3\u3002\u6307\u5b9aConv2d 3x3\u7684rank\u3002 \u56fe\u50cf\u5927\u5c0f\u8c03\u6574\u811a\u672c \uff08\u7a0d\u540e\u5c06\u6574\u7406\u6587\u6863\uff0c\u76ee\u524d\u5148\u5728\u8fd9\u91cc\u5199\u8bf4\u660e\u3002\uff09 \u4f5c\u4e3aAspect Ratio Bucketing\u7684\u529f\u80fd\u6269\u5c55\uff0c\u53ef\u4ee5\u5c06\u8f83\u5c0f\u7684\u56fe\u50cf\u4fdd\u6301\u539f\u6837\u4f5c\u4e3a\u8bad\u7ec3\u6570\u636e\u3002\u6b64\u5916\uff0c\u6536\u5230\u5c06\u539f\u59cb\u8bad\u7ec3\u56fe\u50cf\u7f29\u5c0f\u540e\u7684\u56fe\u50cf\u6dfb\u52a0\u5230\u8bad\u7ec3\u6570\u636e\u7684\u62a5\u544a\u548c\u9884\u5904\u7406\u811a\u672c\uff0c\u56e0\u6b64\u8fdb\u884c\u4e86\u6574\u7406\u548c\u6dfb\u52a0\u3002\u611f\u8c22bmaltais\u3002 \u811a\u672c\u6267\u884c\u65b9\u6cd5 \u8bf7\u6309\u5982\u4e0b\u65b9\u5f0f\u6307\u5b9a\u3002\u539f\u59cb\u56fe\u50cf\u548c\u8c03\u6574\u5927\u5c0f\u540e\u7684\u56fe\u50cf\u5c06\u88ab\u4fdd\u5b58\u5230\u8f6c\u6362\u540e\u7684\u6587\u4ef6\u5939\u4e2d\u3002\u8c03\u6574\u5927\u5c0f\u540e\u7684\u56fe\u50cf\u7684\u6587\u4ef6\u540d\u5c06\u9644\u52a0\u8c03\u6574\u5927\u5c0f\u540e\u7684\u5206\u8fa8\u7387\uff08\u4f8b\u5982 +512x512 \uff09\u3002\u5982\u679c\u8c03\u6574\u5927\u5c0f\u540e\u7684\u5206\u8fa8\u7387\u5c0f\u4e8e\u539f\u59cb\u56fe\u50cf\uff0c\u5219\u4e0d\u4f1a\u88ab\u653e\u5927\u3002 python tools\\resize_images_to_resolution.py --max_resolution 512x512,384x384,256x256 --save_as_png \u539f\u59cb\u56fe\u50cf\u6587\u4ef6\u5939 \u8f6c\u6362\u540e\u7684\u6587\u4ef6\u5939 \u539f\u59cb\u56fe\u50cf\u6587\u4ef6\u5939\u4e2d\u7684\u56fe\u50cf\u6587\u4ef6\u5c06\u88ab\u8c03\u6574\u5927\u5c0f\uff0c\u4ee5\u4f7f\u5176\u9762\u79ef\u4e0e\u6307\u5b9a\u7684\u5206\u8fa8\u7387\uff08\u53ef\u6307\u5b9a\u591a\u4e2a\uff09\u76f8\u540c\uff0c\u5e76\u4fdd\u5b58\u5230\u8f6c\u6362\u540e\u7684\u6587\u4ef6\u5939\u4e2d\u3002\u975e\u56fe\u50cf\u6587\u4ef6\u5c06\u4fdd\u6301\u4e0d\u53d8\u3002 \u901a\u8fc7 --max_resolution \u9009\u9879\u6307\u5b9a\u8c03\u6574\u5927\u5c0f\u540e\u7684\u5927\u5c0f\uff0c\u5982\u793a\u4f8b\u6240\u793a\u3002\u9762\u79ef\u5c06\u88ab\u8c03\u6574\u4e3a\u8be5\u5927\u5c0f\u3002\u6307\u5b9a\u591a\u4e2a\u65f6\uff0c\u5c06\u5206\u522b\u8c03\u6574\u5927\u5c0f\u4e3a\u6bcf\u4e2a\u5206\u8fa8\u7387\u3002\u4f8b\u5982\uff0c 512x512,384x384,256x256 \u5c06\u5728\u8f6c\u6362\u540e\u7684\u6587\u4ef6\u5939\u4e2d\u751f\u6210\u539f\u59cb\u5927\u5c0f\u548c\u8c03\u6574\u5927\u5c0f\u540e\u7684\u5927\u5c0f\u00d73\uff0c\u51714\u5f20\u56fe\u50cf\u3002 \u901a\u8fc7 --save_as_png \u9009\u9879\u6307\u5b9a\u4ee5png\u683c\u5f0f\u4fdd\u5b58\u3002\u7701\u7565\u65f6\u5c06\u4ee5jpeg\u683c\u5f0f\uff08quality=100\uff09\u4fdd\u5b58\u3002 \u901a\u8fc7 --copy_associated_files \u9009\u9879\u6307\u5b9a\u65f6\uff0c\u5c06\u4e0e\u56fe\u50cf\u6587\u4ef6\u540d\uff08\u9664\u6269\u5c55\u540d\u5916\uff09\u76f8\u540c\u7684\u5176\u4ed6\u6587\u4ef6\uff08\u4f8b\u5982caption\uff09\u4ee5\u8c03\u6574\u5927\u5c0f\u540e\u7684\u56fe\u50cf\u7684\u6587\u4ef6\u540d\u590d\u5236\u3002 \u5176\u4ed6\u9009\u9879 divisible_by \u8c03\u6574\u5927\u5c0f\u540e\u7684\u56fe\u50cf\u5927\u5c0f\uff08\u9ad8\u5ea6\u548c\u5bbd\u5ea6\uff09\u5c06\u901a\u8fc7\u88c1\u526a\u56fe\u50cf\u4e2d\u5fc3\uff0c\u4f7f\u5176\u53ef\u4ee5\u88ab\u8be5\u503c\u6574\u9664\u3002 interpolation \u6307\u5b9a\u7f29\u5c0f\u65f6\u7684\u63d2\u503c\u65b9\u6cd5\u3002\u53ef\u9009 area \u3001 cubic \u3001 lanczos4 \uff0c\u9ed8\u8ba4\u4e3a area \u3002 \u9644\u52a0\u4fe1\u606f \u4e0ecloneofsimo\u4ed3\u5e93\u7684\u533a\u522b \u622a\u81f32022/12/25\uff0c\u672c\u4ed3\u5e93\u5c06LoRA\u7684\u5e94\u7528\u8303\u56f4\u6269\u5c55\u5230Text Encoder\u7684MLP\u3001U-Net\u7684FFN\u548cTransformer\u7684in/out projection\uff0c\u4ece\u800c\u589e\u5f3a\u4e86\u8868\u793a\u80fd\u529b\u3002\u4f46\u4ee3\u4ef7\u662f\u5185\u5b58\u4f7f\u7528\u91cf\u589e\u52a0\uff0c8GB VRAM\u52c9\u5f3a\u591f\u7528\u3002 \u6b64\u5916\uff0c\u6a21\u5757\u66ff\u6362\u673a\u5236\u5b8c\u5168\u4e0d\u540c\u3002 \u5173\u4e8e\u672a\u6765\u6269\u5c55 \u4e0d\u4ec5\u9650\u4e8eLoRA\uff0c\u8fd8\u53ef\u4ee5\u652f\u6301\u5176\u4ed6\u6269\u5c55\u3002\u672a\u6765\u5c06\u8003\u8651\u6dfb\u52a0\u8fd9\u4e9b\u6269\u5c55\u3002","title":"Lora-\u6a21\u578b\u8bad\u7ec3"},{"location":"sd-scripts-docs/train_network/#lora","text":"\u8fd9\u662f\u5c06 LoRA: Low-Rank Adaptation of Large Language Models \uff08arxiv\uff09\u548c LoRA \uff08github\uff09\u5e94\u7528\u4e8eStable Diffusion\u7684\u7ed3\u679c\u3002 \u6211\u5927\u91cf\u53c2\u8003\u4e86 cloneofsimo\u7684\u4ed3\u5e93 \uff0c\u5728\u6b64\u8868\u793a\u611f\u8c22\u3002 \u901a\u5e38\u7684LoRA\u4ec5\u9002\u7528\u4e8eLinear\u548c\u5185\u6838\u5927\u5c0f\u4e3a1x1\u7684Conv2d\uff0c\u4f46\u4e5f\u53ef\u4ee5\u6269\u5c55\u5230\u5185\u6838\u5927\u5c0f\u4e3a3x3\u7684Conv2d\u3002 \u5c06Conv2d 3x3\u6269\u5c55\u5230LoRA\u662f\u7531 cloneofsimo \u9996\u5148\u53d1\u5e03\u7684\uff0c KohakuBlueleaf \u63ed\u793a\u4e86\u5176\u6709\u6548\u6027\u3002\u5728\u6b64\u5bf9KohakuBlueleaf\u8868\u793a\u6df1\u6df1\u7684\u611f\u8c22\u3002 \u5373\u4f7f\u57288GB VRAM\u4e0b\uff0c\u4f3c\u4e4e\u4e5f\u80fd\u52c9\u5f3a\u8fd0\u884c\u3002 \u8bf7\u540c\u65f6\u53c2\u9605 \u5173\u4e8e\u8bad\u7ec3\u7684\u5171\u540c\u6587\u6863 \u3002","title":"LoRA\u7684\u8bad\u7ec3"},{"location":"sd-scripts-docs/train_network/#lora_1","text":"\u652f\u6301\u4ee5\u4e0b\u4e24\u79cd\u7c7b\u578b\u3002\u4ee5\u4e0b\u662f\u5728\u672c\u4ed3\u5e93\u4e2d\u7684\u81ea\u5b9a\u4e49\u540d\u79f0\u3002 LoRA-LierLa \uff1a\uff08LoRA for Li__n __e__a __r La yers\uff0c\u8bfb\u4f5cLierLa\uff09 \u9002\u7528\u4e8eLinear\u548c\u5185\u6838\u5927\u5c0f\u4e3a1x1\u7684Conv2d\u7684LoRA\u3002 LoRA-C3Lier \uff1a\uff08LoRA for C__olutional layers with __3 x3 Kernel and Li__n __e__a __r layers\uff0c\u8bfb\u4f5cC3Lier\uff09 \u57281\u7684\u57fa\u7840\u4e0a\uff0c\u989d\u5916\u9002\u7528\u4e8e\u5185\u6838\u5927\u5c0f\u4e3a3x3\u7684Conv2d\u7684LoRA\u3002 \u4e0eLoRA-LierLa\u76f8\u6bd4\uff0cLoRA-C3Lier\u7531\u4e8e\u9002\u7528\u7684\u5c42\u589e\u52a0\uff0c\u53ef\u80fd\u671f\u5f85\u66f4\u9ad8\u7684\u7cbe\u5ea6\u3002 \u5728\u8bad\u7ec3\u65f6\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 DyLoRA \uff08\u540e\u8ff0\uff09\u3002","title":"\u53ef\u4ee5\u8bad\u7ec3\u7684LoRA\u7c7b\u578b"},{"location":"sd-scripts-docs/train_network/#_1","text":"LoRA-LierLa\u53ef\u4ee5\u88abAUTOMATIC1111\u7684Web UI\u7684LoRA\u529f\u80fd\u4f7f\u7528\u3002 \u8981\u4f7f\u7528LoRA-C3Lier\u5728Web UI\u4e2d\u751f\u6210\u56fe\u50cf\uff0c\u8bf7\u4f7f\u7528\u8fd9\u4e2a WebUI\u6269\u5c55 \u3002 \u4e24\u8005\u90fd\u53ef\u4ee5\u4f7f\u7528\u672c\u4ed3\u5e93\u4e2d\u7684\u811a\u672c\u5c06\u8bad\u7ec3\u597d\u7684LoRA\u6a21\u578b\u4e0eStable Diffusion\u6a21\u578b\u5408\u5e76\u3002 \u76ee\u524d\u4e0ecloneofsimo\u7684\u4ed3\u5e93\u548cd8ahazard\u7684 Dreambooth Extension for Stable-Diffusion-WebUI \u4e0d\u517c\u5bb9\uff0c\u56e0\u4e3a\u8fdb\u884c\u4e86\u4e00\u4e9b\u529f\u80fd\u6269\u5c55\uff08\u540e\u8ff0\uff09\u3002","title":"\u5173\u4e8e\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u7684\u6ce8\u610f\u4e8b\u9879"},{"location":"sd-scripts-docs/train_network/#_2","text":"\u8bf7\u5148\u53c2\u8003\u672c\u4ed3\u5e93\u7684README\uff0c\u8fdb\u884c\u73af\u5883\u51c6\u5907\u3002","title":"\u8bad\u7ec3\u6b65\u9aa4"},{"location":"sd-scripts-docs/train_network/#_3","text":"\u8bf7\u53c2\u8003 \u5173\u4e8e\u8bad\u7ec3\u6570\u636e\u51c6\u5907 \u3002","title":"\u6570\u636e\u51c6\u5907"},{"location":"sd-scripts-docs/train_network/#_4","text":"\u4f7f\u7528 train_network.py \u3002 \u5728 train_network.py \u4e2d\uff0c\u901a\u8fc7 --network_module \u9009\u9879\u6307\u5b9a\u8981\u8bad\u7ec3\u7684\u6a21\u5757\u540d\u79f0\u3002\u5bf9\u4e8eLoRA\uff0c\u6307\u5b9a network.lora \u3002 \u5b66\u4e60\u7387\u4f3c\u4e4e\u6bd4\u901a\u5e38\u7684DreamBooth\u6216fine tuning\u8981\u9ad8\uff0c\u5efa\u8bae\u4f7f\u7528 1e-4 ~ 1e-3 \u5de6\u53f3\u7684\u503c\u3002 \u4ee5\u4e0b\u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u793a\u4f8b\u3002 accelerate launch --num_cpu_threads_per_process 1 train_network.py --pretrained_model_name_or_path=<.ckpt\u6216.safetensors\u6216Diffusers\u7248\u6a21\u578b\u7684\u76ee\u5f55> --dataset_config=<\u6570\u636e\u51c6\u5907\u65f6\u521b\u5efa\u7684.toml\u6587\u4ef6> --output_dir=<\u8bad\u7ec3\u597d\u7684\u6a21\u578b\u7684\u8f93\u51fa\u6587\u4ef6\u5939> --output_name=<\u8bad\u7ec3\u597d\u7684\u6a21\u578b\u8f93\u51fa\u65f6\u7684\u6587\u4ef6\u540d> --save_model_as=safetensors --prior_loss_weight=1.0 --max_train_steps=400 --learning_rate=1e-4 --optimizer_type=\"AdamW8bit\" --xformers --mixed_precision=\"fp16\" --cache_latents --gradient_checkpointing --save_every_n_epochs=1 --network_module=networks.lora \u8fd9\u4e2a\u547d\u4ee4\u884c\u5c06\u8bad\u7ec3LoRA-LierLa\u3002 LoRA\u6a21\u578b\u5c06\u88ab\u4fdd\u5b58\u5230 --output_dir \u9009\u9879\u6307\u5b9a\u7684\u6587\u4ef6\u5939\u4e2d\u3002\u5176\u4ed6\u9009\u9879\u548c\u4f18\u5316\u5668\u7b49\u8bf7\u53c2\u8003 \u8bad\u7ec3\u7684\u5171\u540c\u6587\u6863 \u7684\u201c\u5e38\u7528\u9009\u9879\u201d\u3002 \u6b64\u5916\uff0c\u8fd8\u53ef\u4ee5\u6307\u5b9a\u4ee5\u4e0b\u9009\u9879\u3002 --network_dim \u6307\u5b9aLoRA\u7684RANK\uff08\u4f8b\u5982 --network_dim=4 \uff09\u3002\u7701\u7565\u65f6\u9ed8\u8ba4\u4e3a4\u3002\u6570\u503c\u8d8a\u5927\u8868\u793a\u80fd\u529b\u8d8a\u5f3a\uff0c\u4f46\u8bad\u7ec3\u6240\u9700\u7684\u5185\u5b58\u548c\u65f6\u95f4\u4e5f\u4f1a\u589e\u52a0\u3002\u76f2\u76ee\u589e\u52a0\u6570\u503c\u4e5f\u4e0d\u4e00\u5b9a\u597d\u3002 --network_alpha \u6307\u5b9a\u7528\u4e8e\u9632\u6b62\u4e0b\u6ea2\u5e76\u7a33\u5b9a\u8bad\u7ec3\u7684 alpha \u503c\u3002\u9ed8\u8ba4\u4e3a1\u3002` \u5f53\u4e0e network_dim \u7684\u503c\u76f8\u540c\u6307\u5b9a\u65f6\uff0c\u884c\u4e3a\u4e0e\u4ee5\u524d\u7684\u7248\u672c\u76f8\u540c\u3002 --persistent_data_loader_workers \u5728Windows\u73af\u5883\u4e2d\u6307\u5b9a\u65f6\uff0cepoch\u4e4b\u95f4\u7684\u7b49\u5f85\u65f6\u95f4\u5c06\u5927\u5927\u7f29\u77ed\u3002 --max_data_loader_n_workers \u6307\u5b9a\u6570\u636e\u52a0\u8f7d\u7684\u8fdb\u7a0b\u6570\u3002\u8fdb\u7a0b\u6570\u8d8a\u591a\uff0c\u6570\u636e\u52a0\u8f7d\u8d8a\u5feb\uff0cGPU\u5229\u7528\u7387\u8d8a\u9ad8\uff0c\u4f46\u4f1a\u6d88\u8017\u4e3b\u5185\u5b58\u3002\u9ed8\u8ba4\u503c\u4e3a\u201c 8 \u6216 CPU\u5e76\u53d1\u7ebf\u7a0b\u6570-1 \u4e2d\u8f83\u5c0f\u7684\u4e00\u4e2a\u201d\uff0c\u56e0\u6b64\u5982\u679c\u4e3b\u5185\u5b58\u4e0d\u5145\u88d5\u6216GPU\u5229\u7528\u7387\u8fbe\u523090%\u5de6\u53f3\uff0c\u8bf7\u6839\u636e\u8fd9\u4e9b\u6570\u503c\uff0c\u5c06\u5176\u964d\u4f4e\u5230 2 \u6216 1 \u5de6\u53f3\u3002 --network_weights \u5728\u8bad\u7ec3\u524d\u52a0\u8f7d\u9884\u8bad\u7ec3\u7684LoRA\u6743\u91cd\uff0c\u5e76\u5728\u6b64\u57fa\u7840\u4e0a\u7ee7\u7eed\u8bad\u7ec3\u3002 --network_train_unet_only \u53ea\u542f\u7528\u4e0eU-Net\u76f8\u5173\u7684LoRA\u6a21\u5757\u3002\u5728fine tuning\u5f0f\u7684\u8bad\u7ec3\u4e2d\u6307\u5b9a\u53ef\u80fd\u6bd4\u8f83\u597d\u3002 --network_train_text_encoder_only \u53ea\u542f\u7528\u4e0eText Encoder\u76f8\u5173\u7684LoRA\u6a21\u5757\u3002\u53ef\u80fd\u4f1a\u671f\u5f85Textual Inversion\u5f0f\u7684\u6548\u679c\u3002 --unet_lr \u5728\u4e0eU-Net\u76f8\u5173\u7684LoRA\u6a21\u5757\u4e2d\u4f7f\u7528\u4e0e\u901a\u5e38\u7684\u5b66\u4e60\u7387\uff08\u901a\u8fc7 --learning_rate \u9009\u9879\u6307\u5b9a\uff09\u4e0d\u540c\u7684\u5b66\u4e60\u7387\u65f6\u6307\u5b9a\u3002 --text_encoder_lr \u5728\u4e0eText Encoder\u76f8\u5173\u7684LoRA\u6a21\u5757\u4e2d\u4f7f\u7528\u4e0e\u901a\u5e38\u7684\u5b66\u4e60\u7387\uff08\u901a\u8fc7 --learning_rate \u9009\u9879\u6307\u5b9a\uff09\u4e0d\u540c\u7684\u5b66\u4e60\u7387\u65f6\u6307\u5b9a\u3002Text Encoder\u7684\u5b66\u4e60\u7387\u7a0d\u5fae\u4f4e\u4e00\u4e9b\uff085e-5\u7b49\uff09\u53ef\u80fd\u6bd4\u8f83\u597d\u3002 --network_args \u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\u53c2\u6570\uff0c\u540e\u8ff0\u3002 --alpha_mask \u5c06\u56fe\u50cf\u7684alpha\u503c\u7528\u4f5c\u63a9\u7801\u3002\u5728\u8bad\u7ec3\u900f\u660e\u56fe\u50cf\u65f6\u4f7f\u7528\u3002 PR #1223 \u5f53 --network_train_unet_only \u548c --network_train_text_encoder_only \u90fd\u6ca1\u6709\u6307\u5b9a\uff08\u9ed8\u8ba4\uff09\u65f6\uff0cText Encoder\u548cU-Net\u7684LoRA\u6a21\u5757\u90fd\u4f1a\u88ab\u542f\u7528\u3002","title":"\u6267\u884c\u8bad\u7ec3"},{"location":"sd-scripts-docs/train_network/#_5","text":"","title":"\u5176\u4ed6\u8bad\u7ec3\u65b9\u6cd5"},{"location":"sd-scripts-docs/train_network/#lora-c3lier","text":"\u8bf7\u6309\u5982\u4e0b\u65b9\u5f0f\u6307\u5b9a --network_args \u3002\u7528 conv_dim \u6307\u5b9aConv2d (3x3)\u7684rank\uff0c\u7528 conv_alpha \u6307\u5b9aalpha\u3002 --network_args \"conv_dim=4\" \"conv_alpha=1\" \u5728\u4ee5\u4e0b\u793a\u4f8b\u4e2d\uff0c\u7701\u7565 alpha \u65f6\u9ed8\u8ba4\u4e3a1\u3002 --network_args \"conv_dim=4\"","title":"\u8bad\u7ec3LoRA-C3Lier"},{"location":"sd-scripts-docs/train_network/#dylora","text":"DyLoRA\u662f \u8fd9\u7bc7\u8bba\u6587 \u4e2d\u63d0\u51fa\u7684\u3002\u5b98\u65b9\u5b9e\u73b0\u5728 \u8fd9\u91cc \u3002 \u6839\u636e\u8bba\u6587\uff0cLoRA\u7684rank\u4e0d\u4e00\u5b9a\u662f\u8d8a\u9ad8\u8d8a\u597d\uff0c\u9700\u8981\u6839\u636e\u76ee\u6807\u6a21\u578b\u3001\u6570\u636e\u96c6\u3001\u4efb\u52a1\u7b49\u5bfb\u627e\u5408\u9002\u7684rank\u3002\u4f7f\u7528DyLoRA\uff0c\u53ef\u4ee5\u540c\u65f6\u8bad\u7ec3\u591a\u4e2arank\u7684LoRA\uff0c\u4ece\u800c\u7701\u53bb\u5206\u522b\u8bad\u7ec3\u548c\u5bfb\u627e\u6700\u4f73rank\u7684\u9ebb\u70e6\u3002 \u672c\u4ed3\u5e93\u7684\u5b9e\u73b0\u57fa\u4e8e\u5b98\u65b9\u5b9e\u73b0\uff0c\u5e76\u8fdb\u884c\u4e86\u4e00\u4e9b\u6269\u5c55\uff08\u56e0\u6b64\u53ef\u80fd\u5b58\u5728bug\u7b49\uff09\u3002","title":"DyLoRA"},{"location":"sd-scripts-docs/train_network/#dylora_1","text":"\u8bad\u7ec3\u540e\u7684DyLoRA\u6a21\u578b\u6587\u4ef6\u4e0eLoRA\u517c\u5bb9\u3002\u6b64\u5916\uff0c\u53ef\u4ee5\u4ece\u6a21\u578b\u6587\u4ef6\u4e2d\u63d0\u53d6\u51fa\u591a\u4e2adim\u7684LoRA\u3002 \u53ef\u4ee5\u8bad\u7ec3DyLoRA-LierLa\u548cDyLoRA-C3Lier\u3002","title":"\u672c\u4ed3\u5e93\u4e2dDyLoRA\u7684\u7279\u70b9"},{"location":"sd-scripts-docs/train_network/#dylora_2","text":"\u6307\u5b9a --network_module=networks.dylora \uff0c\u50cf\u8fd9\u6837\u4f7f\u7528DyLoRA\u5bf9\u5e94\u7684 network.dylora \u3002 \u6b64\u5916\uff0c\u901a\u8fc7 --network_args \u6307\u5b9a unit \uff0c\u4f8b\u5982 --network_args \"unit=4\" \u3002 unit \u662f\u5206\u5272rank\u7684\u5355\u4f4d\u3002\u4f8b\u5982\uff0c\u6307\u5b9a --network_dim=16 --network_args \"unit=4\" \u3002 unit \u5e94\u8be5\u662f network_dim \u7684\u56e0\u6570\uff08 network_dim \u662f unit \u7684\u500d\u6570\uff09\u3002 \u5982\u679c\u4e0d\u6307\u5b9a unit \uff0c\u5219\u88ab\u89c6\u4e3a unit=1 \u3002 \u793a\u4f8b\u5982\u4e0b\u3002 --network_module=networks.dylora --network_dim=16 --network_args \"unit=4\" --network_module=networks.dylora --network_dim=32 --network_alpha=16 --network_args \"unit=4\" \u5bf9\u4e8eDyLoRA-C3Lier\uff0c\u901a\u8fc7 --network_args \u6307\u5b9a conv_dim \uff0c\u4f8b\u5982 \"conv_dim=4\" \u3002\u4e0e\u901a\u5e38\u7684LoRA\u4e0d\u540c\uff0c conv_dim \u9700\u8981\u4e0e network_dim \u76f8\u540c\u3002\u793a\u4f8b\u5982\u4e0b\u3002 --network_module=networks.dylora --network_dim=16 --network_args \"conv_dim=16\" \"unit=4\" --network_module=networks.dylora --network_dim=32 --network_alpha=16 --network_args \"conv_dim=32\" \"conv_alpha=16\" \"unit=8\" \u4f8b\u5982\uff0c\u5f53dim=16\uff0cunit=4\u65f6\uff0c\u53ef\u4ee5\u8bad\u7ec3\u548c\u63d0\u53d64\u30018\u300112\u300116\u56db\u4e2arank\u7684LoRA\u3002\u901a\u8fc7\u6bd4\u8f83\u4e0d\u540crank\u7684LoRA\u751f\u6210\u7684\u56fe\u50cf\uff0c\u53ef\u4ee5\u9009\u62e9\u6700\u4f73\u7684rank\u3002 \u5176\u4ed6\u9009\u9879\u4e0e\u901a\u5e38\u7684LoRA\u76f8\u540c\u3002 \u203b unit \u662f\u672c\u4ed3\u5e93\u7684\u72ec\u6709\u6269\u5c55\u3002\u5728DyLoRA\u4e2d\uff0c\u4e0e\u76f8\u540cdim\u7684\u901a\u5e38LoRA\u76f8\u6bd4\uff0c\u8bad\u7ec3\u65f6\u95f4\u53ef\u80fd\u4f1a\u66f4\u957f\uff0c\u56e0\u6b64\u91c7\u7528\u4e86\u66f4\u5927\u7684\u5206\u5272\u5355\u4f4d\u3002","title":"\u4f7f\u7528DyLoRA\u8bad\u7ec3"},{"location":"sd-scripts-docs/train_network/#dyloralora","text":"\u4f7f\u7528 networks \u6587\u4ef6\u5939\u4e2d\u7684 extract_lora_from_dylora.py \u3002\u6309\u7167\u6307\u5b9a\u7684 unit \u5355\u4f4d\uff0c\u4eceDyLoRA\u6a21\u578b\u4e2d\u63d0\u53d6LoRA\u6a21\u578b\u3002 \u547d\u4ee4\u884c\u793a\u4f8b\uff1a python networks\\extract_lora_from_dylora.py --model \"foldername/dylora-model.safetensors\" --save_to \"foldername/dylora-model-split.safetensors\" --unit 4 --model \u6307\u5b9aDyLoRA\u6a21\u578b\u6587\u4ef6\uff0c --save_to \u6307\u5b9a\u63d0\u53d6\u7684LoRA\u6a21\u578b\u7684\u4fdd\u5b58\u6587\u4ef6\u540d\uff08\u5c06\u5728\u6587\u4ef6\u540d\u540e\u9644\u52a0rank\u6570\u503c\uff09\uff0c --unit \u6307\u5b9aDyLoRA\u8bad\u7ec3\u65f6\u7684 unit \u3002","title":"\u4eceDyLoRA\u6a21\u578b\u4e2d\u63d0\u53d6LoRA\u6a21\u578b"},{"location":"sd-scripts-docs/train_network/#_6","text":"\u8be6\u60c5\u8bf7\u53c2\u9605 PR #355 \u3002 \u53ef\u4ee5\u4e3a\u5168\u90e825\u4e2afull\u6a21\u578b\u7684block\u6307\u5b9a\u6743\u91cd\u3002\u7b2c\u4e00\u4e2ablock\u5bf9\u5e94\u7684LoRA\u4e0d\u5b58\u5728\uff0c\u4f46\u4e3a\u4e86\u4e0e\u5c42\u6b21\u522bLoRA\u5e94\u7528\u7b49\u4fdd\u6301\u517c\u5bb9\u6027\uff0c\u6307\u5b9a\u4e3a25\u4e2a\u3002\u6b64\u5916\uff0c\u5373\u4f7f\u4e0d\u6269\u5c55\u5230conv2d3x3\uff0c\u4e00\u90e8\u5206block\u7684LoRA\u4e5f\u4e0d\u5b58\u5728\uff0c\u4f46\u4e3a\u4e86\u7edf\u4e00\u63cf\u8ff0\uff0c\u59cb\u7ec8\u6307\u5b9a25\u4e2a\u503c\u3002 \u5728SDXL\u4e2d\uff0c\u8bf7\u6307\u5b9adown/up 9\u4e2a\uff0cmiddle 3\u4e2a\u6570\u503c\u3002 \u901a\u8fc7 --network_args \u6307\u5b9a\u4ee5\u4e0b\u53c2\u6570\u3002 down_lr_weight \uff1a\u6307\u5b9aU-Net\u7684down blocks\u7684\u5b66\u4e60\u7387\u6743\u91cd\u3002\u53ef\u4ee5\u6307\u5b9a\uff1a \u6bcf\u4e2ablock\u7684\u6743\u91cd\uff1a\u4f8b\u5982 \"down_lr_weight=0,0,0,0,0,0,1,1,1,1,1,1\" \uff0c\u6307\u5b9a12\u4e2a\u6570\u503c\uff08SDXL\u4e2d\u4e3a9\u4e2a\uff09\u3002 \u4ece\u9884\u8bbe\u6307\u5b9a\uff1a\u4f8b\u5982 \"down_lr_weight=sine\" \uff0c\u4f7f\u7528sine\u66f2\u7ebf\u6307\u5b9a\u6743\u91cd\u3002\u53ef\u4ee5\u6307\u5b9asine\u3001cosine\u3001linear\u3001reverse_linear\u3001zeros\u3002\u6b64\u5916\uff0c\u901a\u8fc7\u6dfb\u52a0 +\u6570\u503c \uff08\u4f8b\u5982 \"down_lr_weight=cosine+.25\" \uff09\uff0c\u53ef\u4ee5\u52a0\u4e0a\u6307\u5b9a\u7684\u6570\u503c\uff08\u8303\u56f4\u5c06\u662f0.25~1.25\uff09\u3002 mid_lr_weight \uff1a\u6307\u5b9aU-Net\u7684mid block\u7684\u5b66\u4e60\u7387\u6743\u91cd\u3002\u4f8b\u5982 \"mid_lr_weight=0.5\" \uff0c\u6307\u5b9a\u4e00\u4e2a\u6570\u503c\uff08SDXL\u4e2d\u4e3a3\u4e2a\uff09\u3002 up_lr_weight \uff1a\u6307\u5b9aU-Net\u7684up blocks\u7684\u5b66\u4e60\u7387\u6743\u91cd\u3002\u4e0edown_lr_weight\u76f8\u540c\u3002 \u7701\u7565\u7684\u90e8\u5206\u5c06\u88ab\u89c6\u4e3a1.0\u3002\u5982\u679c\u6743\u91cd\u4e3a0\uff0c\u5219\u4e0d\u4f1a\u521b\u5efa\u8be5block\u7684LoRA\u6a21\u5757\u3002 block_lr_zero_threshold \uff1a\u5982\u679c\u6743\u91cd\u5c0f\u4e8e\u6216\u7b49\u4e8e\u6b64\u503c\uff0c\u5219\u4e0d\u4f1a\u521b\u5efaLoRA\u6a21\u5757\u3002\u9ed8\u8ba4\u4e3a0\u3002","title":"\u5c42\u6b21\u522b\u5b66\u4e60\u7387"},{"location":"sd-scripts-docs/train_network/#_7","text":"--network_args \"down_lr_weight=0.5,0.5,0.5,0.5,1.0,1.0,1.0,1.0,1.5,1.5,1.5,1.5\" \"mid_lr_weight=2.0\" \"up_lr_weight=1.5,1.5,1.5,1.5,1.0,1.0,1.0,1.0,0.5,0.5,0.5,0.5\" --network_args \"block_lr_zero_threshold=0.1\" \"down_lr_weight=sine+.5\" \"mid_lr_weight=1.5\" \"up_lr_weight=cosine+.5\"","title":"\u5c42\u6b21\u522b\u5b66\u4e60\u7387\u547d\u4ee4\u884c\u793a\u4f8b\uff1a"},{"location":"sd-scripts-docs/train_network/#toml","text":"network_args = [ \"down_lr_weight=0.5,0.5,0.5,0.5,1.0,1.0,1.0,1.0,1.5,1.5,1.5,1.5\", \"mid_lr_weight=2.0\", \"up_lr_weight=1.5,1.5,1.5,1.5,1.0,1.0,1.0,1.0,0.5,0.5,0.5,0.5\",] network_args = [ \"block_lr_zero_threshold=0.1\", \"down_lr_weight=sine+.5\", \"mid_lr_weight=1.5\", \"up_lr_weight=cosine+.5\", ]","title":"\u5c42\u6b21\u522b\u5b66\u4e60\u7387toml\u6587\u4ef6\u793a\u4f8b\uff1a"},{"location":"sd-scripts-docs/train_network/#dim-rank","text":"\u53ef\u4ee5\u4e3a\u5168\u90e825\u4e2afull\u6a21\u578b\u7684block\u6307\u5b9adim (rank)\u3002\u4e0e\u5c42\u6b21\u522b\u5b66\u4e60\u7387\u7c7b\u4f3c\uff0c\u4e00\u90e8\u5206block\u7684LoRA\u53ef\u80fd\u4e0d\u5b58\u5728\uff0c\u4f46\u59cb\u7ec8\u6307\u5b9a25\u4e2a\u503c\u3002 \u5728SDXL\u4e2d\uff0c\u8bf7\u6307\u5b9a23\u4e2a\u6570\u503c\u3002\u7531\u4e8e\u4e0e sdxl_train.py \u7684 \u5c42\u6b21\u522b\u5b66\u4e60\u7387 \u517c\u5bb9\uff0c\u56e0\u6b64\u4e00\u90e8\u5206block\u7684LoRA\u4e0d\u5b58\u5728\u3002\u5bf9\u5e94\u5173\u7cfb\u4e3a 0: time/label embed, 1-9: input blocks 0-8, 10-12: mid blocks 0-2, 13-21: output blocks 0-8, 22: out \u3002 \u901a\u8fc7 --network_args \u6307\u5b9a\u4ee5\u4e0b\u53c2\u6570\u3002 block_dims \uff1a\u6307\u5b9a\u6bcf\u4e2ablock\u7684dim (rank)\u3002\u4f8b\u5982 \"block_dims=2,2,2,2,4,4,4,4,6,6,6,6,8,6,6,6,6,4,4,4,4,2,2,2,2\" \uff0c\u6307\u5b9a25\u4e2a\u6570\u503c\u3002 block_alphas \uff1a\u6307\u5b9a\u6bcf\u4e2ablock\u7684alpha\u3002\u4e0eblock_dims\u7c7b\u4f3c\uff0c\u6307\u5b9a25\u4e2a\u6570\u503c\u3002\u7701\u7565\u65f6\u4f7f\u7528 network_alpha \u7684\u503c\u3002 conv_block_dims \uff1a\u5c06LoRA\u6269\u5c55\u5230Conv2d 3x3\u65f6\uff0c\u6307\u5b9a\u6bcf\u4e2ablock\u7684dim (rank)\u3002 conv_block_alphas \uff1a\u5c06LoRA\u6269\u5c55\u5230Conv2d 3x3\u65f6\uff0c\u6307\u5b9a\u6bcf\u4e2ablock\u7684alpha\u3002\u7701\u7565\u65f6\u4f7f\u7528 conv_alpha \u7684\u503c\u3002","title":"\u5c42\u6b21\u522bdim (rank)"},{"location":"sd-scripts-docs/train_network/#dim-rank_1","text":"--network_args \"block_dims=2,4,4,4,8,8,8,8,12,12,12,12,16,12,12,12,12,8,8,8,8,4,4,4,2\" --network_args \"block_dims=2,4,4,4,8,8,8,8,12,12,12,12,16,12,12,12,12,8,8,8,8,4,4,4,2\" \"conv_block_dims=2,2,2,2,4,4,4,4,6,6,6,6,8,6,6,6,6,4,4,4,4,2,2,2,2\" --network_args \"block_dims=2,4,4,4,8,8,8,8,12,12,12,12,16,12,12,12,12,8,8,8,8,4,4,4,2\" \"block_alphas=2,2,2,2,4,4,4,4,6,6,6,6,8,6,6,6,6,4,4,4,4,2,2,2,2\"","title":"\u5c42\u6b21\u522bdim (rank)\u547d\u4ee4\u884c\u793a\u4f8b\uff1a"},{"location":"sd-scripts-docs/train_network/#dim-ranktoml","text":"network_args = [ \"block_dims=2,4,4,4,8,8,8,8,12,12,12,12,16,12,12,12,12,8,8,8,8,4,4,4,2\",] network_args = [ \"block_dims=2,4,4,4,8,8,8,8,12,12,12,12,16,12,12,12,12,8,8,8,8,4,4,4,2\", \"block_alphas=2,2,2,2,4,4,4,4,6,6,6,6,8,6,6,6,6,4,4,4,4,2,2,2,2\",]","title":"\u5c42\u6b21\u522bdim (rank)toml\u6587\u4ef6\u793a\u4f8b\uff1a"},{"location":"sd-scripts-docs/train_network/#_8","text":"\u4e0eLoRA\u76f8\u5173\u7684\u811a\u672c\u7fa4\uff0c\u5982\u5408\u5e76\u7b49\u3002","title":"\u5176\u4ed6\u811a\u672c"},{"location":"sd-scripts-docs/train_network/#_9","text":"\u4f7f\u7528merge_lora.py\u53ef\u4ee5\u5c06LoRA\u7684\u8bad\u7ec3\u7ed3\u679c\u4e0eStable Diffusion\u6a21\u578b\u5408\u5e76\uff0c\u6216\u5c06\u591a\u4e2aLoRA\u6a21\u578b\u5408\u5e76\u3002 \u5bf9\u4e8eSDXL\uff0c\u6709sdxl_merge_lora.py\u53ef\u7528\u3002\u9009\u9879\u7b49\u76f8\u540c\uff0c\u56e0\u6b64\u8bf7\u5c06\u4ee5\u4e0bmerge_lora.py\u66ff\u6362\u4e3asdxl_merge_lora.py\u3002","title":"\u5173\u4e8e\u5408\u5e76\u811a\u672c"},{"location":"sd-scripts-docs/train_network/#lorastable-diffusion","text":"\u5408\u5e76\u540e\u7684\u6a21\u578b\u53ef\u4ee5\u50cf\u666e\u901a\u7684Stable Diffusion\u7684ckpt\u4e00\u6837\u5904\u7406\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u662f\u547d\u4ee4\u884c\u793a\u4f8b\u3002 python networks\\merge_lora.py --sd_model ..\\model\\model.ckpt --save_to ..\\lora_train1\\model-char1-merged.safetensors --models ..\\lora_train1\\last.safetensors --ratios 0.8 \u4f7f\u7528Stable Diffusion v2.x\u6a21\u578b\u8fdb\u884c\u8bad\u7ec3\u5e76\u5408\u5e76\u65f6\uff0c\u8bf7\u6307\u5b9a--v2\u9009\u9879\u3002 \u901a\u8fc7--sd_model\u9009\u9879\u6307\u5b9a\u8981\u5408\u5e76\u7684Stable Diffusion\u6a21\u578b\u6587\u4ef6\uff08\u76ee\u524d\u4ec5\u652f\u6301.ckpt\u6216.safetensors\uff0c\u4e0d\u652f\u6301Diffusers\uff09\u3002 \u901a\u8fc7--save_to\u9009\u9879\u6307\u5b9a\u5408\u5e76\u540e\u7684\u6a21\u578b\u7684\u4fdd\u5b58\u8def\u5f84\uff08\u6839\u636e\u6269\u5c55\u540d\u81ea\u52a8\u5224\u65ad\u662f.ckpt\u8fd8\u662f.safetensors\uff09\u3002 \u901a\u8fc7--models\u6307\u5b9a\u8bad\u7ec3\u597d\u7684LoRA\u6a21\u578b\u6587\u4ef6\u3002\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\uff0c\u6309\u987a\u5e8f\u5408\u5e76\u3002 \u901a\u8fc7--ratios\u6307\u5b9a\u6bcf\u4e2a\u6a21\u578b\u7684\u9002\u7528\u7387\uff08\u5373\u6a21\u578b\u6743\u91cd\u5bf9\u539f\u6a21\u578b\u7684\u53cd\u6620\u7a0b\u5ea6\uff09\uff0c\u53d6\u503c\u4e3a0~1.0\u3002\u4f8b\u5982\uff0c\u5982\u679c\u8fc7\u62df\u5408\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u964d\u4f4e\u9002\u7528\u7387\u6765\u6539\u5584\u3002\u6a21\u578b\u7684\u6570\u91cf\u5e94\u4e0e\u6307\u5b9a\u7684\u6a21\u578b\u6570\u91cf\u76f8\u540c\u3002 \u591a\u4e2a\u6a21\u578b\u65f6\u7684\u793a\u4f8b\uff1a python networks\\merge_lora.py --sd_model ..\\model\\model.ckpt --save_to ..\\lora_train1\\model-char1-merged.safetensors --models ..\\lora_train1\\last.safetensors ..\\lora_train2\\last.safetensors --ratios 0.8 0.5","title":"\u5c06LoRA\u6a21\u578b\u4e0eStable Diffusion\u6a21\u578b\u5408\u5e76"},{"location":"sd-scripts-docs/train_network/#lora_2","text":"\u6307\u5b9a--concat\u9009\u9879\uff0c\u53ef\u4ee5\u7b80\u5355\u5730\u5c06\u591a\u4e2aLoRA\u5408\u5e76\u6210\u4e00\u4e2a\u65b0\u7684LoRA\u6a21\u578b\u3002\u6587\u4ef6\u5927\u5c0f\uff08\u4ee5\u53cadim/rank\uff09\u5c06\u662f\u6307\u5b9aLoRA\u7684\u603b\u5927\u5c0f\uff08\u5982\u679c\u8981\u5728\u5408\u5e76\u65f6\u6539\u53d8dim (rank)\uff0c\u8bf7\u4f7f\u7528 svd_merge_lora.py \uff09\u3002 \u4f8b\u5982\uff0c\u4ee5\u4e0b\u662f\u547d\u4ee4\u884c\u793a\u4f8b\u3002 python networks\\merge_lora.py --save_precision bf16 --save_to ..\\lora_train1\\model-char1-style1-merged.safetensors --models ..\\lora_train1\\last.safetensors ..\\lora_train2\\last.safetensors --ratios 1.0 -1.0 --concat --shuffle \u6307\u5b9a--concat\u9009\u9879\u3002 \u6b64\u5916\uff0c\u6dfb\u52a0--shuffle\u9009\u9879\uff0c\u6743\u91cd\u5c06\u88ab\u6253\u4e71\u3002\u5982\u679c\u4e0d\u6253\u4e71\uff0c\u5408\u5e76\u540e\u7684LoRA\u53ef\u4ee5\u88ab\u5206\u89e3\u56de\u539f\u6765\u7684LoRA\uff0c\u56e0\u6b64\u5728\u62f7\u8d1d\u5b66\u4e60\u7b49\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u539f\u59cb\u8bad\u7ec3\u6570\u636e\u88ab\u66b4\u9732\u3002\u8bf7\u6ce8\u610f\u3002 \u901a\u8fc7--save_to\u9009\u9879\u6307\u5b9a\u5408\u5e76\u540e\u7684LoRA\u6a21\u578b\u7684\u4fdd\u5b58\u8def\u5f84\uff08\u6839\u636e\u6269\u5c55\u540d\u81ea\u52a8\u5224\u65ad\u662f.ckpt\u8fd8\u662f.safetensors\uff09\u3002 \u901a\u8fc7--models\u6307\u5b9a\u8bad\u7ec3\u597d\u7684LoRA\u6a21\u578b\u6587\u4ef6\u3002\u53ef\u4ee5\u6307\u5b9a\u4e09\u4e2a\u4ee5\u4e0a\u3002 \u901a\u8fc7--ratios\u6307\u5b9a\u6bcf\u4e2a\u6a21\u578b\u7684\u6bd4\u7387\uff08\u5373\u6a21\u578b\u6743\u91cd\u5bf9\u539f\u6a21\u578b\u7684\u53cd\u6620\u7a0b\u5ea6\uff09\uff0c\u53d6\u503c\u4e3a0~1.0\u3002\u5c06\u4e24\u4e2a\u6a21\u578b\u4e00\u5bf9\u4e00\u5408\u5e76\u65f6\uff0c\u6bd4\u7387\u5e94\u4e3a\u201c0.5 0.5\u201d\u3002\u5982\u679c\u4f7f\u7528\u201c1.0 1.0\u201d\uff0c\u5219\u603b\u6743\u91cd\u5c06\u8fc7\u5927\uff0c\u7ed3\u679c\u53ef\u80fd\u4e0d\u7406\u60f3\u3002 \u4f7f\u7528v1\u8bad\u7ec3\u7684LoRA\u548cv2\u8bad\u7ec3\u7684LoRA\u3001\u6216\u8005rank\uff08\u7ef4\u5ea6\u6570\uff09\u4e0d\u540c\u7684LoRA\u4e0d\u80fd\u5408\u5e76\u3002U-Net alone\u7684LoRA\u548cU-Net+Text Encoder\u7684LoRA\u7406\u8bba\u4e0a\u53ef\u4ee5\u5408\u5e76\uff0c\u4f46\u7ed3\u679c\u672a\u77e5\u3002","title":"\u5408\u5e76\u591a\u4e2aLoRA\u6a21\u578b"},{"location":"sd-scripts-docs/train_network/#_10","text":"precision \u53ef\u4ee5\u6307\u5b9a\u5408\u5e76\u8ba1\u7b97\u65f6\u7684\u7cbe\u5ea6\uff0c\u6709float\u3001fp16\u3001bf16\u53ef\u9009\u3002\u7701\u7565\u65f6\u4e3a\u4e86\u786e\u4fdd\u7cbe\u5ea6\u9ed8\u8ba4\u4e3afloat\u3002\u5982\u679c\u8981\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\u91cf\uff0c\u53ef\u4ee5\u6307\u5b9afp16/bf16\u3002 save_precision \u53ef\u4ee5\u6307\u5b9a\u6a21\u578b\u4fdd\u5b58\u65f6\u7684\u7cbe\u5ea6\uff0c\u6709float\u3001fp16\u3001bf16\u53ef\u9009\u3002\u7701\u7565\u65f6\u4e0eprecision\u76f8\u540c\u3002 \u8fd8\u6709\u5176\u4ed6\u4e00\u4e9b\u9009\u9879\uff0c\u8bf7\u4f7f\u7528--help\u67e5\u770b\u3002","title":"\u5176\u4ed6\u9009\u9879"},{"location":"sd-scripts-docs/train_network/#ranklora","text":"\u4f7f\u7528 svd_merge_lora.py \u5c06\u591a\u4e2aLoRA\u8fd1\u4f3c\u4e3a\u4e00\u4e2aLoRA\uff08\u65e0\u6cd5\u5b8c\u5168\u518d\u73b0\uff09\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u662f\u547d\u4ee4\u884c\u793a\u4f8b\u3002 python networks\\svd_merge_lora.py --save_to ..\\lora_train1\\model-char1-style1-merged.safetensors --models ..\\lora_train1\\last.safetensors ..\\lora_train2\\last.safetensors --ratios 0.6 0.4 --new_rank 32 --device cuda merge_lora.py \u7684\u4e3b\u8981\u9009\u9879\u76f8\u540c\u3002\u4ee5\u4e0b\u9009\u9879\u662f\u65b0\u589e\u7684\u3002 --new_rank \u6307\u5b9a\u521b\u5efa\u7684LoRA\u7684rank\u3002 --new_conv_rank \u6307\u5b9a\u521b\u5efa\u7684 Conv2d 3x3 LoRA \u7684 rank\u3002\u7701\u7565\u65f6\u4e0e new_rank \u76f8\u540c\u3002 --device \u6307\u5b9a --device cuda \u4ee5\u5728GPU\u4e0a\u8fdb\u884c\u8ba1\u7b97\u3002\u5904\u7406\u901f\u5ea6\u66f4\u5feb\u3002","title":"\u5408\u5e76\u591a\u4e2arank\u4e0d\u540c\u7684LoRA\u6a21\u578b"},{"location":"sd-scripts-docs/train_network/#_11","text":"\u5728gen_img_diffusers.py\u4e2d\u6dfb\u52a0 --network_module \u548c --network_weights \u9009\u9879\u3002\u542b\u4e49\u4e0e\u8bad\u7ec3\u65f6\u76f8\u540c\u3002 \u901a\u8fc7 --network_mul \u9009\u9879\u6307\u5b9a0~1.0\u7684\u6570\u503c\uff0c\u53ef\u4ee5\u6539\u53d8LoRA\u7684\u5e94\u7528\u7387\u3002","title":"\u4f7f\u7528\u672c\u4ed3\u5e93\u4e2d\u7684\u56fe\u50cf\u751f\u6210\u811a\u672c\u751f\u6210"},{"location":"sd-scripts-docs/train_network/#diffuserspipeline","text":"\u8bf7\u53c2\u8003\u4ee5\u4e0b\u793a\u4f8b\u3002\u53ea\u9700\u8981networks/lora.py\u6587\u4ef6\u3002Diffusers\u7684\u7248\u672c\u53ef\u80fd\u9700\u8981\u662f0.10.2\u3002 import torch from diffusers import StableDiffusionPipeline from networks.lora import LoRAModule, create_network_from_weights from safetensors.torch import load_file # \u5982\u679cckpt\u662f\u57fa\u4e8eCompVis\u7684\uff0c\u8bf7\u4e8b\u5148\u4f7f\u7528tools/convert_diffusers20_original_sd.py\u8f6c\u6362\u4e3aDiffusers\u3002\u6709\u5173\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605--help\u3002 model_id_or_dir = r\"model_id_on_hugging_face_or_dir\" device = \"cuda\" # \u521b\u5efa\u7ba1\u9053 print(f\"\u4ece{model_id_or_dir}\u521b\u5efa\u7ba1\u9053...\") pipe = StableDiffusionPipeline.from_pretrained(model_id_or_dir, revision=\"fp16\", torch_dtype=torch.float16) pipe = pipe.to(device) vae = pipe.vae text_encoder = pipe.text_encoder unet = pipe.unet # \u52a0\u8f7dLoRA\u7f51\u7edc print(f\"\u52a0\u8f7dLoRA\u7f51\u7edc...\") lora_path1 = r\"lora1.safetensors\" sd = load_file(lora_path1) # \u5982\u679c\u6587\u4ef6\u662f.ckpt\uff0c\u8bf7\u4f7f\u7528torch.load\u3002 network1, sd = create_network_from_weights(0.5, None, vae, text_encoder,unet, sd) network1.apply_to(text_encoder, unet) network1.load_state_dict(sd) network1.to(device, dtype=torch.float16) # # \u60a8\u4e5f\u53ef\u4ee5\u5408\u5e76\u6743\u91cd\uff0c\u800c\u4e0d\u662fapply_to+load_state_dict\u3002network.set_multiplier\u4e0d\u8d77\u4f5c\u7528 # network.merge_to(text_encoder, unet, sd) lora_path2 = r\"lora2.safetensors\" sd = load_file(lora_path2) network2, sd = create_network_from_weights(0.7, None, vae, text_encoder,unet, sd) network2.apply_to(text_encoder, unet) network2.load_state_dict(sd) network2.to(device, dtype=torch.float16) lora_path3 = r\"lora3.safetensors\" sd = load_file(lora_path3) network3, sd = create_network_from_weights(0.5, None, vae, text_encoder,unet, sd) network3.apply_to(text_encoder, unet) network3.load_state_dict(sd) network3.to(device, dtype=torch.float16) # \u63d0\u793a prompt = \"\u6770\u4f5c\uff0c\u6700\u4f73\u8d28\u91cf\uff0c1\u4e2a\u5973\u5b69\uff0c\u7a7f\u7740\u767d\u886c\u886b\uff0c\u770b\u7740\u89c2\u4f17\" negative_prompt = \"\u7cdf\u7cd5\u7684\u8d28\u91cf\uff0c\u6700\u5dee\u7684\u8d28\u91cf\uff0c\u7cdf\u7cd5\u7684\u89e3\u5256\u7ed3\u6784\uff0c\u7cdf\u7cd5\u7684\u624b\" # \u6267\u884c\u7ba1\u9053 print(\"\u751f\u6210\u56fe\u50cf...\") with torch.autocast(\"cuda\"): image = pipe(prompt, guidance_scale=7.5, negative_prompt=negative_prompt).images[0] # \u5982\u679c\u672a\u5408\u5e76\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528set_multiplier # network1.set_multiplier(0.8) # \u5e76\u518d\u6b21\u751f\u6210\u56fe\u50cf... # \u4fdd\u5b58\u56fe\u50cf image.save(r\"\u7531Diffusers\u751f\u6210\u7684\u56fe\u50cf.png\")","title":"\u5728Diffusers\u7684pipeline\u4e2d\u751f\u6210"},{"location":"sd-scripts-docs/train_network/#lora_3","text":"\u8fd9\u662f\u53c2\u8003 \u8fd9\u4e2a\u8ba8\u8bba \u5b9e\u73b0\u7684\u3002\u516c\u5f0f\u76f4\u63a5\u4f7f\u7528\uff08\u4f3c\u4e4e\u4f7f\u7528\u5947\u5f02\u503c\u5206\u89e3\u8fdb\u884c\u8fd1\u4f3c\uff09\u3002 \u5c06\u4e24\u4e2a\u6a21\u578b\uff08\u4f8b\u5982fine tuning\u524d\u7684\u6a21\u578b\u548cfine tuning\u540e\u7684\u6a21\u578b\uff09\u7684\u5dee\u5f02\u8fd1\u4f3c\u4e3aLoRA\u3002","title":"\u4ece\u4e24\u4e2a\u6a21\u578b\u5dee\u5f02\u521b\u5efaLoRA\u6a21\u578b"},{"location":"sd-scripts-docs/train_network/#_12","text":"\u8bf7\u6309\u5982\u4e0b\u65b9\u5f0f\u6307\u5b9a\u3002 python networks\\extract_lora_from_models.py --model_org base-model.ckpt --model_tuned fine-tuned-model.ckpt --save_to lora-weights.safetensors --dim 4 \u901a\u8fc7 --model_org \u9009\u9879\u6307\u5b9a\u539f\u59cb\u7684Stable Diffusion\u6a21\u578b\u3002\u5e94\u7528\u521b\u5efa\u7684LoRA\u6a21\u578b\u65f6\uff0c\u5c06\u4f7f\u7528\u6b64\u6a21\u578b\u3002.ckpt\u6216.safetensors\u53ef\u4ee5\u6307\u5b9a\u3002 \u901a\u8fc7 --model_tuned \u9009\u9879\u6307\u5b9a\u8981\u63d0\u53d6\u5dee\u5f02\u7684\u76ee\u6807Stable Diffusion\u6a21\u578b\u3002\u4f8b\u5982\uff0cfine tuning\u6216DreamBooth\u540e\u7684\u6a21\u578b\u3002.ckpt\u6216.safetensors\u53ef\u4ee5\u6307\u5b9a\u3002 \u901a\u8fc7 --save_to \u6307\u5b9aLoRA\u6a21\u578b\u7684\u4fdd\u5b58\u8def\u5f84\u3002 --dim \u6307\u5b9aLoRA\u7684\u7ef4\u5ea6\u6570\u3002 \u751f\u6210\u7684LoRA\u6a21\u578b\u53ef\u4ee5\u50cf\u8bad\u7ec3\u597d\u7684LoRA\u6a21\u578b\u4e00\u6837\u4f7f\u7528\u3002 \u5982\u679c\u4e24\u4e2a\u6a21\u578b\u7684Text Encoder\u76f8\u540c\uff0c\u5219LoRA\u5c06\u4ec5\u4e3aU-Net\u7684LoRA\u3002","title":"\u811a\u672c\u6267\u884c\u65b9\u6cd5"},{"location":"sd-scripts-docs/train_network/#_13","text":"--v2 \u4f7f\u7528v2.x\u7684Stable Diffusion\u6a21\u578b\u65f6\u6307\u5b9a\u3002 --device \u6307\u5b9a --device cuda \u4ee5\u5728GPU\u4e0a\u8fdb\u884c\u8ba1\u7b97\u3002\u5904\u7406\u901f\u5ea6\u66f4\u5feb\uff08CPU\u4e0b\u4e5f\u4e0d\u592a\u6162\uff0c\u5927\u7ea6\u662f2~\u6570\u500d\uff09\u3002 --save_precision \u6307\u5b9aLoRA\u7684\u4fdd\u5b58\u683c\u5f0f\uff0c\u6709\"float\"\u3001\"fp16\"\u3001\"bf16\"\u53ef\u9009\u3002\u7701\u7565\u65f6\u9ed8\u8ba4\u4e3afloat\u3002 --conv_dim \u6307\u5b9a\u65f6\u5c06LoRA\u7684\u5e94\u7528\u8303\u56f4\u6269\u5c55\u5230Conv2d 3x3\u3002\u6307\u5b9aConv2d 3x3\u7684rank\u3002","title":"\u5176\u4ed6\u9009\u9879"},{"location":"sd-scripts-docs/train_network/#_14","text":"\uff08\u7a0d\u540e\u5c06\u6574\u7406\u6587\u6863\uff0c\u76ee\u524d\u5148\u5728\u8fd9\u91cc\u5199\u8bf4\u660e\u3002\uff09 \u4f5c\u4e3aAspect Ratio Bucketing\u7684\u529f\u80fd\u6269\u5c55\uff0c\u53ef\u4ee5\u5c06\u8f83\u5c0f\u7684\u56fe\u50cf\u4fdd\u6301\u539f\u6837\u4f5c\u4e3a\u8bad\u7ec3\u6570\u636e\u3002\u6b64\u5916\uff0c\u6536\u5230\u5c06\u539f\u59cb\u8bad\u7ec3\u56fe\u50cf\u7f29\u5c0f\u540e\u7684\u56fe\u50cf\u6dfb\u52a0\u5230\u8bad\u7ec3\u6570\u636e\u7684\u62a5\u544a\u548c\u9884\u5904\u7406\u811a\u672c\uff0c\u56e0\u6b64\u8fdb\u884c\u4e86\u6574\u7406\u548c\u6dfb\u52a0\u3002\u611f\u8c22bmaltais\u3002","title":"\u56fe\u50cf\u5927\u5c0f\u8c03\u6574\u811a\u672c"},{"location":"sd-scripts-docs/train_network/#_15","text":"\u8bf7\u6309\u5982\u4e0b\u65b9\u5f0f\u6307\u5b9a\u3002\u539f\u59cb\u56fe\u50cf\u548c\u8c03\u6574\u5927\u5c0f\u540e\u7684\u56fe\u50cf\u5c06\u88ab\u4fdd\u5b58\u5230\u8f6c\u6362\u540e\u7684\u6587\u4ef6\u5939\u4e2d\u3002\u8c03\u6574\u5927\u5c0f\u540e\u7684\u56fe\u50cf\u7684\u6587\u4ef6\u540d\u5c06\u9644\u52a0\u8c03\u6574\u5927\u5c0f\u540e\u7684\u5206\u8fa8\u7387\uff08\u4f8b\u5982 +512x512 \uff09\u3002\u5982\u679c\u8c03\u6574\u5927\u5c0f\u540e\u7684\u5206\u8fa8\u7387\u5c0f\u4e8e\u539f\u59cb\u56fe\u50cf\uff0c\u5219\u4e0d\u4f1a\u88ab\u653e\u5927\u3002 python tools\\resize_images_to_resolution.py --max_resolution 512x512,384x384,256x256 --save_as_png \u539f\u59cb\u56fe\u50cf\u6587\u4ef6\u5939 \u8f6c\u6362\u540e\u7684\u6587\u4ef6\u5939 \u539f\u59cb\u56fe\u50cf\u6587\u4ef6\u5939\u4e2d\u7684\u56fe\u50cf\u6587\u4ef6\u5c06\u88ab\u8c03\u6574\u5927\u5c0f\uff0c\u4ee5\u4f7f\u5176\u9762\u79ef\u4e0e\u6307\u5b9a\u7684\u5206\u8fa8\u7387\uff08\u53ef\u6307\u5b9a\u591a\u4e2a\uff09\u76f8\u540c\uff0c\u5e76\u4fdd\u5b58\u5230\u8f6c\u6362\u540e\u7684\u6587\u4ef6\u5939\u4e2d\u3002\u975e\u56fe\u50cf\u6587\u4ef6\u5c06\u4fdd\u6301\u4e0d\u53d8\u3002 \u901a\u8fc7 --max_resolution \u9009\u9879\u6307\u5b9a\u8c03\u6574\u5927\u5c0f\u540e\u7684\u5927\u5c0f\uff0c\u5982\u793a\u4f8b\u6240\u793a\u3002\u9762\u79ef\u5c06\u88ab\u8c03\u6574\u4e3a\u8be5\u5927\u5c0f\u3002\u6307\u5b9a\u591a\u4e2a\u65f6\uff0c\u5c06\u5206\u522b\u8c03\u6574\u5927\u5c0f\u4e3a\u6bcf\u4e2a\u5206\u8fa8\u7387\u3002\u4f8b\u5982\uff0c 512x512,384x384,256x256 \u5c06\u5728\u8f6c\u6362\u540e\u7684\u6587\u4ef6\u5939\u4e2d\u751f\u6210\u539f\u59cb\u5927\u5c0f\u548c\u8c03\u6574\u5927\u5c0f\u540e\u7684\u5927\u5c0f\u00d73\uff0c\u51714\u5f20\u56fe\u50cf\u3002 \u901a\u8fc7 --save_as_png \u9009\u9879\u6307\u5b9a\u4ee5png\u683c\u5f0f\u4fdd\u5b58\u3002\u7701\u7565\u65f6\u5c06\u4ee5jpeg\u683c\u5f0f\uff08quality=100\uff09\u4fdd\u5b58\u3002 \u901a\u8fc7 --copy_associated_files \u9009\u9879\u6307\u5b9a\u65f6\uff0c\u5c06\u4e0e\u56fe\u50cf\u6587\u4ef6\u540d\uff08\u9664\u6269\u5c55\u540d\u5916\uff09\u76f8\u540c\u7684\u5176\u4ed6\u6587\u4ef6\uff08\u4f8b\u5982caption\uff09\u4ee5\u8c03\u6574\u5927\u5c0f\u540e\u7684\u56fe\u50cf\u7684\u6587\u4ef6\u540d\u590d\u5236\u3002","title":"\u811a\u672c\u6267\u884c\u65b9\u6cd5"},{"location":"sd-scripts-docs/train_network/#_16","text":"divisible_by \u8c03\u6574\u5927\u5c0f\u540e\u7684\u56fe\u50cf\u5927\u5c0f\uff08\u9ad8\u5ea6\u548c\u5bbd\u5ea6\uff09\u5c06\u901a\u8fc7\u88c1\u526a\u56fe\u50cf\u4e2d\u5fc3\uff0c\u4f7f\u5176\u53ef\u4ee5\u88ab\u8be5\u503c\u6574\u9664\u3002 interpolation \u6307\u5b9a\u7f29\u5c0f\u65f6\u7684\u63d2\u503c\u65b9\u6cd5\u3002\u53ef\u9009 area \u3001 cubic \u3001 lanczos4 \uff0c\u9ed8\u8ba4\u4e3a area \u3002","title":"\u5176\u4ed6\u9009\u9879"},{"location":"sd-scripts-docs/train_network/#_17","text":"","title":"\u9644\u52a0\u4fe1\u606f"},{"location":"sd-scripts-docs/train_network/#cloneofsimo","text":"\u622a\u81f32022/12/25\uff0c\u672c\u4ed3\u5e93\u5c06LoRA\u7684\u5e94\u7528\u8303\u56f4\u6269\u5c55\u5230Text Encoder\u7684MLP\u3001U-Net\u7684FFN\u548cTransformer\u7684in/out projection\uff0c\u4ece\u800c\u589e\u5f3a\u4e86\u8868\u793a\u80fd\u529b\u3002\u4f46\u4ee3\u4ef7\u662f\u5185\u5b58\u4f7f\u7528\u91cf\u589e\u52a0\uff0c8GB VRAM\u52c9\u5f3a\u591f\u7528\u3002 \u6b64\u5916\uff0c\u6a21\u5757\u66ff\u6362\u673a\u5236\u5b8c\u5168\u4e0d\u540c\u3002","title":"\u4e0ecloneofsimo\u4ed3\u5e93\u7684\u533a\u522b"},{"location":"sd-scripts-docs/train_network/#_18","text":"\u4e0d\u4ec5\u9650\u4e8eLoRA\uff0c\u8fd8\u53ef\u4ee5\u652f\u6301\u5176\u4ed6\u6269\u5c55\u3002\u672a\u6765\u5c06\u8003\u8651\u6dfb\u52a0\u8fd9\u4e9b\u6269\u5c55\u3002","title":"\u5173\u4e8e\u672a\u6765\u6269\u5c55"},{"location":"sd-scripts-docs/train_ti/","text":"\u8fd9\u662f\u5173\u4e8e Textual Inversion \u5b66\u4e60\u7684\u8bf4\u660e\u3002 \u8bf7\u540c\u65f6\u53c2\u8003 \u5173\u4e8e\u5b66\u4e60\u7684\u5171\u540c\u6587\u6863 \u3002 \u5728\u5b9e\u73b0\u65f6\uff0c\u6211\u4eec\u5927\u91cf\u53c2\u8003\u4e86 https://github.com/huggingface/diffusers/tree/main/examples/textual_inversion\u3002 \u5b66\u4e60\u7684\u6a21\u578b\u53ef\u4ee5\u76f4\u63a5\u5728 Web UI \u4e2d\u4f7f\u7528\u3002 \u5b66\u4e60\u6b65\u9aa4 \u8bf7\u9884\u5148\u53c2\u8003\u6b64\u5b58\u50a8\u5e93\u7684 README\uff0c\u8fdb\u884c\u73af\u5883\u8bbe\u7f6e\u3002 \u6570\u636e\u51c6\u5907 \u8bf7\u53c2\u8003 \u5173\u4e8e\u5b66\u4e60\u6570\u636e\u7684\u51c6\u5907 \u3002 \u6267\u884c\u5b66\u4e60 \u4f7f\u7528 train_textual_inversion.py \u3002\u4ee5\u4e0b\u662f\u547d\u4ee4\u884c\u793a\u4f8b\uff08DreamBooth \u65b9\u6cd5\uff09\u3002 accelerate launch --num_cpu_threads_per_process 1 train_textual_inversion.py --dataset_config=<\u6570\u636e\u51c6\u5907\u65f6\u521b\u5efa\u7684.toml\u6587\u4ef6> --output_dir=<\u5b66\u4e60\u6a21\u578b\u7684\u8f93\u51fa\u6587\u4ef6\u5939> --output_name=<\u5b66\u4e60\u6a21\u578b\u8f93\u51fa\u65f6\u7684\u6587\u4ef6\u540d> --save_model_as=safetensors --prior_loss_weight=1.0 --max_train_steps=1600 --learning_rate=1e-6 --optimizer_type=\"AdamW8bit\" --xformers --mixed_precision=\"fp16\" --cache_latents --gradient_checkpointing --token_string=mychar4 --init_word=cute --num_vectors_per_token=4 \u5728 --token_string \u4e2d\u6307\u5b9a\u5b66\u4e60\u65f6\u7684\u6807\u8bb0\u5b57\u7b26\u4e32\u3002 \u5b66\u4e60\u65f6\u7684\u63d0\u793a\u8bcd\u5fc5\u987b\u5305\u542b\u6b64\u5b57\u7b26\u4e32 \uff08\u5982\u679c token_string \u662f mychar4\uff0c\u5219\u4e3a mychar4 1girl \u7b49\uff09\u3002\u63d0\u793a\u8bcd\u4e2d\u7684\u6b64\u5b57\u7b26\u4e32\u90e8\u5206\u5c06\u88ab\u66ff\u6362\u4e3a Textual Inversion \u7684\u65b0\u6807\u8bb0\u5e76\u8fdb\u884c\u5b66\u4e60\u3002\u6700\u7b80\u5355\u4e14\u6700\u53ef\u9760\u7684\u65b9\u6cd5\u662f\u4f7f\u7528 DreamBooth\u3001class+identifier \u5f62\u5f0f\u7684\u6570\u636e\u96c6\uff0c\u5e76\u5c06 token_string \u4f5c\u4e3a\u6807\u8bb0\u5b57\u7b26\u4e32\u3002 \u8981\u68c0\u67e5\u63d0\u793a\u8bcd\u4e2d\u662f\u5426\u5305\u542b\u6807\u8bb0\u5b57\u7b26\u4e32\uff0c\u53ef\u4ee5\u4f7f\u7528 --debug_dataset \u67e5\u770b\u66ff\u6362\u540e\u7684 token id\u3002\u5982\u679c\u5b58\u5728 49408 \u4e4b\u540e\u7684 token\uff0c\u5219\u8868\u793a\u5305\u542b\u6807\u8bb0\u5b57\u7b26\u4e32\u3002 input ids: tensor([[49406, 49408, 49409, 49410, 49411, 49412, 49413, 49414, 49415, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407]]) \u4e0d\u80fd\u4f7f\u7528\u5206\u8bcd\u5668\u5df2\u7ecf\u62e5\u6709\u7684\u5355\u8bcd\uff08\u5e38\u89c1\u5355\u8bcd\uff09\u3002 \u5728 --init_word \u4e2d\u6307\u5b9a\u521d\u59cb\u5316 embeddings \u65f6\u7684\u590d\u5236\u6e90\u6807\u8bb0\u5b57\u7b26\u4e32\u3002\u9009\u62e9\u4e0e\u8981\u5b66\u4e60\u7684 concept \u63a5\u8fd1\u7684\u5355\u8bcd\u4f3c\u4e4e\u6bd4\u8f83\u597d\u3002\u4e0d\u80fd\u6307\u5b9a\u7531\u4e24\u4e2a\u4ee5\u4e0a\u6807\u8bb0\u7ec4\u6210\u7684\u5b57\u7b26\u4e32\u3002 \u5728 --num_vectors_per_token \u4e2d\u6307\u5b9a\u5728\u6b64\u5b66\u4e60\u4e2d\u4f7f\u7528\u591a\u5c11\u4e2a\u6807\u8bb0\u3002\u6570\u91cf\u8d8a\u591a\uff0c\u8868\u73b0\u529b\u8d8a\u5f3a\uff0c\u4f46\u4e5f\u4f1a\u5360\u7528\u66f4\u591a\u7684\u6807\u8bb0\u3002\u4f8b\u5982\uff0c\u5982\u679c num_vectors_per_token=8\uff0c\u5219\u6307\u5b9a\u7684\u6807\u8bb0\u5b57\u7b26\u4e32\u5c06\u5360\u7528\uff08\u4e00\u822c\u63d0\u793a\u8bcd\u7684 77 \u4e2a\u6807\u8bb0\u9650\u5236\u4e2d\u7684\uff098 \u4e2a\u6807\u8bb0\u3002 \u4ee5\u4e0a\u662f Textual Inversion \u7684\u4e3b\u8981\u9009\u9879\u3002\u4e4b\u540e\u4e0e\u5176\u4ed6\u5b66\u4e60\u811a\u672c\u76f8\u540c\u3002 num_cpu_threads_per_process \u901a\u5e38\u6307\u5b9a\u4e3a 1\u3002 \u5728 pretrained_model_name_or_path \u4e2d\u6307\u5b9a\u4f5c\u4e3a\u57fa\u7840\u8fdb\u884c\u989d\u5916\u5b66\u4e60\u7684\u6a21\u578b\u3002\u53ef\u4ee5\u6307\u5b9a Stable Diffusion \u7684 checkpoint \u6587\u4ef6\uff08.ckpt \u6216 .safetensors\uff09\u3001Diffusers \u7684\u672c\u5730\u78c1\u76d8\u4e0a\u7684\u6a21\u578b\u76ee\u5f55\u3001Diffusers \u7684\u6a21\u578b ID\uff08\u4f8b\u5982 \"stabilityai/stable-diffusion-2\"\uff09\u3002 \u5728 output_dir \u4e2d\u6307\u5b9a\u5b66\u4e60\u540e\u7684\u6a21\u578b\u7684\u4fdd\u5b58\u6587\u4ef6\u5939\u3002\u5728 output_name \u4e2d\u6307\u5b9a\u6a21\u578b\u7684\u6587\u4ef6\u540d\uff08\u4e0d\u5305\u62ec\u6269\u5c55\u540d\uff09\u3002\u901a\u8fc7 save_model_as \u6307\u5b9a\u4fdd\u5b58\u4e3a safetensors \u683c\u5f0f\u3002 \u5728 dataset_config \u4e2d\u6307\u5b9a .toml \u6587\u4ef6\u3002\u5728\u6587\u4ef6\u5185\uff0c\u521d\u59cb\u65f6\u8bf7\u5c06\u6279\u5904\u7406\u5927\u5c0f\u6307\u5b9a\u4e3a 1 \u4ee5\u51cf\u5c11\u5185\u5b58\u6d88\u8017\u3002 \u5c06\u5b66\u4e60\u6b65\u6570 max_train_steps \u6307\u5b9a\u4e3a 10000\u3002\u8fd9\u91cc\u5c06\u5b66\u4e60\u7387 learning_rate \u6307\u5b9a\u4e3a 5e-6\u3002 \u4e3a\u4e86\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff0c\u6307\u5b9a mixed_precision=\"fp16\" \uff08\u5728 RTX30 \u7cfb\u5217\u4e4b\u540e\uff0c\u53ef\u4ee5\u6307\u5b9a bf16 \u3002\u8bf7\u4e0e\u5728\u73af\u5883\u8bbe\u7f6e\u65f6\u5bf9 accelerate \u8fdb\u884c\u7684\u8bbe\u7f6e\u4fdd\u6301\u4e00\u81f4\uff09\u3002\u540c\u65f6\u6307\u5b9a gradient_checkpointing \u3002 \u4e3a\u4e86\u4f7f\u7528\u5185\u5b58\u6d88\u8017\u8f83\u5c11\u7684 8bit AdamW \u4f5c\u4e3a\u4f18\u5316\u5668\uff08\u5c06\u6a21\u578b\u4f18\u5316\u4ee5\u9002\u5e94\u5b66\u4e60\u6570\u636e\uff09\uff0c\u6307\u5b9a optimizer_type=\"AdamW8bit\" \u3002 \u6307\u5b9a xformers \u9009\u9879\uff0c\u4f7f\u7528 xformers \u7684 CrossAttention\u3002\u5982\u679c\u672a\u5b89\u88c5 xformers \u6216\u51fa\u73b0\u9519\u8bef\uff08\u5728\u67d0\u4e9b\u73af\u5883\u4e0b\uff0c\u4f8b\u5982 mixed_precision=\"no\" \uff09\uff0c\u53ef\u4ee5\u6307\u5b9a mem_eff_attn \u9009\u9879\u4ee5\u4f7f\u7528\u8282\u7701\u5185\u5b58\u7684 CrossAttention\uff08\u901f\u5ea6\u4f1a\u53d8\u6162\uff09\u3002 \u5982\u679c\u5185\u5b58\u8db3\u591f\uff0c\u53ef\u4ee5\u7f16\u8f91 .toml \u6587\u4ef6\uff0c\u5c06\u6279\u5904\u7406\u5927\u5c0f\u589e\u52a0\u5230\u4f8b\u5982 8 \uff08\u53ef\u80fd\u4f1a\u63d0\u9ad8\u901f\u5ea6\u548c\u7cbe\u5ea6\uff09\u3002 \u5173\u4e8e\u5e38\u7528\u9009\u9879 \u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\uff0c\u8bf7\u53c2\u8003\u6709\u5173\u9009\u9879\u7684\u6587\u6863\u3002 \u5b66\u4e60 Stable Diffusion 2.x \u6216\u5176\u6d3e\u751f\u6a21\u578b \u5b66\u4e60 clip skip \u4e3a 2 \u6216\u4ee5\u4e0a\u7684\u6a21\u578b \u4f7f\u7528\u8d85\u8fc7 75 \u4e2a\u6807\u8bb0\u7684\u6807\u9898\u8fdb\u884c\u5b66\u4e60 \u5173\u4e8e Textual Inversion \u7684\u6279\u5904\u7406\u5927\u5c0f \u4e0e\u5b66\u4e60\u6574\u4e2a\u6a21\u578b\u7684 DreamBooth \u548c fine tuning \u76f8\u6bd4\uff0cTextual Inversion \u7684\u5185\u5b58\u4f7f\u7528\u91cf\u8f83\u5c11\uff0c\u56e0\u6b64\u53ef\u4ee5\u8bbe\u7f6e\u8f83\u5927\u7684\u6279\u5904\u7406\u5927\u5c0f\u3002 Textual Inversion \u7684\u5176\u4ed6\u4e3b\u8981\u9009\u9879 \u6709\u5173\u6240\u6709\u9009\u9879\uff0c\u8bf7\u53c2\u8003\u5176\u4ed6\u6587\u6863\u3002 --weights \u5728\u5b66\u4e60\u4e4b\u524d\u52a0\u8f7d\u5df2\u5b66\u4e60\u7684 embeddings\uff0c\u5e76\u4ece\u90a3\u91cc\u7ee7\u7eed\u5b66\u4e60\u3002 --use_object_template \u4e0d\u4f7f\u7528\u6807\u9898\uff0c\u800c\u662f\u4f7f\u7528\u9884\u8bbe\u7684\u7269\u4f53\u6a21\u677f\u5b57\u7b26\u4e32\uff08\u4f8b\u5982 a photo of a {} \uff09\u8fdb\u884c\u5b66\u4e60\u3002\u8fd9\u4e0e\u5b98\u65b9\u5b9e\u73b0\u76f8\u540c\u3002\u6807\u9898\u5c06\u88ab\u5ffd\u7565\u3002 --use_style_template \u4e0d\u4f7f\u7528\u6807\u9898\uff0c\u800c\u662f\u4f7f\u7528\u9884\u8bbe\u7684\u6837\u5f0f\u6a21\u677f\u5b57\u7b26\u4e32\uff08\u4f8b\u5982 a painting in the style of {} \uff09\u8fdb\u884c\u5b66\u4e60\u3002\u8fd9\u4e0e\u5b98\u65b9\u5b9e\u73b0\u76f8\u540c\u3002\u6807\u9898\u5c06\u88ab\u5ffd\u7565\u3002 \u4f7f\u7528\u6b64\u5b58\u50a8\u5e93\u4e2d\u7684\u56fe\u50cf\u751f\u6210\u811a\u672c\u751f\u6210\u56fe\u50cf \u5728 gen_img_diffusers.py \u4e2d\uff0c\u4f7f\u7528 --textual_inversion_embeddings \u9009\u9879\u6307\u5b9a\u5b66\u4e60\u7684 embeddings \u6587\u4ef6\uff08\u53ef\u6307\u5b9a\u591a\u4e2a\uff09\u3002\u5728\u63d0\u793a\u8bcd\u4e2d\u4f7f\u7528 embeddings \u6587\u4ef6\u7684\u6587\u4ef6\u540d\uff08\u4e0d\u5305\u62ec\u6269\u5c55\u540d\uff09\uff0c\u5c06\u5e94\u7528\u76f8\u5e94\u7684 embeddings\u3002","title":"Textual-Inversion-\u6a21\u578b\u8bad\u7ec3"},{"location":"sd-scripts-docs/train_ti/#_1","text":"\u8bf7\u9884\u5148\u53c2\u8003\u6b64\u5b58\u50a8\u5e93\u7684 README\uff0c\u8fdb\u884c\u73af\u5883\u8bbe\u7f6e\u3002","title":"\u5b66\u4e60\u6b65\u9aa4"},{"location":"sd-scripts-docs/train_ti/#_2","text":"\u8bf7\u53c2\u8003 \u5173\u4e8e\u5b66\u4e60\u6570\u636e\u7684\u51c6\u5907 \u3002","title":"\u6570\u636e\u51c6\u5907"},{"location":"sd-scripts-docs/train_ti/#_3","text":"\u4f7f\u7528 train_textual_inversion.py \u3002\u4ee5\u4e0b\u662f\u547d\u4ee4\u884c\u793a\u4f8b\uff08DreamBooth \u65b9\u6cd5\uff09\u3002 accelerate launch --num_cpu_threads_per_process 1 train_textual_inversion.py --dataset_config=<\u6570\u636e\u51c6\u5907\u65f6\u521b\u5efa\u7684.toml\u6587\u4ef6> --output_dir=<\u5b66\u4e60\u6a21\u578b\u7684\u8f93\u51fa\u6587\u4ef6\u5939> --output_name=<\u5b66\u4e60\u6a21\u578b\u8f93\u51fa\u65f6\u7684\u6587\u4ef6\u540d> --save_model_as=safetensors --prior_loss_weight=1.0 --max_train_steps=1600 --learning_rate=1e-6 --optimizer_type=\"AdamW8bit\" --xformers --mixed_precision=\"fp16\" --cache_latents --gradient_checkpointing --token_string=mychar4 --init_word=cute --num_vectors_per_token=4 \u5728 --token_string \u4e2d\u6307\u5b9a\u5b66\u4e60\u65f6\u7684\u6807\u8bb0\u5b57\u7b26\u4e32\u3002 \u5b66\u4e60\u65f6\u7684\u63d0\u793a\u8bcd\u5fc5\u987b\u5305\u542b\u6b64\u5b57\u7b26\u4e32 \uff08\u5982\u679c token_string \u662f mychar4\uff0c\u5219\u4e3a mychar4 1girl \u7b49\uff09\u3002\u63d0\u793a\u8bcd\u4e2d\u7684\u6b64\u5b57\u7b26\u4e32\u90e8\u5206\u5c06\u88ab\u66ff\u6362\u4e3a Textual Inversion \u7684\u65b0\u6807\u8bb0\u5e76\u8fdb\u884c\u5b66\u4e60\u3002\u6700\u7b80\u5355\u4e14\u6700\u53ef\u9760\u7684\u65b9\u6cd5\u662f\u4f7f\u7528 DreamBooth\u3001class+identifier \u5f62\u5f0f\u7684\u6570\u636e\u96c6\uff0c\u5e76\u5c06 token_string \u4f5c\u4e3a\u6807\u8bb0\u5b57\u7b26\u4e32\u3002 \u8981\u68c0\u67e5\u63d0\u793a\u8bcd\u4e2d\u662f\u5426\u5305\u542b\u6807\u8bb0\u5b57\u7b26\u4e32\uff0c\u53ef\u4ee5\u4f7f\u7528 --debug_dataset \u67e5\u770b\u66ff\u6362\u540e\u7684 token id\u3002\u5982\u679c\u5b58\u5728 49408 \u4e4b\u540e\u7684 token\uff0c\u5219\u8868\u793a\u5305\u542b\u6807\u8bb0\u5b57\u7b26\u4e32\u3002 input ids: tensor([[49406, 49408, 49409, 49410, 49411, 49412, 49413, 49414, 49415, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407, 49407]]) \u4e0d\u80fd\u4f7f\u7528\u5206\u8bcd\u5668\u5df2\u7ecf\u62e5\u6709\u7684\u5355\u8bcd\uff08\u5e38\u89c1\u5355\u8bcd\uff09\u3002 \u5728 --init_word \u4e2d\u6307\u5b9a\u521d\u59cb\u5316 embeddings \u65f6\u7684\u590d\u5236\u6e90\u6807\u8bb0\u5b57\u7b26\u4e32\u3002\u9009\u62e9\u4e0e\u8981\u5b66\u4e60\u7684 concept \u63a5\u8fd1\u7684\u5355\u8bcd\u4f3c\u4e4e\u6bd4\u8f83\u597d\u3002\u4e0d\u80fd\u6307\u5b9a\u7531\u4e24\u4e2a\u4ee5\u4e0a\u6807\u8bb0\u7ec4\u6210\u7684\u5b57\u7b26\u4e32\u3002 \u5728 --num_vectors_per_token \u4e2d\u6307\u5b9a\u5728\u6b64\u5b66\u4e60\u4e2d\u4f7f\u7528\u591a\u5c11\u4e2a\u6807\u8bb0\u3002\u6570\u91cf\u8d8a\u591a\uff0c\u8868\u73b0\u529b\u8d8a\u5f3a\uff0c\u4f46\u4e5f\u4f1a\u5360\u7528\u66f4\u591a\u7684\u6807\u8bb0\u3002\u4f8b\u5982\uff0c\u5982\u679c num_vectors_per_token=8\uff0c\u5219\u6307\u5b9a\u7684\u6807\u8bb0\u5b57\u7b26\u4e32\u5c06\u5360\u7528\uff08\u4e00\u822c\u63d0\u793a\u8bcd\u7684 77 \u4e2a\u6807\u8bb0\u9650\u5236\u4e2d\u7684\uff098 \u4e2a\u6807\u8bb0\u3002 \u4ee5\u4e0a\u662f Textual Inversion \u7684\u4e3b\u8981\u9009\u9879\u3002\u4e4b\u540e\u4e0e\u5176\u4ed6\u5b66\u4e60\u811a\u672c\u76f8\u540c\u3002 num_cpu_threads_per_process \u901a\u5e38\u6307\u5b9a\u4e3a 1\u3002 \u5728 pretrained_model_name_or_path \u4e2d\u6307\u5b9a\u4f5c\u4e3a\u57fa\u7840\u8fdb\u884c\u989d\u5916\u5b66\u4e60\u7684\u6a21\u578b\u3002\u53ef\u4ee5\u6307\u5b9a Stable Diffusion \u7684 checkpoint \u6587\u4ef6\uff08.ckpt \u6216 .safetensors\uff09\u3001Diffusers \u7684\u672c\u5730\u78c1\u76d8\u4e0a\u7684\u6a21\u578b\u76ee\u5f55\u3001Diffusers \u7684\u6a21\u578b ID\uff08\u4f8b\u5982 \"stabilityai/stable-diffusion-2\"\uff09\u3002 \u5728 output_dir \u4e2d\u6307\u5b9a\u5b66\u4e60\u540e\u7684\u6a21\u578b\u7684\u4fdd\u5b58\u6587\u4ef6\u5939\u3002\u5728 output_name \u4e2d\u6307\u5b9a\u6a21\u578b\u7684\u6587\u4ef6\u540d\uff08\u4e0d\u5305\u62ec\u6269\u5c55\u540d\uff09\u3002\u901a\u8fc7 save_model_as \u6307\u5b9a\u4fdd\u5b58\u4e3a safetensors \u683c\u5f0f\u3002 \u5728 dataset_config \u4e2d\u6307\u5b9a .toml \u6587\u4ef6\u3002\u5728\u6587\u4ef6\u5185\uff0c\u521d\u59cb\u65f6\u8bf7\u5c06\u6279\u5904\u7406\u5927\u5c0f\u6307\u5b9a\u4e3a 1 \u4ee5\u51cf\u5c11\u5185\u5b58\u6d88\u8017\u3002 \u5c06\u5b66\u4e60\u6b65\u6570 max_train_steps \u6307\u5b9a\u4e3a 10000\u3002\u8fd9\u91cc\u5c06\u5b66\u4e60\u7387 learning_rate \u6307\u5b9a\u4e3a 5e-6\u3002 \u4e3a\u4e86\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff0c\u6307\u5b9a mixed_precision=\"fp16\" \uff08\u5728 RTX30 \u7cfb\u5217\u4e4b\u540e\uff0c\u53ef\u4ee5\u6307\u5b9a bf16 \u3002\u8bf7\u4e0e\u5728\u73af\u5883\u8bbe\u7f6e\u65f6\u5bf9 accelerate \u8fdb\u884c\u7684\u8bbe\u7f6e\u4fdd\u6301\u4e00\u81f4\uff09\u3002\u540c\u65f6\u6307\u5b9a gradient_checkpointing \u3002 \u4e3a\u4e86\u4f7f\u7528\u5185\u5b58\u6d88\u8017\u8f83\u5c11\u7684 8bit AdamW \u4f5c\u4e3a\u4f18\u5316\u5668\uff08\u5c06\u6a21\u578b\u4f18\u5316\u4ee5\u9002\u5e94\u5b66\u4e60\u6570\u636e\uff09\uff0c\u6307\u5b9a optimizer_type=\"AdamW8bit\" \u3002 \u6307\u5b9a xformers \u9009\u9879\uff0c\u4f7f\u7528 xformers \u7684 CrossAttention\u3002\u5982\u679c\u672a\u5b89\u88c5 xformers \u6216\u51fa\u73b0\u9519\u8bef\uff08\u5728\u67d0\u4e9b\u73af\u5883\u4e0b\uff0c\u4f8b\u5982 mixed_precision=\"no\" \uff09\uff0c\u53ef\u4ee5\u6307\u5b9a mem_eff_attn \u9009\u9879\u4ee5\u4f7f\u7528\u8282\u7701\u5185\u5b58\u7684 CrossAttention\uff08\u901f\u5ea6\u4f1a\u53d8\u6162\uff09\u3002 \u5982\u679c\u5185\u5b58\u8db3\u591f\uff0c\u53ef\u4ee5\u7f16\u8f91 .toml \u6587\u4ef6\uff0c\u5c06\u6279\u5904\u7406\u5927\u5c0f\u589e\u52a0\u5230\u4f8b\u5982 8 \uff08\u53ef\u80fd\u4f1a\u63d0\u9ad8\u901f\u5ea6\u548c\u7cbe\u5ea6\uff09\u3002","title":"\u6267\u884c\u5b66\u4e60"},{"location":"sd-scripts-docs/train_ti/#_4","text":"\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\uff0c\u8bf7\u53c2\u8003\u6709\u5173\u9009\u9879\u7684\u6587\u6863\u3002 \u5b66\u4e60 Stable Diffusion 2.x \u6216\u5176\u6d3e\u751f\u6a21\u578b \u5b66\u4e60 clip skip \u4e3a 2 \u6216\u4ee5\u4e0a\u7684\u6a21\u578b \u4f7f\u7528\u8d85\u8fc7 75 \u4e2a\u6807\u8bb0\u7684\u6807\u9898\u8fdb\u884c\u5b66\u4e60","title":"\u5173\u4e8e\u5e38\u7528\u9009\u9879"},{"location":"sd-scripts-docs/train_ti/#textual-inversion","text":"\u4e0e\u5b66\u4e60\u6574\u4e2a\u6a21\u578b\u7684 DreamBooth \u548c fine tuning \u76f8\u6bd4\uff0cTextual Inversion \u7684\u5185\u5b58\u4f7f\u7528\u91cf\u8f83\u5c11\uff0c\u56e0\u6b64\u53ef\u4ee5\u8bbe\u7f6e\u8f83\u5927\u7684\u6279\u5904\u7406\u5927\u5c0f\u3002","title":"\u5173\u4e8e Textual Inversion \u7684\u6279\u5904\u7406\u5927\u5c0f"},{"location":"sd-scripts-docs/train_ti/#textual-inversion_1","text":"\u6709\u5173\u6240\u6709\u9009\u9879\uff0c\u8bf7\u53c2\u8003\u5176\u4ed6\u6587\u6863\u3002 --weights \u5728\u5b66\u4e60\u4e4b\u524d\u52a0\u8f7d\u5df2\u5b66\u4e60\u7684 embeddings\uff0c\u5e76\u4ece\u90a3\u91cc\u7ee7\u7eed\u5b66\u4e60\u3002 --use_object_template \u4e0d\u4f7f\u7528\u6807\u9898\uff0c\u800c\u662f\u4f7f\u7528\u9884\u8bbe\u7684\u7269\u4f53\u6a21\u677f\u5b57\u7b26\u4e32\uff08\u4f8b\u5982 a photo of a {} \uff09\u8fdb\u884c\u5b66\u4e60\u3002\u8fd9\u4e0e\u5b98\u65b9\u5b9e\u73b0\u76f8\u540c\u3002\u6807\u9898\u5c06\u88ab\u5ffd\u7565\u3002 --use_style_template \u4e0d\u4f7f\u7528\u6807\u9898\uff0c\u800c\u662f\u4f7f\u7528\u9884\u8bbe\u7684\u6837\u5f0f\u6a21\u677f\u5b57\u7b26\u4e32\uff08\u4f8b\u5982 a painting in the style of {} \uff09\u8fdb\u884c\u5b66\u4e60\u3002\u8fd9\u4e0e\u5b98\u65b9\u5b9e\u73b0\u76f8\u540c\u3002\u6807\u9898\u5c06\u88ab\u5ffd\u7565\u3002","title":"Textual Inversion \u7684\u5176\u4ed6\u4e3b\u8981\u9009\u9879"},{"location":"sd-scripts-docs/train_ti/#_5","text":"\u5728 gen_img_diffusers.py \u4e2d\uff0c\u4f7f\u7528 --textual_inversion_embeddings \u9009\u9879\u6307\u5b9a\u5b66\u4e60\u7684 embeddings \u6587\u4ef6\uff08\u53ef\u6307\u5b9a\u591a\u4e2a\uff09\u3002\u5728\u63d0\u793a\u8bcd\u4e2d\u4f7f\u7528 embeddings \u6587\u4ef6\u7684\u6587\u4ef6\u540d\uff08\u4e0d\u5305\u62ec\u6269\u5c55\u540d\uff09\uff0c\u5c06\u5e94\u7528\u76f8\u5e94\u7684 embeddings\u3002","title":"\u4f7f\u7528\u6b64\u5b58\u50a8\u5e93\u4e2d\u7684\u56fe\u50cf\u751f\u6210\u811a\u672c\u751f\u6210\u56fe\u50cf"},{"location":"sd-scripts-docs/wd14_tagger/","text":"\u4f7f\u7528WD14Tagger\u8fdb\u884c\u6807\u7b7e\u5316 \u6b64\u90e8\u5206\u7684\u8bf4\u660e\u53c2\u8003\u4e86\u8be5github\u9875\u9762\uff08https://github.com/toriato/stable-diffusion-webui-wd14-tagger#mrsmilingwolfs-model-aka-waifu-diffusion-14-tagger \uff09\u3002 \u5efa\u8bae\u4f7f\u7528onnx\u8fdb\u884c\u63a8\u7406\u3002\u8bf7\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5onnx\u3002 pip install onnx==1.15.0 onnxruntime-gpu==1.17.1 \u6a21\u578b\u7684\u6743\u91cd\u5c06\u4eceHugging Face\u81ea\u52a8\u4e0b\u8f7d\u3002 \u4f7f\u7528\u65b9\u6cd5 \u8fd0\u884c\u811a\u672c\u4ee5\u5bf9\u56fe\u50cf\u8fdb\u884c\u6807\u7b7e\u5316\u3002 python fintune/tag_images_by_wd14_tagger.py --onnx --repo_id <\u6a21\u578b\u7684repo id> --batch_size <\u6279\u5927\u5c0f> <\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939> \u5982\u679c\u4f7f\u7528 SmilingWolf/wd-swinv2-tagger-v3 \u4f5c\u4e3a\u4ed3\u5e93ID\uff0c\u5e76\u5c06\u6279\u5927\u5c0f\u8bbe\u7f6e\u4e3a4\uff0c\u540c\u65f6\u5c06\u8bad\u7ec3\u6570\u636e\u653e\u5728\u7236\u6587\u4ef6\u5939\u7684 train_data \u4e2d\uff0c\u5219\u547d\u4ee4\u5982\u4e0b\u3002 python tag_images_by_wd14_tagger.py --onnx --repo_id SmilingWolf/wd-swinv2-tagger-v3 --batch_size 4 ..\\train_data \u9996\u6b21\u8fd0\u884c\u65f6\uff0c\u6a21\u578b\u6587\u4ef6\u5c06\u81ea\u52a8\u4e0b\u8f7d\u5230 wd14_tagger_model \u6587\u4ef6\u5939\u4e2d\uff08\u6587\u4ef6\u5939\u8def\u5f84\u53ef\u901a\u8fc7\u9009\u9879\u66f4\u6539\uff09\u3002 \u6807\u7b7e\u6587\u4ef6\u5c06\u4e0e\u8bad\u7ec3\u6570\u636e\u56fe\u50cf\u5728\u540c\u4e00\u76ee\u5f55\u4e0b\u521b\u5efa\uff0c\u5177\u6709\u76f8\u540c\u7684\u6587\u4ef6\u540d\uff0c\u6269\u5c55\u540d\u4e3a.txt\u3002 \u547d\u4ee4\u793a\u4f8b \u5982\u679c\u8981\u4ee5Animagine XL 3.1 \u65b9\u5f0f\u8f93\u51fa\uff0c\u547d\u4ee4\u5982\u4e0b\uff08\u5b9e\u9645\u8f93\u5165\u65f6\u8bf7\u5728\u4e00\u884c\u5185\u8f93\u5165\uff09\u3002 python tag_images_by_wd14_tagger.py --onnx --repo_id SmilingWolf/wd-swinv2-tagger-v3 --batch_size 4 --remove_underscore --undesired_tags \"PUT,YOUR,UNDESIRED,TAGS\" --recursive --use_rating_tags_as_last_tag --character_tags_first --character_tag_expand --always_first_tags \"1girl,1boy\" ..\\train_data \u53ef\u7528\u7684\u4ed3\u5e93ID \u53ef\u4ee5\u4f7f\u7528 SmilingWolf\u5148\u751f\u7684V2\u3001V3\u6a21\u578b \u3002\u8bf7\u6307\u5b9a\u4e3a SmilingWolf/wd-vit-tagger-v3 \u8fd9\u6837\u7684\u5f62\u5f0f\u3002\u9ed8\u8ba4\u503c\u4e3a SmilingWolf/wd-v1-4-convnext-tagger-v2 \u3002 \u9009\u9879 \u5e38\u89c4\u9009\u9879 --onnx : \u4f7f\u7528ONNX\u8fdb\u884c\u63a8\u7406\u3002\u5982\u679c\u4e0d\u6307\u5b9a\uff0c\u5219\u4f7f\u7528TensorFlow\u3002\u4f7f\u7528TensorFlow\u65f6\u9700\u8981\u5355\u72ec\u5b89\u88c5TensorFlow\u3002 --batch_size : \u4e00\u6b21\u5904\u7406\u7684\u56fe\u50cf\u6570\u91cf\u3002\u9ed8\u8ba4\u503c\u4e3a1\u3002\u8bf7\u6839\u636eVRAM\u5bb9\u91cf\u8c03\u6574\u3002 --caption_extension : \u6807\u7b7e\u6587\u4ef6\u7684\u6269\u5c55\u540d\u3002\u9ed8\u8ba4\u503c\u4e3a .txt \u3002 --max_data_loader_n_workers : DataLoader\u7684\u6700\u5927\u5de5\u4f5c\u8fdb\u7a0b\u6570\u3002\u5982\u679c\u6307\u5b9a1\u6216\u66f4\u5927\u7684\u6570\u503c\uff0c\u5c06\u4f7f\u7528DataLoader\u52a0\u901f\u56fe\u50cf\u8bfb\u53d6\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0c\u5219\u4e0d\u4f7f\u7528DataLoader\u3002 --thresh : \u8f93\u51fa\u6807\u7b7e\u7684\u7f6e\u4fe1\u5ea6\u9608\u503c\u3002\u9ed8\u8ba4\u503c\u4e3a0.35\u3002\u964d\u4f4e\u6b64\u503c\u4f1a\u8f93\u51fa\u66f4\u591a\u6807\u7b7e\uff0c\u4f46\u51c6\u786e\u5ea6\u4f1a\u964d\u4f4e\u3002 --general_threshold : \u4e00\u822c\u6807\u7b7e\u7684\u7f6e\u4fe1\u5ea6\u9608\u503c\u3002\u5982\u679c\u7701\u7565\uff0c\u5219\u4e0e --thresh \u76f8\u540c\u3002 --character_threshold : \u89d2\u8272\u6807\u7b7e\u7684\u7f6e\u4fe1\u5ea6\u9608\u503c\u3002\u5982\u679c\u7701\u7565\uff0c\u5219\u4e0e --thresh \u76f8\u540c\u3002 --recursive : \u5982\u679c\u6307\u5b9a\uff0c\u5219\u9012\u5f52\u5904\u7406\u6307\u5b9a\u6587\u4ef6\u5939\u5185\u7684\u5b50\u6587\u4ef6\u5939\u3002 --append_tags : \u5411\u73b0\u6709\u7684\u6807\u7b7e\u6587\u4ef6\u8ffd\u52a0\u6807\u7b7e\u3002 --frequency_tags : \u8f93\u51fa\u6807\u7b7e\u7684\u9891\u7387\u3002 --debug : \u8c03\u8bd5\u6a21\u5f0f\u3002\u6307\u5b9a\u540e\u8f93\u51fa\u8c03\u8bd5\u4fe1\u606f\u3002 \u6a21\u578b\u4e0b\u8f7d --model_dir : \u6a21\u578b\u6587\u4ef6\u7684\u4fdd\u5b58\u76ee\u5f55\u3002\u9ed8\u8ba4\u503c\u4e3a wd14_tagger_model \u3002 --force_download : \u5982\u679c\u6307\u5b9a\uff0c\u5219\u91cd\u65b0\u4e0b\u8f7d\u6a21\u578b\u6587\u4ef6\u3002 \u6807\u7b7e\u7f16\u8f91\u76f8\u5173 --remove_underscore : \u4ece\u8f93\u51fa\u7684\u6807\u7b7e\u4e2d\u5220\u9664\u4e0b\u5212\u7ebf\u3002 --undesired_tags : \u6307\u5b9a\u4e0d\u8f93\u51fa\u7684\u6807\u7b7e\u3002\u53ef\u4ee5\u7528\u9017\u53f7\u5206\u9694\u591a\u4e2a\u6807\u7b7e\u3002\u4f8b\u5982 black eyes,black hair \u3002 --use_rating_tags : \u5728\u6807\u7b7e\u7684\u5f00\u5934\u8f93\u51fa\u5206\u7ea7\u6807\u7b7e\u3002 --use_rating_tags_as_last_tag : \u5728\u6807\u7b7e\u7684\u672b\u5c3e\u6dfb\u52a0\u5206\u7ea7\u6807\u7b7e\u3002 --character_tags_first : \u9996\u5148\u8f93\u51fa\u89d2\u8272\u6807\u7b7e\u3002 --character_tag_expand : \u5c55\u5f00\u89d2\u8272\u6807\u7b7e\u7684\u7cfb\u5217\u540d\u79f0\u3002\u4f8b\u5982\uff0c\u5c06 chara_name_(series) \u6807\u7b7e\u5206\u5272\u4e3a chara_name, series \u3002 --always_first_tags : \u5f53\u56fe\u50cf\u4e2d\u5b58\u5728\u67d0\u4e2a\u6807\u7b7e\u65f6\uff0c\u6307\u5b9a\u5c06\u5176\u653e\u5728\u6700\u524d\u9762\u7684\u6807\u7b7e\u3002\u53ef\u4ee5\u7528\u9017\u53f7\u5206\u9694\u591a\u4e2a\u6807\u7b7e\u3002\u4f8b\u5982 1girl,1boy \u3002 --caption_separator : \u5728\u8f93\u51fa\u6587\u4ef6\u4e2d\u7528\u6b64\u5b57\u7b26\u4e32\u5206\u9694\u6807\u7b7e\u3002\u9ed8\u8ba4\u503c\u4e3a , \u3002 --tag_replacement : \u8fdb\u884c\u6807\u7b7e\u66ff\u6362\u3002\u6307\u5b9a\u683c\u5f0f\u4e3a tag1,tag2;tag3,tag4 \u3002\u5982\u679c\u8981\u4f7f\u7528 , \u6216 ; \uff0c\u8bf7\u7528 \\ \u8fdb\u884c\u8f6c\u4e49\u3002 \u4f8b\u5982\uff0c aira tsubase,aira tsubase (uniform) \uff08\u5f53\u8981\u5b66\u4e60\u7279\u5b9a\u670d\u88c5\u65f6\uff09\uff0c aira tsubase,aira tsubase\\, heir of shadows \uff08\u5f53\u7cfb\u5217\u540d\u79f0\u672a\u5305\u542b\u5728\u6807\u7b7e\u4e2d\u65f6\uff09\u3002 tag_replacement \u5728 character_tag_expand \u4e4b\u540e\u5e94\u7528\u3002 \u6307\u5b9a remove_underscore \u65f6\uff0c undesired_tags \u3001 always_first_tags \u3001 tag_replacement \u8bf7\u4e0d\u8981\u5305\u542b\u4e0b\u5212\u7ebf\u3002 \u6307\u5b9a caption_separator \u65f6\uff0c undesired_tags \u3001 always_first_tags \u8bf7\u7528 caption_separator \u5206\u9694\u3002 tag_replacement \u8bf7\u59cb\u7ec8\u7528 , \u5206\u9694\u3002","title":"\u6253\u6807"},{"location":"sd-scripts-docs/wd14_tagger/#wd14tagger","text":"\u6b64\u90e8\u5206\u7684\u8bf4\u660e\u53c2\u8003\u4e86\u8be5github\u9875\u9762\uff08https://github.com/toriato/stable-diffusion-webui-wd14-tagger#mrsmilingwolfs-model-aka-waifu-diffusion-14-tagger \uff09\u3002 \u5efa\u8bae\u4f7f\u7528onnx\u8fdb\u884c\u63a8\u7406\u3002\u8bf7\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5onnx\u3002 pip install onnx==1.15.0 onnxruntime-gpu==1.17.1 \u6a21\u578b\u7684\u6743\u91cd\u5c06\u4eceHugging Face\u81ea\u52a8\u4e0b\u8f7d\u3002","title":"\u4f7f\u7528WD14Tagger\u8fdb\u884c\u6807\u7b7e\u5316"},{"location":"sd-scripts-docs/wd14_tagger/#_1","text":"\u8fd0\u884c\u811a\u672c\u4ee5\u5bf9\u56fe\u50cf\u8fdb\u884c\u6807\u7b7e\u5316\u3002 python fintune/tag_images_by_wd14_tagger.py --onnx --repo_id <\u6a21\u578b\u7684repo id> --batch_size <\u6279\u5927\u5c0f> <\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u5939> \u5982\u679c\u4f7f\u7528 SmilingWolf/wd-swinv2-tagger-v3 \u4f5c\u4e3a\u4ed3\u5e93ID\uff0c\u5e76\u5c06\u6279\u5927\u5c0f\u8bbe\u7f6e\u4e3a4\uff0c\u540c\u65f6\u5c06\u8bad\u7ec3\u6570\u636e\u653e\u5728\u7236\u6587\u4ef6\u5939\u7684 train_data \u4e2d\uff0c\u5219\u547d\u4ee4\u5982\u4e0b\u3002 python tag_images_by_wd14_tagger.py --onnx --repo_id SmilingWolf/wd-swinv2-tagger-v3 --batch_size 4 ..\\train_data \u9996\u6b21\u8fd0\u884c\u65f6\uff0c\u6a21\u578b\u6587\u4ef6\u5c06\u81ea\u52a8\u4e0b\u8f7d\u5230 wd14_tagger_model \u6587\u4ef6\u5939\u4e2d\uff08\u6587\u4ef6\u5939\u8def\u5f84\u53ef\u901a\u8fc7\u9009\u9879\u66f4\u6539\uff09\u3002 \u6807\u7b7e\u6587\u4ef6\u5c06\u4e0e\u8bad\u7ec3\u6570\u636e\u56fe\u50cf\u5728\u540c\u4e00\u76ee\u5f55\u4e0b\u521b\u5efa\uff0c\u5177\u6709\u76f8\u540c\u7684\u6587\u4ef6\u540d\uff0c\u6269\u5c55\u540d\u4e3a.txt\u3002","title":"\u4f7f\u7528\u65b9\u6cd5"},{"location":"sd-scripts-docs/wd14_tagger/#_2","text":"\u5982\u679c\u8981\u4ee5Animagine XL 3.1 \u65b9\u5f0f\u8f93\u51fa\uff0c\u547d\u4ee4\u5982\u4e0b\uff08\u5b9e\u9645\u8f93\u5165\u65f6\u8bf7\u5728\u4e00\u884c\u5185\u8f93\u5165\uff09\u3002 python tag_images_by_wd14_tagger.py --onnx --repo_id SmilingWolf/wd-swinv2-tagger-v3 --batch_size 4 --remove_underscore --undesired_tags \"PUT,YOUR,UNDESIRED,TAGS\" --recursive --use_rating_tags_as_last_tag --character_tags_first --character_tag_expand --always_first_tags \"1girl,1boy\" ..\\train_data","title":"\u547d\u4ee4\u793a\u4f8b"},{"location":"sd-scripts-docs/wd14_tagger/#id","text":"\u53ef\u4ee5\u4f7f\u7528 SmilingWolf\u5148\u751f\u7684V2\u3001V3\u6a21\u578b \u3002\u8bf7\u6307\u5b9a\u4e3a SmilingWolf/wd-vit-tagger-v3 \u8fd9\u6837\u7684\u5f62\u5f0f\u3002\u9ed8\u8ba4\u503c\u4e3a SmilingWolf/wd-v1-4-convnext-tagger-v2 \u3002","title":"\u53ef\u7528\u7684\u4ed3\u5e93ID"},{"location":"sd-scripts-docs/wd14_tagger/#_3","text":"","title":"\u9009\u9879"},{"location":"sd-scripts-docs/wd14_tagger/#_4","text":"--onnx : \u4f7f\u7528ONNX\u8fdb\u884c\u63a8\u7406\u3002\u5982\u679c\u4e0d\u6307\u5b9a\uff0c\u5219\u4f7f\u7528TensorFlow\u3002\u4f7f\u7528TensorFlow\u65f6\u9700\u8981\u5355\u72ec\u5b89\u88c5TensorFlow\u3002 --batch_size : \u4e00\u6b21\u5904\u7406\u7684\u56fe\u50cf\u6570\u91cf\u3002\u9ed8\u8ba4\u503c\u4e3a1\u3002\u8bf7\u6839\u636eVRAM\u5bb9\u91cf\u8c03\u6574\u3002 --caption_extension : \u6807\u7b7e\u6587\u4ef6\u7684\u6269\u5c55\u540d\u3002\u9ed8\u8ba4\u503c\u4e3a .txt \u3002 --max_data_loader_n_workers : DataLoader\u7684\u6700\u5927\u5de5\u4f5c\u8fdb\u7a0b\u6570\u3002\u5982\u679c\u6307\u5b9a1\u6216\u66f4\u5927\u7684\u6570\u503c\uff0c\u5c06\u4f7f\u7528DataLoader\u52a0\u901f\u56fe\u50cf\u8bfb\u53d6\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0c\u5219\u4e0d\u4f7f\u7528DataLoader\u3002 --thresh : \u8f93\u51fa\u6807\u7b7e\u7684\u7f6e\u4fe1\u5ea6\u9608\u503c\u3002\u9ed8\u8ba4\u503c\u4e3a0.35\u3002\u964d\u4f4e\u6b64\u503c\u4f1a\u8f93\u51fa\u66f4\u591a\u6807\u7b7e\uff0c\u4f46\u51c6\u786e\u5ea6\u4f1a\u964d\u4f4e\u3002 --general_threshold : \u4e00\u822c\u6807\u7b7e\u7684\u7f6e\u4fe1\u5ea6\u9608\u503c\u3002\u5982\u679c\u7701\u7565\uff0c\u5219\u4e0e --thresh \u76f8\u540c\u3002 --character_threshold : \u89d2\u8272\u6807\u7b7e\u7684\u7f6e\u4fe1\u5ea6\u9608\u503c\u3002\u5982\u679c\u7701\u7565\uff0c\u5219\u4e0e --thresh \u76f8\u540c\u3002 --recursive : \u5982\u679c\u6307\u5b9a\uff0c\u5219\u9012\u5f52\u5904\u7406\u6307\u5b9a\u6587\u4ef6\u5939\u5185\u7684\u5b50\u6587\u4ef6\u5939\u3002 --append_tags : \u5411\u73b0\u6709\u7684\u6807\u7b7e\u6587\u4ef6\u8ffd\u52a0\u6807\u7b7e\u3002 --frequency_tags : \u8f93\u51fa\u6807\u7b7e\u7684\u9891\u7387\u3002 --debug : \u8c03\u8bd5\u6a21\u5f0f\u3002\u6307\u5b9a\u540e\u8f93\u51fa\u8c03\u8bd5\u4fe1\u606f\u3002","title":"\u5e38\u89c4\u9009\u9879"},{"location":"sd-scripts-docs/wd14_tagger/#_5","text":"--model_dir : \u6a21\u578b\u6587\u4ef6\u7684\u4fdd\u5b58\u76ee\u5f55\u3002\u9ed8\u8ba4\u503c\u4e3a wd14_tagger_model \u3002 --force_download : \u5982\u679c\u6307\u5b9a\uff0c\u5219\u91cd\u65b0\u4e0b\u8f7d\u6a21\u578b\u6587\u4ef6\u3002","title":"\u6a21\u578b\u4e0b\u8f7d"},{"location":"sd-scripts-docs/wd14_tagger/#_6","text":"--remove_underscore : \u4ece\u8f93\u51fa\u7684\u6807\u7b7e\u4e2d\u5220\u9664\u4e0b\u5212\u7ebf\u3002 --undesired_tags : \u6307\u5b9a\u4e0d\u8f93\u51fa\u7684\u6807\u7b7e\u3002\u53ef\u4ee5\u7528\u9017\u53f7\u5206\u9694\u591a\u4e2a\u6807\u7b7e\u3002\u4f8b\u5982 black eyes,black hair \u3002 --use_rating_tags : \u5728\u6807\u7b7e\u7684\u5f00\u5934\u8f93\u51fa\u5206\u7ea7\u6807\u7b7e\u3002 --use_rating_tags_as_last_tag : \u5728\u6807\u7b7e\u7684\u672b\u5c3e\u6dfb\u52a0\u5206\u7ea7\u6807\u7b7e\u3002 --character_tags_first : \u9996\u5148\u8f93\u51fa\u89d2\u8272\u6807\u7b7e\u3002 --character_tag_expand : \u5c55\u5f00\u89d2\u8272\u6807\u7b7e\u7684\u7cfb\u5217\u540d\u79f0\u3002\u4f8b\u5982\uff0c\u5c06 chara_name_(series) \u6807\u7b7e\u5206\u5272\u4e3a chara_name, series \u3002 --always_first_tags : \u5f53\u56fe\u50cf\u4e2d\u5b58\u5728\u67d0\u4e2a\u6807\u7b7e\u65f6\uff0c\u6307\u5b9a\u5c06\u5176\u653e\u5728\u6700\u524d\u9762\u7684\u6807\u7b7e\u3002\u53ef\u4ee5\u7528\u9017\u53f7\u5206\u9694\u591a\u4e2a\u6807\u7b7e\u3002\u4f8b\u5982 1girl,1boy \u3002 --caption_separator : \u5728\u8f93\u51fa\u6587\u4ef6\u4e2d\u7528\u6b64\u5b57\u7b26\u4e32\u5206\u9694\u6807\u7b7e\u3002\u9ed8\u8ba4\u503c\u4e3a , \u3002 --tag_replacement : \u8fdb\u884c\u6807\u7b7e\u66ff\u6362\u3002\u6307\u5b9a\u683c\u5f0f\u4e3a tag1,tag2;tag3,tag4 \u3002\u5982\u679c\u8981\u4f7f\u7528 , \u6216 ; \uff0c\u8bf7\u7528 \\ \u8fdb\u884c\u8f6c\u4e49\u3002 \u4f8b\u5982\uff0c aira tsubase,aira tsubase (uniform) \uff08\u5f53\u8981\u5b66\u4e60\u7279\u5b9a\u670d\u88c5\u65f6\uff09\uff0c aira tsubase,aira tsubase\\, heir of shadows \uff08\u5f53\u7cfb\u5217\u540d\u79f0\u672a\u5305\u542b\u5728\u6807\u7b7e\u4e2d\u65f6\uff09\u3002 tag_replacement \u5728 character_tag_expand \u4e4b\u540e\u5e94\u7528\u3002 \u6307\u5b9a remove_underscore \u65f6\uff0c undesired_tags \u3001 always_first_tags \u3001 tag_replacement \u8bf7\u4e0d\u8981\u5305\u542b\u4e0b\u5212\u7ebf\u3002 \u6307\u5b9a caption_separator \u65f6\uff0c undesired_tags \u3001 always_first_tags \u8bf7\u7528 caption_separator \u5206\u9694\u3002 tag_replacement \u8bf7\u59cb\u7ec8\u7528 , \u5206\u9694\u3002","title":"\u6807\u7b7e\u7f16\u8f91\u76f8\u5173"}]}